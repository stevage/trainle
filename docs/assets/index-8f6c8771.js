(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();function QE(t,e){const r=Object.create(null),n=t.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return e?i=>!!r[i.toLowerCase()]:i=>!!r[i]}const Di={},Pd=[],Ql=()=>{},ER=()=>!1,bR=/^on[^a-z]/,K0=t=>bR.test(t),eb=t=>t.startsWith("onUpdate:"),ys=Object.assign,tb=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},TR=Object.prototype.hasOwnProperty,Un=(t,e)=>TR.call(t,e),Fr=Array.isArray,Cd=t=>Y0(t)==="[object Map]",_A=t=>Y0(t)==="[object Set]",Kr=t=>typeof t=="function",Vo=t=>typeof t=="string",rb=t=>typeof t=="symbol",so=t=>t!==null&&typeof t=="object",vA=t=>so(t)&&Kr(t.then)&&Kr(t.catch),xA=Object.prototype.toString,Y0=t=>xA.call(t),SR=t=>Y0(t).slice(8,-1),wA=t=>Y0(t)==="[object Object]",nb=t=>Vo(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,l0=QE(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),J0=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},IR=/-(\w)/g,Rd=J0(t=>t.replace(IR,(e,r)=>r?r.toUpperCase():"")),PR=/\B([A-Z])/g,cg=J0(t=>t.replace(PR,"-$1").toLowerCase()),EA=J0(t=>t.charAt(0).toUpperCase()+t.slice(1)),_w=J0(t=>t?`on${EA(t)}`:""),x0=(t,e)=>!Object.is(t,e),u0=(t,e)=>{for(let r=0;r<t.length;r++)t[r](e)},w0=(t,e,r)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:r})},oE=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let v2;const sE=()=>v2||(v2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ib(t){if(Fr(t)){const e={};for(let r=0;r<t.length;r++){const n=t[r],i=Vo(n)?LR(n):ib(n);if(i)for(const a in i)e[a]=i[a]}return e}else{if(Vo(t))return t;if(so(t))return t}}const CR=/;(?![^(]*\))/g,AR=/:([^]+)/,MR=/\/\*[^]*?\*\//g;function LR(t){const e={};return t.replace(MR,"").split(CR).forEach(r=>{if(r){const n=r.split(AR);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function ob(t){let e="";if(Vo(t))e=t;else if(Fr(t))for(let r=0;r<t.length;r++){const n=ob(t[r]);n&&(e+=n+" ")}else if(so(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}const OR="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",DR=QE(OR);function bA(t){return!!t||t===""}const ql=t=>Vo(t)?t:t==null?"":Fr(t)||so(t)&&(t.toString===xA||!Kr(t.toString))?JSON.stringify(t,TA,2):String(t),TA=(t,e)=>e&&e.__v_isRef?TA(t,e.value):Cd(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((r,[n,i])=>(r[`${n} =>`]=i,r),{})}:_A(e)?{[`Set(${e.size})`]:[...e.values()]}:so(e)&&!Fr(e)&&!wA(e)?String(e):e;let Zl;class NR{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Zl,!e&&Zl&&(this.index=(Zl.scopes||(Zl.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const r=Zl;try{return Zl=this,e()}finally{Zl=r}}}on(){Zl=this}off(){Zl=this.parent}stop(e){if(this._active){let r,n;for(r=0,n=this.effects.length;r<n;r++)this.effects[r].stop();for(r=0,n=this.cleanups.length;r<n;r++)this.cleanups[r]();if(this.scopes)for(r=0,n=this.scopes.length;r<n;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this._active=!1}}}function RR(t,e=Zl){e&&e.active&&e.effects.push(t)}function kR(){return Zl}const sb=t=>{const e=new Set(t);return e.w=0,e.n=0,e},SA=t=>(t.w&Th)>0,IA=t=>(t.n&Th)>0,FR=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Th},zR=t=>{const{deps:e}=t;if(e.length){let r=0;for(let n=0;n<e.length;n++){const i=e[n];SA(i)&&!IA(i)?i.delete(t):e[r++]=i,i.w&=~Th,i.n&=~Th}e.length=r}},aE=new WeakMap;let ly=0,Th=1;const lE=30;let Hl;const Ff=Symbol(""),uE=Symbol("");class ab{constructor(e,r=null,n){this.fn=e,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,RR(this,n)}run(){if(!this.active)return this.fn();let e=Hl,r=xh;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Hl,Hl=this,xh=!0,Th=1<<++ly,ly<=lE?FR(this):x2(this),this.fn()}finally{ly<=lE&&zR(this),Th=1<<--ly,Hl=this.parent,xh=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Hl===this?this.deferStop=!0:this.active&&(x2(this),this.onStop&&this.onStop(),this.active=!1)}}function x2(t){const{deps:e}=t;if(e.length){for(let r=0;r<e.length;r++)e[r].delete(t);e.length=0}}let xh=!0;const PA=[];function hg(){PA.push(xh),xh=!1}function fg(){const t=PA.pop();xh=t===void 0?!0:t}function da(t,e,r){if(xh&&Hl){let n=aE.get(t);n||aE.set(t,n=new Map);let i=n.get(r);i||n.set(r,i=sb()),CA(i)}}function CA(t,e){let r=!1;ly<=lE?IA(t)||(t.n|=Th,r=!SA(t)):r=!t.has(Hl),r&&(t.add(Hl),Hl.deps.push(t))}function Ec(t,e,r,n,i,a){const h=aE.get(t);if(!h)return;let s=[];if(e==="clear")s=[...h.values()];else if(r==="length"&&Fr(t)){const g=Number(n);h.forEach((m,w)=>{(w==="length"||w>=g)&&s.push(m)})}else switch(r!==void 0&&s.push(h.get(r)),e){case"add":Fr(t)?nb(r)&&s.push(h.get("length")):(s.push(h.get(Ff)),Cd(t)&&s.push(h.get(uE)));break;case"delete":Fr(t)||(s.push(h.get(Ff)),Cd(t)&&s.push(h.get(uE)));break;case"set":Cd(t)&&s.push(h.get(Ff));break}if(s.length===1)s[0]&&cE(s[0]);else{const g=[];for(const m of s)m&&g.push(...m);cE(sb(g))}}function cE(t,e){const r=Fr(t)?t:[...t];for(const n of r)n.computed&&w2(n);for(const n of r)n.computed||w2(n)}function w2(t,e){(t!==Hl||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const BR=QE("__proto__,__v_isRef,__isVue"),AA=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(rb)),UR=lb(),GR=lb(!1,!0),VR=lb(!0),E2=jR();function jR(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...r){const n=ui(this);for(let a=0,h=this.length;a<h;a++)da(n,"get",a+"");const i=n[e](...r);return i===-1||i===!1?n[e](...r.map(ui)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...r){hg();const n=ui(this)[e].apply(this,r);return fg(),n}}),t}function qR(t){const e=ui(this);return da(e,"has",t),e.hasOwnProperty(t)}function lb(t=!1,e=!1){return function(n,i,a){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&a===(t?e?s4:NA:e?DA:OA).get(n))return n;const h=Fr(n);if(!t){if(h&&Un(E2,i))return Reflect.get(E2,i,a);if(i==="hasOwnProperty")return qR}const s=Reflect.get(n,i,a);return(rb(i)?AA.has(i):BR(i))||(t||da(n,"get",i),e)?s:qs(s)?h&&nb(i)?s:s.value:so(s)?t?RA(s):hb(s):s}}const $R=MA(),ZR=MA(!0);function MA(t=!1){return function(r,n,i,a){let h=r[n];if(Ey(h)&&qs(h)&&!qs(i))return!1;if(!t&&(!hE(i)&&!Ey(i)&&(h=ui(h),i=ui(i)),!Fr(r)&&qs(h)&&!qs(i)))return h.value=i,!0;const s=Fr(r)&&nb(n)?Number(n)<r.length:Un(r,n),g=Reflect.set(r,n,i,a);return r===ui(a)&&(s?x0(i,h)&&Ec(r,"set",n,i):Ec(r,"add",n,i)),g}}function XR(t,e){const r=Un(t,e);t[e];const n=Reflect.deleteProperty(t,e);return n&&r&&Ec(t,"delete",e,void 0),n}function WR(t,e){const r=Reflect.has(t,e);return(!rb(e)||!AA.has(e))&&da(t,"has",e),r}function HR(t){return da(t,"iterate",Fr(t)?"length":Ff),Reflect.ownKeys(t)}const LA={get:UR,set:$R,deleteProperty:XR,has:WR,ownKeys:HR},KR={get:VR,set(t,e){return!0},deleteProperty(t,e){return!0}},YR=ys({},LA,{get:GR,set:ZR}),ub=t=>t,Q0=t=>Reflect.getPrototypeOf(t);function Vv(t,e,r=!1,n=!1){t=t.__v_raw;const i=ui(t),a=ui(e);r||(e!==a&&da(i,"get",e),da(i,"get",a));const{has:h}=Q0(i),s=n?ub:r?db:pb;if(h.call(i,e))return s(t.get(e));if(h.call(i,a))return s(t.get(a));t!==i&&t.get(e)}function jv(t,e=!1){const r=this.__v_raw,n=ui(r),i=ui(t);return e||(t!==i&&da(n,"has",t),da(n,"has",i)),t===i?r.has(t):r.has(t)||r.has(i)}function qv(t,e=!1){return t=t.__v_raw,!e&&da(ui(t),"iterate",Ff),Reflect.get(t,"size",t)}function b2(t){t=ui(t);const e=ui(this);return Q0(e).has.call(e,t)||(e.add(t),Ec(e,"add",t,t)),this}function T2(t,e){e=ui(e);const r=ui(this),{has:n,get:i}=Q0(r);let a=n.call(r,t);a||(t=ui(t),a=n.call(r,t));const h=i.call(r,t);return r.set(t,e),a?x0(e,h)&&Ec(r,"set",t,e):Ec(r,"add",t,e),this}function S2(t){const e=ui(this),{has:r,get:n}=Q0(e);let i=r.call(e,t);i||(t=ui(t),i=r.call(e,t)),n&&n.call(e,t);const a=e.delete(t);return i&&Ec(e,"delete",t,void 0),a}function I2(){const t=ui(this),e=t.size!==0,r=t.clear();return e&&Ec(t,"clear",void 0,void 0),r}function $v(t,e){return function(n,i){const a=this,h=a.__v_raw,s=ui(h),g=e?ub:t?db:pb;return!t&&da(s,"iterate",Ff),h.forEach((m,w)=>n.call(i,g(m),g(w),a))}}function Zv(t,e,r){return function(...n){const i=this.__v_raw,a=ui(i),h=Cd(a),s=t==="entries"||t===Symbol.iterator&&h,g=t==="keys"&&h,m=i[t](...n),w=r?ub:e?db:pb;return!e&&da(a,"iterate",g?uE:Ff),{next(){const{value:b,done:I}=m.next();return I?{value:b,done:I}:{value:s?[w(b[0]),w(b[1])]:w(b),done:I}},[Symbol.iterator](){return this}}}}function ph(t){return function(...e){return t==="delete"?!1:this}}function JR(){const t={get(a){return Vv(this,a)},get size(){return qv(this)},has:jv,add:b2,set:T2,delete:S2,clear:I2,forEach:$v(!1,!1)},e={get(a){return Vv(this,a,!1,!0)},get size(){return qv(this)},has:jv,add:b2,set:T2,delete:S2,clear:I2,forEach:$v(!1,!0)},r={get(a){return Vv(this,a,!0)},get size(){return qv(this,!0)},has(a){return jv.call(this,a,!0)},add:ph("add"),set:ph("set"),delete:ph("delete"),clear:ph("clear"),forEach:$v(!0,!1)},n={get(a){return Vv(this,a,!0,!0)},get size(){return qv(this,!0)},has(a){return jv.call(this,a,!0)},add:ph("add"),set:ph("set"),delete:ph("delete"),clear:ph("clear"),forEach:$v(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(a=>{t[a]=Zv(a,!1,!1),r[a]=Zv(a,!0,!1),e[a]=Zv(a,!1,!0),n[a]=Zv(a,!0,!0)}),[t,r,e,n]}const[QR,e4,t4,r4]=JR();function cb(t,e){const r=e?t?r4:t4:t?e4:QR;return(n,i,a)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?n:Reflect.get(Un(r,i)&&i in n?r:n,i,a)}const n4={get:cb(!1,!1)},i4={get:cb(!1,!0)},o4={get:cb(!0,!1)},OA=new WeakMap,DA=new WeakMap,NA=new WeakMap,s4=new WeakMap;function a4(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function l4(t){return t.__v_skip||!Object.isExtensible(t)?0:a4(SR(t))}function hb(t){return Ey(t)?t:fb(t,!1,LA,n4,OA)}function u4(t){return fb(t,!1,YR,i4,DA)}function RA(t){return fb(t,!0,KR,o4,NA)}function fb(t,e,r,n,i){if(!so(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const a=i.get(t);if(a)return a;const h=l4(t);if(h===0)return t;const s=new Proxy(t,h===2?n:r);return i.set(t,s),s}function Ad(t){return Ey(t)?Ad(t.__v_raw):!!(t&&t.__v_isReactive)}function Ey(t){return!!(t&&t.__v_isReadonly)}function hE(t){return!!(t&&t.__v_isShallow)}function kA(t){return Ad(t)||Ey(t)}function ui(t){const e=t&&t.__v_raw;return e?ui(e):t}function FA(t){return w0(t,"__v_skip",!0),t}const pb=t=>so(t)?hb(t):t,db=t=>so(t)?RA(t):t;function c4(t){xh&&Hl&&(t=ui(t),CA(t.dep||(t.dep=sb())))}function h4(t,e){t=ui(t);const r=t.dep;r&&cE(r)}function qs(t){return!!(t&&t.__v_isRef===!0)}function f4(t){return qs(t)?t.value:t}const p4={get:(t,e,r)=>f4(Reflect.get(t,e,r)),set:(t,e,r,n)=>{const i=t[e];return qs(i)&&!qs(r)?(i.value=r,!0):Reflect.set(t,e,r,n)}};function zA(t){return Ad(t)?t:new Proxy(t,p4)}class d4{constructor(e,r,n,i){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new ab(e,()=>{this._dirty||(this._dirty=!0,h4(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const e=ui(this);return c4(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function g4(t,e,r=!1){let n,i;const a=Kr(t);return a?(n=t,i=Ql):(n=t.get,i=t.set),new d4(n,i,a||!i,r)}function wh(t,e,r,n){let i;try{i=n?t(...n):t()}catch(a){e1(a,e,r)}return i}function eu(t,e,r,n){if(Kr(t)){const a=wh(t,e,r,n);return a&&vA(a)&&a.catch(h=>{e1(h,e,r)}),a}const i=[];for(let a=0;a<t.length;a++)i.push(eu(t[a],e,r,n));return i}function e1(t,e,r,n=!0){const i=e?e.vnode:null;if(e){let a=e.parent;const h=e.proxy,s=r;for(;a;){const m=a.ec;if(m){for(let w=0;w<m.length;w++)if(m[w](t,h,s)===!1)return}a=a.parent}const g=e.appContext.config.errorHandler;if(g){wh(g,null,10,[t,h,s]);return}}m4(t,r,i,n)}function m4(t,e,r,n=!0){console.error(t)}let by=!1,fE=!1;const Ms=[];let Du=0;const Md=[];let dc=null,Lf=0;const BA=Promise.resolve();let gb=null;function y4(t){const e=gb||BA;return t?e.then(this?t.bind(this):t):e}function _4(t){let e=Du+1,r=Ms.length;for(;e<r;){const n=e+r>>>1;Ty(Ms[n])<t?e=n+1:r=n}return e}function mb(t){(!Ms.length||!Ms.includes(t,by&&t.allowRecurse?Du+1:Du))&&(t.id==null?Ms.push(t):Ms.splice(_4(t.id),0,t),UA())}function UA(){!by&&!fE&&(fE=!0,gb=BA.then(VA))}function v4(t){const e=Ms.indexOf(t);e>Du&&Ms.splice(e,1)}function x4(t){Fr(t)?Md.push(...t):(!dc||!dc.includes(t,t.allowRecurse?Lf+1:Lf))&&Md.push(t),UA()}function P2(t,e=by?Du+1:0){for(;e<Ms.length;e++){const r=Ms[e];r&&r.pre&&(Ms.splice(e,1),e--,r())}}function GA(t){if(Md.length){const e=[...new Set(Md)];if(Md.length=0,dc){dc.push(...e);return}for(dc=e,dc.sort((r,n)=>Ty(r)-Ty(n)),Lf=0;Lf<dc.length;Lf++)dc[Lf]();dc=null,Lf=0}}const Ty=t=>t.id==null?1/0:t.id,w4=(t,e)=>{const r=Ty(t)-Ty(e);if(r===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return r};function VA(t){fE=!1,by=!0,Ms.sort(w4);const e=Ql;try{for(Du=0;Du<Ms.length;Du++){const r=Ms[Du];r&&r.active!==!1&&wh(r,null,14)}}finally{Du=0,Ms.length=0,GA(),by=!1,gb=null,(Ms.length||Md.length)&&VA()}}function E4(t,e,...r){if(t.isUnmounted)return;const n=t.vnode.props||Di;let i=r;const a=e.startsWith("update:"),h=a&&e.slice(7);if(h&&h in n){const w=`${h==="modelValue"?"model":h}Modifiers`,{number:b,trim:I}=n[w]||Di;I&&(i=r.map(A=>Vo(A)?A.trim():A)),b&&(i=r.map(oE))}let s,g=n[s=_w(e)]||n[s=_w(Rd(e))];!g&&a&&(g=n[s=_w(cg(e))]),g&&eu(g,t,6,i);const m=n[s+"Once"];if(m){if(!t.emitted)t.emitted={};else if(t.emitted[s])return;t.emitted[s]=!0,eu(m,t,6,i)}}function jA(t,e,r=!1){const n=e.emitsCache,i=n.get(t);if(i!==void 0)return i;const a=t.emits;let h={},s=!1;if(!Kr(t)){const g=m=>{const w=jA(m,e,!0);w&&(s=!0,ys(h,w))};!r&&e.mixins.length&&e.mixins.forEach(g),t.extends&&g(t.extends),t.mixins&&t.mixins.forEach(g)}return!a&&!s?(so(t)&&n.set(t,null),null):(Fr(a)?a.forEach(g=>h[g]=null):ys(h,a),so(t)&&n.set(t,h),h)}function t1(t,e){return!t||!K0(e)?!1:(e=e.slice(2).replace(/Once$/,""),Un(t,e[0].toLowerCase()+e.slice(1))||Un(t,cg(e))||Un(t,e))}let Kl=null,qA=null;function E0(t){const e=Kl;return Kl=t,qA=t&&t.type.__scopeId||null,e}function b4(t,e=Kl,r){if(!e||t._n)return t;const n=(...i)=>{n._d&&z2(-1);const a=E0(e);let h;try{h=t(...i)}finally{E0(a),n._d&&z2(1)}return h};return n._n=!0,n._c=!0,n._d=!0,n}function vw(t){const{type:e,vnode:r,proxy:n,withProxy:i,props:a,propsOptions:[h],slots:s,attrs:g,emit:m,render:w,renderCache:b,data:I,setupState:A,ctx:z,inheritAttrs:V}=t;let H,Z;const D=E0(t);try{if(r.shapeFlag&4){const j=i||n;H=Ou(w.call(j,j,b,a,A,I,z)),Z=g}else{const j=e;H=Ou(j.length>1?j(a,{attrs:g,slots:s,emit:m}):j(a,null)),Z=e.props?g:T4(g)}}catch(j){vy.length=0,e1(j,t,1),H=Ru(Gf)}let k=H;if(Z&&V!==!1){const j=Object.keys(Z),{shapeFlag:Y}=k;j.length&&Y&7&&(h&&j.some(eb)&&(Z=S4(Z,h)),k=kd(k,Z))}return r.dirs&&(k=kd(k),k.dirs=k.dirs?k.dirs.concat(r.dirs):r.dirs),r.transition&&(k.transition=r.transition),H=k,E0(D),H}const T4=t=>{let e;for(const r in t)(r==="class"||r==="style"||K0(r))&&((e||(e={}))[r]=t[r]);return e},S4=(t,e)=>{const r={};for(const n in t)(!eb(n)||!(n.slice(9)in e))&&(r[n]=t[n]);return r};function I4(t,e,r){const{props:n,children:i,component:a}=t,{props:h,children:s,patchFlag:g}=e,m=a.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&g>=0){if(g&1024)return!0;if(g&16)return n?C2(n,h,m):!!h;if(g&8){const w=e.dynamicProps;for(let b=0;b<w.length;b++){const I=w[b];if(h[I]!==n[I]&&!t1(m,I))return!0}}}else return(i||s)&&(!s||!s.$stable)?!0:n===h?!1:n?h?C2(n,h,m):!0:!!h;return!1}function C2(t,e,r){const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(let i=0;i<n.length;i++){const a=n[i];if(e[a]!==t[a]&&!t1(r,a))return!0}return!1}function P4({vnode:t,parent:e},r){for(;e&&e.subTree===t;)(t=e.vnode).el=r,e=e.parent}const C4=t=>t.__isSuspense;function A4(t,e){e&&e.pendingBranch?Fr(t)?e.effects.push(...t):e.effects.push(t):x4(t)}const Xv={};function xw(t,e,r){return $A(t,e,r)}function $A(t,e,{immediate:r,deep:n,flush:i,onTrack:a,onTrigger:h}=Di){var s;const g=kR()===((s=Ls)==null?void 0:s.scope)?Ls:null;let m,w=!1,b=!1;if(qs(t)?(m=()=>t.value,w=hE(t)):Ad(t)?(m=()=>t,n=!0):Fr(t)?(b=!0,w=t.some(j=>Ad(j)||hE(j)),m=()=>t.map(j=>{if(qs(j))return j.value;if(Ad(j))return Rf(j);if(Kr(j))return wh(j,g,2)})):Kr(t)?e?m=()=>wh(t,g,2):m=()=>{if(!(g&&g.isUnmounted))return I&&I(),eu(t,g,3,[A])}:m=Ql,e&&n){const j=m;m=()=>Rf(j())}let I,A=j=>{I=D.onStop=()=>{wh(j,g,4)}},z;if(Py)if(A=Ql,e?r&&eu(e,g,3,[m(),b?[]:void 0,A]):m(),i==="sync"){const j=S5();z=j.__watcherHandles||(j.__watcherHandles=[])}else return Ql;let V=b?new Array(t.length).fill(Xv):Xv;const H=()=>{if(D.active)if(e){const j=D.run();(n||w||(b?j.some((Y,ie)=>x0(Y,V[ie])):x0(j,V)))&&(I&&I(),eu(e,g,3,[j,V===Xv?void 0:b&&V[0]===Xv?[]:V,A]),V=j)}else D.run()};H.allowRecurse=!!e;let Z;i==="sync"?Z=H:i==="post"?Z=()=>ua(H,g&&g.suspense):(H.pre=!0,g&&(H.id=g.uid),Z=()=>mb(H));const D=new ab(m,Z);e?r?H():V=D.run():i==="post"?ua(D.run.bind(D),g&&g.suspense):D.run();const k=()=>{D.stop(),g&&g.scope&&tb(g.scope.effects,D)};return z&&z.push(k),k}function M4(t,e,r){const n=this.proxy,i=Vo(t)?t.includes(".")?ZA(n,t):()=>n[t]:t.bind(n,n);let a;Kr(e)?a=e:(a=e.handler,r=e);const h=Ls;Fd(this);const s=$A(i,a.bind(n),r);return h?Fd(h):zf(),s}function ZA(t,e){const r=e.split(".");return()=>{let n=t;for(let i=0;i<r.length&&n;i++)n=n[r[i]];return n}}function Rf(t,e){if(!so(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),qs(t))Rf(t.value,e);else if(Fr(t))for(let r=0;r<t.length;r++)Rf(t[r],e);else if(_A(t)||Cd(t))t.forEach(r=>{Rf(r,e)});else if(wA(t))for(const r in t)Rf(t[r],e);return t}function L4(t,e){const r=Kl;if(r===null)return t;const n=o1(r)||r.proxy,i=t.dirs||(t.dirs=[]);for(let a=0;a<e.length;a++){let[h,s,g,m=Di]=e[a];h&&(Kr(h)&&(h={mounted:h,updated:h}),h.deep&&Rf(s),i.push({dir:h,instance:n,value:s,oldValue:void 0,arg:g,modifiers:m}))}return t}function Cf(t,e,r,n){const i=t.dirs,a=e&&e.dirs;for(let h=0;h<i.length;h++){const s=i[h];a&&(s.oldValue=a[h].value);let g=s.dir[n];g&&(hg(),eu(g,r,8,[t.el,s,t,e]),fg())}}const c0=t=>!!t.type.__asyncLoader,XA=t=>t.type.__isKeepAlive;function O4(t,e){WA(t,"a",e)}function D4(t,e){WA(t,"da",e)}function WA(t,e,r=Ls){const n=t.__wdc||(t.__wdc=()=>{let i=r;for(;i;){if(i.isDeactivated)return;i=i.parent}return t()});if(r1(e,n,r),r){let i=r.parent;for(;i&&i.parent;)XA(i.parent.vnode)&&N4(n,e,r,i),i=i.parent}}function N4(t,e,r,n){const i=r1(e,t,n,!0);HA(()=>{tb(n[e],i)},r)}function r1(t,e,r=Ls,n=!1){if(r){const i=r[t]||(r[t]=[]),a=e.__weh||(e.__weh=(...h)=>{if(r.isUnmounted)return;hg(),Fd(r);const s=eu(e,r,t,h);return zf(),fg(),s});return n?i.unshift(a):i.push(a),a}}const Dc=t=>(e,r=Ls)=>(!Py||t==="sp")&&r1(t,(...n)=>e(...n),r),R4=Dc("bm"),k4=Dc("m"),F4=Dc("bu"),z4=Dc("u"),B4=Dc("bum"),HA=Dc("um"),U4=Dc("sp"),G4=Dc("rtg"),V4=Dc("rtc");function j4(t,e=Ls){r1("ec",t,e)}const q4=Symbol.for("v-ndc");function A2(t,e,r,n){let i;const a=r&&r[n];if(Fr(t)||Vo(t)){i=new Array(t.length);for(let h=0,s=t.length;h<s;h++)i[h]=e(t[h],h,void 0,a&&a[h])}else if(typeof t=="number"){i=new Array(t);for(let h=0;h<t;h++)i[h]=e(h+1,h,void 0,a&&a[h])}else if(so(t))if(t[Symbol.iterator])i=Array.from(t,(h,s)=>e(h,s,void 0,a&&a[s]));else{const h=Object.keys(t);i=new Array(h.length);for(let s=0,g=h.length;s<g;s++){const m=h[s];i[s]=e(t[m],m,s,a&&a[s])}}else i=[];return r&&(r[n]=i),i}const pE=t=>t?sM(t)?o1(t)||t.proxy:pE(t.parent):null,_y=ys(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>pE(t.parent),$root:t=>pE(t.root),$emit:t=>t.emit,$options:t=>yb(t),$forceUpdate:t=>t.f||(t.f=()=>mb(t.update)),$nextTick:t=>t.n||(t.n=y4.bind(t.proxy)),$watch:t=>M4.bind(t)}),ww=(t,e)=>t!==Di&&!t.__isScriptSetup&&Un(t,e),$4={get({_:t},e){const{ctx:r,setupState:n,data:i,props:a,accessCache:h,type:s,appContext:g}=t;let m;if(e[0]!=="$"){const A=h[e];if(A!==void 0)switch(A){case 1:return n[e];case 2:return i[e];case 4:return r[e];case 3:return a[e]}else{if(ww(n,e))return h[e]=1,n[e];if(i!==Di&&Un(i,e))return h[e]=2,i[e];if((m=t.propsOptions[0])&&Un(m,e))return h[e]=3,a[e];if(r!==Di&&Un(r,e))return h[e]=4,r[e];dE&&(h[e]=0)}}const w=_y[e];let b,I;if(w)return e==="$attrs"&&da(t,"get",e),w(t);if((b=s.__cssModules)&&(b=b[e]))return b;if(r!==Di&&Un(r,e))return h[e]=4,r[e];if(I=g.config.globalProperties,Un(I,e))return I[e]},set({_:t},e,r){const{data:n,setupState:i,ctx:a}=t;return ww(i,e)?(i[e]=r,!0):n!==Di&&Un(n,e)?(n[e]=r,!0):Un(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(a[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:n,appContext:i,propsOptions:a}},h){let s;return!!r[h]||t!==Di&&Un(t,h)||ww(e,h)||(s=a[0])&&Un(s,h)||Un(n,h)||Un(_y,h)||Un(i.config.globalProperties,h)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:Un(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}};function M2(t){return Fr(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}let dE=!0;function Z4(t){const e=yb(t),r=t.proxy,n=t.ctx;dE=!1,e.beforeCreate&&L2(e.beforeCreate,t,"bc");const{data:i,computed:a,methods:h,watch:s,provide:g,inject:m,created:w,beforeMount:b,mounted:I,beforeUpdate:A,updated:z,activated:V,deactivated:H,beforeDestroy:Z,beforeUnmount:D,destroyed:k,unmounted:j,render:Y,renderTracked:ie,renderTriggered:ne,errorCaptured:ae,serverPrefetch:W,expose:$e,inheritAttrs:Oe,components:ze,directives:We,filters:Ze}=e;if(m&&X4(m,n,null),h)for(const St in h){const et=h[St];Kr(et)&&(n[St]=et.bind(r))}if(i){const St=i.call(r,r);so(St)&&(t.data=hb(St))}if(dE=!0,a)for(const St in a){const et=a[St],zt=Kr(et)?et.bind(r,r):Kr(et.get)?et.get.bind(r,r):Ql,mt=!Kr(et)&&Kr(et.set)?et.set.bind(r):Ql,bt=b5({get:zt,set:mt});Object.defineProperty(n,St,{enumerable:!0,configurable:!0,get:()=>bt.value,set:It=>bt.value=It})}if(s)for(const St in s)KA(s[St],n,r,St);if(g){const St=Kr(g)?g.call(r):g;Reflect.ownKeys(St).forEach(et=>{Q4(et,St[et])})}w&&L2(w,t,"c");function at(St,et){Fr(et)?et.forEach(zt=>St(zt.bind(r))):et&&St(et.bind(r))}if(at(R4,b),at(k4,I),at(F4,A),at(z4,z),at(O4,V),at(D4,H),at(j4,ae),at(V4,ie),at(G4,ne),at(B4,D),at(HA,j),at(U4,W),Fr($e))if($e.length){const St=t.exposed||(t.exposed={});$e.forEach(et=>{Object.defineProperty(St,et,{get:()=>r[et],set:zt=>r[et]=zt})})}else t.exposed||(t.exposed={});Y&&t.render===Ql&&(t.render=Y),Oe!=null&&(t.inheritAttrs=Oe),ze&&(t.components=ze),We&&(t.directives=We)}function X4(t,e,r=Ql){Fr(t)&&(t=gE(t));for(const n in t){const i=t[n];let a;so(i)?"default"in i?a=h0(i.from||n,i.default,!0):a=h0(i.from||n):a=h0(i),qs(a)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>a.value,set:h=>a.value=h}):e[n]=a}}function L2(t,e,r){eu(Fr(t)?t.map(n=>n.bind(e.proxy)):t.bind(e.proxy),e,r)}function KA(t,e,r,n){const i=n.includes(".")?ZA(r,n):()=>r[n];if(Vo(t)){const a=e[t];Kr(a)&&xw(i,a)}else if(Kr(t))xw(i,t.bind(r));else if(so(t))if(Fr(t))t.forEach(a=>KA(a,e,r,n));else{const a=Kr(t.handler)?t.handler.bind(r):e[t.handler];Kr(a)&&xw(i,a,t)}}function yb(t){const e=t.type,{mixins:r,extends:n}=e,{mixins:i,optionsCache:a,config:{optionMergeStrategies:h}}=t.appContext,s=a.get(e);let g;return s?g=s:!i.length&&!r&&!n?g=e:(g={},i.length&&i.forEach(m=>b0(g,m,h,!0)),b0(g,e,h)),so(e)&&a.set(e,g),g}function b0(t,e,r,n=!1){const{mixins:i,extends:a}=e;a&&b0(t,a,r,!0),i&&i.forEach(h=>b0(t,h,r,!0));for(const h in e)if(!(n&&h==="expose")){const s=W4[h]||r&&r[h];t[h]=s?s(t[h],e[h]):e[h]}return t}const W4={data:O2,props:D2,emits:D2,methods:uy,computed:uy,beforeCreate:Vs,created:Vs,beforeMount:Vs,mounted:Vs,beforeUpdate:Vs,updated:Vs,beforeDestroy:Vs,beforeUnmount:Vs,destroyed:Vs,unmounted:Vs,activated:Vs,deactivated:Vs,errorCaptured:Vs,serverPrefetch:Vs,components:uy,directives:uy,watch:K4,provide:O2,inject:H4};function O2(t,e){return e?t?function(){return ys(Kr(t)?t.call(this,this):t,Kr(e)?e.call(this,this):e)}:e:t}function H4(t,e){return uy(gE(t),gE(e))}function gE(t){if(Fr(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function Vs(t,e){return t?[...new Set([].concat(t,e))]:e}function uy(t,e){return t?ys(Object.create(null),t,e):e}function D2(t,e){return t?Fr(t)&&Fr(e)?[...new Set([...t,...e])]:ys(Object.create(null),M2(t),M2(e??{})):e}function K4(t,e){if(!t)return e;if(!e)return t;const r=ys(Object.create(null),t);for(const n in e)r[n]=Vs(t[n],e[n]);return r}function YA(){return{app:null,config:{isNativeTag:ER,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Y4=0;function J4(t,e){return function(n,i=null){Kr(n)||(n=ys({},n)),i!=null&&!so(i)&&(i=null);const a=YA(),h=new Set;let s=!1;const g=a.app={_uid:Y4++,_component:n,_props:i,_container:null,_context:a,_instance:null,version:I5,get config(){return a.config},set config(m){},use(m,...w){return h.has(m)||(m&&Kr(m.install)?(h.add(m),m.install(g,...w)):Kr(m)&&(h.add(m),m(g,...w))),g},mixin(m){return a.mixins.includes(m)||a.mixins.push(m),g},component(m,w){return w?(a.components[m]=w,g):a.components[m]},directive(m,w){return w?(a.directives[m]=w,g):a.directives[m]},mount(m,w,b){if(!s){const I=Ru(n,i);return I.appContext=a,w&&e?e(I,m):t(I,m,b),s=!0,g._container=m,m.__vue_app__=g,o1(I.component)||I.component.proxy}},unmount(){s&&(t(null,g._container),delete g._container.__vue_app__)},provide(m,w){return a.provides[m]=w,g},runWithContext(m){T0=g;try{return m()}finally{T0=null}}};return g}}let T0=null;function Q4(t,e){if(Ls){let r=Ls.provides;const n=Ls.parent&&Ls.parent.provides;n===r&&(r=Ls.provides=Object.create(n)),r[t]=e}}function h0(t,e,r=!1){const n=Ls||Kl;if(n||T0){const i=n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:T0._context.provides;if(i&&t in i)return i[t];if(arguments.length>1)return r&&Kr(e)?e.call(n&&n.proxy):e}}function e5(t,e,r,n=!1){const i={},a={};w0(a,i1,1),t.propsDefaults=Object.create(null),JA(t,e,i,a);for(const h in t.propsOptions[0])h in i||(i[h]=void 0);r?t.props=n?i:u4(i):t.type.props?t.props=i:t.props=a,t.attrs=a}function t5(t,e,r,n){const{props:i,attrs:a,vnode:{patchFlag:h}}=t,s=ui(i),[g]=t.propsOptions;let m=!1;if((n||h>0)&&!(h&16)){if(h&8){const w=t.vnode.dynamicProps;for(let b=0;b<w.length;b++){let I=w[b];if(t1(t.emitsOptions,I))continue;const A=e[I];if(g)if(Un(a,I))A!==a[I]&&(a[I]=A,m=!0);else{const z=Rd(I);i[z]=mE(g,s,z,A,t,!1)}else A!==a[I]&&(a[I]=A,m=!0)}}}else{JA(t,e,i,a)&&(m=!0);let w;for(const b in s)(!e||!Un(e,b)&&((w=cg(b))===b||!Un(e,w)))&&(g?r&&(r[b]!==void 0||r[w]!==void 0)&&(i[b]=mE(g,s,b,void 0,t,!0)):delete i[b]);if(a!==s)for(const b in a)(!e||!Un(e,b))&&(delete a[b],m=!0)}m&&Ec(t,"set","$attrs")}function JA(t,e,r,n){const[i,a]=t.propsOptions;let h=!1,s;if(e)for(let g in e){if(l0(g))continue;const m=e[g];let w;i&&Un(i,w=Rd(g))?!a||!a.includes(w)?r[w]=m:(s||(s={}))[w]=m:t1(t.emitsOptions,g)||(!(g in n)||m!==n[g])&&(n[g]=m,h=!0)}if(a){const g=ui(r),m=s||Di;for(let w=0;w<a.length;w++){const b=a[w];r[b]=mE(i,g,b,m[b],t,!Un(m,b))}}return h}function mE(t,e,r,n,i,a){const h=t[r];if(h!=null){const s=Un(h,"default");if(s&&n===void 0){const g=h.default;if(h.type!==Function&&!h.skipFactory&&Kr(g)){const{propsDefaults:m}=i;r in m?n=m[r]:(Fd(i),n=m[r]=g.call(null,e),zf())}else n=g}h[0]&&(a&&!s?n=!1:h[1]&&(n===""||n===cg(r))&&(n=!0))}return n}function QA(t,e,r=!1){const n=e.propsCache,i=n.get(t);if(i)return i;const a=t.props,h={},s=[];let g=!1;if(!Kr(t)){const w=b=>{g=!0;const[I,A]=QA(b,e,!0);ys(h,I),A&&s.push(...A)};!r&&e.mixins.length&&e.mixins.forEach(w),t.extends&&w(t.extends),t.mixins&&t.mixins.forEach(w)}if(!a&&!g)return so(t)&&n.set(t,Pd),Pd;if(Fr(a))for(let w=0;w<a.length;w++){const b=Rd(a[w]);N2(b)&&(h[b]=Di)}else if(a)for(const w in a){const b=Rd(w);if(N2(b)){const I=a[w],A=h[b]=Fr(I)||Kr(I)?{type:I}:ys({},I);if(A){const z=F2(Boolean,A.type),V=F2(String,A.type);A[0]=z>-1,A[1]=V<0||z<V,(z>-1||Un(A,"default"))&&s.push(b)}}}const m=[h,s];return so(t)&&n.set(t,m),m}function N2(t){return t[0]!=="$"}function R2(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:t===null?"null":""}function k2(t,e){return R2(t)===R2(e)}function F2(t,e){return Fr(e)?e.findIndex(r=>k2(r,t)):Kr(e)&&k2(e,t)?0:-1}const eM=t=>t[0]==="_"||t==="$stable",_b=t=>Fr(t)?t.map(Ou):[Ou(t)],r5=(t,e,r)=>{if(e._n)return e;const n=b4((...i)=>_b(e(...i)),r);return n._c=!1,n},tM=(t,e,r)=>{const n=t._ctx;for(const i in t){if(eM(i))continue;const a=t[i];if(Kr(a))e[i]=r5(i,a,n);else if(a!=null){const h=_b(a);e[i]=()=>h}}},rM=(t,e)=>{const r=_b(e);t.slots.default=()=>r},n5=(t,e)=>{if(t.vnode.shapeFlag&32){const r=e._;r?(t.slots=ui(e),w0(e,"_",r)):tM(e,t.slots={})}else t.slots={},e&&rM(t,e);w0(t.slots,i1,1)},i5=(t,e,r)=>{const{vnode:n,slots:i}=t;let a=!0,h=Di;if(n.shapeFlag&32){const s=e._;s?r&&s===1?a=!1:(ys(i,e),!r&&s===1&&delete i._):(a=!e.$stable,tM(e,i)),h=e}else e&&(rM(t,e),h={default:1});if(a)for(const s in i)!eM(s)&&!(s in h)&&delete i[s]};function yE(t,e,r,n,i=!1){if(Fr(t)){t.forEach((I,A)=>yE(I,e&&(Fr(e)?e[A]:e),r,n,i));return}if(c0(n)&&!i)return;const a=n.shapeFlag&4?o1(n.component)||n.component.proxy:n.el,h=i?null:a,{i:s,r:g}=t,m=e&&e.r,w=s.refs===Di?s.refs={}:s.refs,b=s.setupState;if(m!=null&&m!==g&&(Vo(m)?(w[m]=null,Un(b,m)&&(b[m]=null)):qs(m)&&(m.value=null)),Kr(g))wh(g,s,12,[h,w]);else{const I=Vo(g),A=qs(g);if(I||A){const z=()=>{if(t.f){const V=I?Un(b,g)?b[g]:w[g]:g.value;i?Fr(V)&&tb(V,a):Fr(V)?V.includes(a)||V.push(a):I?(w[g]=[a],Un(b,g)&&(b[g]=w[g])):(g.value=[a],t.k&&(w[t.k]=g.value))}else I?(w[g]=h,Un(b,g)&&(b[g]=h)):A&&(g.value=h,t.k&&(w[t.k]=h))};h?(z.id=-1,ua(z,r)):z()}}}const ua=A4;function o5(t){return s5(t)}function s5(t,e){const r=sE();r.__VUE__=!0;const{insert:n,remove:i,patchProp:a,createElement:h,createText:s,createComment:g,setText:m,setElementText:w,parentNode:b,nextSibling:I,setScopeId:A=Ql,insertStaticContent:z}=t,V=(Ee,Ce,Ke,Qe=null,ot=null,wt=null,Mt=!1,_t=null,Nt=!!Ce.dynamicChildren)=>{if(Ee===Ce)return;Ee&&!Qm(Ee,Ce)&&(Qe=Ar(Ee),It(Ee,ot,wt,!0),Ee=null),Ce.patchFlag===-2&&(Nt=!1,Ce.dynamicChildren=null);const{type:xt,ref:ir,shapeFlag:$t}=Ce;switch(xt){case n1:H(Ee,Ce,Ke,Qe);break;case Gf:Z(Ee,Ce,Ke,Qe);break;case Ew:Ee==null&&D(Ce,Ke,Qe,Mt);break;case Xl:ze(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt);break;default:$t&1?Y(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt):$t&6?We(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt):($t&64||$t&128)&&xt.process(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt,Xr)}ir!=null&&ot&&yE(ir,Ee&&Ee.ref,wt,Ce||Ee,!Ce)},H=(Ee,Ce,Ke,Qe)=>{if(Ee==null)n(Ce.el=s(Ce.children),Ke,Qe);else{const ot=Ce.el=Ee.el;Ce.children!==Ee.children&&m(ot,Ce.children)}},Z=(Ee,Ce,Ke,Qe)=>{Ee==null?n(Ce.el=g(Ce.children||""),Ke,Qe):Ce.el=Ee.el},D=(Ee,Ce,Ke,Qe)=>{[Ee.el,Ee.anchor]=z(Ee.children,Ce,Ke,Qe,Ee.el,Ee.anchor)},k=({el:Ee,anchor:Ce},Ke,Qe)=>{let ot;for(;Ee&&Ee!==Ce;)ot=I(Ee),n(Ee,Ke,Qe),Ee=ot;n(Ce,Ke,Qe)},j=({el:Ee,anchor:Ce})=>{let Ke;for(;Ee&&Ee!==Ce;)Ke=I(Ee),i(Ee),Ee=Ke;i(Ce)},Y=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt)=>{Mt=Mt||Ce.type==="svg",Ee==null?ie(Ce,Ke,Qe,ot,wt,Mt,_t,Nt):W(Ee,Ce,ot,wt,Mt,_t,Nt)},ie=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t)=>{let Nt,xt;const{type:ir,props:$t,shapeFlag:Qt,transition:fr,dirs:Mr}=Ee;if(Nt=Ee.el=h(Ee.type,wt,$t&&$t.is,$t),Qt&8?w(Nt,Ee.children):Qt&16&&ae(Ee.children,Nt,null,Qe,ot,wt&&ir!=="foreignObject",Mt,_t),Mr&&Cf(Ee,null,Qe,"created"),ne(Nt,Ee,Ee.scopeId,Mt,Qe),$t){for(const Wr in $t)Wr!=="value"&&!l0(Wr)&&a(Nt,Wr,null,$t[Wr],wt,Ee.children,Qe,ot,rr);"value"in $t&&a(Nt,"value",null,$t.value),(xt=$t.onVnodeBeforeMount)&&Su(xt,Qe,Ee)}Mr&&Cf(Ee,null,Qe,"beforeMount");const jr=(!ot||ot&&!ot.pendingBranch)&&fr&&!fr.persisted;jr&&fr.beforeEnter(Nt),n(Nt,Ce,Ke),((xt=$t&&$t.onVnodeMounted)||jr||Mr)&&ua(()=>{xt&&Su(xt,Qe,Ee),jr&&fr.enter(Nt),Mr&&Cf(Ee,null,Qe,"mounted")},ot)},ne=(Ee,Ce,Ke,Qe,ot)=>{if(Ke&&A(Ee,Ke),Qe)for(let wt=0;wt<Qe.length;wt++)A(Ee,Qe[wt]);if(ot){let wt=ot.subTree;if(Ce===wt){const Mt=ot.vnode;ne(Ee,Mt,Mt.scopeId,Mt.slotScopeIds,ot.parent)}}},ae=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt=0)=>{for(let xt=Nt;xt<Ee.length;xt++){const ir=Ee[xt]=_t?mh(Ee[xt]):Ou(Ee[xt]);V(null,ir,Ce,Ke,Qe,ot,wt,Mt,_t)}},W=(Ee,Ce,Ke,Qe,ot,wt,Mt)=>{const _t=Ce.el=Ee.el;let{patchFlag:Nt,dynamicChildren:xt,dirs:ir}=Ce;Nt|=Ee.patchFlag&16;const $t=Ee.props||Di,Qt=Ce.props||Di;let fr;Ke&&Af(Ke,!1),(fr=Qt.onVnodeBeforeUpdate)&&Su(fr,Ke,Ce,Ee),ir&&Cf(Ce,Ee,Ke,"beforeUpdate"),Ke&&Af(Ke,!0);const Mr=ot&&Ce.type!=="foreignObject";if(xt?$e(Ee.dynamicChildren,xt,_t,Ke,Qe,Mr,wt):Mt||et(Ee,Ce,_t,null,Ke,Qe,Mr,wt,!1),Nt>0){if(Nt&16)Oe(_t,Ce,$t,Qt,Ke,Qe,ot);else if(Nt&2&&$t.class!==Qt.class&&a(_t,"class",null,Qt.class,ot),Nt&4&&a(_t,"style",$t.style,Qt.style,ot),Nt&8){const jr=Ce.dynamicProps;for(let Wr=0;Wr<jr.length;Wr++){const di=jr[Wr],co=$t[di],Fs=Qt[di];(Fs!==co||di==="value")&&a(_t,di,co,Fs,ot,Ee.children,Ke,Qe,rr)}}Nt&1&&Ee.children!==Ce.children&&w(_t,Ce.children)}else!Mt&&xt==null&&Oe(_t,Ce,$t,Qt,Ke,Qe,ot);((fr=Qt.onVnodeUpdated)||ir)&&ua(()=>{fr&&Su(fr,Ke,Ce,Ee),ir&&Cf(Ce,Ee,Ke,"updated")},Qe)},$e=(Ee,Ce,Ke,Qe,ot,wt,Mt)=>{for(let _t=0;_t<Ce.length;_t++){const Nt=Ee[_t],xt=Ce[_t],ir=Nt.el&&(Nt.type===Xl||!Qm(Nt,xt)||Nt.shapeFlag&70)?b(Nt.el):Ke;V(Nt,xt,ir,null,Qe,ot,wt,Mt,!0)}},Oe=(Ee,Ce,Ke,Qe,ot,wt,Mt)=>{if(Ke!==Qe){if(Ke!==Di)for(const _t in Ke)!l0(_t)&&!(_t in Qe)&&a(Ee,_t,Ke[_t],null,Mt,Ce.children,ot,wt,rr);for(const _t in Qe){if(l0(_t))continue;const Nt=Qe[_t],xt=Ke[_t];Nt!==xt&&_t!=="value"&&a(Ee,_t,xt,Nt,Mt,Ce.children,ot,wt,rr)}"value"in Qe&&a(Ee,"value",Ke.value,Qe.value)}},ze=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt)=>{const xt=Ce.el=Ee?Ee.el:s(""),ir=Ce.anchor=Ee?Ee.anchor:s("");let{patchFlag:$t,dynamicChildren:Qt,slotScopeIds:fr}=Ce;fr&&(_t=_t?_t.concat(fr):fr),Ee==null?(n(xt,Ke,Qe),n(ir,Ke,Qe),ae(Ce.children,Ke,ir,ot,wt,Mt,_t,Nt)):$t>0&&$t&64&&Qt&&Ee.dynamicChildren?($e(Ee.dynamicChildren,Qt,Ke,ot,wt,Mt,_t),(Ce.key!=null||ot&&Ce===ot.subTree)&&nM(Ee,Ce,!0)):et(Ee,Ce,Ke,ir,ot,wt,Mt,_t,Nt)},We=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt)=>{Ce.slotScopeIds=_t,Ee==null?Ce.shapeFlag&512?ot.ctx.activate(Ce,Ke,Qe,Mt,Nt):Ze(Ce,Ke,Qe,ot,wt,Mt,Nt):Pt(Ee,Ce,Nt)},Ze=(Ee,Ce,Ke,Qe,ot,wt,Mt)=>{const _t=Ee.component=y5(Ee,Qe,ot);if(XA(Ee)&&(_t.ctx.renderer=Xr),_5(_t),_t.asyncDep){if(ot&&ot.registerDep(_t,at),!Ee.el){const Nt=_t.subTree=Ru(Gf);Z(null,Nt,Ce,Ke)}return}at(_t,Ee,Ce,Ke,ot,wt,Mt)},Pt=(Ee,Ce,Ke)=>{const Qe=Ce.component=Ee.component;if(I4(Ee,Ce,Ke))if(Qe.asyncDep&&!Qe.asyncResolved){St(Qe,Ce,Ke);return}else Qe.next=Ce,v4(Qe.update),Qe.update();else Ce.el=Ee.el,Qe.vnode=Ce},at=(Ee,Ce,Ke,Qe,ot,wt,Mt)=>{const _t=()=>{if(Ee.isMounted){let{next:ir,bu:$t,u:Qt,parent:fr,vnode:Mr}=Ee,jr=ir,Wr;Af(Ee,!1),ir?(ir.el=Mr.el,St(Ee,ir,Mt)):ir=Mr,$t&&u0($t),(Wr=ir.props&&ir.props.onVnodeBeforeUpdate)&&Su(Wr,fr,ir,Mr),Af(Ee,!0);const di=vw(Ee),co=Ee.subTree;Ee.subTree=di,V(co,di,b(co.el),Ar(co),Ee,ot,wt),ir.el=di.el,jr===null&&P4(Ee,di.el),Qt&&ua(Qt,ot),(Wr=ir.props&&ir.props.onVnodeUpdated)&&ua(()=>Su(Wr,fr,ir,Mr),ot)}else{let ir;const{el:$t,props:Qt}=Ce,{bm:fr,m:Mr,parent:jr}=Ee,Wr=c0(Ce);if(Af(Ee,!1),fr&&u0(fr),!Wr&&(ir=Qt&&Qt.onVnodeBeforeMount)&&Su(ir,jr,Ce),Af(Ee,!0),$t&&nr){const di=()=>{Ee.subTree=vw(Ee),nr($t,Ee.subTree,Ee,ot,null)};Wr?Ce.type.__asyncLoader().then(()=>!Ee.isUnmounted&&di()):di()}else{const di=Ee.subTree=vw(Ee);V(null,di,Ke,Qe,Ee,ot,wt),Ce.el=di.el}if(Mr&&ua(Mr,ot),!Wr&&(ir=Qt&&Qt.onVnodeMounted)){const di=Ce;ua(()=>Su(ir,jr,di),ot)}(Ce.shapeFlag&256||jr&&c0(jr.vnode)&&jr.vnode.shapeFlag&256)&&Ee.a&&ua(Ee.a,ot),Ee.isMounted=!0,Ce=Ke=Qe=null}},Nt=Ee.effect=new ab(_t,()=>mb(xt),Ee.scope),xt=Ee.update=()=>Nt.run();xt.id=Ee.uid,Af(Ee,!0),xt()},St=(Ee,Ce,Ke)=>{Ce.component=Ee;const Qe=Ee.vnode.props;Ee.vnode=Ce,Ee.next=null,t5(Ee,Ce.props,Qe,Ke),i5(Ee,Ce.children,Ke),hg(),P2(),fg()},et=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt=!1)=>{const xt=Ee&&Ee.children,ir=Ee?Ee.shapeFlag:0,$t=Ce.children,{patchFlag:Qt,shapeFlag:fr}=Ce;if(Qt>0){if(Qt&128){mt(xt,$t,Ke,Qe,ot,wt,Mt,_t,Nt);return}else if(Qt&256){zt(xt,$t,Ke,Qe,ot,wt,Mt,_t,Nt);return}}fr&8?(ir&16&&rr(xt,ot,wt),$t!==xt&&w(Ke,$t)):ir&16?fr&16?mt(xt,$t,Ke,Qe,ot,wt,Mt,_t,Nt):rr(xt,ot,wt,!0):(ir&8&&w(Ke,""),fr&16&&ae($t,Ke,Qe,ot,wt,Mt,_t,Nt))},zt=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt)=>{Ee=Ee||Pd,Ce=Ce||Pd;const xt=Ee.length,ir=Ce.length,$t=Math.min(xt,ir);let Qt;for(Qt=0;Qt<$t;Qt++){const fr=Ce[Qt]=Nt?mh(Ce[Qt]):Ou(Ce[Qt]);V(Ee[Qt],fr,Ke,null,ot,wt,Mt,_t,Nt)}xt>ir?rr(Ee,ot,wt,!0,!1,$t):ae(Ce,Ke,Qe,ot,wt,Mt,_t,Nt,$t)},mt=(Ee,Ce,Ke,Qe,ot,wt,Mt,_t,Nt)=>{let xt=0;const ir=Ce.length;let $t=Ee.length-1,Qt=ir-1;for(;xt<=$t&&xt<=Qt;){const fr=Ee[xt],Mr=Ce[xt]=Nt?mh(Ce[xt]):Ou(Ce[xt]);if(Qm(fr,Mr))V(fr,Mr,Ke,null,ot,wt,Mt,_t,Nt);else break;xt++}for(;xt<=$t&&xt<=Qt;){const fr=Ee[$t],Mr=Ce[Qt]=Nt?mh(Ce[Qt]):Ou(Ce[Qt]);if(Qm(fr,Mr))V(fr,Mr,Ke,null,ot,wt,Mt,_t,Nt);else break;$t--,Qt--}if(xt>$t){if(xt<=Qt){const fr=Qt+1,Mr=fr<ir?Ce[fr].el:Qe;for(;xt<=Qt;)V(null,Ce[xt]=Nt?mh(Ce[xt]):Ou(Ce[xt]),Ke,Mr,ot,wt,Mt,_t,Nt),xt++}}else if(xt>Qt)for(;xt<=$t;)It(Ee[xt],ot,wt,!0),xt++;else{const fr=xt,Mr=xt,jr=new Map;for(xt=Mr;xt<=Qt;xt++){const $i=Ce[xt]=Nt?mh(Ce[xt]):Ou(Ce[xt]);$i.key!=null&&jr.set($i.key,xt)}let Wr,di=0;const co=Qt-Mr+1;let Fs=!1,pu=0;const zs=new Array(co);for(xt=0;xt<co;xt++)zs[xt]=0;for(xt=fr;xt<=$t;xt++){const $i=Ee[xt];if(di>=co){It($i,ot,wt,!0);continue}let _o;if($i.key!=null)_o=jr.get($i.key);else for(Wr=Mr;Wr<=Qt;Wr++)if(zs[Wr-Mr]===0&&Qm($i,Ce[Wr])){_o=Wr;break}_o===void 0?It($i,ot,wt,!0):(zs[_o-Mr]=xt+1,_o>=pu?pu=_o:Fs=!0,V($i,Ce[_o],Ke,null,ot,wt,Mt,_t,Nt),di++)}const Ta=Fs?a5(zs):Pd;for(Wr=Ta.length-1,xt=co-1;xt>=0;xt--){const $i=Mr+xt,_o=Ce[$i],bl=$i+1<ir?Ce[$i+1].el:Qe;zs[xt]===0?V(null,_o,Ke,bl,ot,wt,Mt,_t,Nt):Fs&&(Wr<0||xt!==Ta[Wr]?bt(_o,Ke,bl,2):Wr--)}}},bt=(Ee,Ce,Ke,Qe,ot=null)=>{const{el:wt,type:Mt,transition:_t,children:Nt,shapeFlag:xt}=Ee;if(xt&6){bt(Ee.component.subTree,Ce,Ke,Qe);return}if(xt&128){Ee.suspense.move(Ce,Ke,Qe);return}if(xt&64){Mt.move(Ee,Ce,Ke,Xr);return}if(Mt===Xl){n(wt,Ce,Ke);for(let $t=0;$t<Nt.length;$t++)bt(Nt[$t],Ce,Ke,Qe);n(Ee.anchor,Ce,Ke);return}if(Mt===Ew){k(Ee,Ce,Ke);return}if(Qe!==2&&xt&1&&_t)if(Qe===0)_t.beforeEnter(wt),n(wt,Ce,Ke),ua(()=>_t.enter(wt),ot);else{const{leave:$t,delayLeave:Qt,afterLeave:fr}=_t,Mr=()=>n(wt,Ce,Ke),jr=()=>{$t(wt,()=>{Mr(),fr&&fr()})};Qt?Qt(wt,Mr,jr):jr()}else n(wt,Ce,Ke)},It=(Ee,Ce,Ke,Qe=!1,ot=!1)=>{const{type:wt,props:Mt,ref:_t,children:Nt,dynamicChildren:xt,shapeFlag:ir,patchFlag:$t,dirs:Qt}=Ee;if(_t!=null&&yE(_t,null,Ke,Ee,!0),ir&256){Ce.ctx.deactivate(Ee);return}const fr=ir&1&&Qt,Mr=!c0(Ee);let jr;if(Mr&&(jr=Mt&&Mt.onVnodeBeforeUnmount)&&Su(jr,Ce,Ee),ir&6)yr(Ee.component,Ke,Qe);else{if(ir&128){Ee.suspense.unmount(Ke,Qe);return}fr&&Cf(Ee,null,Ce,"beforeUnmount"),ir&64?Ee.type.remove(Ee,Ce,Ke,ot,Xr,Qe):xt&&(wt!==Xl||$t>0&&$t&64)?rr(xt,Ce,Ke,!1,!0):(wt===Xl&&$t&384||!ot&&ir&16)&&rr(Nt,Ce,Ke),Qe&&jt(Ee)}(Mr&&(jr=Mt&&Mt.onVnodeUnmounted)||fr)&&ua(()=>{jr&&Su(jr,Ce,Ee),fr&&Cf(Ee,null,Ce,"unmounted")},Ke)},jt=Ee=>{const{type:Ce,el:Ke,anchor:Qe,transition:ot}=Ee;if(Ce===Xl){Jt(Ke,Qe);return}if(Ce===Ew){j(Ee);return}const wt=()=>{i(Ke),ot&&!ot.persisted&&ot.afterLeave&&ot.afterLeave()};if(Ee.shapeFlag&1&&ot&&!ot.persisted){const{leave:Mt,delayLeave:_t}=ot,Nt=()=>Mt(Ke,wt);_t?_t(Ee.el,wt,Nt):Nt()}else wt()},Jt=(Ee,Ce)=>{let Ke;for(;Ee!==Ce;)Ke=I(Ee),i(Ee),Ee=Ke;i(Ce)},yr=(Ee,Ce,Ke)=>{const{bum:Qe,scope:ot,update:wt,subTree:Mt,um:_t}=Ee;Qe&&u0(Qe),ot.stop(),wt&&(wt.active=!1,It(Mt,Ee,Ce,Ke)),_t&&ua(_t,Ce),ua(()=>{Ee.isUnmounted=!0},Ce),Ce&&Ce.pendingBranch&&!Ce.isUnmounted&&Ee.asyncDep&&!Ee.asyncResolved&&Ee.suspenseId===Ce.pendingId&&(Ce.deps--,Ce.deps===0&&Ce.resolve())},rr=(Ee,Ce,Ke,Qe=!1,ot=!1,wt=0)=>{for(let Mt=wt;Mt<Ee.length;Mt++)It(Ee[Mt],Ce,Ke,Qe,ot)},Ar=Ee=>Ee.shapeFlag&6?Ar(Ee.component.subTree):Ee.shapeFlag&128?Ee.suspense.next():I(Ee.anchor||Ee.el),Ii=(Ee,Ce,Ke)=>{Ee==null?Ce._vnode&&It(Ce._vnode,null,null,!0):V(Ce._vnode||null,Ee,Ce,null,null,null,Ke),P2(),GA(),Ce._vnode=Ee},Xr={p:V,um:It,m:bt,r:jt,mt:Ze,mc:ae,pc:et,pbc:$e,n:Ar,o:t};let si,nr;return e&&([si,nr]=e(Xr)),{render:Ii,hydrate:si,createApp:J4(Ii,si)}}function Af({effect:t,update:e},r){t.allowRecurse=e.allowRecurse=r}function nM(t,e,r=!1){const n=t.children,i=e.children;if(Fr(n)&&Fr(i))for(let a=0;a<n.length;a++){const h=n[a];let s=i[a];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=i[a]=mh(i[a]),s.el=h.el),r||nM(h,s)),s.type===n1&&(s.el=h.el)}}function a5(t){const e=t.slice(),r=[0];let n,i,a,h,s;const g=t.length;for(n=0;n<g;n++){const m=t[n];if(m!==0){if(i=r[r.length-1],t[i]<m){e[n]=i,r.push(n);continue}for(a=0,h=r.length-1;a<h;)s=a+h>>1,t[r[s]]<m?a=s+1:h=s;m<t[r[a]]&&(a>0&&(e[n]=r[a-1]),r[a]=n)}}for(a=r.length,h=r[a-1];a-- >0;)r[a]=h,h=e[h];return r}const l5=t=>t.__isTeleport,Xl=Symbol.for("v-fgt"),n1=Symbol.for("v-txt"),Gf=Symbol.for("v-cmt"),Ew=Symbol.for("v-stc"),vy=[];let Yl=null;function ho(t=!1){vy.push(Yl=t?null:[])}function u5(){vy.pop(),Yl=vy[vy.length-1]||null}let Sy=1;function z2(t){Sy+=t}function iM(t){return t.dynamicChildren=Sy>0?Yl||Pd:null,u5(),Sy>0&&Yl&&Yl.push(t),t}function So(t,e,r,n,i,a){return iM(yi(t,e,r,n,i,a,!0))}function c5(t,e,r,n,i){return iM(Ru(t,e,r,n,i,!0))}function h5(t){return t?t.__v_isVNode===!0:!1}function Qm(t,e){return t.type===e.type&&t.key===e.key}const i1="__vInternal",oM=({key:t})=>t??null,f0=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?Vo(t)||qs(t)||Kr(t)?{i:Kl,r:t,k:e,f:!!r}:t:null);function yi(t,e=null,r=null,n=0,i=null,a=t===Xl?0:1,h=!1,s=!1){const g={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&oM(e),ref:e&&f0(e),scopeId:qA,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Kl};return s?(vb(g,r),a&128&&t.normalize(g)):r&&(g.shapeFlag|=Vo(r)?8:16),Sy>0&&!h&&Yl&&(g.patchFlag>0||a&6)&&g.patchFlag!==32&&Yl.push(g),g}const Ru=f5;function f5(t,e=null,r=null,n=0,i=null,a=!1){if((!t||t===q4)&&(t=Gf),h5(t)){const s=kd(t,e,!0);return r&&vb(s,r),Sy>0&&!a&&Yl&&(s.shapeFlag&6?Yl[Yl.indexOf(t)]=s:Yl.push(s)),s.patchFlag|=-2,s}if(E5(t)&&(t=t.__vccOpts),e){e=p5(e);let{class:s,style:g}=e;s&&!Vo(s)&&(e.class=ob(s)),so(g)&&(kA(g)&&!Fr(g)&&(g=ys({},g)),e.style=ib(g))}const h=Vo(t)?1:C4(t)?128:l5(t)?64:so(t)?4:Kr(t)?2:0;return yi(t,e,r,n,i,h,a,!0)}function p5(t){return t?kA(t)||i1 in t?ys({},t):t:null}function kd(t,e,r=!1){const{props:n,ref:i,patchFlag:a,children:h}=t,s=e?d5(n||{},e):n;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:s,key:s&&oM(s),ref:e&&e.ref?r&&i?Fr(i)?i.concat(f0(e)):[i,f0(e)]:f0(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:h,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Xl?a===-1?16:a|16:a,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&kd(t.ssContent),ssFallback:t.ssFallback&&kd(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Iy(t=" ",e=0){return Ru(n1,null,t,e)}function pc(t="",e=!1){return e?(ho(),c5(Gf,null,t)):Ru(Gf,null,t)}function Ou(t){return t==null||typeof t=="boolean"?Ru(Gf):Fr(t)?Ru(Xl,null,t.slice()):typeof t=="object"?mh(t):Ru(n1,null,String(t))}function mh(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:kd(t)}function vb(t,e){let r=0;const{shapeFlag:n}=t;if(e==null)e=null;else if(Fr(e))r=16;else if(typeof e=="object")if(n&65){const i=e.default;i&&(i._c&&(i._d=!1),vb(t,i()),i._c&&(i._d=!0));return}else{r=32;const i=e._;!i&&!(i1 in e)?e._ctx=Kl:i===3&&Kl&&(Kl.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Kr(e)?(e={default:e,_ctx:Kl},r=32):(e=String(e),n&64?(r=16,e=[Iy(e)]):r=8);t.children=e,t.shapeFlag|=r}function d5(...t){const e={};for(let r=0;r<t.length;r++){const n=t[r];for(const i in n)if(i==="class")e.class!==n.class&&(e.class=ob([e.class,n.class]));else if(i==="style")e.style=ib([e.style,n.style]);else if(K0(i)){const a=e[i],h=n[i];h&&a!==h&&!(Fr(a)&&a.includes(h))&&(e[i]=a?[].concat(a,h):h)}else i!==""&&(e[i]=n[i])}return e}function Su(t,e,r,n=null){eu(t,e,7,[r,n])}const g5=YA();let m5=0;function y5(t,e,r){const n=t.type,i=(e?e.appContext:t.appContext)||g5,a={uid:m5++,vnode:t,type:n,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new NR(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:QA(n,i),emitsOptions:jA(n,i),emit:null,emitted:null,propsDefaults:Di,inheritAttrs:n.inheritAttrs,ctx:Di,data:Di,props:Di,attrs:Di,slots:Di,refs:Di,setupState:Di,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=E4.bind(null,a),t.ce&&t.ce(a),a}let Ls=null,xb,fd,B2="__VUE_INSTANCE_SETTERS__";(fd=sE()[B2])||(fd=sE()[B2]=[]),fd.push(t=>Ls=t),xb=t=>{fd.length>1?fd.forEach(e=>e(t)):fd[0](t)};const Fd=t=>{xb(t),t.scope.on()},zf=()=>{Ls&&Ls.scope.off(),xb(null)};function sM(t){return t.vnode.shapeFlag&4}let Py=!1;function _5(t,e=!1){Py=e;const{props:r,children:n}=t.vnode,i=sM(t);e5(t,r,i,e),n5(t,n);const a=i?v5(t,e):void 0;return Py=!1,a}function v5(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=FA(new Proxy(t.ctx,$4));const{setup:n}=r;if(n){const i=t.setupContext=n.length>1?w5(t):null;Fd(t),hg();const a=wh(n,t,0,[t.props,i]);if(fg(),zf(),vA(a)){if(a.then(zf,zf),e)return a.then(h=>{U2(t,h,e)}).catch(h=>{e1(h,t,0)});t.asyncDep=a}else U2(t,a,e)}else aM(t,e)}function U2(t,e,r){Kr(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:so(e)&&(t.setupState=zA(e)),aM(t,r)}let G2;function aM(t,e,r){const n=t.type;if(!t.render){if(!e&&G2&&!n.render){const i=n.template||yb(t).template;if(i){const{isCustomElement:a,compilerOptions:h}=t.appContext.config,{delimiters:s,compilerOptions:g}=n,m=ys(ys({isCustomElement:a,delimiters:s},h),g);n.render=G2(i,m)}}t.render=n.render||Ql}Fd(t),hg(),Z4(t),fg(),zf()}function x5(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(e,r){return da(t,"get","$attrs"),e[r]}}))}function w5(t){const e=r=>{t.exposed=r||{}};return{get attrs(){return x5(t)},slots:t.slots,emit:t.emit,expose:e}}function o1(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(zA(FA(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in _y)return _y[r](t)},has(e,r){return r in e||r in _y}}))}function E5(t){return Kr(t)&&"__vccOpts"in t}const b5=(t,e)=>g4(t,e,Py),T5=Symbol.for("v-scx"),S5=()=>h0(T5),I5="3.3.4",P5="http://www.w3.org/2000/svg",Of=typeof document<"u"?document:null,V2=Of&&Of.createElement("template"),C5={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,n)=>{const i=e?Of.createElementNS(P5,t):Of.createElement(t,r?{is:r}:void 0);return t==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:t=>Of.createTextNode(t),createComment:t=>Of.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Of.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,n,i,a){const h=r?r.previousSibling:e.lastChild;if(i&&(i===a||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),r),!(i===a||!(i=i.nextSibling)););else{V2.innerHTML=n?`<svg>${t}</svg>`:t;const s=V2.content;if(n){const g=s.firstChild;for(;g.firstChild;)s.appendChild(g.firstChild);s.removeChild(g)}e.insertBefore(s,r)}return[h?h.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}};function A5(t,e,r){const n=t._vtc;n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}function M5(t,e,r){const n=t.style,i=Vo(r);if(r&&!i){if(e&&!Vo(e))for(const a in e)r[a]==null&&_E(n,a,"");for(const a in r)_E(n,a,r[a])}else{const a=n.display;i?e!==r&&(n.cssText=r):e&&t.removeAttribute("style"),"_vod"in t&&(n.display=a)}}const j2=/\s*!important$/;function _E(t,e,r){if(Fr(r))r.forEach(n=>_E(t,e,n));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const n=L5(t,e);j2.test(r)?t.setProperty(cg(n),r.replace(j2,""),"important"):t[n]=r}}const q2=["Webkit","Moz","ms"],bw={};function L5(t,e){const r=bw[e];if(r)return r;let n=Rd(e);if(n!=="filter"&&n in t)return bw[e]=n;n=EA(n);for(let i=0;i<q2.length;i++){const a=q2[i]+n;if(a in t)return bw[e]=a}return e}const $2="http://www.w3.org/1999/xlink";function O5(t,e,r,n,i){if(n&&e.startsWith("xlink:"))r==null?t.removeAttributeNS($2,e.slice(6,e.length)):t.setAttributeNS($2,e,r);else{const a=DR(e);r==null||a&&!bA(r)?t.removeAttribute(e):t.setAttribute(e,a?"":r)}}function D5(t,e,r,n,i,a,h){if(e==="innerHTML"||e==="textContent"){n&&h(n,i,a),t[e]=r??"";return}const s=t.tagName;if(e==="value"&&s!=="PROGRESS"&&!s.includes("-")){t._value=r;const m=s==="OPTION"?t.getAttribute("value"):t.value,w=r??"";m!==w&&(t.value=w),r==null&&t.removeAttribute(e);return}let g=!1;if(r===""||r==null){const m=typeof t[e];m==="boolean"?r=bA(r):r==null&&m==="string"?(r="",g=!0):m==="number"&&(r=0,g=!0)}try{t[e]=r}catch{}g&&t.removeAttribute(e)}function _d(t,e,r,n){t.addEventListener(e,r,n)}function N5(t,e,r,n){t.removeEventListener(e,r,n)}function R5(t,e,r,n,i=null){const a=t._vei||(t._vei={}),h=a[e];if(n&&h)h.value=n;else{const[s,g]=k5(e);if(n){const m=a[e]=B5(n,i);_d(t,s,m,g)}else h&&(N5(t,s,h,g),a[e]=void 0)}}const Z2=/(?:Once|Passive|Capture)$/;function k5(t){let e;if(Z2.test(t)){e={};let n;for(;n=t.match(Z2);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):cg(t.slice(2)),e]}let Tw=0;const F5=Promise.resolve(),z5=()=>Tw||(F5.then(()=>Tw=0),Tw=Date.now());function B5(t,e){const r=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=r.attached)return;eu(U5(n,r.value),e,5,[n])};return r.value=t,r.attached=z5(),r}function U5(t,e){if(Fr(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(n=>i=>!i._stopped&&n&&n(i))}else return e}const X2=/^on[a-z]/,G5=(t,e,r,n,i=!1,a,h,s,g)=>{e==="class"?A5(t,n,i):e==="style"?M5(t,r,n):K0(e)?eb(e)||R5(t,e,r,n,h):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):V5(t,e,n,i))?D5(t,e,n,a,h,s,g):(e==="true-value"?t._trueValue=n:e==="false-value"&&(t._falseValue=n),O5(t,e,n,i))};function V5(t,e,r,n){return n?!!(e==="innerHTML"||e==="textContent"||e in t&&X2.test(e)&&Kr(r)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||X2.test(e)&&Vo(r)?!1:e in t}const W2=t=>{const e=t.props["onUpdate:modelValue"]||!1;return Fr(e)?r=>u0(e,r):e};function j5(t){t.target.composing=!0}function H2(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const q5={created(t,{modifiers:{lazy:e,trim:r,number:n}},i){t._assign=W2(i);const a=n||i.props&&i.props.type==="number";_d(t,e?"change":"input",h=>{if(h.target.composing)return;let s=t.value;r&&(s=s.trim()),a&&(s=oE(s)),t._assign(s)}),r&&_d(t,"change",()=>{t.value=t.value.trim()}),e||(_d(t,"compositionstart",j5),_d(t,"compositionend",H2),_d(t,"change",H2))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,modifiers:{lazy:r,trim:n,number:i}},a){if(t._assign=W2(a),t.composing||document.activeElement===t&&t.type!=="range"&&(r||n&&t.value.trim()===e||(i||t.type==="number")&&oE(t.value)===e))return;const h=e??"";t.value!==h&&(t.value=h)}},$5=ys({patchProp:G5},C5);let K2;function Z5(){return K2||(K2=o5($5))}const X5=(...t)=>{const e=Z5().createApp(...t),{mount:r}=e;return e.mount=n=>{const i=W5(n);if(!i)return;const a=e._component;!Kr(a)&&!a.render&&!a.template&&(a.template=i.innerHTML),i.innerHTML="";const h=r(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),h},e};function W5(t){return Vo(t)?document.querySelector(t):t}var e_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function s1(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var lM={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(e_,function(){var r,n,i;function a(s,g){if(!r)r=g;else if(!n)n=g;else{var m="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",w={};r(w),i=g(w),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([m],{type:"text/javascript"})))}}a(["exports"],function(s){var g=typeof self<"u"?self:{},m="2.15.0";let w;const b={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(w==null){const l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{w={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):l}catch{w=l}}return w},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!b.API_URL)return null;try{const l=new URL(b.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},I={supported:!1,testSupport:function(l){!V&&z&&(H?Z(l):A=l)}};let A,z,V=!1,H=!1;function Z(l){const o=l.createTexture();l.bindTexture(l.TEXTURE_2D,o);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,z),l.isContextLost())return;I.supported=!0}catch{}l.deleteTexture(o),V=!0}g.document&&(z=g.document.createElement("img"),z.onload=function(){A&&Z(A),A=null,H=!0},z.onerror=function(){V=!0,A=null},z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const D="01";function k(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var j=Y;function Y(l,o,u,f){this.cx=3*l,this.bx=3*(u-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=u,this.p2y=f}Y.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var u=l,f=0;f<8;f++){var d=this.sampleCurveX(u)-l;if(Math.abs(d)<o)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=d/_}var x=0,T=1;for(u=l,f=0;f<20&&(d=this.sampleCurveX(u),!(Math.abs(d-l)<o));f++)l>d?x=u:T=u,u=.5*(T-x)+x;return u},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var ie=k(j),ne=ae;function ae(l,o){this.x=l,this.y=o}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,u=l.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),u=Math.sin(l),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(l,o){var u=Math.cos(l),f=Math.sin(l),d=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(l){return l instanceof ae?l:Array.isArray(l)?new ae(l[0],l[1]):l};var W=k(ne);const $e=Math.PI/180,Oe=180/Math.PI;function ze(l){return l*$e}function We(l){return l*Oe}const Ze=[[0,0],[1,0],[1,1],[0,1]];function Pt(l){if(l<=0)return 0;if(l>=1)return 1;const o=l*l,u=o*l;return 4*(l<.5?u:3*(l-o)+u-.75)}function at(l,o,u,f){const d=new ie(l,o,u,f);return function(_){return d.solve(_)}}const St=at(.25,.1,.25,1);function et(l,o,u){return Math.min(u,Math.max(o,l))}function zt(l,o,u){return(u=et((u-l)/(o-l),0,1))*u*(3-2*u)}function mt(l,o,u){const f=u-o,d=((l-o)%f+f)%f+o;return d===o?u:d}function bt(l,o,u){if(!l.length)return u(null,[]);let f=l.length;const d=new Array(l.length);let _=null;l.forEach((x,T)=>{o(x,(P,C)=>{P&&(_=P),d[T]=C,--f==0&&u(_,d)})})}function It(l){const o=[];for(const u in l)o.push(l[u]);return o}function jt(l,...o){for(const u of o)for(const f in u)l[f]=u[f];return l}let Jt=1;function yr(){return Jt++}function rr(){return function l(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()}function Ar(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function Ii(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)}function Xr(l,o){l.forEach(u=>{o[u]&&(o[u]=o[u].bind(o))})}function si(l,o){return l.indexOf(o,l.length-o.length)!==-1}function nr(l,o,u){const f={};for(const d in l)f[d]=o.call(u||this,l[d],d,l);return f}function Ee(l,o,u){const f={};for(const d in l)o.call(u||this,l[d],d,l)&&(f[d]=l[d]);return f}function Ce(l){return Array.isArray(l)?l.map(Ce):typeof l=="object"&&l?nr(l,Ce):l}const Ke={};function Qe(l){Ke[l]||(typeof console<"u"&&console.warn(l),Ke[l]=!0)}function ot(l,o,u){return(u.y-l.y)*(o.x-l.x)>(o.y-l.y)*(u.x-l.x)}function wt(l){let o=0;for(let u,f,d=0,_=l.length,x=_-1;d<_;x=d++)u=l[d],f=l[x],o+=(f.x-u.x)*(u.y+f.y);return o}function Mt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function _t(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,d,_)=>{const x=d||_;return o[f]=!x||x.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}let Nt=null;function xt(l){if(Nt==null){const o=l.navigator?l.navigator.userAgent:null;Nt=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Nt}function ir(l){try{const o=g[l];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function $t(l,o){return[l[4*o],l[4*o+1],l[4*o+2],l[4*o+3]]}const Qt="mapbox-tiles";let fr=500,Mr=50,jr,Wr;function di(){try{return g.caches}catch{}}function co(){di()&&!jr&&(jr=g.caches.open(Qt))}function Fs(l){const o=l.indexOf("?");if(o<0)return l;const u=function(d){const _=d.indexOf("?");return _>0?d.slice(_+1).split("&"):[]}(l),f=u.filter(d=>{const _=d.split("=");return _[0]==="language"||_[0]==="worldview"});return f.length?`${l.slice(0,o)}?${f.join("&")}`:l.slice(0,o)}let pu=1/0;const zs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(zs);class Ta extends Error{constructor(o,u,f){u===401&&Ne(f)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=u,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $i=Mt()?()=>self.worker&&self.worker.referrer:()=>(g.location.protocol==="blob:"?g.parent:g).location.href,_o=function(l,o){if(!(/^file:/.test(u=l.url)||/^file:/.test($i())&&!/^\w+:/.test(u))){if(g.fetch&&g.Request&&g.AbortController&&g.Request.prototype.hasOwnProperty("signal"))return function(f,d){const _=new g.AbortController,x=new g.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:$i(),referrerPolicy:f.referrerPolicy,signal:_.signal});let T=!1,P=!1;const C=(O=x.url).indexOf("sku=")>0&&Ne(O);var O;f.type==="json"&&x.headers.set("Accept","application/json");const R=(G,q,K)=>{if(P)return;if(G&&G.message!=="SecurityError"&&Qe(G.toString()),q&&K)return F(q);const re=Date.now();g.fetch(x).then(he=>{if(he.ok){const _e=C?he.clone():null;return F(he,_e,re)}return d(new Ta(he.statusText,he.status,f.url))}).catch(he=>{he.name!=="AbortError"&&d(new Error(`${he.message} ${f.url}`))})},F=(G,q,K)=>{(f.type==="arrayBuffer"?G.arrayBuffer():f.type==="json"?G.json():G.text()).then(re=>{P||(q&&K&&function(he,_e,fe){if(co(),!jr)return;const me={status:_e.status,statusText:_e.statusText,headers:new g.Headers};_e.headers.forEach((Ue,ke)=>me.headers.set(ke,Ue));const xe=_t(_e.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&me.headers.set("Expires",new Date(fe+1e3*xe["max-age"]).toUTCString());const ve=me.headers.get("Expires");ve&&(new Date(ve).getTime()-fe<42e4||function(Ue,ke){if(Wr===void 0)try{new Response(new ReadableStream),Wr=!0}catch{Wr=!1}Wr?ke(Ue.body):Ue.blob().then(ke)}(_e,Ue=>{const ke=new g.Response(Ue,me);co(),jr&&jr.then(Je=>Je.put(Fs(he.url),ke)).catch(Je=>Qe(Je.message))}))}(x,q,K),T=!0,d(null,re,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(re=>{P||d(new Error(re.message))})};return C?function(G,q){if(co(),!jr)return q(null);const K=Fs(G.url);jr.then(re=>{re.match(K).then(he=>{const _e=function(fe){if(!fe)return!1;const me=new Date(fe.headers.get("Expires")||0),xe=_t(fe.headers.get("Cache-Control")||"");return me>Date.now()&&!xe["no-cache"]}(he);re.delete(K),_e&&re.put(K,he.clone()),q(null,he,_e)}).catch(q)}).catch(q)}(x,R):R(null,null),{cancel:()=>{P=!0,T||_.abort()}}}(l,o);if(Mt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var u;return function(f,d){const _=new g.XMLHttpRequest;_.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const x in f.headers)_.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=f.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let x=_.response;if(f.type==="json")try{x=JSON.parse(_.response)}catch(T){return d(T)}d(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else d(new Ta(_.statusText,_.status,f.url))},_.send(f.body),{cancel:()=>_.abort()}}(l,o)},bl=function(l,o){return _o(jt(l,{type:"arrayBuffer"}),o)};function dp(l){const o=g.document.createElement("a");return o.href=l,o.protocol===g.document.location.protocol&&o.host===g.document.location.host}const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let J,Q;J=[],Q=0;const ge=function(l,o){if(I.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Q>=b.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:l,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return J.push(_),_}Q++;let u=!1;const f=()=>{if(!u)for(u=!0,Q--;J.length&&Q<b.MAX_PARALLEL_IMAGE_REQUESTS;){const _=J.shift(),{requestParameters:x,callback:T,cancelled:P}=_;P||(_.cancel=ge(x,T).cancel)}},d=bl(l,(_,x,T,P)=>{f(),_?o(_):x&&(g.createImageBitmap?function(C,O){const R=new g.Blob([new Uint8Array(C)],{type:"image/png"});g.createImageBitmap(R).then(F=>{O(null,F)}).catch(F=>{O(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(C,O)=>o(C,O,T,P)):function(C,O){const R=new g.Image,F=g.URL;R.onload=()=>{O(null,R),F.revokeObjectURL(R.src),R.onload=null,g.requestAnimationFrame(()=>{R.src=ye})},R.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new g.Blob([new Uint8Array(C)],{type:"image/png"});R.src=C.byteLength?F.createObjectURL(G):ye}(x,(C,O)=>o(C,O,T,P)))});return{cancel:()=>{d.cancel(),f()}}},we="NO_ACCESS_TOKEN";function Pe(l){return l.indexOf("mapbox:")===0}function Ne(l){return b.API_URL_REGEX.test(l)}function De(l){return b.API_CDN_URL_REGEX.test(l)}function Ie(l){return b.API_STYLE_REGEX.test(l)&&!qe(l)}function qe(l){return b.API_SPRITE_REGEX.test(l)}const vt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tt(l){const o=l.match(vt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function dt(l){const o=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${o}`}const br="mapbox.eventData";function Lr(l){if(!l)return null;const o=l.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(g.atob(o[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Tr{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=Lr(b.ACCESS_TOKEN);let f="";return f=u&&u.u?g.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(d,_)=>String.fromCharCode(+("0x"+_)))):b.ACCESS_TOKEN||"",o?`${br}.${o}:${f}`:`${br}:${f}`}fetchEventData(){const o=ir("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{const d=g.localStorage.getItem(u);d&&(this.eventData=JSON.parse(d));const _=g.localStorage.getItem(f);_&&(this.anonId=_)}catch{Qe("Unable to read from LocalStorage")}}saveEventData(){const o=ir("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{g.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&g.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{Qe("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,f,d){if(!b.EVENTS_URL)return;const _=Tt(b.EVENTS_URL);_.params.push(`access_token=${d||b.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(o).toISOString()},T=u?jt(x,u):x,P={url:dt(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=function(C,O){return _o(jt(C,{method:"POST"}),O)}(P,C=>{this.pendingRequest=null,f(C),this.saveEventData(),this.processRequests(d)})}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const Or=new class extends Tr{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,o){b.EVENTS_URL&&b.ACCESS_TOKEN&&Array.isArray(l)&&l.some(u=>Pe(u)||Ne(u))&&this.queueRequest(Date.now(),o)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Lr(b.ACCESS_TOKEN),u=o?o.u:b.ACCESS_TOKEN;let f=u!==this.eventData.tokenU;Ii(this.anonId)||(this.anonId=rr(),f=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(d),T=(d-this.eventData.lastSuccess)/864e5;f=f||T>=1||T<-1||_.getDate()!==x.getDate()}else f=!0;f?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:D,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=d,this.eventData.tokenU=u)},l):this.processRequests()}},Vr=Or.postTurnstileEvent.bind(Or),Ei=new class extends Tr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,o,u,f){this.skuToken=o,this.errorCb=f,b.EVENTS_URL&&(u||b.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},u):this.errorCb(new Error(we)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),Ii(this.anonId)||(this.anonId=rr()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:D,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},l))}},Zi=Ei.postMapLoadEvent.bind(Ei),Xo=new class extends Tr{constructor(){super("gljs.performance")}postPerformanceEvent(l,o){b.EVENTS_URL&&(l||b.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:u}=this.queue.shift(),f=function(d){const _=g.performance.getEntriesByType("resource"),x=g.performance.getEntriesByType("mark"),T=function(F){const G={};if(F){for(const q in F)if(q!=="other")for(const K of F[q]){const re=`${q}ResolveRangeMin`,he=`${q}ResolveRangeMax`,_e=`${q}RequestCount`,fe=`${q}RequestCachedCount`;G[re]=Math.min(G[re]||1/0,K.startTime),G[he]=Math.max(G[he]||-1/0,K.responseEnd);const me=xe=>{G[xe]===void 0&&(G[xe]=0),++G[xe]};K.transferSize!==void 0&&K.transferSize===0&&me(fe),me(_e)}}return G}(function(F,G){const q={};if(F)for(const K of F){const re=G(K);q[re]===void 0&&(q[re]=[]),q[re].push(K)}return q}(_,y_)),P=g.devicePixelRatio,C=g.navigator.connection||g.navigator.mozConnection||g.navigator.webkitConnection,O={counters:[],metadata:[],attributes:[]},R=(F,G,q)=>{q!=null&&F.push({name:G,value:q.toString()})};for(const F in T)R(O.counters,F,T[F]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(R(O.counters,"interactionRangeMin",d.interactionRange[0]),R(O.counters,"interactionRangeMax",d.interactionRange[1])),x)for(const F of Object.keys(Fc)){const G=Fc[F],q=x.find(K=>K.name===G);q&&R(O.counters,G,q.startTime)}return R(O.counters,"visibilityHidden",d.visibilityHidden),R(O.attributes,"style",function(F){if(F)for(const G of F){const q=G.name.split("?")[0];if(Ie(q)){const K=q.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(_)),R(O.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),R(O.attributes,"fogEnabled",d.fogEnabled?"true":"false"),R(O.attributes,"projection",d.projection),R(O.attributes,"zoom",d.zoom),R(O.metadata,"devicePixelRatio",P),R(O.metadata,"connectionEffectiveType",C?C.effectiveType:void 0),R(O.metadata,"navigatorUserAgent",g.navigator.userAgent),R(O.metadata,"screenWidth",g.screen.width),R(O.metadata,"screenHeight",g.screen.height),R(O.metadata,"windowWidth",g.innerWidth),R(O.metadata,"windowHeight",g.innerHeight),R(O.metadata,"mapWidth",d.width/P),R(O.metadata,"mapHeight",d.height/P),R(O.metadata,"webglRenderer",d.renderer),R(O.metadata,"webglVendor",d.vendor),R(O.metadata,"sdkVersion",m),R(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(u);for(const d of f.metadata);for(const d of f.counters);for(const d of f.attributes);this.postEvent(o,f,()=>{},l)}},lo=Xo.postPerformanceEvent.bind(Xo),ja=new class extends Tr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,o,u,f){if(!b.API_URL||!b.SESSION_PATH)return;const d=Tt(b.API_URL+b.SESSION_PATH);d.params.push(`sku=${o||""}`),d.params.push(`access_token=${f||b.ACCESS_TOKEN||""}`);const _={url:dt(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(x,T){return _o(jt(x,{method:"GET"}),T)}(_,x=>{this.pendingRequest=null,u(x),this.saveEventData(),this.processRequests(f)})}getSessionAPI(l,o,u,f){this.skuToken=o,this.errorCb=f,b.SESSION_PATH&&b.API_URL&&(u||b.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},u):this.errorCb(new Error(we)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},l)}},vo=ja.getSessionAPI.bind(ja),hs=new Set,Fc={create:"create",load:"load",fullLoad:"fullLoad"},B1={mark(l){g.performance.mark(l)},measure(l,o,u){g.performance.measure(l,o,u)}};function y_(l){const o=l.name.split("?")[0];return De(o)&&o.includes("mapbox-gl.js")?"javascript":De(o)&&o.includes("mapbox-gl.css")?"css":function(u){return b.API_FONTS_REGEX.test(u)}(o)?"fontRange":qe(o)?"sprite":Ie(o)?"style":function(u){return b.API_TILEJSON_REGEX.test(u)}(o)?"tilejson":"other"}const On=g.performance;function Eg(l){const o=l?l.url.toString():void 0;return On.getEntriesByName(o)}let Uh,bg,gp,qa;const Tl={now:()=>gp!==void 0?gp:g.performance.now(),setNow(l){gp=l},restoreNow(){gp=void 0},frame(l){const o=g.requestAnimationFrame(l);return{cancel:()=>g.cancelAnimationFrame(o)}},getImageData(l,o=0){const{width:u,height:f}=l;qa||(qa=g.document.createElement("canvas"));const d=qa.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(u>qa.width||f>qa.height)&&(qa.width=u,qa.height=f),d.clearRect(-o,-o,u+2*o,f+2*o),d.drawImage(l,0,0,u,f),d.getImageData(-o,-o,u+2*o,f+2*o)},resolveURL:l=>(Uh||(Uh=g.document.createElement("a")),Uh.href=l,Uh.href),get devicePixelRatio(){return g.devicePixelRatio},get prefersReducedMotion(){return!!g.matchMedia&&(bg==null&&(bg=g.matchMedia("(prefers-reduced-motion: reduce)")),bg.matches)}};function Tg(l,o,u){u[l]&&u[l].indexOf(o)!==-1||(u[l]=u[l]||[],u[l].push(o))}function Sg(l,o,u){if(u&&u[l]){const f=u[l].indexOf(o);f!==-1&&u[l].splice(f,1)}}class Hu{constructor(o,u={}){jt(this,u),this.type=o}}class Sl extends Hu{constructor(o,u={}){super("error",jt({error:o},u))}}class Gh{on(o,u){return this._listeners=this._listeners||{},Tg(o,u,this._listeners),this}off(o,u){return Sg(o,u,this._listeners),Sg(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Tg(o,u,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,u){typeof o=="string"&&(o=new Hu(o,u||{}));const f=o.type;if(this.listens(f)){o.target=this;const d=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of d)T.call(this,o);const _=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of _)Sg(f,T,this._oneTimeListeners),T.call(this,o);const x=this._eventedParent;x&&(jt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(o))}else o instanceof Sl&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Il(l,...o){for(const u of o)for(const f in u)l[f]=u[f];return l}function Xi(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function xo(l){if(Array.isArray(l))return l.map(xo);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const u in l)o[u]=xo(l[u]);return o}return Xi(l)}class __ extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}var $a=__;class Ig{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[f,d]of u)this.bindings[f]=d}concat(o){return new Ig(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var v_=Ig;const zc={kind:"null"},Dt={kind:"number"},Ur={kind:"string"},Nr={kind:"boolean"},Bs={kind:"color"},Sa={kind:"object"},Rr={kind:"value"},Us={kind:"collator"},Vh={kind:"formatted"},Ku={kind:"resolvedImage"};function Qs(l,o){return{kind:"array",itemType:l,N:o}}function gi(l){if(l.kind==="array"){const o=gi(l.itemType);return typeof l.N=="number"?`array<${o}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${o}>`}return l.kind}const x_=[zc,Dt,Ur,Nr,Bs,Vh,Sa,Qs(Rr),Ku];function Pl(l,o){if(o.kind==="error")return null;if(l.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Pl(l.itemType,o.itemType))&&(typeof l.N!="number"||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if(l.kind==="value"){for(const u of x_)if(!Pl(u,o))return null}}return`Expected ${gi(l)} but found ${gi(o)} instead.`}function jh(l,o){return o.some(u=>u.kind===l.kind)}function qh(l,o){return o.some(u=>u==="null"?l===null:u==="array"?Array.isArray(l):u==="object"?l&&!Array.isArray(l)&&typeof l=="object":u===typeof l)}var Pg,w_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $h(l){return(l=Math.round(l))<0?0:l>255?255:l}function Zh(l){return $h(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function mp(l){return(o=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:o>1?1:o;var o}function Bc(l,o,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?l+(o-l)*u*6:2*u<1?o:3*u<2?l+(o-l)*(2/3-u)*6:l}try{Pg={}.parseCSSColor=function(l){var o,u=l.replace(/ /g,"").toLowerCase();if(u in w_)return w_[u].slice();if(u[0]==="#")return u.length===4?(o=parseInt(u.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:u.length===7&&(o=parseInt(u.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var f=u.indexOf("("),d=u.indexOf(")");if(f!==-1&&d+1===u.length){var _=u.substr(0,f),x=u.substr(f+1,d-(f+1)).split(","),T=1;switch(_){case"rgba":if(x.length!==4)return null;T=mp(x.pop());case"rgb":return x.length!==3?null:[Zh(x[0]),Zh(x[1]),Zh(x[2]),T];case"hsla":if(x.length!==4)return null;T=mp(x.pop());case"hsl":if(x.length!==3)return null;var P=(parseFloat(x[0])%360+360)%360/360,C=mp(x[1]),O=mp(x[2]),R=O<=.5?O*(C+1):O+C-O*C,F=2*O-R;return[$h(255*Bc(F,R,P+1/3)),$h(255*Bc(F,R,P)),$h(255*Bc(F,R,P-1/3)),T];default:return null}}return null}}catch{}class ws{constructor(o,u,f,d=1){this.r=o,this.g=u,this.b=f,this.a=d}static parse(o){if(!o)return;if(o instanceof ws)return o;if(typeof o!="string")return;const u=Pg(o);return u?new ws(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[o,u,f,d]=this.toArray();return`rgba(${Math.round(o)},${Math.round(u)},${Math.round(f)},${d})`}toArray(){const{r:o,g:u,b:f,a:d}=this;return d===0?[0,0,0,0]:[255*o/d,255*u/d,255*f/d,d]}toArray01(){const{r:o,g:u,b:f,a:d}=this;return d===0?[0,0,0,0]:[o/d,u/d,f/d,d]}toArray01PremultipliedAlpha(){const{r:o,g:u,b:f,a:d}=this;return[o,u,f,d]}}ws.black=new ws(0,0,0,1),ws.white=new ws(1,1,1,1),ws.transparent=new ws(0,0,0,0),ws.red=new ws(1,0,0,1),ws.blue=new ws(0,0,1,1);var Bi=ws;class Cg{constructor(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ag{constructor(o,u,f,d,_){this.text=o.normalize?o.normalize():o,this.image=u,this.scale=f,this.fontStack=d,this.textColor=_}}class Es{constructor(o){this.sections=o}static fromString(o){return new Es([new Ag(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Es?o:Es.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const u of this.sections){if(u.image){o.push(["image",u.image.name]);continue}o.push(u.text);const f={};u.fontStack&&(f["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(f["font-scale"]=u.scale),u.textColor&&(f["text-color"]=["rgba"].concat(u.textColor.toArray())),o.push(f)}return o}}class ea{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new ea({name:o,available:!1}):null}serialize(){return["image",this.name]}}function E_(l,o,u,f){return typeof l=="number"&&l>=0&&l<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[l,o,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[l,o,u,f]:[l,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xh(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Bi||l instanceof Cg||l instanceof Es||l instanceof ea)return!0;if(Array.isArray(l)){for(const o of l)if(!Xh(o))return!1;return!0}if(typeof l=="object"){for(const o in l)if(!Xh(l[o]))return!1;return!0}return!1}function Li(l){if(l===null)return zc;if(typeof l=="string")return Ur;if(typeof l=="boolean")return Nr;if(typeof l=="number")return Dt;if(l instanceof Bi)return Bs;if(l instanceof Cg)return Us;if(l instanceof Es)return Vh;if(l instanceof ea)return Ku;if(Array.isArray(l)){const o=l.length;let u;for(const f of l){const d=Li(f);if(u){if(u===d)continue;u=Rr;break}u=d}return Qs(u||Rr,o)}return Sa}function Wh(l){const o=typeof l;return l===null?"":o==="string"||o==="number"||o==="boolean"?String(l):l instanceof Bi||l instanceof Es||l instanceof ea?l.toString():JSON.stringify(l)}class Mg{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(o.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Xh(o[1]))return u.error("invalid value");const f=o[1];let d=Li(f);const _=u.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Mg(d,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Es?this.value.serialize():this.value}}var Yu=Mg,ko=class{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}};const Lg={string:Ur,number:Dt,boolean:Nr,object:Sa};class Og{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f,d=1;const _=o[0];if(_==="array"){let T,P;if(o.length>2){const C=o[1];if(typeof C!="string"||!(C in Lg)||C==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);T=Lg[C],d++}else T=Rr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=o[2],d++}f=Qs(T,P)}else f=Lg[_];const x=[];for(;d<o.length;d++){const T=u.parse(o[d],d,Rr);if(!T)return null;x.push(T)}return new Og(f,x)}evaluate(o){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(o);if(!Pl(this.type,Li(f)))return f;if(u===this.args.length-1)throw new ko(`Expected value to be of type ${gi(this.type)}, but found ${gi(Li(f))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,u=[o.kind];if(o.kind==="array"){const f=o.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);const d=o.N;(typeof d=="number"||this.args.length>1)&&u.push(d)}}return u.concat(this.args.map(f=>f.serialize()))}}var Cl=Og;class du{constructor(o){this.type=Vh,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const d=[];let _=!1;for(let x=1;x<=o.length-1;++x){const T=o[x];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let P=null;if(T["font-scale"]&&(P=u.parse(T["font-scale"],1,Dt),!P))return null;let C=null;if(T["text-font"]&&(C=u.parse(T["text-font"],1,Qs(Ur)),!C))return null;let O=null;if(T["text-color"]&&(O=u.parse(T["text-color"],1,Bs),!O))return null;const R=d[d.length-1];R.scale=P,R.font=C,R.textColor=O}else{const P=u.parse(o[x],1,Rr);if(!P)return null;const C=P.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:P,scale:null,font:null,textColor:null})}}return new du(d)}evaluate(o){return new Es(this.sections.map(u=>{const f=u.content.evaluate(o);return Li(f)===Ku?new Ag("",f,null,null,null):new Ag(Wh(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const u of this.sections){o.push(u.content.serialize());const f={};u.scale&&(f["font-scale"]=u.scale.serialize()),u.font&&(f["text-font"]=u.font.serialize()),u.textColor&&(f["text-color"]=u.textColor.serialize()),o.push(f)}return o}}class yp{constructor(o){this.type=Ku,this.input=o}static parse(o,u){if(o.length!==2)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Ur);return f?new yp(f):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),f=ea.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const U1={"to-boolean":Nr,"to-color":Bs,"to-number":Dt,"to-string":Ur};class Dg{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[0];if((f==="to-boolean"||f==="to-string")&&o.length!==2)return u.error("Expected one argument.");const d=U1[f],_=[];for(let x=1;x<o.length;x++){const T=u.parse(o[x],x,Rr);if(!T)return null;_.push(T)}return new Dg(d,_)}evaluate(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){let u,f;for(const d of this.args){if(u=d.evaluate(o),f=null,u instanceof Bi)return u;if(typeof u=="string"){const _=o.parseColor(u);if(_)return _}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:E_(u[0],u[1],u[2],u[3]),!f))return new Bi(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ko(f||`Could not parse color from value '${typeof u=="string"?u:String(JSON.stringify(u))}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(o),u===null)return 0;const d=Number(u);if(!isNaN(d))return d}throw new ko(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?Es.fromString(Wh(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?ea.fromString(Wh(this.args[0].evaluate(o))):Wh(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if(this.type.kind==="formatted")return new du([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Uc=Dg;const Za=["Unknown","Point","LineString","Polygon"];var Ng=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Za[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-l[0])+this.featureDistanceData.bearing[1]*(f*o-l[1])}return 0}parseColor(l){let o=this._parseColorCache[l];return o||(o=this._parseColorCache[l]=Bi.parse(l)),o}};class Ju{constructor(o,u,f,d){this.name=o,this.type=u,this._evaluate=f,this.args=d}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,u){const f=o[0],d=Ju.definitions[f];if(!d)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,x=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,T=x.filter(([C])=>!Array.isArray(C)||C.length===o.length-1);let P=null;for(const[C,O]of T){P=new Ug(u.registry,u.path,null,u.scope);const R=[];let F=!1;for(let G=1;G<o.length;G++){const q=o[G],K=Array.isArray(C)?C[G-1]:C.type,re=P.parse(q,1+R.length,K);if(!re){F=!0;break}R.push(re)}if(!F)if(Array.isArray(C)&&C.length!==R.length)P.error(`Expected ${C.length} arguments, but found ${R.length} instead.`);else{for(let G=0;G<R.length;G++){const q=Array.isArray(C)?C[G]:C.type,K=R[G];P.concat(G+1).checkSubtype(q,K.type)}if(P.errors.length===0)return new Ju(f,_,O,R)}}if(T.length===1)u.errors.push(...P.errors);else{const C=(T.length?T:x).map(([R])=>{return F=R,Array.isArray(F)?`(${F.map(gi).join(", ")})`:`(${gi(F.type)}...)`;var F}).join(" | "),O=[];for(let R=1;R<o.length;R++){const F=u.parse(o[R],1+O.length);if(!F)return null;O.push(gi(F.type))}u.error(`Expected arguments of type ${C}, but found (${O.join(", ")}) instead.`)}return null}static register(o,u){Ju.definitions=u;for(const f in u)o[f]=Ju}}var Al=Ju;class Hh{constructor(o,u,f){this.type=Us,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(o.length!==2)return u.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const d=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Nr);if(!d)return null;const _=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Nr);if(!_)return null;let x=null;return f.locale&&(x=u.parse(f.locale,1,Ur),!x)?null:new Hh(d,_,x)}evaluate(o){return new Cg(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ml=8192;function _p(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function Gc(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function Kh(l,o){const u=(180+l[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,d=Math.pow(2,o.z);return[Math.round(u*d*Ml),Math.round(f*d*Ml)]}function b_(l,o,u){const f=l[0]-o[0],d=l[1]-o[1],_=l[0]-u[0],x=l[1]-u[1];return f*x-_*d==0&&f*_<=0&&d*x<=0}function vp(l,o){let u=!1;for(let x=0,T=o.length;x<T;x++){const P=o[x];for(let C=0,O=P.length;C<O-1;C++){if(b_(l,P[C],P[C+1]))return!1;(d=P[C])[1]>(f=l)[1]!=(_=P[C+1])[1]>f[1]&&f[0]<(_[0]-d[0])*(f[1]-d[1])/(_[1]-d[1])+d[0]&&(u=!u)}}var f,d,_;return u}function Rg(l,o){for(let u=0;u<o.length;u++)if(vp(l,o[u]))return!0;return!1}function kg(l,o,u,f){const d=f[0]-u[0],_=f[1]-u[1],x=(l[0]-u[0])*_-d*(l[1]-u[1]),T=(o[0]-u[0])*_-d*(o[1]-u[1]);return x>0&&T<0||x<0&&T>0}function Vc(l,o,u){for(const C of u)for(let O=0;O<C.length-1;++O)if((T=[(x=C[O+1])[0]-(_=C[O])[0],x[1]-_[1]])[0]*(P=[(d=o)[0]-(f=l)[0],d[1]-f[1]])[1]-T[1]*P[0]!=0&&kg(f,d,_,x)&&kg(_,x,f,d))return!0;var f,d,_,x,T,P;return!1}function Dn(l,o){for(let u=0;u<l.length;++u)if(!vp(l[u],o))return!1;for(let u=0;u<l.length-1;++u)if(Vc(l[u],l[u+1],o))return!1;return!0}function G1(l,o){for(let u=0;u<o.length;u++)if(Dn(l,o[u]))return!0;return!1}function Fg(l,o,u){const f=[];for(let d=0;d<l.length;d++){const _=[];for(let x=0;x<l[d].length;x++){const T=Kh(l[d][x],u);_p(o,T),_.push(T)}f.push(_)}return f}function T_(l,o,u){const f=[];for(let d=0;d<l.length;d++){const _=Fg(l[d],o,u);f.push(_)}return f}function zg(l,o,u,f){if(l[0]<u[0]||l[0]>u[2]){const d=.5*f;let _=l[0]-u[0]>d?-f:u[0]-l[0]>d?f:0;_===0&&(_=l[0]-u[2]>d?-f:u[2]-l[0]>d?f:0),l[0]+=_}_p(o,l)}function S_(l,o,u,f){const d=Math.pow(2,f.z)*Ml,_=[f.x*Ml,f.y*Ml],x=[];if(!l)return x;for(const T of l)for(const P of T){const C=[P.x+_[0],P.y+_[1]];zg(C,o,u,d),x.push(C)}return x}function Bg(l,o,u,f){const d=Math.pow(2,f.z)*Ml,_=[f.x*Ml,f.y*Ml],x=[];if(!l)return x;for(const P of l){const C=[];for(const O of P){const R=[O.x+_[0],O.y+_[1]];_p(o,R),C.push(R)}x.push(C)}if(o[2]-o[0]<=d/2){(T=o)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const P of x)for(const C of P)zg(C,o,u,d)}var T;return x}class jc{constructor(o,u){this.type=Nr,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Xh(o[1])){const f=o[1];if(f.type==="FeatureCollection")for(let d=0;d<f.features.length;++d){const _=f.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new jc(f,f.features[d].geometry)}else if(f.type==="Feature"){const d=f.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new jc(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new jc(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,f){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=u.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const T=Fg(f.coordinates,_,x),P=S_(u.geometry(),d,_,x);if(!Gc(d,_))return!1;for(const C of P)if(!vp(C,T))return!1}if(f.type==="MultiPolygon"){const T=T_(f.coordinates,_,x),P=S_(u.geometry(),d,_,x);if(!Gc(d,_))return!1;for(const C of P)if(!Rg(C,T))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,f){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=u.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const T=Fg(f.coordinates,_,x),P=Bg(u.geometry(),d,_,x);if(!Gc(d,_))return!1;for(const C of P)if(!Dn(C,T))return!1}if(f.type==="MultiPolygon"){const T=T_(f.coordinates,_,x),P=Bg(u.geometry(),d,_,x);if(!Gc(d,_))return!1;for(const C of P)if(!G1(C,T))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var xp=jc;function qc(l){if(l instanceof Al&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof xp)return!1;let o=!0;return l.eachChild(u=>{o&&!qc(u)&&(o=!1)}),o}function Ll(l){if(l instanceof Al&&l.name==="feature-state")return!1;let o=!0;return l.eachChild(u=>{o&&!Ll(u)&&(o=!1)}),o}function Qu(l,o){if(l instanceof Al&&o.indexOf(l.name)>=0)return!1;let u=!0;return l.eachChild(f=>{u&&!Qu(f,o)&&(u=!1)}),u}class wp{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=o[1];return u.scope.has(f)?new wp(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var I_=wp;class Yh{constructor(o,u=[],f,d=new v_,_=[]){this.registry=o,this.path=u,this.key=u.map(x=>`[${x}]`).join(""),this.scope=d,this.errors=_,this.expectedType=f}parse(o,u,f,d,_={}){return u?this.concat(u,f,d)._parse(o,_):this._parse(o,_)}_parse(o,u){function f(d,_,x){return x==="assert"?new Cl(_,[d]):x==="coerce"?new Uc(_,[d]):d}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=o[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let x=_.parse(o,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,P=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||P.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(T,P))return null}else x=f(x,T,u.typeAnnotation||"coerce");else x=f(x,T,u.typeAnnotation||"assert")}if(!(x instanceof Yu)&&x.type.kind!=="resolvedImage"&&Gg(x)){const T=new Ng;try{x=new Yu(x.type,x.evaluate(T))}catch(P){return this.error(P.message),null}}return x}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,f){const d=typeof o=="number"?this.path.concat(o):this.path,_=f?this.scope.concat(f):this.scope;return new Yh(this.registry,d,u||null,_,this.errors)}error(o,...u){const f=`${this.key}${u.map(d=>`[${d}]`).join("")}`;this.errors.push(new $a(f,o))}checkSubtype(o,u){const f=Pl(o,u);return f&&this.error(f),f}}var Ug=Yh;function Gg(l){if(l instanceof I_)return Gg(l.boundExpression);if(l instanceof Al&&l.name==="error"||l instanceof Hh||l instanceof xp)return!1;const o=l instanceof Uc||l instanceof Cl;let u=!0;return l.eachChild(f=>{u=o?u&&Gg(f):u&&f instanceof Yu}),!!u&&qc(l)&&Qu(l,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ep(l,o){const u=l.length-1;let f,d,_=0,x=u,T=0;for(;_<=x;)if(T=Math.floor((_+x)/2),f=l[T],d=l[T+1],f<=o){if(T===u||o<d)return T;_=T+1}else{if(!(f>o))throw new ko("Input is not a number.");x=T-1}return 0}class bp{constructor(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[d,_]of f)this.labels.push(d),this.outputs.push(_)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(o[1],1,Dt);if(!f)return null;const d=[];let _=null;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);for(let x=1;x<o.length;x+=2){const T=x===1?-1/0:o[x],P=o[x+1],C=x,O=x+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(d.length&&d[d.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const R=u.parse(P,O,_);if(!R)return null;_=_||R.type,d.push([T,R])}return new bp(_,f,d)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const d=this.input.evaluate(o);if(d<=u[0])return f[0].evaluate(o);const _=u.length;return d>=u[_-1]?f[_-1].evaluate(o):f[Ep(u,d)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o}}var Vg=bp;function Hr(l,o,u){return l*(1-u)+o*u}var Jh=Object.freeze({__proto__:null,array:function(l,o,u){return l.map((f,d)=>Hr(f,o[d],u))},color:function(l,o,u){return new Bi(Hr(l.r,o.r,u),Hr(l.g,o.g,u),Hr(l.b,o.b,u),Hr(l.a,o.a,u))},number:Hr});const P_=.95047,jg=1.08883,C_=4/29,ec=6/29,qg=3*ec*ec,V1=ec*ec*ec,j1=Math.PI/180,q1=180/Math.PI;function $g(l){return l>V1?Math.pow(l,1/3):l/qg+C_}function Zg(l){return l>ec?l*l*l:qg*(l-C_)}function Xg(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Tp(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function A_(l){const o=Tp(l.r),u=Tp(l.g),f=Tp(l.b),d=$g((.4124564*o+.3575761*u+.1804375*f)/P_),_=$g((.2126729*o+.7151522*u+.072175*f)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-$g((.0193339*o+.119192*u+.9503041*f)/jg)),alpha:l.a}}function M_(l){let o=(l.l+16)/116,u=isNaN(l.a)?o:o+l.a/500,f=isNaN(l.b)?o:o-l.b/200;return o=1*Zg(o),u=P_*Zg(u),f=jg*Zg(f),new Bi(Xg(3.2404542*u-1.5371385*o-.4985314*f),Xg(-.969266*u+1.8760108*o+.041556*f),Xg(.0556434*u-.2040259*o+1.0572252*f),l.alpha)}function $1(l,o,u){const f=o-l;return l+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Qh={forward:A_,reverse:M_,interpolate:function(l,o,u){return{l:Hr(l.l,o.l,u),a:Hr(l.a,o.a,u),b:Hr(l.b,o.b,u),alpha:Hr(l.alpha,o.alpha,u)}}},$c={forward:function(l){const{l:o,a:u,b:f}=A_(l),d=Math.atan2(f,u)*q1;return{h:d<0?d+360:d,c:Math.sqrt(u*u+f*f),l:o,alpha:l.a}},reverse:function(l){const o=l.h*j1,u=l.c;return M_({l:l.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:l.alpha})},interpolate:function(l,o,u){return{h:$1(l.h,o.h,u),c:Hr(l.c,o.c,u),l:Hr(l.l,o.l,u),alpha:Hr(l.alpha,o.alpha,u)}}};var Wg=Object.freeze({__proto__:null,hcl:$c,lab:Qh});class ef{constructor(o,u,f,d,_){this.type=o,this.operator=u,this.interpolation=f,this.input=d,this.labels=[],this.outputs=[];for(const[x,T]of _)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(o,u,f,d){let _=0;if(o.name==="exponential")_=Hg(u,o.base,f,d);else if(o.name==="linear")_=Hg(u,1,f,d);else if(o.name==="cubic-bezier"){const x=o.controlPoints;_=new ie(x[0],x[1],x[2],x[3]).solve(Hg(u,1,f,d))}return _}static parse(o,u){let[f,d,_,...x]=o;if(!Array.isArray(d)||d.length===0)return u.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const C=d[1];if(typeof C!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:C}}else{if(d[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const C=d.slice(1);if(C.length!==4||C.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:C}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(_=u.parse(_,2,Dt),!_)return null;const T=[];let P=null;f==="interpolate-hcl"||f==="interpolate-lab"?P=Bs:u.expectedType&&u.expectedType.kind!=="value"&&(P=u.expectedType);for(let C=0;C<x.length;C+=2){const O=x[C],R=x[C+1],F=C+3,G=C+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(T.length&&T[T.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const q=u.parse(R,G,P);if(!q)return null;P=P||q.type,T.push([O,q])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new ef(P,f,d,_,T):u.error(`Type ${gi(P)} is not interpolatable.`)}evaluate(o){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);const d=this.input.evaluate(o);if(d<=u[0])return f[0].evaluate(o);const _=u.length;if(d>=u[_-1])return f[_-1].evaluate(o);const x=Ep(u,d),T=ef.interpolationFactor(this.interpolation,d,u[x],u[x+1]),P=f[x].evaluate(o),C=f[x+1].evaluate(o);return this.operator==="interpolate"?Jh[this.type.kind.toLowerCase()](P,C,T):this.operator==="interpolate-hcl"?$c.reverse($c.interpolate($c.forward(P),$c.forward(C),T)):Qh.reverse(Qh.interpolate(Qh.forward(P),Qh.forward(C),T))}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,o,this.input.serialize()];for(let f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u}}function Hg(l,o,u,f){const d=f-u,_=l-u;return d===0?0:o===1?_/d:(Math.pow(o,_)-1)/(Math.pow(o,d)-1)}var Xa=ef;class Sp{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let f=null;const d=u.expectedType;d&&d.kind!=="value"&&(f=d);const _=[];for(const T of o.slice(1)){const P=u.parse(T,1+_.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,_.push(P)}const x=d&&_.some(T=>Pl(d,T.type));return new Sp(x?Rr:f,_)}evaluate(o){let u,f=null,d=0;for(const _ of this.args){if(d++,f=_.evaluate(o),f&&f instanceof ea&&!f.available&&(u||(u=f),f=null,d===this.args.length))return u;if(f!==null)break}return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Kg=Sp;class Ip{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let _=1;_<o.length-1;_+=2){const x=o[_];if(typeof x!="string")return u.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=u.parse(o[_+1],_+1);if(!T)return null;f.push([x,T])}const d=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return d?new Ip(f,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[u,f]of this.bindings)o.push(u,f.serialize());return o.push(this.result.serialize()),o}}var L_=Ip;class Yg{constructor(o,u,f){this.type=o,this.index=u,this.input=f}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Dt),d=u.parse(o[2],2,Qs(u.expectedType||Rr));return f&&d?new Yg(d.type.itemType,f,d):null}evaluate(o){const u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new ko(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new ko(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new ko(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Z1=Yg;class Jg{constructor(o,u){this.type=Nr,this.needle=o,this.haystack=u}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Rr),d=u.parse(o[2],2,Rr);return f&&d?jh(f.type,[Nr,Ur,Dt,zc,Rr])?new Jg(f,d):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(f.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(f==null)return!1;if(!qh(u,["boolean","string","number","null"]))throw new ko(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Li(u))} instead.`);if(!qh(f,["string","array"]))throw new ko(`Expected second argument to be of type array or string, but found ${gi(Li(f))} instead.`);return f.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Pp=Jg;class tf{constructor(o,u,f){this.type=Dt,this.needle=o,this.haystack=u,this.fromIndex=f}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Rr),d=u.parse(o[2],2,Rr);if(!f||!d)return null;if(!jh(f.type,[Nr,Ur,Dt,zc,Rr]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(f.type)} instead`);if(o.length===4){const _=u.parse(o[3],3,Dt);return _?new tf(f,d,_):null}return new tf(f,d)}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!qh(u,["boolean","string","number","null"]))throw new ko(`Expected first argument to be of type boolean, string, number or null, but found ${gi(Li(u))} instead.`);if(!qh(f,["string","array"]))throw new ko(`Expected second argument to be of type array or string, but found ${gi(Li(f))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(o);return f.indexOf(u,d)}return f.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var O_=tf;class Qg{constructor(o,u,f,d,_,x){this.inputType=o,this.type=u,this.input=f,this.cases=d,this.outputs=_,this.otherwise=x}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let f,d;u.expectedType&&u.expectedType.kind!=="value"&&(d=u.expectedType);const _={},x=[];for(let C=2;C<o.length-1;C+=2){let O=o[C];const R=o[C+1];Array.isArray(O)||(O=[O]);const F=u.concat(C);if(O.length===0)return F.error("Expected at least one branch label.");for(const q of O){if(typeof q!="number"&&typeof q!="string")return F.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return F.error("Numeric branch labels must be integer values.");if(f){if(F.checkSubtype(f,Li(q)))return null}else f=Li(q);if(_[String(q)]!==void 0)return F.error("Branch labels must be unique.");_[String(q)]=x.length}const G=u.parse(R,C,d);if(!G)return null;d=d||G.type,x.push(G)}const T=u.parse(o[1],1,Rr);if(!T)return null;const P=u.parse(o[o.length-1],o.length-1,d);return P?T.type.kind!=="value"&&u.concat(1).checkSubtype(f,T.type)?null:new Qg(f,d,T,_,x,P):null}evaluate(o){const u=this.input.evaluate(o);return(Li(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),f=[],d={};for(const x of u){const T=d[this.cases[x]];T===void 0?(d[this.cases[x]]=f.length,f.push([this.cases[x],[x]])):f[T][1].push(x)}const _=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,T]of f)o.push(T.length===1?_(T[0]):T.map(_)),o.push(this.outputs[x].serialize());return o.push(this.otherwise.serialize()),o}}var X1=Qg;class em{constructor(o,u,f){this.type=o,this.branches=u,this.otherwise=f}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const d=[];for(let x=1;x<o.length-1;x+=2){const T=u.parse(o[x],x,Nr);if(!T)return null;const P=u.parse(o[x+1],x+1,f);if(!P)return null;d.push([T,P]),f=f||P.type}const _=u.parse(o[o.length-1],o.length-1,f);return _?new em(f,d,_):null}evaluate(o){for(const[u,f]of this.branches)if(u.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,f]of this.branches)o(u),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var D_=em;class rf{constructor(o,u,f,d){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=d}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,Rr),d=u.parse(o[2],2,Dt);if(!f||!d)return null;if(!jh(f.type,[Qs(Rr),Ur,Rr]))return u.error(`Expected first argument to be of type array or string, but found ${gi(f.type)} instead`);if(o.length===4){const _=u.parse(o[3],3,Dt);return _?new rf(f.type,f,d,_):null}return new rf(f.type,f,d)}evaluate(o){const u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!qh(u,["string","array"]))throw new ko(`Expected first argument to be of type array or string, but found ${gi(Li(u))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(o);return u.slice(f,d)}return u.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var N_=rf;function Cp(l,o){return l==="=="||l==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function R_(l,o,u,f){return f.compare(o,u)===0}function Zc(l,o,u){const f=l!=="=="&&l!=="!=";return class uM{constructor(_,x,T){this.type=Nr,this.lhs=_,this.rhs=x,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||x.type.kind==="value"}static parse(_,x){if(_.length!==3&&_.length!==4)return x.error("Expected two or three arguments.");const T=_[0];let P=x.parse(_[1],1,Rr);if(!P)return null;if(!Cp(T,P.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${gi(P.type)}'.`);let C=x.parse(_[2],2,Rr);if(!C)return null;if(!Cp(T,C.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${gi(C.type)}'.`);if(P.type.kind!==C.type.kind&&P.type.kind!=="value"&&C.type.kind!=="value")return x.error(`Cannot compare types '${gi(P.type)}' and '${gi(C.type)}'.`);f&&(P.type.kind==="value"&&C.type.kind!=="value"?P=new Cl(C.type,[P]):P.type.kind!=="value"&&C.type.kind==="value"&&(C=new Cl(P.type,[C])));let O=null;if(_.length===4){if(P.type.kind!=="string"&&C.type.kind!=="string"&&P.type.kind!=="value"&&C.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(O=x.parse(_[3],3,Us),!O)return null}return new uM(P,C,O)}evaluate(_){const x=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(f&&this.hasUntypedArgument){const P=Li(x),C=Li(T);if(P.kind!==C.kind||P.kind!=="string"&&P.kind!=="number")throw new ko(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${P.kind}, ${C.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=Li(x),C=Li(T);if(P.kind!=="string"||C.kind!=="string")return o(_,x,T)}return this.collator?u(_,x,T,this.collator.evaluate(_)):o(_,x,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[l];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const W1=Zc("==",function(l,o,u){return o===u},R_),H1=Zc("!=",function(l,o,u){return o!==u},function(l,o,u,f){return!R_(0,o,u,f)}),K1=Zc("<",function(l,o,u){return o<u},function(l,o,u,f){return f.compare(o,u)<0}),Y1=Zc(">",function(l,o,u){return o>u},function(l,o,u,f){return f.compare(o,u)>0}),J1=Zc("<=",function(l,o,u){return o<=u},function(l,o,u,f){return f.compare(o,u)<=0}),k_=Zc(">=",function(l,o,u){return o>=u},function(l,o,u,f){return f.compare(o,u)>=0});class Ap{constructor(o,u,f,d,_,x){this.type=Ur,this.number=o,this.locale=u,this.currency=f,this.unit=d,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(o,u){if(o.length!==3)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Dt);if(!f)return null;const d=o[2];if(typeof d!="object"||Array.isArray(d))return u.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=u.parse(d.locale,1,Ur),!_))return null;let x=null;if(d.currency&&(x=u.parse(d.currency,1,Ur),!x))return null;let T=null;if(d.unit&&(T=u.parse(d.unit,1,Ur),!T))return null;let P=null;if(d["min-fraction-digits"]&&(P=u.parse(d["min-fraction-digits"],1,Dt),!P))return null;let C=null;return d["max-fraction-digits"]&&(C=u.parse(d["max-fraction-digits"],1,Dt),!C)?null:new Ap(f,_,x,T,P,C)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Xc{constructor(o){this.type=Dt,this.input=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=u.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${gi(f.type)} instead.`):new Xc(f):null}evaluate(o){const u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ko(`Expected value to be of type string or array, but found ${gi(Li(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(u=>{o.push(u.serialize())}),o}}const F_={"==":W1,"!=":H1,">":Y1,"<":K1,">=":k_,"<=":J1,array:Cl,at:Z1,boolean:Cl,case:D_,coalesce:Kg,collator:Hh,format:du,image:yp,in:Pp,"index-of":O_,interpolate:Xa,"interpolate-hcl":Xa,"interpolate-lab":Xa,length:Xc,let:L_,literal:Yu,match:X1,number:Cl,"number-format":Ap,object:Cl,slice:N_,step:Vg,string:Cl,"to-boolean":Uc,"to-color":Uc,"to-number":Uc,"to-string":Uc,var:I_,within:xp};function z_(l,[o,u,f,d]){o=o.evaluate(l),u=u.evaluate(l),f=f.evaluate(l);const _=d?d.evaluate(l):1,x=E_(o,u,f,_);if(x)throw new ko(x);return new Bi(o/255*_,u/255*_,f/255*_,_)}function Ol(l,o){return l in o}function Mp(l,o){const u=o[l];return u===void 0?null:u}function ta(l){return{type:l}}Al.register(F_,{error:[{kind:"error"},[Ur],(l,[o])=>{throw new ko(o.evaluate(l))}],typeof:[Ur,[Rr],(l,[o])=>gi(Li(o.evaluate(l)))],"to-rgba":[Qs(Dt,4),[Bs],(l,[o])=>o.evaluate(l).toArray()],rgb:[Bs,[Dt,Dt,Dt],z_],rgba:[Bs,[Dt,Dt,Dt,Dt],z_],has:{type:Nr,overloads:[[[Ur],(l,[o])=>Ol(o.evaluate(l),l.properties())],[[Ur,Sa],(l,[o,u])=>Ol(o.evaluate(l),u.evaluate(l))]]},get:{type:Rr,overloads:[[[Ur],(l,[o])=>Mp(o.evaluate(l),l.properties())],[[Ur,Sa],(l,[o,u])=>Mp(o.evaluate(l),u.evaluate(l))]]},"feature-state":[Rr,[Ur],(l,[o])=>Mp(o.evaluate(l),l.featureState||{})],properties:[Sa,[],l=>l.properties()],"geometry-type":[Ur,[],l=>l.geometryType()],id:[Rr,[],l=>l.id()],zoom:[Dt,[],l=>l.globals.zoom],pitch:[Dt,[],l=>l.globals.pitch||0],"distance-from-center":[Dt,[],l=>l.distanceFromCenter()],"heatmap-density":[Dt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Dt,[],l=>l.globals.lineProgress||0],"sky-radial-progress":[Dt,[],l=>l.globals.skyRadialProgress||0],accumulated:[Rr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Dt,ta(Dt),(l,o)=>{let u=0;for(const f of o)u+=f.evaluate(l);return u}],"*":[Dt,ta(Dt),(l,o)=>{let u=1;for(const f of o)u*=f.evaluate(l);return u}],"-":{type:Dt,overloads:[[[Dt,Dt],(l,[o,u])=>o.evaluate(l)-u.evaluate(l)],[[Dt],(l,[o])=>-o.evaluate(l)]]},"/":[Dt,[Dt,Dt],(l,[o,u])=>o.evaluate(l)/u.evaluate(l)],"%":[Dt,[Dt,Dt],(l,[o,u])=>o.evaluate(l)%u.evaluate(l)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(l,[o,u])=>Math.pow(o.evaluate(l),u.evaluate(l))],sqrt:[Dt,[Dt],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[Dt,[Dt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[Dt,[Dt],(l,[o])=>Math.log(o.evaluate(l))],log2:[Dt,[Dt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[Dt,[Dt],(l,[o])=>Math.sin(o.evaluate(l))],cos:[Dt,[Dt],(l,[o])=>Math.cos(o.evaluate(l))],tan:[Dt,[Dt],(l,[o])=>Math.tan(o.evaluate(l))],asin:[Dt,[Dt],(l,[o])=>Math.asin(o.evaluate(l))],acos:[Dt,[Dt],(l,[o])=>Math.acos(o.evaluate(l))],atan:[Dt,[Dt],(l,[o])=>Math.atan(o.evaluate(l))],min:[Dt,ta(Dt),(l,o)=>Math.min(...o.map(u=>u.evaluate(l)))],max:[Dt,ta(Dt),(l,o)=>Math.max(...o.map(u=>u.evaluate(l)))],abs:[Dt,[Dt],(l,[o])=>Math.abs(o.evaluate(l))],round:[Dt,[Dt],(l,[o])=>{const u=o.evaluate(l);return u<0?-Math.round(-u):Math.round(u)}],floor:[Dt,[Dt],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[Dt,[Dt],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[Nr,[Ur,Rr],(l,[o,u])=>l.properties()[o.value]===u.value],"filter-id-==":[Nr,[Rr],(l,[o])=>l.id()===o.value],"filter-type-==":[Nr,[Ur],(l,[o])=>l.geometryType()===o.value],"filter-<":[Nr,[Ur,Rr],(l,[o,u])=>{const f=l.properties()[o.value],d=u.value;return typeof f==typeof d&&f<d}],"filter-id-<":[Nr,[Rr],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u<f}],"filter->":[Nr,[Ur,Rr],(l,[o,u])=>{const f=l.properties()[o.value],d=u.value;return typeof f==typeof d&&f>d}],"filter-id->":[Nr,[Rr],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u>f}],"filter-<=":[Nr,[Ur,Rr],(l,[o,u])=>{const f=l.properties()[o.value],d=u.value;return typeof f==typeof d&&f<=d}],"filter-id-<=":[Nr,[Rr],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u<=f}],"filter->=":[Nr,[Ur,Rr],(l,[o,u])=>{const f=l.properties()[o.value],d=u.value;return typeof f==typeof d&&f>=d}],"filter-id->=":[Nr,[Rr],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u>=f}],"filter-has":[Nr,[Rr],(l,[o])=>o.value in l.properties()],"filter-has-id":[Nr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Nr,[Qs(Ur)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[Nr,[Qs(Rr)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[Nr,[Ur,Qs(Rr)],(l,[o,u])=>u.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[Nr,[Ur,Qs(Rr)],(l,[o,u])=>function(f,d,_,x){for(;_<=x;){const T=_+x>>1;if(d[T]===f)return!0;d[T]>f?x=T-1:_=T+1}return!1}(l.properties()[o.value],u.value,0,u.value.length-1)],all:{type:Nr,overloads:[[[Nr,Nr],(l,[o,u])=>o.evaluate(l)&&u.evaluate(l)],[ta(Nr),(l,o)=>{for(const u of o)if(!u.evaluate(l))return!1;return!0}]]},any:{type:Nr,overloads:[[[Nr,Nr],(l,[o,u])=>o.evaluate(l)||u.evaluate(l)],[ta(Nr),(l,o)=>{for(const u of o)if(u.evaluate(l))return!0;return!1}]]},"!":[Nr,[Nr],(l,[o])=>!o.evaluate(l)],"is-supported-script":[Nr,[Ur],(l,[o])=>{const u=l.globals&&l.globals.isSupportedScript;return!u||u(o.evaluate(l))}],upcase:[Ur,[Ur],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[Ur,[Ur],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[Ur,ta(Rr),(l,o)=>o.map(u=>Wh(u.evaluate(l))).join("")],"resolved-locale":[Ur,[Us],(l,[o])=>o.evaluate(l).resolvedLocale()]});var nf=F_;function B_(l){return{result:"success",value:l}}function tc(l){return{result:"error",value:l}}function Wc(l){return l["property-type"]==="data-driven"}function Lp(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Op(l){return!!l.expression&&l.expression.interpolated}function bn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function of(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function U_(l){return l}function Dp(l,o){const u=o.type==="color",f=l.stops&&typeof l.stops[0][0]=="object",d=f||!(f||l.property!==void 0),_=l.type||(Op(o)?"exponential":"interval");if(u&&((l=Il({},l)).stops&&(l.stops=l.stops.map(C=>[C[0],Bi.parse(C[1])])),l.default=Bi.parse(l.default?l.default:o.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Wg[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let x,T,P;if(_==="exponential")x=Dl;else if(_==="interval")x=Np;else if(_==="categorical"){x=G_,T=Object.create(null);for(const C of l.stops)T[C[0]]=C[1];P=typeof l.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);x=V_}if(f){const C={},O=[];for(let G=0;G<l.stops.length;G++){const q=l.stops[G],K=q[0].zoom;C[K]===void 0&&(C[K]={zoom:K,type:l.type,property:l.property,default:l.default,stops:[]},O.push(K)),C[K].stops.push([q[0].value,q[1]])}const R=[];for(const G of O)R.push([C[G].zoom,Dp(C[G],o)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Xa.interpolationFactor.bind(void 0,F),zoomStops:R.map(G=>G[0]),evaluate:({zoom:G},q)=>Dl({stops:R,base:l.base},o,G).evaluate(G,q)}}if(d){const C=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Xa.interpolationFactor.bind(void 0,C),zoomStops:l.stops.map(O=>O[0]),evaluate:({zoom:O})=>x(l,o,O,T,P)}}return{kind:"source",evaluate(C,O){const R=O&&O.properties?O.properties[l.property]:void 0;return R===void 0?Hc(l.default,o.default):x(l,o,R,T,P)}}}function Hc(l,o,u){return l!==void 0?l:o!==void 0?o:u!==void 0?u:void 0}function G_(l,o,u,f,d){return Hc(typeof u===d?f[u]:void 0,l.default,o.default)}function Np(l,o,u){if(bn(u)!=="number")return Hc(l.default,o.default);const f=l.stops.length;if(f===1||u<=l.stops[0][0])return l.stops[0][1];if(u>=l.stops[f-1][0])return l.stops[f-1][1];const d=Ep(l.stops.map(_=>_[0]),u);return l.stops[d][1]}function Dl(l,o,u){const f=l.base!==void 0?l.base:1;if(bn(u)!=="number")return Hc(l.default,o.default);const d=l.stops.length;if(d===1||u<=l.stops[0][0])return l.stops[0][1];if(u>=l.stops[d-1][0])return l.stops[d-1][1];const _=Ep(l.stops.map(O=>O[0]),u),x=function(O,R,F,G){const q=G-F,K=O-F;return q===0?0:R===1?K/q:(Math.pow(R,K)-1)/(Math.pow(R,q)-1)}(u,f,l.stops[_][0],l.stops[_+1][0]),T=l.stops[_][1],P=l.stops[_+1][1];let C=Jh[o.type]||U_;if(l.colorSpace&&l.colorSpace!=="rgb"){const O=Wg[l.colorSpace];C=(R,F)=>O.reverse(O.interpolate(O.forward(R),O.forward(F),x))}return typeof T.evaluate=="function"?{evaluate(...O){const R=T.evaluate.apply(void 0,O),F=P.evaluate.apply(void 0,O);if(R!==void 0&&F!==void 0)return C(R,F,x)}}:C(T,P,x)}function V_(l,o,u){return o.type==="color"?u=Bi.parse(u):o.type==="formatted"?u=Es.fromString(u.toString()):o.type==="resolvedImage"?u=ea.fromString(u.toString()):bn(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),Hc(u,l.default,o.default)}class Rp{constructor(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Ng,this._defaultValue=u?function(f){return f.type==="color"&&(of(f.default)||Array.isArray(f.default))?new Bi(0,0,0,0):f.type==="color"?Bi.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(o,u,f,d,_,x,T,P){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(o,u,f,d,_,x,T,P){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=P||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new ko(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function Kc(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in nf}function Yc(l,o){const u=new Ug(nf,[],o?function(d){const _={color:Bs,string:Ur,number:Dt,enum:Ur,boolean:Nr,formatted:Vh,resolvedImage:Ku};return d.type==="array"?Qs(_[d.value]||Rr,d.length):_[d.type]}(o):void 0),f=u.parse(l,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?B_(new Rp(f,o)):tc(u.errors)}class tm{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!Ll(u.expression)}evaluateWithoutErrorHandling(o,u,f,d,_,x){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,d,_,x)}evaluate(o,u,f,d,_,x){return this._styleExpression.evaluate(o,u,f,d,_,x)}}class sf{constructor(o,u,f,d){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!Ll(u.expression),this.interpolationType=d}evaluateWithoutErrorHandling(o,u,f,d,_,x){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,d,_,x)}evaluate(o,u,f,d,_,x){return this._styleExpression.evaluate(o,u,f,d,_,x)}interpolationFactor(o,u,f){return this.interpolationType?Xa.interpolationFactor(this.interpolationType,o,u,f):0}}function af(l,o){if((l=Yc(l,o)).result==="error")return l;const u=l.value.expression,f=qc(u);if(!f&&!Wc(o))return tc([new $a("","data expressions not supported")]);const d=Qu(u,["zoom","pitch","distance-from-center"]);if(!d&&!Lp(o))return tc([new $a("","zoom expressions not supported")]);const _=Fp(u);return _||d?_ instanceof $a?tc([_]):_ instanceof Xa&&!Op(o)?tc([new $a("",'"interpolate" expressions cannot be used with this property')]):B_(_?new sf(f?"camera":"composite",l.value,_.labels,_ instanceof Xa?_.interpolation:void 0):new tm(f?"constant":"source",l.value)):tc([new $a("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class kp{constructor(o,u){this._parameters=o,this._specification=u,Il(this,Dp(this._parameters,this._specification))}static deserialize(o){return new kp(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Fp(l){let o=null;if(l instanceof L_)o=Fp(l.result);else if(l instanceof Kg){for(const u of l.args)if(o=Fp(u),o)break}else(l instanceof Vg||l instanceof Xa)&&l.input instanceof Al&&l.input.name==="zoom"&&(o=l);return o instanceof $a||l.eachChild(u=>{const f=Fp(u);f instanceof $a?o=f:!o&&f?o=new $a("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new $a("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Rt{constructor(o,u,f,d){this.message=(o?`${o}: `:"")+f,d&&(this.identifier=d),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ia(l){const o=l.key,u=l.value,f=l.valueSpec||{},d=l.objectElementValidators||{},_=l.style,x=l.styleSpec;let T=[];const P=bn(u);if(P!=="object")return[new Rt(o,u,`object expected, ${P} found`)];for(const C in u){const O=C.split(".")[0];let R;d[O]?R=d[O]:f[O]?R=Wo:d["*"]?R=d["*"]:f["*"]&&(R=Wo),R?T=T.concat(R({key:(o&&`${o}.`)+C,value:u[C],valueSpec:f[O]||f["*"],style:_,styleSpec:x,object:u,objectKey:C},u)):T.push(new Rt(o,u[C],`unknown property "${C}"`))}for(const C in f)d[C]||f[C].required&&f[C].default===void 0&&u[C]===void 0&&T.push(new Rt(o,u,`missing required property "${C}"`));return T}function j_(l){const o=l.value,u=l.valueSpec,f=l.style,d=l.styleSpec,_=l.key,x=l.arrayElementValidator||Wo;if(bn(o)!=="array")return[new Rt(_,o,`array expected, ${bn(o)} found`)];if(u.length&&o.length!==u.length)return[new Rt(_,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new Rt(_,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let T={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};d.$version<7&&(T.function=u.function),bn(u.value)==="object"&&(T=u.value);let P=[];for(let C=0;C<o.length;C++)P=P.concat(x({array:o,arrayIndex:C,value:o[C],valueSpec:T,style:f,styleSpec:d,key:`${_}[${C}]`}));return P}function lf(l){const o=l.key,u=l.value,f=l.valueSpec;let d=bn(u);if(d==="number"&&u!=u&&(d="NaN"),d!=="number")return[new Rt(o,u,`number expected, ${d} found`)];if("minimum"in f){let _=f.minimum;if(bn(f.minimum)==="array"&&(_=f.minimum[l.arrayIndex]),u<_)return[new Rt(o,u,`${u} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(bn(f.maximum)==="array"&&(_=f.maximum[l.arrayIndex]),u>_)return[new Rt(o,u,`${u} is greater than the maximum value ${_}`)]}return[]}function uf(l){const o=l.valueSpec,u=Xi(l.value.type);let f,d,_,x={};const T=u!=="categorical"&&l.value.property===void 0,P=!T,C=bn(l.value.stops)==="array"&&bn(l.value.stops[0])==="array"&&bn(l.value.stops[0][0])==="object",O=Ia({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(G){if(u==="identity")return[new Rt(G.key,G.value,'identity function may not have a "stops" property')];let q=[];const K=G.value;return q=q.concat(j_({key:G.key,value:K,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:R})),bn(K)==="array"&&K.length===0&&q.push(new Rt(G.key,K,"array must have at least one stop")),q},default:function(G){return Wo({key:G.key,value:G.value,valueSpec:o,style:G.style,styleSpec:G.styleSpec})}}});return u==="identity"&&T&&O.push(new Rt(l.key,l.value,'missing required property "property"')),u==="identity"||l.value.stops||O.push(new Rt(l.key,l.value,'missing required property "stops"')),u==="exponential"&&l.valueSpec.expression&&!Op(l.valueSpec)&&O.push(new Rt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(P&&!Wc(l.valueSpec)?O.push(new Rt(l.key,l.value,"property functions not supported")):T&&!Lp(l.valueSpec)&&O.push(new Rt(l.key,l.value,"zoom functions not supported"))),u!=="categorical"&&!C||l.value.property!==void 0||O.push(new Rt(l.key,l.value,'"property" property is required')),O;function R(G){let q=[];const K=G.value,re=G.key;if(bn(K)!=="array")return[new Rt(re,K,`array expected, ${bn(K)} found`)];if(K.length!==2)return[new Rt(re,K,`array length 2 expected, length ${K.length} found`)];if(C){if(bn(K[0])!=="object")return[new Rt(re,K,`object expected, ${bn(K[0])} found`)];if(K[0].zoom===void 0)return[new Rt(re,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Rt(re,K,"object stop key must have value")];const he=Xi(K[0].zoom);if(typeof he!="number")return[new Rt(re,K[0].zoom,"stop zoom values must be numbers")];if(_&&_>he)return[new Rt(re,K[0].zoom,"stop zoom values must appear in ascending order")];he!==_&&(_=he,d=void 0,x={}),q=q.concat(Ia({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:lf,value:F}}))}else q=q.concat(F({key:`${re}[0]`,value:K[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},K));return Kc(xo(K[1]))?q.concat([new Rt(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):q.concat(Wo({key:`${re}[1]`,value:K[1],valueSpec:o,style:G.style,styleSpec:G.styleSpec}))}function F(G,q){const K=bn(G.value),re=Xi(G.value),he=G.value!==null?G.value:q;if(f){if(K!==f)return[new Rt(G.key,he,`${K} stop domain type must match previous stop domain type ${f}`)]}else f=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new Rt(G.key,he,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&u!=="categorical"){let _e=`number expected, ${K} found`;return Wc(o)&&u===void 0&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt(G.key,he,_e)]}return u!=="categorical"||K!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?u!=="categorical"&&K==="number"&&typeof re=="number"&&typeof d=="number"&&d!==void 0&&re<d?[new Rt(G.key,he,"stop domain values must appear in ascending order")]:(d=re,u==="categorical"&&re in x?[new Rt(G.key,he,"stop domain values must be unique")]:(x[re]=!0,[])):[new Rt(G.key,he,`integer expected, found ${String(re)}`)]}}function wo(l){const o=(l.expressionContext==="property"?af:Yc)(xo(l.value),l.valueSpec);if(o.result==="error")return o.value.map(f=>new Rt(`${l.key}${f.key}`,l.value,f.message));const u=o.value.expression||o.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!u.outputDefined())return[new Rt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Ll(u))return[new Rt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return cf(u,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!Qu(u,["zoom","feature-state"]))return[new Rt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!qc(u))return[new Rt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cf(l,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const d of o.valueSpec.expression.parameters)u.delete(d);if(u.size===0)return[];const f=[];return l instanceof Al&&u.has(l.name)?[new Rt(o.key,o.value,`["${l.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(l.eachChild(d=>{f.push(...cf(d,o))}),f)}function zp(l){const o=l.key,u=l.value,f=l.valueSpec,d=[];return Array.isArray(f.values)?f.values.indexOf(Xi(u))===-1&&d.push(new Rt(o,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Xi(u))===-1&&d.push(new Rt(o,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),d}function rm(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!rm(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}function Bp(l,o="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rm(l)||(l=Qc(l));const u=l;let f=!0;try{f=function(C){if(!Jc(C))return C;let O=xo(C);return Up(O),O=q_(O),O}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}const d=Ye[`filter_${o}`],_=Yc(f,d);let x=null;if(_.result==="error")throw new Error(_.value.map(C=>`${C.key}: ${C.message}`).join(", "));x=(C,O,R)=>_.value.evaluate(C,O,{},R);let T=null,P=null;if(f!==u){const C=Yc(u,d);if(C.result==="error")throw new Error(C.value.map(O=>`${O.key}: ${O.message}`).join(", "));T=(O,R,F,G,q)=>C.value.evaluate(O,R,{},F,void 0,void 0,G,q),P=!qc(C.value.expression)}return{filter:x,dynamicFilter:T||void 0,needGeometry:$_(f),needFeature:!!P}}function q_(l){if(!Array.isArray(l))return l;const o=function(u){if(nm.has(u[0])){for(let f=1;f<u.length;f++)if(Jc(u[f]))return!0}return u}(l);return o===!0?o:o.map(u=>q_(u))}function Up(l){let o=!1;const u=[];if(l[0]==="case"){for(let f=1;f<l.length-1;f+=2)o=o||Jc(l[f]),u.push(l[f+1]);u.push(l[l.length-1])}else if(l[0]==="match"){o=o||Jc(l[1]);for(let f=2;f<l.length-1;f+=2)u.push(l[f+1]);u.push(l[l.length-1])}else if(l[0]==="step"){o=o||Jc(l[1]);for(let f=1;f<l.length-1;f+=2)u.push(l[f+1])}o&&(l.length=0,l.push("any",...u));for(let f=1;f<l.length;f++)Up(l[f])}function Jc(l){if(!Array.isArray(l))return!1;if((o=l[0])==="pitch"||o==="distance-from-center")return!0;var o;for(let u=1;u<l.length;u++)if(Jc(l[u]))return!0;return!1}const nm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Q1(l,o){return l<o?-1:l>o?1:0}function $_(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let o=1;o<l.length;o++)if($_(l[o]))return!0;return!1}function Qc(l){if(!l)return!0;const o=l[0];return l.length<=1?o!=="any":o==="=="?im(l[1],l[2],"=="):o==="!="?Gp(im(l[1],l[2],"==")):o==="<"||o===">"||o==="<="||o===">="?im(l[1],l[2],o):o==="any"?(u=l.slice(1),["any"].concat(u.map(Qc))):o==="all"?["all"].concat(l.slice(1).map(Qc)):o==="none"?["all"].concat(l.slice(1).map(Qc).map(Gp)):o==="in"?om(l[1],l.slice(2)):o==="!in"?Gp(om(l[1],l.slice(2))):o==="has"?sm(l[1]):o==="!has"?Gp(sm(l[1])):o!=="within"||l;var u}function im(l,o,u){switch(l){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,l,o]}}function om(l,o){if(o.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",l,["literal",o.sort(Q1)]]:["filter-in-small",l,["literal",o]]}}function sm(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Gp(l){return["!",l]}function hf(l){return rm(xo(l.value))?wo(Il({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):ff(l)}function ff(l){const o=l.value,u=l.key;if(bn(o)!=="array")return[new Rt(u,o,`array expected, ${bn(o)} found`)];const f=l.styleSpec;let d,_=[];if(o.length<1)return[new Rt(u,o,"filter array must have at least 1 element")];switch(_=_.concat(zp({key:`${u}[0]`,value:o[0],valueSpec:f.filter_operator,style:l.style,styleSpec:l.styleSpec})),Xi(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Xi(o[1])==="$type"&&_.push(new Rt(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&_.push(new Rt(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(d=bn(o[1]),d!=="string"&&_.push(new Rt(`${u}[1]`,o[1],`string expected, ${d} found`)));for(let x=2;x<o.length;x++)d=bn(o[x]),Xi(o[1])==="$type"?_=_.concat(zp({key:`${u}[${x}]`,value:o[x],valueSpec:f.geometry_type,style:l.style,styleSpec:l.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new Rt(`${u}[${x}]`,o[x],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)_=_.concat(ff({key:`${u}[${x}]`,value:o[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":d=bn(o[1]),o.length!==2?_.push(new Rt(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new Rt(`${u}[1]`,o[1],`string expected, ${d} found`));break;case"within":d=bn(o[1]),o.length!==2?_.push(new Rt(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new Rt(`${u}[1]`,o[1],`object expected, ${d} found`))}return _}function am(l,o){const u=l.key,f=l.style,d=l.styleSpec,_=l.value,x=l.objectKey,T=d[`${o}_${l.layerType}`];if(!T)return[];const P=x.match(/^(.*)-transition$/);if(o==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return Wo({key:u,value:_,valueSpec:d.transition,style:f,styleSpec:d});const C=l.valueSpec||T[x];if(!C)return[new Rt(u,_,`unknown property "${x}"`)];let O;if(bn(_)==="string"&&Wc(C)&&!C.tokens&&(O=/^{([^}]+)}$/.exec(_))){const F=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new Rt(u,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: ${F}.`)]}const R=[];return l.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&R.push(new Rt(u,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&of(xo(_))&&Xi(_.type)==="identity"&&R.push(new Rt(u,_,'"text-font" does not support identity functions'))),R.concat(Wo({key:l.key,value:_,valueSpec:C,style:f,styleSpec:d,expressionContext:"property",propertyType:o,propertyKey:x}))}function Z_(l){return am(l,"paint")}function lm(l){return am(l,"layout")}function X_(l){let o=[];const u=l.value,f=l.key,d=l.style,_=l.styleSpec;u.type||u.ref||o.push(new Rt(f,u,'either "type" or "ref" is required'));let x=Xi(u.type);const T=Xi(u.ref);if(u.id){const P=Xi(u.id);for(let C=0;C<l.arrayIndex;C++){const O=d.layers[C];Xi(O.id)===P&&o.push(new Rt(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(C=>{C in u&&o.push(new Rt(f,u[C],`"${C}" is prohibited for ref layers`))}),d.layers.forEach(C=>{Xi(C.id)===T&&(P=C)}),P?P.ref?o.push(new Rt(f,u.ref,"ref cannot reference another ref layer")):x=Xi(P.type):typeof T=="string"&&o.push(new Rt(f,u.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky")if(u.source){const P=d.sources&&d.sources[u.source],C=P&&Xi(P.type);P?C==="vector"&&x==="raster"?o.push(new Rt(f,u.source,`layer "${u.id}" requires a raster source`)):C==="raster"&&x!=="raster"?o.push(new Rt(f,u.source,`layer "${u.id}" requires a vector source`)):C!=="vector"||u["source-layer"]?C==="raster-dem"&&x!=="hillshade"?o.push(new Rt(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||C==="geojson"&&P.lineMetrics||o.push(new Rt(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Rt(f,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new Rt(f,u.source,`source "${u.source}" not found`))}else o.push(new Rt(f,u,'missing required property "source"'));return o=o.concat(Ia({key:f,value:u,valueSpec:_.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wo({key:`${f}.type`,value:u.type,valueSpec:_.layer.type,style:l.style,styleSpec:l.styleSpec,object:u,objectKey:"type"}),filter:P=>hf(Il({layerType:x},P)),layout:P=>Ia({layer:u,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":C=>lm(Il({layerType:x},C))}}),paint:P=>Ia({layer:u,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":C=>Z_(Il({layerType:x},C))}})}})),o}function gu(l){const o=l.value,u=l.key,f=bn(o);return f!=="string"?[new Rt(u,o,`string expected, ${f} found`)]:[]}const W_={promoteId:function({key:l,value:o}){if(bn(o)==="string")return gu({key:l,value:o});{const u=[];for(const f in o)u.push(...gu({key:`${l}.${f}`,value:o[f]}));return u}}};function H_(l){const o=l.value,u=l.key,f=l.styleSpec,d=l.style;if(!o.type)return[new Rt(u,o,'"type" is required')];const _=Xi(o.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=Ia({key:u,value:o,valueSpec:f[`source_${_.replace("-","_")}`],style:l.style,styleSpec:f,objectElementValidators:W_}),x;case"geojson":if(x=Ia({key:u,value:o,valueSpec:f.source_geojson,style:d,styleSpec:f,objectElementValidators:W_}),o.cluster)for(const T in o.clusterProperties){const[P,C]=o.clusterProperties[T],O=typeof P=="string"?[P,["accumulated"],["get",T]]:P;x.push(...wo({key:`${u}.${T}.map`,value:C,expressionContext:"cluster-map"})),x.push(...wo({key:`${u}.${T}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return x;case"video":return Ia({key:u,value:o,valueSpec:f.source_video,style:d,styleSpec:f});case"image":return Ia({key:u,value:o,valueSpec:f.source_image,style:d,styleSpec:f});case"canvas":return[new Rt(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zp({key:`${u}.type`,value:o.type,valueSpec:{values:ex(f)},style:d,styleSpec:f})}}function ex(l){return l.source.reduce((o,u)=>{const f=l[u];return f.type.type==="enum"&&(o=o.concat(Object.keys(f.type.values))),o},[])}function K_(l){const o=l.value,u=l.styleSpec,f=u.light,d=l.style;let _=[];const x=bn(o);if(o===void 0)return _;if(x!=="object")return _=_.concat([new Rt("light",o,`object expected, ${x} found`)]),_;for(const T in o){const P=T.match(/^(.*)-transition$/);_=_.concat(P&&f[P[1]]&&f[P[1]].transition?Wo({key:T,value:o[T],valueSpec:u.transition,style:d,styleSpec:u}):f[T]?Wo({key:T,value:o[T],valueSpec:f[T],style:d,styleSpec:u}):[new Rt(T,o[T],`unknown property "${T}"`)])}return _}function um(l){const o=l.value,u=l.key,f=l.style,d=l.styleSpec,_=d.terrain;let x=[];const T=bn(o);if(o===void 0)return x;if(T!=="object")return x=x.concat([new Rt("terrain",o,`object expected, ${T} found`)]),x;for(const P in o){const C=P.match(/^(.*)-transition$/);x=x.concat(C&&_[C[1]]&&_[C[1]].transition?Wo({key:P,value:o[P],valueSpec:d.transition,style:f,styleSpec:d}):_[P]?Wo({key:P,value:o[P],valueSpec:_[P],style:f,styleSpec:d}):[new Rt(P,o[P],`unknown property "${P}"`)])}if(o.source){const P=f.sources&&f.sources[o.source],C=P&&Xi(P.type);P?C!=="raster-dem"&&x.push(new Rt(u,o.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):x.push(new Rt(u,o.source,`source "${o.source}" not found`))}else x.push(new Rt(u,o,'terrain is missing required property "source"'));return x}function Y_(l){const o=l.value,u=l.style,f=l.styleSpec,d=f.fog;let _=[];const x=bn(o);if(o===void 0)return _;if(x!=="object")return _=_.concat([new Rt("fog",o,`object expected, ${x} found`)]),_;for(const T in o){const P=T.match(/^(.*)-transition$/);_=_.concat(P&&d[P[1]]&&d[P[1]].transition?Wo({key:T,value:o[T],valueSpec:f.transition,style:u,styleSpec:f}):d[T]?Wo({key:T,value:o[T],valueSpec:d[T],style:u,styleSpec:f}):[new Rt(T,o[T],`unknown property "${T}"`)])}return _}const J_={"*":()=>[],array:j_,boolean:function(l){const o=l.value,u=l.key,f=bn(o);return f!=="boolean"?[new Rt(u,o,`boolean expected, ${f} found`)]:[]},number:lf,color:function(l){const o=l.key,u=l.value,f=bn(u);return f!=="string"?[new Rt(o,u,`color expected, ${f} found`)]:Pg(u)===null?[new Rt(o,u,`color expected, "${u}" found`)]:[]},enum:zp,filter:hf,function:uf,layer:X_,object:Ia,source:H_,light:K_,terrain:um,fog:Y_,string:gu,formatted:function(l){return gu(l).length===0?[]:wo(l)},resolvedImage:function(l){return gu(l).length===0?[]:wo(l)},projection:function(l){const o=l.value,u=l.styleSpec,f=u.projection,d=l.style;let _=[];const x=bn(o);if(x==="object")for(const T in o)_=_.concat(Wo({key:T,value:o[T],valueSpec:f[T],style:d,styleSpec:u}));else x!=="string"&&(_=_.concat([new Rt("projection",o,`object or string expected, ${x} found`)]));return _}};function Wo(l){const o=l.value,u=l.valueSpec,f=l.styleSpec;return u.expression&&of(Xi(o))?uf(l):u.expression&&Kc(xo(o))?wo(l):u.type&&J_[u.type]?J_[u.type](l):Ia(Il({},l,{valueSpec:u.type?f[u.type]:u}))}function tx(l){const o=l.value,u=l.key,f=gu(l);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new Rt(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new Rt(u,o,'"glyphs" url must include a "{range}" token'))),f}function Q_(l,o=Ye){return ra(Wo({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,objectElementValidators:{glyphs:tx,"*":()=>[]}}))}const rx=l=>ra(Z_(l)),nx=l=>ra(lm(l));function ra(l){return l.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function ev(l,o){let u=!1;if(o&&o.length)for(const f of o)l.fire(new Sl(new Error(f.message))),u=!0;return u}var ix=Wa,Pa=3;function Wa(l,o,u){var f=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var d=new Int32Array(this.arrayBuffer);l=d[0],this.d=(o=d[1])+2*(u=d[2]);for(var _=0;_<this.d*this.d;_++){var x=d[Pa+_],T=d[Pa+_+1];f.push(x===T?null:d.subarray(x,T))}var P=d[Pa+f.length+1];this.keys=d.subarray(d[Pa+f.length],P),this.bboxes=d.subarray(P),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var C=0;C<this.d*this.d;C++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=l,this.padding=u,this.scale=o/l,this.uid=0;var O=u/o*l;this.min=-O,this.max=l+O}Wa.prototype.insert=function(l,o,u,f,d){this._forEachCell(o,u,f,d,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(d)},Wa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Wa.prototype._insertCell=function(l,o,u,f,d,_){this.cells[d].push(_)},Wa.prototype.query=function(l,o,u,f,d){var _=this.min,x=this.max;if(l<=_&&o<=_&&x<=u&&x<=f&&!d)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(l,o,u,f,this._queryCell,T,{},d),T},Wa.prototype._queryCell=function(l,o,u,f,d,_,x,T){var P=this.cells[d];if(P!==null)for(var C=this.keys,O=this.bboxes,R=0;R<P.length;R++){var F=P[R];if(x[F]===void 0){var G=4*F;(T?T(O[G+0],O[G+1],O[G+2],O[G+3]):l<=O[G+2]&&o<=O[G+3]&&u>=O[G+0]&&f>=O[G+1])?(x[F]=!0,_.push(C[F])):x[F]=!1}}},Wa.prototype._forEachCell=function(l,o,u,f,d,_,x,T){for(var P=this._convertToCellCoord(l),C=this._convertToCellCoord(o),O=this._convertToCellCoord(u),R=this._convertToCellCoord(f),F=P;F<=O;F++)for(var G=C;G<=R;G++){var q=this.d*G+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&d.call(this,l,o,u,f,q,_,x,T))return}},Wa.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},Wa.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},Wa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,o=Pa+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var d=new Int32Array(o+u+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var _=o,x=0;x<l.length;x++){var T=l[x];d[Pa+x]=_,d.set(T,_),_+=T.length}return d[Pa+l.length]=_,d.set(this.keys,_),d[Pa+l.length+1]=_+=this.keys.length,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer};var rc=k(ix);const Vp={};function Bt(l,o,u={}){Object.defineProperty(l,"_classRegistryKey",{value:o,writeable:!1}),Vp[o]={klass:l,omit:u.omit||[]}}Bt(Object,"Object"),rc.serialize=function(l,o){const u=l.toArrayBuffer();return o&&o.push(u),{buffer:u}},rc.deserialize=function(l){return new rc(l.buffer)},Object.defineProperty(rc,"name",{value:"Grid"}),Bt(rc,"Grid"),Bt(Bi,"Color"),Bt(Error,"Error"),Bt(Ta,"AJAXError"),Bt(ea,"ResolvedImage"),Bt(kp,"StylePropertyFunction"),Bt(Rp,"StyleExpression",{omit:["_evaluator"]}),Bt(sf,"ZoomDependentExpression"),Bt(tm,"ZoomConstantExpression"),Bt(Al,"CompoundExpression",{omit:["_evaluate"]});for(const l in nf)Vp[nf[l]._classRegistryKey]||Bt(nf[l],`Expression${l}`);function cm(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function hm(l){return g.ImageBitmap&&l instanceof g.ImageBitmap}function eh(l,o){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(cm(l)||hm(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const u=l;return o&&o.push(u.buffer),u}if(l instanceof g.ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const u=[];for(const f of l)u.push(eh(f,o));return u}if(typeof l=="object"){const u=l.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const d=u.serialize?u.serialize(l,o):{};if(!u.serialize){for(const _ in l)l.hasOwnProperty(_)&&(Vp[f].omit.indexOf(_)>=0||(d[_]=eh(l[_],o)));l instanceof Error&&(d.message=l.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(d.$name=f),d}throw new Error("can't serialize object of type "+typeof l)}function nc(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||cm(l)||hm(l)||ArrayBuffer.isView(l)||l instanceof g.ImageData)return l;if(Array.isArray(l))return l.map(nc);if(typeof l=="object"){const o=l.$name||"Object",{klass:u}=Vp[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(l);const f=Object.create(u.prototype);for(const d of Object.keys(l))d!=="$name"&&(f[d]=nc(l[d]));return f}throw new Error("can't deserialize object of type "+typeof l)}const Ot={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function fm(l){for(const o of l)if(pm(o.charCodeAt(0)))return!0;return!1}function ox(l){for(const o of l)if(!tv(o.charCodeAt(0)))return!1;return!0}function tv(l){return!(Ot.Arabic(l)||Ot["Arabic Supplement"](l)||Ot["Arabic Extended-A"](l)||Ot["Arabic Presentation Forms-A"](l)||Ot["Arabic Presentation Forms-B"](l))}function pm(l){return!(l!==746&&l!==747&&(l<4352||!(Ot["Bopomofo Extended"](l)||Ot.Bopomofo(l)||Ot["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Ot["CJK Compatibility Ideographs"](l)||Ot["CJK Compatibility"](l)||Ot["CJK Radicals Supplement"](l)||Ot["CJK Strokes"](l)||!(!Ot["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Ot["CJK Unified Ideographs Extension A"](l)||Ot["CJK Unified Ideographs"](l)||Ot["Enclosed CJK Letters and Months"](l)||Ot["Hangul Compatibility Jamo"](l)||Ot["Hangul Jamo Extended-A"](l)||Ot["Hangul Jamo Extended-B"](l)||Ot["Hangul Jamo"](l)||Ot["Hangul Syllables"](l)||Ot.Hiragana(l)||Ot["Ideographic Description Characters"](l)||Ot.Kanbun(l)||Ot["Kangxi Radicals"](l)||Ot["Katakana Phonetic Extensions"](l)||Ot.Katakana(l)&&l!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Ot["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](l)||Ot["Unified Canadian Aboriginal Syllabics Extended"](l)||Ot["Vertical Forms"](l)||Ot["Yijing Hexagram Symbols"](l)||Ot["Yi Syllables"](l)||Ot["Yi Radicals"](l))))}function rv(l){return!(pm(l)||function(o){return!!(Ot["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Ot["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Ot["Letterlike Symbols"](o)||Ot["Number Forms"](o)||Ot["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ot["Control Pictures"](o)&&o!==9251||Ot["Optical Character Recognition"](o)||Ot["Enclosed Alphanumerics"](o)||Ot["Geometric Shapes"](o)||Ot["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ot["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ot["CJK Symbols and Punctuation"](o)||Ot.Katakana(o)||Ot["Private Use Area"](o)||Ot["CJK Compatibility Forms"](o)||Ot["Small Form Variants"](o)||Ot["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(l))}function nv(l){return l>=1424&&l<=2303||Ot["Arabic Presentation Forms-A"](l)||Ot["Arabic Presentation Forms-B"](l)}function sx(l,o){return!(!o&&nv(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Ot.Khmer(l))}function ax(l){for(const o of l)if(nv(o.charCodeAt(0)))return!0;return!1}const dm="deferred",gm="loading",mm="loaded";let th=null,y="unavailable",c=null;const p=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(y="error"),th&&th(l)};function v(){E.fire(new Hu("pluginStateChange",{pluginStatus:y,pluginURL:c}))}const E=new Gh,S=function(){return y},M=function(){if(y!==dm||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=gm,v(),c&&bl({url:c},l=>{l?p(l):(y=mm,v())})},L={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===mm||L.applyArabicShaping!=null,isLoading:()=>y===gm,setState(l){y=l.pluginStatus,c=l.pluginURL},isParsed:()=>L.applyArabicShaping!=null&&L.processBidirectionalText!=null&&L.processStyledBidirectionalText!=null,getPluginURL:()=>c};class N{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(u,f){for(const d of u)if(!sx(d.charCodeAt(0),f))return!1;return!0}(o,L.isLoaded())}}class U{constructor(o,u){this.property=o,this.value=u,this.expression=function(f,d){if(of(f))return new kp(f,d);if(Kc(f)){const _=af(f,d);if(_.result==="error")throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=f;return typeof f=="string"&&d.type==="color"&&(_=Bi.parse(f)),{kind:"constant",evaluate:()=>_}}}(u===void 0?o.specification.default:u,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)}}class B{constructor(o){this.property=o,this.value=new U(o,void 0)}transitioned(o,u){return new te(this.property,this.value,u,jt({},o.transition,this.transition),o.now)}untransitioned(){return new te(this.property,this.value,null,{},0)}}class ${constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Ce(this._values[o].value.value)}setValue(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].value=new U(this._values[o].property,u===null?void 0:Ce(u))}getTransition(o){return Ce(this._values[o].transition)}setTransition(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].transition=Ce(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f);const d=this.getTransition(u);d!==void 0&&(o[`${u}-transition`]=d)}return o}transitioned(o,u){const f=new se(this._properties);for(const d of Object.keys(this._values))f._values[d]=this._values[d].transitioned(o,u._values[d]);return f}untransitioned(){const o=new se(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class te{constructor(o,u,f,d,_){const x=d.delay||0,T=d.duration||0;_=_||0,this.property=o,this.value=u,this.begin=_+x,this.end=this.begin+T,o.specification.transition&&(d.delay||d.duration)&&(this.prior=f)}possiblyEvaluate(o,u,f){const d=o.now||0,_=this.value.possiblyEvaluate(o,u,f),x=this.prior;if(x){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return x.possiblyEvaluate(o,u,f);{const T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(o,u,f),_,Pt(T))}}return _}}class se{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,f){const d=new ce(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(o,u,f);return d}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class ue{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Ce(this._values[o].value)}setValue(o,u){this._values[o]=new U(this._values[o].property,u===null?void 0:Ce(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(o[u]=f)}return o}possiblyEvaluate(o,u,f){const d=new ce(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(o,u,f);return d}}class le{constructor(o,u,f){this.property=o,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,u,f,d){return this.property.evaluate(this.value,this.parameters,o,u,f,d)}}class ce{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class X{constructor(o){this.specification=o}possiblyEvaluate(o,u){return o.expression.evaluate(u)}interpolate(o,u,f){const d=Jh[this.specification.type];return d?d(o,u,f):o}}class oe{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,f,d){return new le(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},f,d)}:o.expression,u)}interpolate(o,u,f){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new le(this,{kind:"constant",value:void 0},o.parameters);const d=Jh[this.specification.type];return d?new le(this,{kind:"constant",value:d(o.value.value,u.value.value,f)},o.parameters):o}evaluate(o,u,f,d,_,x){return o.kind==="constant"?o.value:o.evaluate(u,f,d,_,x)}}class pe{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,d){return!!o.expression.evaluate(u,null,{},f,d)}interpolate(){return!1}}class de{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new N(0,{});for(const f in o){const d=o[f];d.specification.overridable&&this.overridableProperties.push(f);const _=this.defaultPropertyValues[f]=new U(d,void 0),x=this.defaultTransitionablePropertyValues[f]=new B(d);this.defaultTransitioningPropertyValues[f]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=_.possiblyEvaluate(u)}}}function be(l,o){return 256*(l=et(Math.floor(l),0,255))+et(Math.floor(o),0,255)}Bt(oe,"DataDrivenProperty"),Bt(X,"DataConstantProperty"),Bt(pe,"ColorRampProperty");const Se={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Te{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Me{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ae(l,o=1){let u=0,f=0;return{members:l.map(d=>{const _=Se[d.type].BYTES_PER_ELEMENT,x=u=Be(u,Math.max(o,_)),T=d.components||1;return f=Math.max(f,_),u+=_*T,{name:d.name,type:d.type,components:T,offset:x}}),size:Be(u,Math.max(f,o)),alignment:o}}function Be(l,o){return Math.ceil(l/o)*o}class ct extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const d=2*o;return this.int16[d+0]=u,this.int16[d+1]=f,o}}ct.prototype.bytesPerElement=4,Bt(ct,"StructArrayLayout2i4");class Re extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,o,u,f)}emplace(o,u,f,d){const _=3*o;return this.int16[_+0]=u,this.int16[_+1]=f,this.int16[_+2]=d,o}}Re.prototype.bytesPerElement=6,Bt(Re,"StructArrayLayout3i6");class rt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,d){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f,d)}emplace(o,u,f,d,_){const x=4*o;return this.int16[x+0]=u,this.int16[x+1]=f,this.int16[x+2]=d,this.int16[x+3]=_,o}}rt.prototype.bytesPerElement=8,Bt(rt,"StructArrayLayout4i8");class Ve extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T){const P=this.length;return this.resize(P+1),this.emplace(P,o,u,f,d,_,x,T)}emplace(o,u,f,d,_,x,T,P){const C=6*o,O=12*o,R=3*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.uint8[O+4]=d,this.uint8[O+5]=_,this.uint8[O+6]=x,this.uint8[O+7]=T,this.float32[R+2]=P,o}}Ve.prototype.bytesPerElement=12,Bt(Ve,"StructArrayLayout2i4ub1f12");class ut extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f,d)}emplace(o,u,f,d,_){const x=4*o;return this.float32[x+0]=u,this.float32[x+1]=f,this.float32[x+2]=d,this.float32[x+3]=_,o}}ut.prototype.bytesPerElement=16,Bt(ut,"StructArrayLayout4f16");class Fe extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,d,_)}emplace(o,u,f,d,_,x){const T=6*o,P=3*o;return this.uint16[T+0]=u,this.uint16[T+1]=f,this.uint16[T+2]=d,this.uint16[T+3]=_,this.float32[P+2]=x,o}}Fe.prototype.bytesPerElement=12,Bt(Fe,"StructArrayLayout4ui1f12");class tt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,d){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f,d)}emplace(o,u,f,d,_){const x=4*o;return this.uint16[x+0]=u,this.uint16[x+1]=f,this.uint16[x+2]=d,this.uint16[x+3]=_,o}}tt.prototype.bytesPerElement=8,Bt(tt,"StructArrayLayout4ui8");class ft extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,o,u,f,d,_,x)}emplace(o,u,f,d,_,x,T){const P=6*o;return this.int16[P+0]=u,this.int16[P+1]=f,this.int16[P+2]=d,this.int16[P+3]=_,this.int16[P+4]=x,this.int16[P+5]=T,o}}ft.prototype.bytesPerElement=12,Bt(ft,"StructArrayLayout6i12");class st extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T,P,C,O,R,F){const G=this.length;return this.resize(G+1),this.emplace(G,o,u,f,d,_,x,T,P,C,O,R,F)}emplace(o,u,f,d,_,x,T,P,C,O,R,F,G){const q=12*o;return this.int16[q+0]=u,this.int16[q+1]=f,this.int16[q+2]=d,this.int16[q+3]=_,this.uint16[q+4]=x,this.uint16[q+5]=T,this.uint16[q+6]=P,this.uint16[q+7]=C,this.int16[q+8]=O,this.int16[q+9]=R,this.int16[q+10]=F,this.int16[q+11]=G,o}}st.prototype.bytesPerElement=24,Bt(st,"StructArrayLayout4i4ui4i24");class pt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,o,u,f,d,_,x)}emplace(o,u,f,d,_,x,T){const P=10*o,C=5*o;return this.int16[P+0]=u,this.int16[P+1]=f,this.int16[P+2]=d,this.float32[C+2]=_,this.float32[C+3]=x,this.float32[C+4]=T,o}}pt.prototype.bytesPerElement=20,Bt(pt,"StructArrayLayout3i3f20");class Ht extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}Ht.prototype.bytesPerElement=4,Bt(Ht,"StructArrayLayout1ul4");class pr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T,P,C,O,R,F,G){const q=this.length;return this.resize(q+1),this.emplace(q,o,u,f,d,_,x,T,P,C,O,R,F,G)}emplace(o,u,f,d,_,x,T,P,C,O,R,F,G,q){const K=20*o,re=10*o;return this.int16[K+0]=u,this.int16[K+1]=f,this.int16[K+2]=d,this.int16[K+3]=_,this.int16[K+4]=x,this.float32[re+3]=T,this.float32[re+4]=P,this.float32[re+5]=C,this.float32[re+6]=O,this.int16[K+14]=R,this.uint32[re+8]=F,this.uint16[K+18]=G,this.uint16[K+19]=q,o}}pr.prototype.bytesPerElement=40,Bt(pr,"StructArrayLayout5i4f1i1ul2ui40");class Gt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T){const P=this.length;return this.resize(P+1),this.emplace(P,o,u,f,d,_,x,T)}emplace(o,u,f,d,_,x,T,P){const C=8*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=d,this.int16[C+4]=_,this.int16[C+5]=x,this.int16[C+6]=T,this.int16[C+7]=P,o}}Gt.prototype.bytesPerElement=16,Bt(Gt,"StructArrayLayout3i2i2i16");class or extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,d,_)}emplace(o,u,f,d,_,x){const T=4*o,P=8*o;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=d,this.int16[P+6]=_,this.int16[P+7]=x,o}}or.prototype.bytesPerElement=16,Bt(or,"StructArrayLayout2f1f2i16");class kr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f,d)}emplace(o,u,f,d,_){const x=12*o,T=3*o;return this.uint8[x+0]=u,this.uint8[x+1]=f,this.float32[T+1]=d,this.float32[T+2]=_,o}}kr.prototype.bytesPerElement=12,Bt(kr,"StructArrayLayout2ub2f12");class Dr extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,o,u,f)}emplace(o,u,f,d){const _=3*o;return this.float32[_+0]=u,this.float32[_+1]=f,this.float32[_+2]=d,o}}Dr.prototype.bytesPerElement=12,Bt(Dr,"StructArrayLayout3f12");class Xt extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,o,u,f)}emplace(o,u,f,d){const _=3*o;return this.uint16[_+0]=u,this.uint16[_+1]=f,this.uint16[_+2]=d,o}}Xt.prototype.bytesPerElement=6,Bt(Xt,"StructArrayLayout3ui6");class Fn extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe){const ve=this.length;return this.resize(ve+1),this.emplace(ve,o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe)}emplace(o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe,ve){const Ue=30*o,ke=15*o,Je=60*o;return this.int16[Ue+0]=u,this.int16[Ue+1]=f,this.int16[Ue+2]=d,this.float32[ke+2]=_,this.float32[ke+3]=x,this.uint16[Ue+8]=T,this.uint16[Ue+9]=P,this.uint32[ke+5]=C,this.uint32[ke+6]=O,this.uint32[ke+7]=R,this.uint16[Ue+16]=F,this.uint16[Ue+17]=G,this.uint16[Ue+18]=q,this.float32[ke+10]=K,this.float32[ke+11]=re,this.uint8[Je+48]=he,this.uint8[Je+49]=_e,this.uint8[Je+50]=fe,this.uint32[ke+13]=me,this.int16[Ue+28]=xe,this.uint8[Je+58]=ve,o}}Fn.prototype.bytesPerElement=60,Bt(Fn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jn extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe,ve,Ue,ke,Je,ht,je,nt,it,lt){const gt=this.length;return this.resize(gt+1),this.emplace(gt,o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe,ve,Ue,ke,Je,ht,je,nt,it,lt)}emplace(o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re,he,_e,fe,me,xe,ve,Ue,ke,Je,ht,je,nt,it,lt,gt){const He=38*o,Ct=19*o;return this.int16[He+0]=u,this.int16[He+1]=f,this.int16[He+2]=d,this.float32[Ct+2]=_,this.float32[Ct+3]=x,this.int16[He+8]=T,this.int16[He+9]=P,this.int16[He+10]=C,this.int16[He+11]=O,this.int16[He+12]=R,this.int16[He+13]=F,this.uint16[He+14]=G,this.uint16[He+15]=q,this.uint16[He+16]=K,this.uint16[He+17]=re,this.uint16[He+18]=he,this.uint16[He+19]=_e,this.uint16[He+20]=fe,this.uint16[He+21]=me,this.uint16[He+22]=xe,this.uint16[He+23]=ve,this.uint16[He+24]=Ue,this.uint16[He+25]=ke,this.uint16[He+26]=Je,this.uint16[He+27]=ht,this.uint16[He+28]=je,this.uint32[Ct+15]=nt,this.float32[Ct+16]=it,this.float32[Ct+17]=lt,this.float32[Ct+18]=gt,o}}jn.prototype.bytesPerElement=76,Bt(jn,"StructArrayLayout3i2f6i15ui1ul3f76");class qn extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}qn.prototype.bytesPerElement=4,Bt(qn,"StructArrayLayout1f4");class $n extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,d,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,d,_)}emplace(o,u,f,d,_,x){const T=5*o;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=d,this.float32[T+3]=_,this.float32[T+4]=x,o}}$n.prototype.bytesPerElement=20,Bt($n,"StructArrayLayout5f20");class Ho extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,d){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f,d)}emplace(o,u,f,d,_){const x=6*o;return this.uint32[3*o+0]=u,this.uint16[x+2]=f,this.uint16[x+3]=d,this.uint16[x+4]=_,o}}Ho.prototype.bytesPerElement=12,Bt(Ho,"StructArrayLayout1ul3ui12");class Eo extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const d=2*o;return this.uint16[d+0]=u,this.uint16[d+1]=f,o}}Eo.prototype.bytesPerElement=4,Bt(Eo,"StructArrayLayout2ui4");class na extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}na.prototype.bytesPerElement=2,Bt(na,"StructArrayLayout1ui2");class Ha extends Me{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const d=2*o;return this.float32[d+0]=u,this.float32[d+1]=f,o}}Ha.prototype.bytesPerElement=8,Bt(Ha,"StructArrayLayout2f8");class mi extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}mi.prototype.size=40;class Zn extends pr{get(o){return new mi(this,o)}}Bt(Zn,"CollisionBoxArray");class In extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}In.prototype.size=60;class Wi extends Fn{get(o){return new In(this,o)}}Bt(Wi,"PlacedSymbolArray");class fs extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}fs.prototype.size=76;class li extends jn{get(o){return new fs(this,o)}}Bt(li,"SymbolInstanceArray");class bs extends qn{getoffsetX(o){return this.float32[1*o+0]}}Bt(bs,"GlyphOffsetArray");class jp extends ct{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Bt(jp,"SymbolLineVertexArray");class ic extends Te{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ic.prototype.size=12;class pf extends Ho{get(o){return new ic(this,o)}}Bt(pf,"FeatureIndexArray");class Nl extends Eo{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Bt(Nl,"FillExtrusionCentroidArray");const mu=Ae([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),oc=Ae([{name:"a_dash",components:4,type:"Uint16"}]);var qp={exports:{}},df={exports:{}};df.exports=function(l,o){var u,f,d,_,x,T,P,C;for(f=l.length-(u=3&l.length),d=o,x=3432918353,T=461845907,C=0;C<f;)P=255&l.charCodeAt(C)|(255&l.charCodeAt(++C))<<8|(255&l.charCodeAt(++C))<<16|(255&l.charCodeAt(++C))<<24,++C,d=27492+(65535&(_=5*(65535&(d=(d^=P=(65535&(P=(P=(65535&P)*x+(((P>>>16)*x&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&l.charCodeAt(C+2))<<16;case 2:P^=(255&l.charCodeAt(C+1))<<8;case 1:d^=P=(65535&(P=(P=(65535&(P^=255&l.charCodeAt(C)))*x+(((P>>>16)*x&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return d^=l.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var ym=df.exports,jT={exports:{}};jT.exports=function(l,o){for(var u,f=l.length,d=o^f,_=0;f>=4;)u=1540483477*(65535&(u=255&l.charCodeAt(_)|(255&l.charCodeAt(++_))<<8|(255&l.charCodeAt(++_))<<16|(255&l.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++_;switch(f){case 3:d^=(255&l.charCodeAt(_+2))<<16;case 2:d^=(255&l.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&l.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var qT=ym,WD=jT.exports;qp.exports=qT,qp.exports.murmur3=qT,qp.exports.murmur2=WD;var lx=k(qp.exports);class iv{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,f,d){this.ids.push($T(o)),this.positions.push(u,f,d)}getPositions(o){const u=$T(o);let f=0,d=this.ids.length-1;for(;f<d;){const x=f+d>>1;this.ids[x]>=u?d=x:f=x+1}const _=[];for(;this.ids[f]===u;)_.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return _}static serialize(o,u){const f=new Float64Array(o.ids),d=new Uint32Array(o.positions);return ux(f,d,0,f.length-1),u&&u.push(f.buffer,d.buffer),{ids:f,positions:d}}static deserialize(o){const u=new iv;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function $T(l){const o=+l;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:lx(String(l))}function ux(l,o,u,f){for(;u<f;){const d=l[u+f>>1];let _=u-1,x=f+1;for(;;){do _++;while(l[_]<d);do x--;while(l[x]>d);if(_>=x)break;ov(l,_,x),ov(o,3*_,3*x),ov(o,3*_+1,3*x+1),ov(o,3*_+2,3*x+2)}x-u<f-x?(ux(l,o,u,x),u=x+1):(ux(l,o,x+1,f),f=x)}}function ov(l,o,u){const f=l[o];l[o]=l[u],l[u]=f}Bt(iv,"FeaturePositionMap");class sc{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,u),this.initialized=!0),!!this.location}}class sv extends sc{constructor(o){super(o),this.current=0}set(o,u,f){this.fetchUniformLocation(o,u)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class ZT extends sc{constructor(o){super(o),this.current=[0,0,0,0]}set(o,u,f){this.fetchUniformLocation(o,u)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class XT extends sc{constructor(o){super(o),this.current=Bi.transparent}set(o,u,f){this.fetchUniformLocation(o,u)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const HD=new Float32Array(16),KD=new Float32Array(9),YD=new Float32Array(4);function cx(l){return[be(255*l.r,255*l.g),be(255*l.b,255*l.a)]}class _m{constructor(o,u,f){this.value=o,this.uniformNames=u.map(d=>`u_${d}`),this.type=f}setUniform(o,u,f,d,_){u.set(o,_,d.constantOr(this.value))}getBinding(o,u){return this.type==="color"?new XT(o):new sv(o)}}class $p{constructor(o,u){this.uniformNames=u.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,u,f,d,_){const x=_==="u_pattern"||_==="u_dash"?this.pattern:_==="u_pixel_ratio"?this.pixelRatio:null;x&&u.set(o,_,x)}getBinding(o,u){return u==="u_pattern"||u==="u_dash"?new ZT(o):new sv(o)}}class ac{constructor(o,u,f,d){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(_=>({name:`a_${_}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(o,u,f,d,_,x){const T=this.paintVertexArray.length,P=this.expression.evaluate(new N(0),u,{},_,d,x);this.paintVertexArray.resize(o),this._setPaintValue(T,o,P)}updatePaintArray(o,u,f,d,_){const x=this.expression.evaluate({zoom:0},f,d,void 0,_);this._setPaintValue(o,u,x)}_setPaintValue(o,u,f){if(this.type==="color"){const d=cx(f);for(let _=o;_<u;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=o;d<u;d++)this.paintVertexArray.emplace(d,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rl{constructor(o,u,f,d,_,x){this.expression=o,this.uniformNames=u.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=u.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(o,u,f,d,_,x){const T=this.expression.evaluate(new N(this.zoom),u,{},_,d,x),P=this.expression.evaluate(new N(this.zoom+1),u,{},_,d,x),C=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(C,o,T,P)}updatePaintArray(o,u,f,d,_){const x=this.expression.evaluate({zoom:this.zoom},f,d,void 0,_),T=this.expression.evaluate({zoom:this.zoom+1},f,d,void 0,_);this._setPaintValue(o,u,x,T)}_setPaintValue(o,u,f,d){if(this.type==="color"){const _=cx(f),x=cx(d);for(let T=o;T<u;T++)this.paintVertexArray.emplace(T,_[0],_[1],x[0],x[1])}else{for(let _=o;_<u;_++)this.paintVertexArray.emplace(_,f,d);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u,f,d,_){const x=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,T=et(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);u.set(o,_,T)}getBinding(o,u){return new sv(o)}}class rh{constructor(o,u,f,d,_){this.expression=o,this.layerId=_,this.paintVertexAttributes=(f==="array"?oc:mu).members;for(let x=0;x<u.length;++x);this.paintVertexArray=new d}populatePaintArray(o,u,f){const d=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(d,o,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(o,u,f,d,_,x){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(o,u,f,d){if(!d||!f)return;const _=d[f];if(!_)return;const{tl:x,br:T,pixelRatio:P}=_;for(let C=o;C<u;C++)this.paintVertexArray.emplace(C,x[0],x[1],T[0],T[1],P)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class nh{constructor(o,u,f=()=>!0){this.binders={},this._buffers=[];const d=[];for(const _ in o.paint._values){if(!f(_))continue;const x=o.paint.get(_);if(!(x instanceof le&&Wc(x.property.specification)))continue;const T=QD(_,o.type),P=x.value,C=x.property.specification.type,O=!!x.property.useIntegerZoom,R=_==="line-dasharray"||_.endsWith("pattern"),F=_==="line-dasharray"&&o.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||F)if(P.kind==="source"||F||R){const G=WT(_,C,"source");this.binders[_]=R?new rh(P,T,C,G,o.id):new ac(P,T,C,G),d.push(`/a_${_}`)}else{const G=WT(_,C,"composite");this.binders[_]=new Rl(P,T,C,O,u,G),d.push(`/z_${_}`)}else this.binders[_]=R?new $p(P.value,T):new _m(P.value,T,C),d.push(`/u_${_}`)}this.cacheKey=d.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof ac||u instanceof Rl?u.maxValue:0}populatePaintArrays(o,u,f,d,_,x){for(const T in this.binders){const P=this.binders[T];(P instanceof ac||P instanceof Rl||P instanceof rh)&&P.populatePaintArray(o,u,f,d,_,x)}}setConstantPatternPositions(o){for(const u in this.binders){const f=this.binders[u];f instanceof $p&&f.setConstantPatternPositions(o)}}updatePaintArrays(o,u,f,d,_,x){let T=!1;for(const P in o){const C=u.getPositions(P);for(const O of C){const R=f.feature(O.index);for(const F in this.binders){const G=this.binders[F];if((G instanceof ac||G instanceof Rl||G instanceof rh)&&G.expression.isStateDependent===!0){const q=d.paint.get(F);G.expression=q.value,G.updatePaintArray(O.start,O.end,R,o[P],_,x),T=!0}}}}return T}defines(){const o=[];for(const u in this.binders){const f=this.binders[u];(f instanceof _m||f instanceof $p)&&o.push(...f.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ac||f instanceof Rl||f instanceof rh)for(let d=0;d<f.paintVertexAttributes.length;d++)o.push(f.paintVertexAttributes[d].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof _m||f instanceof $p||f instanceof Rl)for(const d of f.uniformNames)o.push(d)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const u=[];for(const f in this.binders){const d=this.binders[f];if(d instanceof _m||d instanceof $p||d instanceof Rl)for(const _ of d.uniformNames)u.push({name:_,property:f,binding:d.getBinding(o,_)})}return u}setUniforms(o,u,f,d,_){for(const{name:x,property:T,binding:P}of f)this.binders[T].setUniform(o,P,_,d.get(T),x)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const u=this.binders[o];(u instanceof ac||u instanceof Rl||u instanceof rh)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const u in this.binders){const f=this.binders[u];(f instanceof ac||f instanceof Rl||f instanceof rh)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof ac||u instanceof Rl||u instanceof rh)&&u.destroy()}}}class gf{constructor(o,u,f=()=>!0){this.programConfigurations={};for(const d of o)this.programConfigurations[d.id]=new nh(d,u,f);this.needsUpload=!1,this._featureMap=new iv,this._bufferOffset=0}populatePaintArrays(o,u,f,d,_,x,T){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(o,u,d,_,x,T);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,f,d,_){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(o,this._featureMap,u,x,d,_)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const JD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function QD(l,o){return JD[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}const e3={"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe},"line-dasharray":{source:tt,composite:tt}},t3={color:{source:Ha,composite:ut},number:{source:qn,composite:Ha}};function WT(l,o,u){const f=e3[l];return f&&f[u]||t3[o][u]}Bt(_m,"ConstantBinder"),Bt($p,"PatternConstantBinder"),Bt(ac,"SourceExpressionBinder"),Bt(rh,"PatternCompositeBinder"),Bt(Rl,"CompositeExpressionBinder"),Bt(nh,"ProgramConfiguration",{omit:["_buffers"]}),Bt(gf,"ProgramConfigurationSet");const HT="-transition";class kl extends Gh{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&o.type!=="sky"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new ue(u.layout)),u.paint)){this._transitionablePaint=new $(u.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(u.paint)}}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u,f={}){u!=null&&this._validate(nx,`layers.${this.id}.layout.${o}`,o,u,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return si(o,HT)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,f={}){if(u!=null&&this._validate(rx,`layers.${this.id}.paint.${o}`,o,u,f))return!1;if(si(o,HT))return this._transitionablePaint.setTransition(o.slice(0,-11),u||void 0),!1;{const d=this._transitionablePaint._values[o],_=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value,P=T.isDataDriven(),C=si(o,"pattern")||o==="line-dasharray";return P||_||C||this._handleOverridablePaintPropertyUpdate(o,x,T)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,u,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Ee(o,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(o,u,f,d,_={}){return(!_||_.validate!==!1)&&ev(this,o.call(Q_,{key:u,layerType:this.type,objectKey:f,value:d,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof le&&Wc(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Bp(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const r3=Ae([{name:"a_pos",components:2,type:"Int16"}],4),n3=Ae([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hi{constructor(o=[]){this.segments=o}prepareSegment(o,u,f,d){let _=this.segments[this.segments.length-1];return o>Hi.MAX_VERTEX_ARRAY_LENGTH&&Qe(`Max vertices per segment is ${Hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!_||_.vertexLength+o>Hi.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,f,d){return new Hi([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:d,vaos:{},sortKey:0}])}}Hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(Hi,"SegmentVector");var er=8192;class ih{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Xn?new Xn(o.lng,o.lat):Xn.convert(o),this}setSouthWest(o){return this._sw=o instanceof Xn?new Xn(o.lng,o.lat):Xn.convert(o),this}extend(o){const u=this._sw,f=this._ne;let d,_;if(o instanceof Xn)d=o,_=o;else{if(!(o instanceof ih))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(ih.convert(o)):this.extend(Xn.convert(o)):typeof o=="object"&&o!==null&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Xn.convert(o)):this;if(d=o._sw,_=o._ne,!d||!_)return this}return u||f?(u.lng=Math.min(d.lng,u.lng),u.lat=Math.min(d.lat,u.lat),f.lng=Math.max(_.lng,f.lng),f.lat=Math.max(_.lat,f.lat)):(this._sw=new Xn(d.lng,d.lat),this._ne=new Xn(_.lng,_.lat)),this}getCenter(){return new Xn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xn(this.getWest(),this.getNorth())}getSouthEast(){return new Xn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:f}=Xn.convert(o);let d=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&d}static convert(o){return!o||o instanceof ih?o:new ih(o)}}var av=1e-6,ia=typeof Float32Array<"u"?Float32Array:Array;function KT(){var l=new ia(9);return ia!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function YT(l,o,u){var f=o[0],d=o[1],_=o[2],x=o[3],T=o[4],P=o[5],C=o[6],O=o[7],R=o[8],F=u[0],G=u[1],q=u[2],K=u[3],re=u[4],he=u[5],_e=u[6],fe=u[7],me=u[8];return l[0]=F*f+G*x+q*C,l[1]=F*d+G*T+q*O,l[2]=F*_+G*P+q*R,l[3]=K*f+re*x+he*C,l[4]=K*d+re*T+he*O,l[5]=K*_+re*P+he*R,l[6]=_e*f+fe*x+me*C,l[7]=_e*d+fe*T+me*O,l[8]=_e*_+fe*P+me*R,l}function Fl(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function hx(l,o){var u=o[0],f=o[1],d=o[2],_=o[3],x=o[4],T=o[5],P=o[6],C=o[7],O=o[8],R=o[9],F=o[10],G=o[11],q=o[12],K=o[13],re=o[14],he=o[15],_e=u*T-f*x,fe=u*P-d*x,me=u*C-_*x,xe=f*P-d*T,ve=f*C-_*T,Ue=d*C-_*P,ke=O*K-R*q,Je=O*re-F*q,ht=O*he-G*q,je=R*re-F*K,nt=R*he-G*K,it=F*he-G*re,lt=_e*it-fe*nt+me*je+xe*ht-ve*Je+Ue*ke;return lt?(l[0]=(T*it-P*nt+C*je)*(lt=1/lt),l[1]=(d*nt-f*it-_*je)*lt,l[2]=(K*Ue-re*ve+he*xe)*lt,l[3]=(F*ve-R*Ue-G*xe)*lt,l[4]=(P*ht-x*it-C*Je)*lt,l[5]=(u*it-d*ht+_*Je)*lt,l[6]=(re*me-q*Ue-he*fe)*lt,l[7]=(O*Ue-F*me+G*fe)*lt,l[8]=(x*nt-T*ht+C*ke)*lt,l[9]=(f*ht-u*nt-_*ke)*lt,l[10]=(q*ve-K*me+he*_e)*lt,l[11]=(R*me-O*ve-G*_e)*lt,l[12]=(T*Je-x*je-P*ke)*lt,l[13]=(u*je-f*Je+d*ke)*lt,l[14]=(K*fe-q*xe-re*_e)*lt,l[15]=(O*xe-R*fe+F*_e)*lt,l):null}function mf(l,o,u){var f=o[0],d=o[1],_=o[2],x=o[3],T=o[4],P=o[5],C=o[6],O=o[7],R=o[8],F=o[9],G=o[10],q=o[11],K=o[12],re=o[13],he=o[14],_e=o[15],fe=u[0],me=u[1],xe=u[2],ve=u[3];return l[0]=fe*f+me*T+xe*R+ve*K,l[1]=fe*d+me*P+xe*F+ve*re,l[2]=fe*_+me*C+xe*G+ve*he,l[3]=fe*x+me*O+xe*q+ve*_e,l[4]=(fe=u[4])*f+(me=u[5])*T+(xe=u[6])*R+(ve=u[7])*K,l[5]=fe*d+me*P+xe*F+ve*re,l[6]=fe*_+me*C+xe*G+ve*he,l[7]=fe*x+me*O+xe*q+ve*_e,l[8]=(fe=u[8])*f+(me=u[9])*T+(xe=u[10])*R+(ve=u[11])*K,l[9]=fe*d+me*P+xe*F+ve*re,l[10]=fe*_+me*C+xe*G+ve*he,l[11]=fe*x+me*O+xe*q+ve*_e,l[12]=(fe=u[12])*f+(me=u[13])*T+(xe=u[14])*R+(ve=u[15])*K,l[13]=fe*d+me*P+xe*F+ve*re,l[14]=fe*_+me*C+xe*G+ve*he,l[15]=fe*x+me*O+xe*q+ve*_e,l}function vm(l,o,u){var f,d,_,x,T,P,C,O,R,F,G,q,K=u[0],re=u[1],he=u[2];return o===l?(l[12]=o[0]*K+o[4]*re+o[8]*he+o[12],l[13]=o[1]*K+o[5]*re+o[9]*he+o[13],l[14]=o[2]*K+o[6]*re+o[10]*he+o[14],l[15]=o[3]*K+o[7]*re+o[11]*he+o[15]):(d=o[1],_=o[2],x=o[3],T=o[4],P=o[5],C=o[6],O=o[7],R=o[8],F=o[9],G=o[10],q=o[11],l[0]=f=o[0],l[1]=d,l[2]=_,l[3]=x,l[4]=T,l[5]=P,l[6]=C,l[7]=O,l[8]=R,l[9]=F,l[10]=G,l[11]=q,l[12]=f*K+T*re+R*he+o[12],l[13]=d*K+P*re+F*he+o[13],l[14]=_*K+C*re+G*he+o[14],l[15]=x*K+O*re+q*he+o[15]),l}function yf(l,o,u){var f=u[0],d=u[1],_=u[2];return l[0]=o[0]*f,l[1]=o[1]*f,l[2]=o[2]*f,l[3]=o[3]*f,l[4]=o[4]*d,l[5]=o[5]*d,l[6]=o[6]*d,l[7]=o[7]*d,l[8]=o[8]*_,l[9]=o[9]*_,l[10]=o[10]*_,l[11]=o[11]*_,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l}function fx(l,o,u){var f=Math.sin(u),d=Math.cos(u),_=o[4],x=o[5],T=o[6],P=o[7],C=o[8],O=o[9],R=o[10],F=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=_*d+C*f,l[5]=x*d+O*f,l[6]=T*d+R*f,l[7]=P*d+F*f,l[8]=C*d-_*f,l[9]=O*d-x*f,l[10]=R*d-T*f,l[11]=F*d-P*f,l}function lv(l,o,u){var f=Math.sin(u),d=Math.cos(u),_=o[0],x=o[1],T=o[2],P=o[3],C=o[8],O=o[9],R=o[10],F=o[11];return o!==l&&(l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=_*d-C*f,l[1]=x*d-O*f,l[2]=T*d-R*f,l[3]=P*d-F*f,l[8]=_*f+C*d,l[9]=x*f+O*d,l[10]=T*f+R*d,l[11]=P*f+F*d,l}function JT(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function QT(l,o,u){var f,d,_,x=u[0],T=u[1],P=u[2],C=Math.hypot(x,T,P);return C<av?null:(x*=C=1/C,T*=C,P*=C,f=Math.sin(o),d=Math.cos(o),l[0]=x*x*(_=1-d)+d,l[1]=T*x*_+P*f,l[2]=P*x*_-T*f,l[3]=0,l[4]=x*T*_-P*f,l[5]=T*T*_+d,l[6]=P*T*_+x*f,l[7]=0,l[8]=x*P*_+T*f,l[9]=T*P*_-x*f,l[10]=P*P*_+d,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var i3=mf;function px(){var l=new ia(3);return ia!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function eS(l){var o=new ia(3);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o}function xm(l){return Math.hypot(l[0],l[1],l[2])}function Zp(l,o,u){var f=new ia(3);return f[0]=l,f[1]=o,f[2]=u,f}function lc(l,o,u){return l[0]=o[0]+u[0],l[1]=o[1]+u[1],l[2]=o[2]+u[2],l}function dx(l,o,u){return l[0]=o[0]-u[0],l[1]=o[1]-u[1],l[2]=o[2]-u[2],l}function tS(l,o,u){return l[0]=o[0]*u[0],l[1]=o[1]*u[1],l[2]=o[2]*u[2],l}function wm(l,o,u){return l[0]=Math.min(o[0],u[0]),l[1]=Math.min(o[1],u[1]),l[2]=Math.min(o[2],u[2]),l}function Em(l,o,u){return l[0]=Math.max(o[0],u[0]),l[1]=Math.max(o[1],u[1]),l[2]=Math.max(o[2],u[2]),l}function Ca(l,o,u){return l[0]=o[0]*u,l[1]=o[1]*u,l[2]=o[2]*u,l}function bm(l,o,u,f){return l[0]=o[0]+u[0]*f,l[1]=o[1]+u[1]*f,l[2]=o[2]+u[2]*f,l}function Ts(l,o){var u=o[0],f=o[1],d=o[2],_=u*u+f*f+d*d;return _>0&&(_=1/Math.sqrt(_)),l[0]=o[0]*_,l[1]=o[1]*_,l[2]=o[2]*_,l}function Ka(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]}function gx(l,o,u){var f=o[0],d=o[1],_=o[2],x=u[0],T=u[1],P=u[2];return l[0]=d*P-_*T,l[1]=_*x-f*P,l[2]=f*T-d*x,l}function Ui(l,o,u){var f=o[0],d=o[1],_=o[2],x=u[3]*f+u[7]*d+u[11]*_+u[15];return l[0]=(u[0]*f+u[4]*d+u[8]*_+u[12])/(x=x||1),l[1]=(u[1]*f+u[5]*d+u[9]*_+u[13])/x,l[2]=(u[2]*f+u[6]*d+u[10]*_+u[14])/x,l}function rS(l,o,u){var f=u[0],d=u[1],_=u[2],x=o[0],T=o[1],P=o[2],C=d*P-_*T,O=_*x-f*P,R=f*T-d*x,F=d*R-_*O,G=_*C-f*R,q=f*O-d*C,K=2*u[3];return O*=K,R*=K,G*=2,q*=2,l[0]=x+(C*=K)+(F*=2),l[1]=T+O+G,l[2]=P+R+q,l}var Tm,zl=dx,o3=tS,s3=xm;function nS(l,o,u){return l[0]=o[0]*u,l[1]=o[1]*u,l[2]=o[2]*u,l[3]=o[3]*u,l}function iS(l,o){var u=o[0],f=o[1],d=o[2],_=o[3],x=u*u+f*f+d*d+_*_;return x>0&&(x=1/Math.sqrt(x)),l[0]=u*x,l[1]=f*x,l[2]=d*x,l[3]=_*x,l}function _f(l,o,u){var f=o[0],d=o[1],_=o[2],x=o[3];return l[0]=u[0]*f+u[4]*d+u[8]*_+u[12]*x,l[1]=u[1]*f+u[5]*d+u[9]*_+u[13]*x,l[2]=u[2]*f+u[6]*d+u[10]*_+u[14]*x,l[3]=u[3]*f+u[7]*d+u[11]*_+u[15]*x,l}function oS(){var l=new ia(4);return ia!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function sS(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function aS(l,o,u){u*=.5;var f=o[0],d=o[1],_=o[2],x=o[3],T=Math.sin(u),P=Math.cos(u);return l[0]=f*P+x*T,l[1]=d*P+_*T,l[2]=_*P-d*T,l[3]=x*P-f*T,l}function lS(l,o,u){u*=.5;var f=o[0],d=o[1],_=o[2],x=o[3],T=Math.sin(u),P=Math.cos(u);return l[0]=f*P-_*T,l[1]=d*P+x*T,l[2]=_*P+f*T,l[3]=x*P-d*T,l}px(),Tm=new ia(4),ia!=Float32Array&&(Tm[0]=0,Tm[1]=0,Tm[2]=0,Tm[3]=0);var a3=iS;px(),Zp(1,0,0),Zp(0,1,0),oS(),oS(),KT();const l3=Ae([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:uS}=l3,cS=Ae([{name:"a_pos_3",components:3,type:"Int16"}]);var Sm=Ae([{name:"a_pos",type:"Int16",components:2}]);class mx{constructor(o,u){this.pos=o,this.dir=u}intersectsPlane(o,u,f){const d=Ka(u,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((o[0]-this.pos[0])*u[0]+(o[1]-this.pos[1])*u[1]+(o[2]-this.pos[2])*u[2])/d;return f[0]=this.pos[0]+this.dir[0]*_,f[1]=this.pos[1]+this.dir[1]*_,f[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(o,u,f){if(function(G,q){var K=G[0],re=G[1],he=G[2],_e=q[0],fe=q[1],me=q[2];return Math.abs(K-_e)<=av*Math.max(1,Math.abs(K),Math.abs(_e))&&Math.abs(re-fe)<=av*Math.max(1,Math.abs(re),Math.abs(fe))&&Math.abs(he-me)<=av*Math.max(1,Math.abs(he),Math.abs(me))}(this.pos,o)||u===0)return f[0]=f[1]=f[2]=0,!1;const[d,_,x]=this.dir,T=this.pos[0]-o[0],P=this.pos[1]-o[1],C=this.pos[2]-o[2],O=d*d+_*_+x*x,R=2*(T*d+P*_+C*x),F=R*R-4*O*(T*T+P*P+C*C-u*u);if(F<0){const G=Math.max(-R/2,0),q=T+d*G,K=P+_*G,re=C+x*G,he=Math.hypot(q,K,re);return f[0]=q*u/he,f[1]=K*u/he,f[2]=re*u/he,!1}{const G=(-R-Math.sqrt(F))/(2*O);if(G<0){const q=Math.hypot(T,P,C);return f[0]=T*u/q,f[1]=P*u/q,f[2]=C*u/q,!1}return f[0]=T+d*G,f[1]=P+_*G,f[2]=C+x*G,!0}}}class yx{constructor(o,u,f,d,_){this.TL=o,this.TR=u,this.BR=f,this.BL=d,this.horizon=_}static fromInvProjectionMatrix(o,u,f){const d=[-1,1,1],_=[1,1,1],x=[1,-1,1],T=[-1,-1,1],P=Ui(d,d,o),C=Ui(_,_,o),O=Ui(x,x,o),R=Ui(T,T,o);return new yx(P,C,O,R,u/f)}}class _x{constructor(o,u){this.points=o,this.planes=u}static fromInvProjectionMatrix(o,u,f,d){const _=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const C=_f([],P,o),O=1/C[3]/u*_;return function(R,F,G){return R[0]=F[0]*G[0],R[1]=F[1]*G[1],R[2]=F[2]*G[2],R[3]=F[3]*G[3],R}(C,C,[O,O,d?1/C[3]:O,O])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const C=Ts([],gx([],zl([],x[P[0]],x[P[1]]),zl([],x[P[2]],x[P[1]]))),O=-Ka(C,x[P[1]]);return C.concat(O)});return new _x(x,T)}}class Ss{static fromPoints(o){const u=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const d of o)wm(u,u,d),Em(f,f,d);return new Ss(u,f)}static applyTransform(o,u){const f=o.getCorners();for(let d=0;d<f.length;++d)Ui(f[d],f[d],u);return Ss.fromPoints(f)}constructor(o,u){this.min=o,this.max=u,this.center=Ca([],lc([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],f=eS(this.min),d=eS(this.max);for(let _=0;_<u.length;_++)f[_]=u[_]?this.min[_]:this.center[_],d[_]=u[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Ss(f,d)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,u=this.max;return[[o[0],o[1],o[2]],[u[0],o[1],o[2]],[u[0],u[1],o[2]],[o[0],u[1],o[2]],[o[0],o[1],u[2]],[u[0],o[1],u[2]],[u[0],u[1],u[2]],[o[0],u[1],u[2]]]}intersects(o){const u=this.getCorners();let f=!0;for(let d=0;d<o.planes.length;d++){const _=o.planes[d];let x=0;for(let T=0;T<u.length;T++)x+=Ka(_,u[T])+_[3]>=0;if(x===0)return 0;x!==u.length&&(f=!1)}if(f)return 2;for(let d=0;d<3;d++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let T=0;T<o.points.length;T++){const P=o.points[T][d]-this.min[d];_=Math.min(_,P),x=Math.max(x,P)}if(x<0||_>this.max[d]-this.min[d])return 0}return 1}}const vx=5,hS=6,yu=er/Math.PI/2,u3=16383,vf=64,Im=[vf,32,16],Ya=-yu,Ja=yu,c3=[new Ss([Ya,Ya,Ya],[Ja,Ja,Ja]),new Ss([Ya,Ya,Ya],[0,0,Ja]),new Ss([0,Ya,Ya],[Ja,0,Ja]),new Ss([Ya,0,Ya],[0,Ja,Ja]),new Ss([0,0,Ya],[Ja,Ja,Ja])];function uv(l){return l*yu/Am}function fS(l,o,u,f=!0){const d=Ca([],l._camera.position,l.worldSize),_=[o,u,1,1];_f(_,_,l.pixelMatrixInverse),nS(_,_,1/_[3]);const x=Ts([],zl([],_,d)),T=l.globeMatrix,P=[T[12],T[13],T[14]],C=zl([],P,d),O=xm(C),R=Ts([],C),F=l.worldSize/(2*Math.PI),G=Ka(R,x),q=Math.asin(F/O);if(q<Math.acos(G)){if(!f)return null;const ht=[],je=[];Ca(ht,x,O/G),Ts(je,zl(je,ht,C)),Ts(x,lc(x,C,Ca(x,je,Math.tan(q)*O)))}const K=[];new mx(d,x).closestPointOnSphere(P,F,K);const re=Ts([],$t(T,0)),he=Ts([],$t(T,1)),_e=Ts([],$t(T,2)),fe=Ka(re,K),me=Ka(he,K),xe=Ka(_e,K),ve=We(Math.asin(-me/F));let Ue=We(Math.atan2(fe,xe));Ue=l.center.lng+function(ht,je){const nt=(je-ht+180)%360-180;return nt<-180?nt+360:nt}(l.center.lng,Ue);const ke=vu(Ue),Je=et(xu(ve),0,1);return new Kp(ke,Je)}class h3{constructor(o,u,f){this.a=zl([],o,f),this.b=zl([],u,f),this.center=f;const d=Ts([],this.a),_=Ts([],this.b);this.angle=Math.acos(Ka(d,_))}}function xx(l,o){if(l.angle===0)return null;let u;return u=l.a[o]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[o]/l.a[o]/Math.sin(l.angle)-1/Math.tan(l.angle)),u<0||u>1?null:function(f,d,_,x){const T=Math.sin(_);return f*(Math.sin((1-x)*_)/T)+d*(Math.sin(x*_)/T)}(l.a[o],l.b[o],l.angle,et(u,0,1))+l.center[o]}function _u(l){if(l.z<=1)return c3[l.z+2*l.y+l.x];const o=wx(cv(l));return Ss.fromPoints(o)}function xf(l,o,u){return Ca(l,l,1-u),bm(l,l,o,u)}function pS(l,o){const u=Hp(o.zoom);if(u===0)return _u(l);const f=cv(l),d=wx(f),_=vu(f.getWest())*o.worldSize,x=vu(f.getEast())*o.worldSize,T=xu(f.getNorth())*o.worldSize,P=xu(f.getSouth())*o.worldSize,C=[_,T,0],O=[x,T,0],R=[_,P,0],F=[x,P,0],G=hx([],o.globeMatrix);return Ui(C,C,G),Ui(O,O,G),Ui(R,R,G),Ui(F,F,G),d[0]=xf(d[0],R,u),d[1]=xf(d[1],F,u),d[2]=xf(d[2],O,u),d[3]=xf(d[3],C,u),Ss.fromPoints(d)}function dS(l,o,u){for(const f of l)Ui(f,f,o),Ca(f,f,u)}function f3(l,o,u){const f=o/l.worldSize,d=l.globeMatrix;if(u.z<=1){const ke=_u(u).getCorners();return dS(ke,d,f),Ss.fromPoints(ke)}const _=cv(u),x=wx(_);dS(x,d,f);const T=Number.MAX_VALUE,P=[-T,-T,-T],C=[T,T,T];if(_.contains(l.center)){for(const ht of x)wm(C,C,ht),Em(P,P,ht);P[2]=0;const ke=l.point,Je=[ke.x*f,ke.y*f,0];return wm(C,C,Je),Em(P,P,Je),new Ss(C,P)}const O=[d[12]*f,d[13]*f,d[14]*f],R=_.getCenter(),F=et(l.center.lat,-Yo,Yo),G=et(R.lat,-Yo,Yo),q=vu(l.center.lng),K=xu(F);let re=q-vu(R.lng);const he=K-xu(G);re>.5?re-=1:re<-.5&&(re+=1);let _e=0;Math.abs(re)>Math.abs(he)?_e=re>=0?1:3:(_e=he>=0?0:2,bm(O,O,[d[4]*f,d[5]*f,d[6]*f],-Math.sin(ze(he>=0?_.getSouth():_.getNorth()))*yu));const fe=x[_e],me=x[(_e+1)%4],xe=new h3(fe,me,O),ve=[xx(xe,0)||fe[0],xx(xe,1)||fe[1],xx(xe,2)||fe[2]],Ue=Hp(l.zoom);if(Ue>0){const ke=function({x:ht,y:je,z:nt},it,lt,gt,He){const Ct=1/(1<<nt);let Vt=ht*Ct,Lt=Vt+Ct,vr=je*Ct,yt=vr+Ct,Kt=0;const xr=(Vt+Lt)/2-gt;return xr>.5?Kt=-1:xr<-.5&&(Kt=1),Vt=((Vt+Kt)*it-(gt*=it))*lt+gt,Lt=((Lt+Kt)*it-gt)*lt+gt,vr=(vr*it-(He*=it))*lt+He,yt=(yt*it-He)*lt+He,[[Vt,yt,0],[Lt,yt,0],[Lt,vr,0],[Vt,vr,0]]}(u,o,l._pixelsPerMercatorPixel,q,K);for(let ht=0;ht<x.length;ht++)xf(x[ht],ke[ht],Ue);const Je=lc([],ke[_e],ke[(_e+1)%4]);Ca(Je,Je,.5),xf(ve,Je,Ue)}for(const ke of x)wm(C,C,ke),Em(P,P,ke);return C[2]=Math.min(fe[2],me[2]),wm(C,C,ve),Em(P,P,ve),new Ss(C,P)}function cv({x:l,y:o,z:u}){const f=1/(1<<u),d=new Xn(Aa(l*f),Ko((o+1)*f)),_=new Xn(Aa((l+1)*f),Ko(o*f));return new ih(d,_)}function wx(l){const o=ze(l.getNorth()),u=ze(l.getSouth()),f=Math.cos(o),d=Math.cos(u),_=Math.sin(o),x=Math.sin(u),T=l.getWest(),P=l.getEast();return[Xp(d,x,T),Xp(d,x,P),Xp(f,_,P),Xp(f,_,T)]}function Xp(l,o,u,f=yu){return u=ze(u),[l*Math.sin(u)*f,-o*f,l*Math.cos(u)*f]}function Wp(l,o,u){return Xp(Math.cos(ze(l)),Math.sin(ze(l)),o,u)}function Pm(l,o,u,f){const d=1<<u.z,_=(l/er+u.x)/d;return Wp(Ko((o/er+u.y)/d),Aa(_),f)}function hv({min:l,max:o}){return u3/Math.max(o[0]-l[0],o[1]-l[1],o[2]-l[2])}const gS=new Float64Array(16);function Cm(l){const o=hv(l),u=JT(gS,[o,o,o]);return vm(u,u,((f=[])[0]=-(d=l.min)[0],f[1]=-d[1],f[2]=-d[2],f));var f,d}function Ex(l){const o=(f=l.min,(u=gS)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u);var u,f;const d=1/hv(l);return yf(o,o,[d,d,d])}function mS(l,o,u,f,d){const _=function(P){const C=er/(2*Math.PI);return P/(2*Math.PI)/C}(u),x=[l,o,-u/(2*Math.PI)],T=Fl(new Float64Array(16));return vm(T,T,x),yf(T,T,[_,_,_]),fx(T,T,ze(-d)),lv(T,T,ze(-f)),T}function Hp(l){return zt(vx,hS,l)}function yS(l,o){const u=Wp(o.lat,o.lng),f=function(q){const K=Wp(q._center.lat,q._center.lng);let re=gx([],Zp(0,1,0),K);const he=QT([],-q.angle,K);re=Ui(re,re,he),QT(he,-q._pitch,re);const _e=Ts([],K);return Ca(_e,_e,uv(q.cameraToCenterDistance/q.pixelsPerMeter)),Ui(_e,_e,he),lc([],K,_e)}(l);return x=(d=dx([],f,u))[0],T=d[1],P=d[2],C=(_=u)[0],O=_[1],R=_[2],G=(F=Math.sqrt(x*x+T*T+P*P)*Math.sqrt(C*C+O*O+R*R))&&Ka(d,_)/F,Math.acos(Math.min(Math.max(G,-1),1));var d,_,x,T,P,C,O,R,F,G}function bx(l,o){return yS(l,o)>Math.PI/2*1.01}const _S=ze(85),p3=Math.cos(_S),d3=Math.sin(_S),Am=63710088e-1,vS=2*Math.PI*Am;class oh{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oh(mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,f=this.lat*u,d=o.lat*u,_=Math.sin(f)*Math.sin(d)+Math.cos(f)*Math.cos(d)*Math.cos((o.lng-this.lng)*u);return Am*Math.acos(Math.min(_,1))}toBounds(o=0){const u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new ih(new oh(this.lng-f,this.lat-u),new oh(this.lng+f,this.lat+u))}toEcef(o){const u=uv(o);return Wp(this.lat,this.lng,yu+u)}static convert(o){if(o instanceof oh)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new oh(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new oh(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Xn=oh;function Tx(l){return vS*Math.cos(l*Math.PI/180)}function vu(l){return(180+l)/360}function xu(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Bl(l,o){return l/Tx(o)}function Aa(l){return 360*l-180}function Ko(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function xS(l,o){return l*Tx(Ko(o))}const Yo=85.051129;function wS(l){return 1/Math.cos(l*Math.PI/180)}class Kp{constructor(o,u,f=0){this.x=+o,this.y=+u,this.z=+f}static fromLngLat(o,u=0){const f=Xn.convert(o);return new Kp(vu(f.lng),xu(f.lat),Bl(u,f.lat))}toLngLat(){return new Xn(Aa(this.x),Ko(this.y))}toAltitude(){return xS(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vS*wS(Ko(this.y))}}function Sx(l,o,u,f,d,_,x,T,P){const C=(o+f)/2,O=(u+d)/2,R=new W(C,O);T(R),function(F,G,q,K,re,he){const _e=q-re,fe=K-he;return Math.abs((K-G)*_e-(q-F)*fe)/Math.hypot(_e,fe)}(R.x,R.y,_.x,_.y,x.x,x.y)>=P?(Sx(l,o,u,C,O,_,R,T,P),Sx(l,C,O,f,d,R,x,T,P)):l.push(x)}function ES(l,o,u){let f=l[0],d=f.x,_=f.y;o(f);const x=[f];for(let T=1;T<l.length;T++){const P=l[T],{x:C,y:O}=P;o(P),Sx(x,d,_,C,O,f,P,o,u),d=C,_=O,f=P}return x}function Ix(l,o,u,f){if(f(o,u)){const d=o.add(u)._mult(.5);Ix(l,o,d,f),Ix(l,d,u,f)}else l.push(u)}function g3(l,o){let u=l[0];const f=[u];for(let d=1;d<l.length;d++){const _=l[d];Ix(f,u,_,o),u=_}return f}const Px=Math.pow(2,14)-1,bS=-Px-1;function m3(l,o){const u=Math.round(l.x*o),f=Math.round(l.y*o);return l.x=et(u,bS,Px),l.y=et(f,bS,Px),(u<l.x||u>l.x+1||f<l.y||f>l.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function uc(l,o,u){const f=l.loadGeometry(),d=l.extent,_=er/d;if(o&&u&&u.projection.isReprojectedInTileSpace){const x=1<<o.z,{scale:T,x:P,y:C,projection:O}=u,R=F=>{const G=Aa((o.x+F.x/d)/x),q=Ko((o.y+F.y/d)/x),K=O.project(G,q);F.x=(K.x*T-P)*d,F.y=(K.y*T-C)*d};for(let F=0;F<f.length;F++)if(l.type!==1)f[F]=ES(f[F],R,1);else{const G=[];for(const q of f[F])q.x<0||q.x>=d||q.y<0||q.y>=d||(R(q),G.push(q));f[F]=G}}for(const x of f)for(const T of x)m3(T,_);return f}function wf(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?uc(l):[]}}function fv(l,o,u,f,d){l.emplaceBack(2*o+(f+1)/2,2*u+(d+1)/2)}function pv(l,o,u){l.emplaceBack(o.x,o.y,o.z,u[0]*16384,u[1]*16384,u[2]*16384)}class Cx{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new ct,this.indexArray=new Xt,this.segments=new Hi,this.programConfigurations=new gf(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,d){const _=this.layers[0],x=[];let T=null;_.type==="circle"&&(T=_.layout.get("circle-sort-key"));for(const{feature:C,id:O,index:R,sourceLayerIndex:F}of o){const G=this.layers[0]._featureFilter.needGeometry,q=wf(C,G);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),q,f))continue;const K=T?T.evaluate(q,{},f):void 0,re={id:O,properties:C.properties,type:C.type,sourceLayerIndex:F,index:R,geometry:G?q.geometry:uc(C,f,d),patterns:{},sortKey:K};x.push(re)}T&&x.sort((C,O)=>C.sortKey-O.sortKey);let P=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new ft,P=d.projection);for(const C of x){const{geometry:O,index:R,sourceLayerIndex:F}=C,G=o[R].feature;this.addFeature(C,O,R,u.availableImages,f,P),u.featureIndex.insert(G,O,R,F,this.index)}}update(o,u,f,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,r3.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,n3.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,u,f,d,_,x){for(const T of u)for(const P of T){const C=P.x,O=P.y;if(C<0||C>=er||O<0||O>=er)continue;if(x){const G=x.projectTilePoint(C,O,_),q=x.upVector(_,C,O),K=this.globeExtVertexArray;pv(K,G,q),pv(K,G,q),pv(K,G,q),pv(K,G,q)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),F=R.vertexLength;fv(this.layoutVertexArray,C,O,-1,-1),fv(this.layoutVertexArray,C,O,1,-1),fv(this.layoutVertexArray,C,O,1,1),fv(this.layoutVertexArray,C,O,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},d,_)}}function TS(l,o){for(let u=0;u<l.length;u++)if(Ef(o,l[u]))return!0;for(let u=0;u<o.length;u++)if(Ef(l,o[u]))return!0;return!!Ax(l,o)}function y3(l,o,u){return!!Ef(l,o)||!!Mx(o,l,u)}function SS(l,o){if(l.length===1)return PS(o,l[0]);for(let u=0;u<o.length;u++){const f=o[u];for(let d=0;d<f.length;d++)if(Ef(l,f[d]))return!0}for(let u=0;u<l.length;u++)if(PS(o,l[u]))return!0;for(let u=0;u<o.length;u++)if(Ax(l,o[u]))return!0;return!1}function _3(l,o,u){if(l.length>1){if(Ax(l,o))return!0;for(let f=0;f<o.length;f++)if(Mx(o[f],l,u))return!0}for(let f=0;f<l.length;f++)if(Mx(l[f],o,u))return!0;return!1}function Ax(l,o){if(l.length===0||o.length===0)return!1;for(let u=0;u<l.length-1;u++){const f=l[u],d=l[u+1];for(let _=0;_<o.length-1;_++)if(v3(f,d,o[_],o[_+1]))return!0}return!1}function v3(l,o,u,f){return ot(l,u,f)!==ot(o,u,f)&&ot(l,o,u)!==ot(l,o,f)}function Mx(l,o,u){const f=u*u;if(o.length===1)return l.distSqr(o[0])<f;for(let d=1;d<o.length;d++)if(IS(l,o[d-1],o[d])<f)return!0;return!1}function IS(l,o,u){const f=o.distSqr(u);if(f===0)return l.distSqr(o);const d=((l.x-o.x)*(u.x-o.x)+(l.y-o.y)*(u.y-o.y))/f;return l.distSqr(d<0?o:d>1?u:u.sub(o)._mult(d)._add(o))}function PS(l,o){let u,f,d,_=!1;for(let x=0;x<l.length;x++){u=l[x];for(let T=0,P=u.length-1;T<u.length;P=T++)f=u[T],d=u[P],f.y>o.y!=d.y>o.y&&o.x<(d.x-f.x)*(o.y-f.y)/(d.y-f.y)+f.x&&(_=!_)}return _}function Ef(l,o){let u=!1;for(let f=0,d=l.length-1;f<l.length;d=f++){const _=l[f],x=l[d];_.y>o.y!=x.y>o.y&&o.x<(x.x-_.x)*(o.y-_.y)/(x.y-_.y)+_.x&&(u=!u)}return u}function CS(l,o,u,f,d){for(const x of l)if(o<=x.x&&u<=x.y&&f>=x.x&&d>=x.y)return!0;const _=[new W(o,u),new W(o,d),new W(f,d),new W(f,u)];if(l.length>2){for(const x of _)if(Ef(l,x))return!0}for(let x=0;x<l.length-1;x++)if(x3(l[x],l[x+1],_))return!0;return!1}function x3(l,o,u){const f=u[0],d=u[2];if(l.x<f.x&&o.x<f.x||l.x>d.x&&o.x>d.x||l.y<f.y&&o.y<f.y||l.y>d.y&&o.y>d.y)return!1;const _=ot(l,o,u[0]);return _!==ot(l,o,u[1])||_!==ot(l,o,u[2])||_!==ot(l,o,u[3])}function Yp(l,o,u){const f=o.paint.get(l).value;return f.kind==="constant"?f.value:u.programConfigurations.get(o.id).getMaxValue(l)}function dv(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function AS(l,o,u,f,d){if(!o[0]&&!o[1])return l;const _=W.convert(o)._mult(d);u==="viewport"&&_._rotate(-f);const x=[];for(let T=0;T<l.length;T++)x.push(l[T].sub(_));return x}function MS(l,o,u,f){const d=W.convert(l)._mult(f);return o==="viewport"&&d._rotate(-u),d}Bt(Cx,"CircleBucket",{omit:["layers"]});const w3=new de({"circle-sort-key":new oe(Ye.layout_circle["circle-sort-key"])});var E3={paint:new de({"circle-radius":new oe(Ye.paint_circle["circle-radius"]),"circle-color":new oe(Ye.paint_circle["circle-color"]),"circle-blur":new oe(Ye.paint_circle["circle-blur"]),"circle-opacity":new oe(Ye.paint_circle["circle-opacity"]),"circle-translate":new X(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new X(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new X(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new X(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new oe(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new oe(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new oe(Ye.paint_circle["circle-stroke-opacity"])}),layout:w3};function LS(l,o,u,f,d,_,x,T,P){if(_&&l.queryGeometry.isAboveHorizon)return!1;_&&(P*=l.pixelToTileUnitsFactor);const C=l.tileID.canonical,O=u.projection.upVectorScale(C,u.center.lat,u.worldSize).metersToTile;for(const R of o)for(const F of R){const G=F.add(T),q=d&&u.elevation?u.elevation.exaggeration()*d.getElevationAt(G.x,G.y,!0):0,K=u.projection.projectTilePoint(G.x,G.y,C);if(q>0){const fe=u.projection.upVector(C,G.x,G.y);K.x+=fe[0]*O*q,K.y+=fe[1]*O*q,K.z+=fe[2]*O*q}const re=_?G:b3(K.x,K.y,K.z,f),he=_?l.tilespaceRays.map(fe=>S3(fe,q)):l.queryGeometry.screenGeometry,_e=_f([],[K.x,K.y,K.z,1],f);if(!x&&_?P*=_e[3]/u.cameraToCenterDistance:x&&!_&&(P*=u.cameraToCenterDistance/_e[3]),_){const fe=Ko((F.y/er+C.y)/(1<<C.z));P/=u.projection.pixelsPerMeter(fe,1)/Bl(1,fe)}if(y3(he,re,P))return!0}return!1}function b3(l,o,u,f){const d=_f([],[l,o,u,1],f);return new W(d[0]/d[3],d[1]/d[3])}const OS=Zp(0,0,0),T3=Zp(0,0,1);function S3(l,o){const u=px();return OS[2]=o,l.intersectsPlane(OS,T3,u),new W(u[0],u[1])}class DS extends Cx{}function NS(l,{width:o,height:u},f,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==o*u*f)throw new RangeError("mismatched image size")}else d=new Uint8Array(o*u*f);return l.width=o,l.height=u,l.data=d,l}function RS(l,o,u){const{width:f,height:d}=o;f===l.width&&d===l.height||(Lx(l,o,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,f),height:Math.min(l.height,d)},u),l.width=f,l.height=d,l.data=o.data)}function Lx(l,o,u,f,d,_){if(d.width===0||d.height===0)return o;if(d.width>l.width||d.height>l.height||u.x>l.width-d.width||u.y>l.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>o.width||d.height>o.height||f.x>o.width-d.width||f.y>o.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const x=l.data,T=o.data;for(let P=0;P<d.height;P++){const C=((u.y+P)*l.width+u.x)*_,O=((f.y+P)*o.width+f.x)*_;for(let R=0;R<d.width*_;R++)T[O+R]=x[C+R]}return o}Bt(DS,"HeatmapBucket",{omit:["layers"]});class cc{constructor(o,u){NS(this,o,1,u)}resize(o){RS(this,new cc(o),1)}clone(){return new cc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,d,_){Lx(o,u,f,d,_,1)}}class oa{constructor(o,u){NS(this,o,4,u)}resize(o){RS(this,new oa(o),4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new oa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,d,_){Lx(o,u,f,d,_,4)}}Bt(cc,"AlphaImage"),Bt(oa,"RGBAImage");var I3={paint:new de({"heatmap-radius":new oe(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new oe(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new X(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pe(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new X(Ye.paint_heatmap["heatmap-opacity"])})};function Ox(l){const o={},u=l.resolution||256,f=l.clips?l.clips.length:1,d=l.image||new oa({width:u,height:f}),_=(x,T,P)=>{o[l.evaluationKey]=P;const C=l.expression.evaluate(o);d.data[x+T+0]=Math.floor(255*C.r/C.a),d.data[x+T+1]=Math.floor(255*C.g/C.a),d.data[x+T+2]=Math.floor(255*C.b/C.a),d.data[x+T+3]=Math.floor(255*C.a)};if(l.clips)for(let x=0,T=0;x<f;++x,T+=4*u)for(let P=0,C=0;P<u;P++,C+=4){const O=P/(u-1),{start:R,end:F}=l.clips[x];_(T,C,R*(1-O)+F*O)}else for(let x=0,T=0;x<u;x++,T+=4)_(0,T,x/(u-1));return d}var P3={paint:new de({"hillshade-illumination-direction":new X(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new X(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new X(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new X(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new X(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new X(Ye.paint_hillshade["hillshade-accent-color"])})};const C3=Ae([{name:"a_pos",components:2,type:"Int16"}],4),{members:A3}=C3;var Dx={exports:{}};function gv(l,o,u){u=u||2;var f,d,_,x,T,P,C,O=o&&o.length,R=O?o[0]*u:l.length,F=kS(l,0,R,u,!0),G=[];if(!F||F.next===F.prev)return G;if(O&&(F=function(K,re,he,_e){var fe,me,xe,ve=[];for(fe=0,me=re.length;fe<me;fe++)(xe=kS(K,re[fe]*_e,fe<me-1?re[fe+1]*_e:K.length,_e,!1))===xe.next&&(xe.steiner=!0),ve.push(F3(xe));for(ve.sort(N3),fe=0;fe<ve.length;fe++)he=R3(ve[fe],he);return he}(l,o,F,u)),l.length>80*u){f=_=l[0],d=x=l[1];for(var q=u;q<R;q+=u)(T=l[q])<f&&(f=T),(P=l[q+1])<d&&(d=P),T>_&&(_=T),P>x&&(x=P);C=(C=Math.max(_-f,x-d))!==0?32767/C:0}return Mm(F,G,u,f,d,C,0),G}function kS(l,o,u,f,d){var _,x;if(d===kx(l,o,u,f)>0)for(_=o;_<u;_+=f)x=BS(_,l[_],l[_+1],x);else for(_=u-f;_>=o;_-=f)x=BS(_,l[_],l[_+1],x);return x&&mv(x,x.next)&&(Om(x),x=x.next),x}function bf(l,o){if(!l)return l;o||(o=l);var u,f=l;do if(u=!1,f.steiner||!mv(f,f.next)&&Ki(f.prev,f,f.next)!==0)f=f.next;else{if(Om(f),(f=o=f.prev)===f.next)break;u=!0}while(u||f!==o);return o}function Mm(l,o,u,f,d,_,x){if(l){!x&&_&&function(O,R,F,G){var q=O;do q.z===0&&(q.z=Nx(q.x,q.y,R,F,G)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==O);q.prevZ.nextZ=null,q.prevZ=null,function(K){var re,he,_e,fe,me,xe,ve,Ue,ke=1;do{for(he=K,K=null,me=null,xe=0;he;){for(xe++,_e=he,ve=0,re=0;re<ke&&(ve++,_e=_e.nextZ);re++);for(Ue=ke;ve>0||Ue>0&&_e;)ve!==0&&(Ue===0||!_e||he.z<=_e.z)?(fe=he,he=he.nextZ,ve--):(fe=_e,_e=_e.nextZ,Ue--),me?me.nextZ=fe:K=fe,fe.prevZ=me,me=fe;he=_e}me.nextZ=null,ke*=2}while(xe>1)}(q)}(l,f,d,_);for(var T,P,C=l;l.prev!==l.next;)if(T=l.prev,P=l.next,_?L3(l,f,d,_):M3(l))o.push(T.i/u|0),o.push(l.i/u|0),o.push(P.i/u|0),Om(l),l=P.next,C=P.next;else if((l=P)===C){x?x===1?Mm(l=O3(bf(l),o,u),o,u,f,d,_,2):x===2&&D3(l,o,u,f,d,_):Mm(bf(l),o,u,f,d,_,1);break}}}function M3(l){var o=l.prev,u=l,f=l.next;if(Ki(o,u,f)>=0)return!1;for(var d=o.x,_=u.x,x=f.x,T=o.y,P=u.y,C=f.y,O=d<_?d<x?d:x:_<x?_:x,R=T<P?T<C?T:C:P<C?P:C,F=d>_?d>x?d:x:_>x?_:x,G=T>P?T>C?T:C:P>C?P:C,q=f.next;q!==o;){if(q.x>=O&&q.x<=F&&q.y>=R&&q.y<=G&&Jp(d,T,_,P,x,C,q.x,q.y)&&Ki(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function L3(l,o,u,f){var d=l.prev,_=l,x=l.next;if(Ki(d,_,x)>=0)return!1;for(var T=d.x,P=_.x,C=x.x,O=d.y,R=_.y,F=x.y,G=T<P?T<C?T:C:P<C?P:C,q=O<R?O<F?O:F:R<F?R:F,K=T>P?T>C?T:C:P>C?P:C,re=O>R?O>F?O:F:R>F?R:F,he=Nx(G,q,o,u,f),_e=Nx(K,re,o,u,f),fe=l.prevZ,me=l.nextZ;fe&&fe.z>=he&&me&&me.z<=_e;){if(fe.x>=G&&fe.x<=K&&fe.y>=q&&fe.y<=re&&fe!==d&&fe!==x&&Jp(T,O,P,R,C,F,fe.x,fe.y)&&Ki(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,me.x>=G&&me.x<=K&&me.y>=q&&me.y<=re&&me!==d&&me!==x&&Jp(T,O,P,R,C,F,me.x,me.y)&&Ki(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;fe&&fe.z>=he;){if(fe.x>=G&&fe.x<=K&&fe.y>=q&&fe.y<=re&&fe!==d&&fe!==x&&Jp(T,O,P,R,C,F,fe.x,fe.y)&&Ki(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;me&&me.z<=_e;){if(me.x>=G&&me.x<=K&&me.y>=q&&me.y<=re&&me!==d&&me!==x&&Jp(T,O,P,R,C,F,me.x,me.y)&&Ki(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function O3(l,o,u){var f=l;do{var d=f.prev,_=f.next.next;!mv(d,_)&&FS(d,f,f.next,_)&&Lm(d,_)&&Lm(_,d)&&(o.push(d.i/u|0),o.push(f.i/u|0),o.push(_.i/u|0),Om(f),Om(f.next),f=l=_),f=f.next}while(f!==l);return bf(f)}function D3(l,o,u,f,d,_){var x=l;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&z3(x,T)){var P=zS(x,T);return x=bf(x,x.next),P=bf(P,P.next),Mm(x,o,u,f,d,_,0),void Mm(P,o,u,f,d,_,0)}T=T.next}x=x.next}while(x!==l)}function N3(l,o){return l.x-o.x}function R3(l,o){var u=function(d,_){var x,T=_,P=d.x,C=d.y,O=-1/0;do{if(C<=T.y&&C>=T.next.y&&T.next.y!==T.y){var R=T.x+(C-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(R<=P&&R>O&&(O=R,x=T.x<T.next.x?T:T.next,R===P))return x}T=T.next}while(T!==_);if(!x)return null;var F,G=x,q=x.x,K=x.y,re=1/0;T=x;do P>=T.x&&T.x>=q&&P!==T.x&&Jp(C<K?P:O,C,q,K,C<K?O:P,C,T.x,T.y)&&(F=Math.abs(C-T.y)/(P-T.x),Lm(T,d)&&(F<re||F===re&&(T.x>x.x||T.x===x.x&&k3(x,T)))&&(x=T,re=F)),T=T.next;while(T!==G);return x}(l,o);if(!u)return o;var f=zS(u,l);return bf(f,f.next),bf(u,u.next)}function k3(l,o){return Ki(l.prev,l,o.prev)<0&&Ki(o.next,l,l.next)<0}function Nx(l,o,u,f,d){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-u)*d|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function F3(l){var o=l,u=l;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==l);return u}function Jp(l,o,u,f,d,_,x,T){return(d-x)*(o-T)>=(l-x)*(_-T)&&(l-x)*(f-T)>=(u-x)*(o-T)&&(u-x)*(_-T)>=(d-x)*(f-T)}function z3(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(u,f){var d=u;do{if(d.i!==u.i&&d.next.i!==u.i&&d.i!==f.i&&d.next.i!==f.i&&FS(d,d.next,u,f))return!0;d=d.next}while(d!==u);return!1}(l,o)&&(Lm(l,o)&&Lm(o,l)&&function(u,f){var d=u,_=!1,x=(u.x+f.x)/2,T=(u.y+f.y)/2;do d.y>T!=d.next.y>T&&d.next.y!==d.y&&x<(d.next.x-d.x)*(T-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==u);return _}(l,o)&&(Ki(l.prev,l,o.prev)||Ki(l,o.prev,o))||mv(l,o)&&Ki(l.prev,l,l.next)>0&&Ki(o.prev,o,o.next)>0)}function Ki(l,o,u){return(o.y-l.y)*(u.x-o.x)-(o.x-l.x)*(u.y-o.y)}function mv(l,o){return l.x===o.x&&l.y===o.y}function FS(l,o,u,f){var d=_v(Ki(l,o,u)),_=_v(Ki(l,o,f)),x=_v(Ki(u,f,l)),T=_v(Ki(u,f,o));return d!==_&&x!==T||!(d!==0||!yv(l,u,o))||!(_!==0||!yv(l,f,o))||!(x!==0||!yv(u,l,f))||!(T!==0||!yv(u,o,f))}function yv(l,o,u){return o.x<=Math.max(l.x,u.x)&&o.x>=Math.min(l.x,u.x)&&o.y<=Math.max(l.y,u.y)&&o.y>=Math.min(l.y,u.y)}function _v(l){return l>0?1:l<0?-1:0}function Lm(l,o){return Ki(l.prev,l,l.next)<0?Ki(l,o,l.next)>=0&&Ki(l,l.prev,o)>=0:Ki(l,o,l.prev)<0||Ki(l,l.next,o)<0}function zS(l,o){var u=new Rx(l.i,l.x,l.y),f=new Rx(o.i,o.x,o.y),d=l.next,_=o.prev;return l.next=o,o.prev=l,u.next=d,d.prev=u,f.next=u,u.prev=f,_.next=f,f.prev=_,f}function BS(l,o,u,f){var d=new Rx(l,o,u);return f?(d.next=f.next,d.prev=f,f.next.prev=d,f.next=d):(d.prev=d,d.next=d),d}function Om(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Rx(l,o,u){this.i=l,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kx(l,o,u,f){for(var d=0,_=o,x=u-f;_<u;_+=f)d+=(l[x]-l[_])*(l[_+1]+l[x+1]),x=_;return d}Dx.exports=gv,Dx.exports.default=gv,gv.deviation=function(l,o,u,f){var d=o&&o.length,_=Math.abs(kx(l,0,d?o[0]*u:l.length,u));if(d)for(var x=0,T=o.length;x<T;x++)_-=Math.abs(kx(l,o[x]*u,x<T-1?o[x+1]*u:l.length,u));var P=0;for(x=0;x<f.length;x+=3){var C=f[x]*u,O=f[x+1]*u,R=f[x+2]*u;P+=Math.abs((l[C]-l[R])*(l[O+1]-l[C+1])-(l[C]-l[O])*(l[R+1]-l[C+1]))}return _===0&&P===0?0:Math.abs((P-_)/_)},gv.flatten=function(l){for(var o=l[0][0].length,u={vertices:[],holes:[],dimensions:o},f=0,d=0;d<l.length;d++){for(var _=0;_<l[d].length;_++)for(var x=0;x<o;x++)u.vertices.push(l[d][_][x]);d>0&&u.holes.push(f+=l[d-1].length)}return u};var Fx=k(Dx.exports);function B3(l,o,u,f,d){US(l,o,u||0,f||l.length-1,d||U3)}function US(l,o,u,f,d){for(;f>u;){if(f-u>600){var _=f-u+1,x=o-u+1,T=Math.log(_),P=.5*Math.exp(2*T/3),C=.5*Math.sqrt(T*P*(_-P)/_)*(x-_/2<0?-1:1);US(l,o,Math.max(u,Math.floor(o-x*P/_+C)),Math.min(f,Math.floor(o+(_-x)*P/_+C)),d)}var O=l[o],R=u,F=f;for(Dm(l,u,o),d(l[f],O)>0&&Dm(l,u,f);R<F;){for(Dm(l,R,F),R++,F--;d(l[R],O)<0;)R++;for(;d(l[F],O)>0;)F--}d(l[u],O)===0?Dm(l,u,F):Dm(l,++F,f),F<=o&&(u=F+1),o<=F&&(f=F-1)}}function Dm(l,o,u){var f=l[o];l[o]=l[u],l[u]=f}function U3(l,o){return l<o?-1:l>o?1:0}function zx(l,o){const u=l.length;if(u<=1)return[l];const f=[];let d,_;for(let x=0;x<u;x++){const T=wt(l[x]);T!==0&&(l[x].area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(d&&f.push(d),d=[l[x]]):d.push(l[x]))}if(d&&f.push(d),o>1)for(let x=0;x<f.length;x++)f[x].length<=o||(B3(f[x],o,1,f[x].length-1,G3),f[x]=f[x].slice(0,o));return f}function G3(l,o){return o.area-l.area}function Bx(l,o,u){const f=u.patternDependencies;let d=!1;for(const _ of o){const x=_.paint.get(`${l}-pattern`);x.isConstant()||(d=!0);const T=x.constantOr(null);T&&(d=!0,f[T]=!0)}return d}function Ux(l,o,u,f,d){const _=d.patternDependencies;for(const x of o){const T=x.paint.get(`${l}-pattern`).value;if(T.kind!=="constant"){let P=T.evaluate({zoom:f},u,{},d.availableImages);P=P&&P.name?P.name:P,_[P]=!0,u.patterns[x.id]=P}}return u}class vv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ct,this.indexArray=new Xt,this.indexArray2=new Eo,this.programConfigurations=new gf(o.layers,o.zoom),this.segments=new Hi,this.segments2=new Hi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=o.projection}populate(o,u,f,d){this.hasPattern=Bx("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:T,id:P,index:C,sourceLayerIndex:O}of o){const R=this.layers[0]._featureFilter.needGeometry,F=wf(T,R);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),F,f))continue;const G=_?_.evaluate(F,{},f,u.availableImages):void 0,q={id:P,properties:T.properties,type:T.type,sourceLayerIndex:O,index:C,geometry:R?F.geometry:uc(T,f,d),patterns:{},sortKey:G};x.push(q)}_&&x.sort((T,P)=>T.sortKey-P.sortKey);for(const T of x){const{geometry:P,index:C,sourceLayerIndex:O}=T;if(this.hasPattern){const R=Ux("fill",this.layers,T,this.zoom,u);this.patternFeatures.push(R)}else this.addFeature(T,P,C,f,{},u.availableImages);u.featureIndex.insert(o[C].feature,P,C,O,this.index)}}update(o,u,f,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,d)}addFeatures(o,u,f,d,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,u,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,A3),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,f,d,_,x=[]){for(const T of zx(u,500)){let P=0;for(const q of T)P+=q.length;const C=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),O=C.vertexLength,R=[],F=[];for(const q of T){if(q.length===0)continue;q!==T[0]&&F.push(R.length/2);const K=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),re=K.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(re+q.length-1,re),R.push(q[0].x),R.push(q[0].y);for(let he=1;he<q.length;he++)this.layoutVertexArray.emplaceBack(q[he].x,q[he].y),this.indexArray2.emplaceBack(re+he-1,re+he),R.push(q[he].x),R.push(q[he].y);K.vertexLength+=q.length,K.primitiveLength+=q.length}const G=Fx(R,F);for(let q=0;q<G.length;q+=3)this.indexArray.emplaceBack(O+G[q],O+G[q+1],O+G[q+2]);C.vertexLength+=P,C.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,_,x,d)}}Bt(vv,"FillBucket",{omit:["layers","patternFeatures"]});const V3=new de({"fill-sort-key":new oe(Ye.layout_fill["fill-sort-key"])});var j3={paint:new de({"fill-antialias":new X(Ye.paint_fill["fill-antialias"]),"fill-opacity":new oe(Ye.paint_fill["fill-opacity"]),"fill-color":new oe(Ye.paint_fill["fill-color"]),"fill-outline-color":new oe(Ye.paint_fill["fill-outline-color"]),"fill-translate":new X(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new X(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new oe(Ye.paint_fill["fill-pattern"])}),layout:V3};const q3=Ae([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$3=Ae([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Z3=Ae([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:X3}=q3;var xv={},W3=ne,GS=Qp;function Qp(l,o,u,f,d){this.properties={},this.extent=u,this.type=0,this._pbf=l,this._geometry=-1,this._keys=f,this._values=d,l.readFields(H3,this,o)}function H3(l,o,u){l==1?o.id=u.readVarint():l==2?function(f,d){for(var _=f.readVarint()+f.pos;f.pos<_;){var x=d._keys[f.readVarint()],T=d._values[f.readVarint()];d.properties[x]=T}}(u,o):l==3?o.type=u.readVarint():l==4&&(o._geometry=u.pos)}function K3(l){for(var o,u,f=0,d=0,_=l.length,x=_-1;d<_;x=d++)f+=((u=l[x]).x-(o=l[d]).x)*(o.y+u.y);return f}Qp.types=["Unknown","Point","LineString","Polygon"],Qp.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,u=l.readVarint()+l.pos,f=1,d=0,_=0,x=0,T=[];l.pos<u;){if(d<=0){var P=l.readVarint();f=7&P,d=P>>3}if(d--,f===1||f===2)_+=l.readSVarint(),x+=l.readSVarint(),f===1&&(o&&T.push(o),o=[]),o.push(new W3(_,x));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&T.push(o),T},Qp.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,u=1,f=0,d=0,_=0,x=1/0,T=-1/0,P=1/0,C=-1/0;l.pos<o;){if(f<=0){var O=l.readVarint();u=7&O,f=O>>3}if(f--,u===1||u===2)(d+=l.readSVarint())<x&&(x=d),d>T&&(T=d),(_+=l.readSVarint())<P&&(P=_),_>C&&(C=_);else if(u!==7)throw new Error("unknown command "+u)}return[x,P,T,C]},Qp.prototype.toGeoJSON=function(l,o,u){var f,d,_=this.extent*Math.pow(2,u),x=this.extent*l,T=this.extent*o,P=this.loadGeometry(),C=Qp.types[this.type];function O(G){for(var q=0;q<G.length;q++){var K=G[q];G[q]=[360*(K.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+T)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(f=0;f<P.length;f++)R[f]=P[f][0];O(P=R);break;case 2:for(f=0;f<P.length;f++)O(P[f]);break;case 3:for(P=function(G){var q=G.length;if(q<=1)return[G];for(var K,re,he=[],_e=0;_e<q;_e++){var fe=K3(G[_e]);fe!==0&&(re===void 0&&(re=fe<0),re===fe<0?(K&&he.push(K),K=[G[_e]]):K.push(G[_e]))}return K&&he.push(K),he}(P),f=0;f<P.length;f++)for(d=0;d<P[f].length;d++)O(P[f][d])}P.length===1?P=P[0]:C="Multi"+C;var F={type:"Feature",geometry:{type:C,coordinates:P},properties:this.properties};return"id"in this&&(F.id=this.id),F};var Y3=GS,VS=jS;function jS(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(J3,this,o),this.length=this._features.length}function J3(l,o,u){l===15?o.version=u.readVarint():l===1?o.name=u.readString():l===5?o.extent=u.readVarint():l===2?o._features.push(u.pos):l===3?o._keys.push(u.readString()):l===4&&o._values.push(function(f){for(var d=null,_=f.readVarint()+f.pos;f.pos<_;){var x=f.readVarint()>>3;d=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return d}(u))}jS.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new Y3(this._pbf,o,this.extent,this._keys,this._values)};var Q3=VS;function eN(l,o,u){if(l===3){var f=new Q3(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}var Gx=xv.VectorTile=function(l,o){this.layers=l.readFields(eN,{},o)},wv=xv.VectorTileFeature=GS;function Ev(l,o,u,f){const d=[],_=f===0?(x,T,P,C,O,R)=>{x.push(new W(R,P+(R-T)/(C-T)*(O-P)))}:(x,T,P,C,O,R)=>{x.push(new W(T+(R-P)/(O-P)*(C-T),R))};for(const x of l){const T=[];for(const P of x){if(P.length<=2)continue;const C=[];for(let F=0;F<P.length-1;F++){const G=P[F].x,q=P[F].y,K=P[F+1].x,re=P[F+1].y,he=f===0?G:q,_e=f===0?K:re;he<o?_e>o&&_(C,G,q,K,re,o):he>u?_e<u&&_(C,G,q,K,re,u):C.push(P[F]),_e<o&&he>=o&&_(C,G,q,K,re,o),_e>u&&he<=u&&_(C,G,q,K,re,u)}let O=P[P.length-1];const R=f===0?O.x:O.y;R>=o&&R<=u&&C.push(O),C.length&&(O=C[C.length-1],C[0].x===O.x&&C[0].y===O.y||C.push(C[0]),T.push(C))}T.length&&d.push(T)}return d}xv.VectorTileLayer=VS;const tN=wv.types,rN=Math.pow(2,13);function Nm(l,o,u,f,d,_,x,T){l.emplaceBack((o<<1)+x,(u<<1)+_,(Math.floor(f*rN)<<1)+d,Math.round(T))}function Rm(l,o,u){l.emplaceBack(o.x,o.y,o.z,u[0]*16384,u[1]*16384,u[2]*16384)}class qS{constructor(){this.acc=new W(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new W(o.x,o.y),this.max=new W(o.x,o.y))}append(o,u){this.currentPolyCount.edges++,this.acc._add(o);const f=this.min,d=this.max;o.x<f.x?f.x=o.x:o.x>d.x&&(d.x=o.x),o.y<f.y?f.y=o.y:o.y>d.y&&(d.y=o.y),((o.x===0||o.x===er)&&o.x===u.x)!=((o.y===0||o.y===er)&&o.y===u.y)&&this.processBorderOverlap(o,u),u.x<0!=o.x<0&&this.addBorderIntersection(0,Hr(u.y,o.y,(0-u.x)/(o.x-u.x))),u.x>er!=o.x>er&&this.addBorderIntersection(1,Hr(u.y,o.y,(er-u.x)/(o.x-u.x))),u.y<0!=o.y<0&&this.addBorderIntersection(2,Hr(u.x,o.x,(0-u.y)/(o.y-u.y))),u.y>er!=o.y>er&&this.addBorderIntersection(3,Hr(u.x,o.x,(er-u.y)/(o.y-u.y)))}addBorderIntersection(o,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[o];u<f[0]&&(f[0]=u),u>f[1]&&(f[1]=u)}processBorderOverlap(o,u){if(o.x===u.x){if(o.y===u.y)return;const f=o.x===0?0:1;this.addBorderIntersection(f,u.y),this.addBorderIntersection(f,o.y)}else{const f=o.y===0?2:3;this.addBorderIntersection(f,u.x),this.addBorderIntersection(f,o.x)}}centroid(){const o=this.polyCount.reduce((u,f)=>u+f.edges,0);return o!==0?this.acc.div(o)._round():new W(0,0)}span(){return new W(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,u)=>o+ +(u[0]!==Number.MAX_VALUE),0)}}class km{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new rt,this.centroidVertexArray=new Nl,this.indexArray=new Xt,this.programConfigurations=new gf(o.layers,o.zoom),this.segments=new Hi,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=o.enableTerrain}populate(o,u,f,d){this.features=[],this.hasPattern=Bx("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/er/(1<<_.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:x,index:T,sourceLayerIndex:P}of o){const C=this.layers[0]._featureFilter.needGeometry,O=wf(_,C);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),O,f))continue;const R={id:x,sourceLayerIndex:P,index:T,geometry:C?O.geometry:uc(_,f,d),properties:_.properties,type:_.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ux("fill-extrusion",this.layers,R,this.zoom,u)):this.addFeature(R,R.geometry,T,f,{},u.availableImages,d),u.featureIndex.insert(_,R.geometry,T,P,this.index,F)}this.sortBorders()}addFeatures(o,u,f,d,_){for(const x of this.features){const{geometry:T}=x;this.addFeature(x,T,x.index,u,f,d,_)}this.sortBorders()}update(o,u,f,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,X3),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Z3.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,$3.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,f,d,_,x,T){const P=[new W(0,0),new W(er,er)],C=T.projection,O=C.name==="globe",R=this.enableTerrain&&!O?new qS:null,F=tN[o.type]==="Polygon";O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ft);const G=zx(u,500);for(let he=G.length-1;he>=0;he--){const _e=G[he];(_e.length===0||(q=_e[0]).every(fe=>fe.x<=0)||q.every(fe=>fe.x>=er)||q.every(fe=>fe.y<=0)||q.every(fe=>fe.y>=er))&&G.splice(he,1)}var q;let K;if(O)K=YS(G,P,d);else{K=[];for(const he of G)K.push({polygon:he,bounds:P})}const re=F?this.edgeRadius:0;for(const{polygon:he,bounds:_e}of K){let fe=0,me=0;for(const ve of he)F&&!ve[0].equals(ve[ve.length-1])&&ve.push(ve[0]),me+=F?ve.length-1:ve.length;const xe=this.segments.prepareSegment((F?5:4)*me,this.layoutVertexArray,this.indexArray);if(F){const ve=[],Ue=[];fe=xe.vertexLength;for(const Je of he){let ht,je;Je.length&&Je!==he[0]&&Ue.push(ve.length/2),ht=Je[1].sub(Je[0])._perp()._unit();for(let nt=1;nt<Je.length;nt++){const it=Je[nt],lt=Je[nt===Je.length-1?1:nt+1];let{x:gt,y:He}=it;if(re){je=lt.sub(it)._perp()._unit();const Ct=ht.add(je)._unit(),Vt=re*Math.min(4,1/(ht.x*Ct.x+ht.y*Ct.y));gt+=Vt*Ct.x,He+=Vt*Ct.y,ht=je}Nm(this.layoutVertexArray,gt,He,0,0,1,1,0),xe.vertexLength++,ve.push(it.x,it.y),O&&Rm(this.layoutVertexExtArray,C.projectTilePoint(gt,He,d),C.upVector(d,gt,He))}}const ke=Fx(ve,Ue);for(let Je=0;Je<ke.length;Je+=3)this.indexArray.emplaceBack(fe+ke[Je],fe+ke[Je+2],fe+ke[Je+1]),xe.primitiveLength++}for(const ve of he){R&&ve.length&&R.startRing(ve[0]);let Ue,ke,Je,ht=ve.length>4&&WS(ve[ve.length-2],ve[0],ve[1]),je=re?nN(ve[ve.length-2],ve[0],ve[1],re):0;ke=ve[1].sub(ve[0])._perp()._unit();let nt=!0;for(let it=1,lt=0;it<ve.length;it++){let gt=ve[it-1],He=ve[it];const Ct=ve[it===ve.length-1?1:it+1];if(R&&F&&R.currentPolyCount.top++,XS(He,gt,_e)){re&&(ke=Ct.sub(He)._perp()._unit(),nt=!nt);continue}R&&R.append(He,gt);const Vt=He.sub(gt)._perp(),Lt=Vt.x/(Math.abs(Vt.x)+Math.abs(Vt.y)),vr=Vt.y>0?1:0,yt=gt.dist(He);if(lt+yt>32768&&(lt=0),re){Je=Ct.sub(He)._perp()._unit();let wr=ZS(gt,He,Ct,$S(ke,Je),re);isNaN(wr)&&(wr=0);const ar=He.sub(gt)._unit();gt=gt.add(ar.mult(je))._round(),He=He.add(ar.mult(-wr))._round(),je=wr,ke=Je}const Kt=xe.vertexLength,xr=ve.length>4&&WS(gt,He,Ct);let Tn=HS(lt,ht,nt);if(Nm(this.layoutVertexArray,gt.x,gt.y,Lt,vr,0,0,Tn),Nm(this.layoutVertexArray,gt.x,gt.y,Lt,vr,0,1,Tn),lt+=yt,Tn=HS(lt,xr,!nt),ht=xr,Nm(this.layoutVertexArray,He.x,He.y,Lt,vr,0,0,Tn),Nm(this.layoutVertexArray,He.x,He.y,Lt,vr,0,1,Tn),xe.vertexLength+=4,this.indexArray.emplaceBack(Kt+0,Kt+1,Kt+2),this.indexArray.emplaceBack(Kt+1,Kt+3,Kt+2),xe.primitiveLength+=2,re){const wr=fe+(it===1?ve.length-2:it-2),ar=it===1?fe:wr+1;if(this.indexArray.emplaceBack(Kt+1,wr,Kt+3),this.indexArray.emplaceBack(wr,ar,Kt+3),xe.primitiveLength+=2,Ue===void 0&&(Ue=Kt),!XS(Ct,ve[it],_e)){const ai=it===ve.length-1?Ue:xe.vertexLength;this.indexArray.emplaceBack(Kt+2,Kt+3,ai),this.indexArray.emplaceBack(Kt+3,ai+1,ai),this.indexArray.emplaceBack(Kt+3,ar,ai+1),xe.primitiveLength+=3}nt=!nt}if(O){const wr=this.layoutVertexExtArray,ar=C.projectTilePoint(gt.x,gt.y,d),ai=C.projectTilePoint(He.x,He.y,d),Sr=C.upVector(d,gt.x,gt.y),Ir=C.upVector(d,He.x,He.y);Rm(wr,ar,Sr),Rm(wr,ar,Sr),Rm(wr,ai,Ir),Rm(wr,ai,Ir)}}F&&(fe+=ve.length-1)}}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const he=R.borders,_e=this.featuresOnBorder.push(R)-1;for(let fe=0;fe<4;fe++)he[fe][0]!==Number.MAX_VALUE&&this.borders[fe].push(_e)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,_,x,d)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((u,f)=>this.featuresOnBorder[u].borders[o][0]-this.featuresOnBorder[f].borders[o][0])}encodeCentroid(o,u,f=!0){let d,_;if(o)if(o.y!==0){const T=u.span()._mult(this.tileToMeter);d=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(T.x/10)),_=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else d=Math.ceil(7*(o.x+450)),_=0;else d=0,_=+f;let x=f?this.centroidVertexArray.length:u.vertexArrayOffset;for(const T of u.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let P=0;P<T.top;P++)this.centroidVertexArray.emplace(x++,d,_);for(let P=0;P<2*T.edges;P++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,d,_)}}}function $S(l,o){const u=l.add(o)._unit();return l.x*u.x+l.y*u.y}function nN(l,o,u,f){const d=o.sub(l)._perp()._unit(),_=u.sub(o)._perp()._unit();return ZS(l,o,u,$S(d,_),f)}function ZS(l,o,u,f,d){const _=Math.sqrt(1-f*f);return Math.min(l.dist(o)/3,o.dist(u)/3,d*_/f)}function XS(l,o,u){return l.x<u[0].x&&o.x<u[0].x||l.x>u[1].x&&o.x>u[1].x||l.y<u[0].y&&o.y<u[0].y||l.y>u[1].y&&o.y>u[1].y}function WS(l,o,u){if(l.x<0||l.x>=er||o.x<0||o.x>=er||u.x<0||u.x>=er)return!1;const f=u.sub(o),d=f.perp(),_=l.sub(o);return(f.x*_.x+f.y*_.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(_.x*_.x+_.y*_.y))>-.866&&d.x*_.x+d.y*_.y<0}function HS(l,o,u){const f=o?2|l:-3&l;return u?1|f:-2&f}function KS(){const l=Math.PI/32,o=Math.tan(l),u=Am;return u*Math.sqrt(1+2*o*o)-u}function YS(l,o,u){const f=1<<u.z,d=Aa(u.x/f),_=Aa((u.x+1)/f),x=Ko(u.y/f),T=Ko((u.y+1)/f);return function(P,C,O,R,F=0,G){const q=[];if(!P.length||!O||!R)return q;const K=(ve,Ue)=>{for(const ke of ve)q.push({polygon:ke,bounds:Ue})},re=Math.ceil(Math.log2(O)),he=Math.ceil(Math.log2(R)),_e=re-he,fe=[];for(let ve=0;ve<Math.abs(_e);ve++)fe.push(_e>0?0:1);for(let ve=0;ve<Math.min(re,he);ve++)fe.push(0),fe.push(1);let me=P;if(me=Ev(me,C[0].y-F,C[1].y+F,1),me=Ev(me,C[0].x-F,C[1].x+F,0),!me.length)return q;const xe=[];for(fe.length?xe.push({polygons:me,bounds:C,depth:0}):K(me,C);xe.length;){const ve=xe.pop(),Ue=ve.depth,ke=fe[Ue],Je=ve.bounds[0],ht=ve.bounds[1],je=ke===0?Je.x:Je.y,nt=ke===0?ht.x:ht.y,it=G?G(ke,je,nt):.5*(je+nt),lt=Ev(ve.polygons,je-F,it+F,ke),gt=Ev(ve.polygons,it-F,nt+F,ke);if(lt.length){const He=[Je,new W(ke===0?it:ht.x,ke===1?it:ht.y)];fe.length>Ue+1?xe.push({polygons:lt,bounds:He,depth:Ue+1}):K(lt,He)}if(gt.length){const He=[new W(ke===0?it:Je.x,ke===1?it:Je.y),ht];fe.length>Ue+1?xe.push({polygons:gt,bounds:He,depth:Ue+1}):K(gt,He)}}return q}(l,o,Math.ceil((_-d)/11.25),Math.ceil((x-T)/11.25),1,(P,C,O)=>{if(P===0)return .5*(C+O);{const R=Ko((u.y+C/er)/f);return(xu(.5*(Ko((u.y+O/er)/f)+R))*f-u.y)*er}})}Bt(km,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(qS,"PartMetadata");const iN=new de({"fill-extrusion-edge-radius":new X(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var oN={paint:new de({"fill-extrusion-opacity":new X(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new oe(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new X(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new X(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new oe(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new oe(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new oe(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new X(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new X(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new X(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new X(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:iN};function JS(l,o,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[l*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class bv{constructor(o,u,f){this.z=o,this.x=u,this.y=f,this.key=Fm(0,o,o,u,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u){const f=function(_,x,T){var P=JS(256*_,256*(x=Math.pow(2,T)-x-1),T),C=JS(256*(_+1),256*(x+1),T);return P[0]+","+P[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),d=function(_,x,T){let P,C="";for(let O=_;O>0;O--)P=1<<O-1,C+=(x&P?1:0)+(T&P?2:0);return C}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class QS{constructor(o,u){this.wrap=o,this.canonical=u,this.key=Fm(o,u.z,u.z,u.x,u.y)}}class Is{constructor(o,u,f,d,_){this.overscaledZ=o,this.wrap=u,this.canonical=new bv(f,+d,+_),this.key=u===0&&o===f?this.canonical.key:Fm(u,o,f,d,_)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const u=this.canonical.z-o;return o>this.canonical.z?new Is(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u=!0){if(this.overscaledZ===o&&u)return this.key;if(o>this.canonical.z)return Fm(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-o;return Fm(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,d=2*this.canonical.y;return[new Is(u,this.wrap,u,f,d),new Is(u,this.wrap,u,f+1,d),new Is(u,this.wrap,u,f,d+1),new Is(u,this.wrap,u,f+1,d+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Is(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new QS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fm(l,o,u,f,d){const _=1<<Math.min(u,22);let x=_*(d%_)+f%_;return l&&u<22&&(x+=_*_*((l<0?-2*l-1:2*l)%(1<<2*(22-u)))),16*(32*x+u)+(o-u)}Bt(bv,"CanonicalTileID"),Bt(Is,"OverscaledTileID",{omit:["projMatrix"]});class ed extends W{constructor(o,u,f){super(o,u),this.z=f}}function zm(l,o){return l.x*o.x+l.y*o.y}function eI(l,o){if(l.length===1){let u=0;const f=o[u++];let d;for(;!d||f.equals(d);)if(d=o[u++],!d)return 1/0;for(;u<o.length;u++){const _=o[u],x=l[0],T=d.sub(f),P=_.sub(f),C=x.sub(f),O=zm(T,T),R=zm(T,P),F=zm(P,P),G=zm(C,T),q=zm(C,P),K=O*F-R*R,re=(F*G-R*q)/K,he=(O*q-R*G)/K,_e=f.z*(1-re-he)+d.z*re+_.z*he;if(isFinite(_e))return _e}return 1/0}{let u=1/0;for(const f of o)u=Math.min(u,f.z);return u}}function tI(l,o,u,f,d,_,x,T){const P=x*d.getElevationAt(l,o,!0,!0),C=_[0]!==0,O=C?_[1]===0?x*(_[0]/7-450):x*function(R,F,G){const q=Math.floor(F[0]/8),K=Math.floor(F[1]/8),re=10*(F[0]-8*q),he=10*(F[1]-8*K),_e=R.getElevationAt(q,K,!0,!0),fe=R.getMeterToDEM(G),me=Math.floor(.5*(re*fe-1)),xe=Math.floor(.5*(he*fe-1)),ve=R.tileCoordToPixel(q,K),Ue=2*me+1,ke=2*xe+1,Je=function(gt,He,Ct,Vt,Lt){return[gt.getElevationAtPixel(He,Ct,!0),gt.getElevationAtPixel(He+Lt,Ct,!0),gt.getElevationAtPixel(He,Ct+Lt,!0),gt.getElevationAtPixel(He+Vt,Ct+Lt,!0)]}(R,ve.x-me,ve.y-xe,Ue,ke),ht=Math.abs(Je[0]-Je[1]),je=Math.abs(Je[2]-Je[3]),nt=Math.abs(Je[0]-Je[2])+Math.abs(Je[1]-Je[3]),it=Math.min(.25,.5*fe*(ht+je)/Ue),lt=Math.min(.25,.5*fe*nt/ke);return _e+Math.max(it*re,lt*he)}(d,_,T):P;return{base:P+(u===0)?-1:u,top:C?Math.max(O+f,P+u+2):P+f}}const sN=Ae([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:aN}=sN,lN=Ae([{name:"a_packed",components:4,type:"Float32"}]),{members:uN}=lN,cN=wv.types,hN=Math.cos(Math.PI/180*37.5);class Tv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ve,this.layoutVertexArray2=new ut,this.indexArray=new Xt,this.programConfigurations=new gf(o.layers,o.zoom),this.segments=new Hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,d){this.hasPattern=Bx("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:O,id:R,index:F,sourceLayerIndex:G}of o){const q=this.layers[0]._featureFilter.needGeometry,K=wf(O,q);if(!this.layers[0]._featureFilter.filter(new N(this.zoom),K,f))continue;const re=_?_.evaluate(K,{},f):void 0,he={id:R,properties:O.properties,type:O.type,sourceLayerIndex:G,index:F,geometry:q?K.geometry:uc(O,f,d),patterns:{},sortKey:re};x.push(he)}_&&x.sort((O,R)=>O.sortKey-R.sortKey);const{lineAtlas:T,featureIndex:P}=u,C=this.addConstantDashes(T);for(const O of x){const{geometry:R,index:F,sourceLayerIndex:G}=O;if(C&&this.addFeatureDashes(O,T),this.hasPattern){const q=Ux("line",this.layers,O,this.zoom,u);this.patternFeatures.push(q)}else this.addFeature(O,R,F,f,T.positions,u.availableImages);P.insert(o[F].feature,R,F,G,this.index)}}addConstantDashes(o){let u=!1;for(const f of this.layers){const d=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(d.kind!=="constant"||_.kind!=="constant")u=!0;else{const x=_.value,T=d.value;if(!T)continue;o.addDash(T,x)}}return u}addFeatureDashes(o,u){const f=this.zoom;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,x=d.layout.get("line-cap").value;if(_.kind==="constant"&&x.kind==="constant")continue;let T,P;if(_.kind==="constant"){if(T=_.value,!T)continue}else T=_.evaluate({zoom:f},o);P=x.kind==="constant"?x.value:x.evaluate({zoom:f},o),u.addDash(T,P),o.patterns[d.id]=u.getKey(T,P)}}update(o,u,f,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,d)}addFeatures(o,u,f,d,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,u,f,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,uN)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,aN),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,f,d,_,x){const T=this.layers[0].layout,P=T.get("line-join").evaluate(o,{}),C=T.get("line-cap").evaluate(o,{}),O=T.get("line-miter-limit"),R=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const F of u)this.addLine(F,o,P,C,O,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,_,x,d)}addLine(o,u,f,d,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<o.length-1;he++)this.totalDistance+=o[he].dist(o[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=cN[u.type]==="Polygon";let P=o.length;for(;P>=2&&o[P-1].equals(o[P-2]);)P--;let C=0;for(;C<P-1&&o[C].equals(o[C+1]);)C++;if(P<(T?3:2))return;f==="bevel"&&(_=1.05);const O=this.overscaling<=16?15*er/(512*this.overscaling):0,R=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let F,G,q,K,re;this.e1=this.e2=-1,T&&(F=o[P-2],re=o[C].sub(F)._unit()._perp());for(let he=C;he<P;he++){if(q=he===P-1?T?o[C+1]:void 0:o[he+1],q&&o[he].equals(q))continue;re&&(K=re),F&&(G=F),F=o[he],re=q?q.sub(F)._unit()._perp():K,K=K||re;let _e=K.add(re);_e.x===0&&_e.y===0||_e._unit();const fe=K.x*re.x+K.y*re.y,me=_e.x*re.x+_e.y*re.y,xe=me!==0?1/me:1/0,ve=2*Math.sqrt(2-2*me),Ue=me<hN&&G&&q,ke=K.x*re.y-K.y*re.x>0;if(Ue&&he>C){const je=F.dist(G);if(je>2*O){const nt=F.sub(F.sub(G)._mult(O/je)._round());this.updateDistance(G,nt),this.addCurrentVertex(nt,K,0,0,R),G=nt}}const Je=G&&q;let ht=Je?f:T?"butt":d;if(Je&&ht==="round"&&(xe<x?ht="miter":xe<=2&&(ht="fakeround")),ht==="miter"&&xe>_&&(ht="bevel"),ht==="bevel"&&(xe>2&&(ht="flipbevel"),xe<_&&(ht="miter")),G&&this.updateDistance(G,F),ht==="miter")_e._mult(xe),this.addCurrentVertex(F,_e,0,0,R);else if(ht==="flipbevel"){if(xe>100)_e=re.mult(-1);else{const je=xe*K.add(re).mag()/K.sub(re).mag();_e._perp()._mult(je*(ke?-1:1))}this.addCurrentVertex(F,_e,0,0,R),this.addCurrentVertex(F,_e.mult(-1),0,0,R)}else if(ht==="bevel"||ht==="fakeround"){const je=-Math.sqrt(xe*xe-1),nt=ke?je:0,it=ke?0:je;if(G&&this.addCurrentVertex(F,K,nt,it,R),ht==="fakeround"){const lt=Math.round(180*ve/Math.PI/20);for(let gt=1;gt<lt;gt++){let He=gt/lt;if(He!==.5){const Vt=He-.5;He+=He*Vt*(He-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*Vt*Vt+(.848013+fe*(.215638*fe-1.06021)))}const Ct=re.sub(K)._mult(He)._add(K)._unit()._mult(ke?-1:1);this.addHalfVertex(F,Ct.x,Ct.y,!1,ke,0,R)}}q&&this.addCurrentVertex(F,re,-nt,-it,R)}else if(ht==="butt")this.addCurrentVertex(F,_e,0,0,R);else if(ht==="square"){const je=G?1:-1;G||this.addCurrentVertex(F,_e,je,je,R),this.addCurrentVertex(F,_e,0,0,R),G&&this.addCurrentVertex(F,_e,je,je,R)}else ht==="round"&&(G&&(this.addCurrentVertex(F,K,0,0,R),this.addCurrentVertex(F,K,1,1,R,!0)),q&&(this.addCurrentVertex(F,re,-1,-1,R,!0),this.addCurrentVertex(F,re,0,0,R)));if(Ue&&he<P-1){const je=F.dist(q);if(je>2*O){const nt=F.add(q.sub(F)._mult(O/je)._round());this.updateDistance(F,nt),this.addCurrentVertex(nt,re,0,0,R),F=nt}}}}addCurrentVertex(o,u,f,d,_,x=!1){const T=u.y*d-u.x,P=-u.y-u.x*d;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,x,!1,f,_),this.addHalfVertex(o,T,P,x,!0,-d,_)}addHalfVertex({x:o,y:u},f,d,_,x,T,P){this.layoutVertexArray.emplaceBack((o<<1)+(_?1:0),(u<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*d)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),P.primitiveLength++),x?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}Bt(Tv,"LineBucket",{omit:["layers","patternFeatures"]});const fN=new de({"line-cap":new oe(Ye.layout_line["line-cap"]),"line-join":new oe(Ye.layout_line["line-join"]),"line-miter-limit":new X(Ye.layout_line["line-miter-limit"]),"line-round-limit":new X(Ye.layout_line["line-round-limit"]),"line-sort-key":new oe(Ye.layout_line["line-sort-key"])});var rI={paint:new de({"line-opacity":new oe(Ye.paint_line["line-opacity"]),"line-color":new oe(Ye.paint_line["line-color"]),"line-translate":new X(Ye.paint_line["line-translate"]),"line-translate-anchor":new X(Ye.paint_line["line-translate-anchor"]),"line-width":new oe(Ye.paint_line["line-width"]),"line-gap-width":new oe(Ye.paint_line["line-gap-width"]),"line-offset":new oe(Ye.paint_line["line-offset"]),"line-blur":new oe(Ye.paint_line["line-blur"]),"line-dasharray":new oe(Ye.paint_line["line-dasharray"]),"line-pattern":new oe(Ye.paint_line["line-pattern"]),"line-gradient":new pe(Ye.paint_line["line-gradient"]),"line-trim-offset":new X(Ye.paint_line["line-trim-offset"])}),layout:fN};const nI=new class extends oe{possiblyEvaluate(l,o){return o=new N(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(l,o)}evaluate(l,o,u,f){return o=jt({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(l,o,u,f)}}(rI.paint.properties["line-width"].specification);function iI(l,o){return o>0?o+2*l:l}nI.useIntegerZoom=!0;const pN=Ae([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dN=Ae([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gN=Ae([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ae([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mN=Ae([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),yN=Ae([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const oI=Ae([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_N=Ae([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ae([{name:"triangle",components:3,type:"Uint16"}]),Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ae([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ae([{type:"Float32",name:"offsetX"}]),Ae([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Fo=24;const Ul=128;function Vx(l,o){const{expression:u}=o;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new N(l+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:d}=u;let _=0;for(;_<f.length&&f[_]<=l;)_++;_=Math.max(0,_-1);let x=_;for(;x<f.length&&f[x]<l+1;)x++;x=Math.min(f.length-1,x);const T=f[_],P=f[x];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:P,interpolationType:d}:{kind:"camera",minZoom:T,maxZoom:P,minSize:u.evaluate(new N(T)),maxSize:u.evaluate(new N(P)),interpolationType:d}}}function Sv(l,{uSize:o,uSizeT:u},{lowerSize:f,upperSize:d}){return l.kind==="source"?f/Ul:l.kind==="composite"?Hr(f/Ul,d/Ul,u):o}function td(l,o){let u=0,f=0;if(l.kind==="constant")f=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:x}=l,T=d?et(Xa.interpolationFactor(d,o,_,x),0,1):0;l.kind==="camera"?f=Hr(l.minSize,l.maxSize,T):u=T}return{uSizeT:u,uSize:f}}var vN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ul,evaluateSizeForFeature:Sv,evaluateSizeForZoom:td,getSizeData:Vx});function xN(l,o,u){return l.sections.forEach(f=>{f.text=function(d,_,x){const T=_.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?d=d.toLocaleUpperCase():T==="lowercase"&&(d=d.toLocaleLowerCase()),L.applyArabicShaping&&(d=L.applyArabicShaping(d)),d}(f.text,o,u)}),l}const Bm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function wN(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function EN(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}var sI=Qn,aI=function(l,o,u,f,d){var _,x,T=8*d-f-1,P=(1<<T)-1,C=P>>1,O=-7,R=u?d-1:0,F=u?-1:1,G=l[o+R];for(R+=F,_=G&(1<<-O)-1,G>>=-O,O+=T;O>0;_=256*_+l[o+R],R+=F,O-=8);for(x=_&(1<<-O)-1,_>>=-O,O+=f;O>0;x=256*x+l[o+R],R+=F,O-=8);if(_===0)_=1-C;else{if(_===P)return x?NaN:1/0*(G?-1:1);x+=Math.pow(2,f),_-=C}return(G?-1:1)*x*Math.pow(2,_-f)},lI=function(l,o,u,f,d,_){var x,T,P,C=8*_-d-1,O=(1<<C)-1,R=O>>1,F=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=f?0:_-1,q=f?1:-1,K=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(T=isNaN(o)?1:0,x=O):(x=Math.floor(Math.log(o)/Math.LN2),o*(P=Math.pow(2,-x))<1&&(x--,P*=2),(o+=x+R>=1?F/P:F*Math.pow(2,1-R))*P>=2&&(x++,P/=2),x+R>=O?(T=0,x=O):x+R>=1?(T=(o*P-1)*Math.pow(2,d),x+=R):(T=o*Math.pow(2,R-1)*Math.pow(2,d),x=0));d>=8;l[u+G]=255&T,G+=q,T/=256,d-=8);for(x=x<<d|T,C+=d;C>0;l[u+G]=255&x,G+=q,x/=256,C-=8);l[u+G-q]|=128*K};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Qn(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var jx=4294967296,uI=1/jx,cI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function hc(l){return l.type===Qn.Bytes?l.readVarint()+l.pos:l.pos+1}function rd(l,o,u){return u?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}function hI(l,o,u){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(f);for(var d=u.pos-1;d>=l;d--)u.buf[d+f]=u.buf[d]}function bN(l,o){for(var u=0;u<l.length;u++)o.writeVarint(l[u])}function TN(l,o){for(var u=0;u<l.length;u++)o.writeSVarint(l[u])}function SN(l,o){for(var u=0;u<l.length;u++)o.writeFloat(l[u])}function IN(l,o){for(var u=0;u<l.length;u++)o.writeDouble(l[u])}function PN(l,o){for(var u=0;u<l.length;u++)o.writeBoolean(l[u])}function CN(l,o){for(var u=0;u<l.length;u++)o.writeFixed32(l[u])}function AN(l,o){for(var u=0;u<l.length;u++)o.writeSFixed32(l[u])}function MN(l,o){for(var u=0;u<l.length;u++)o.writeFixed64(l[u])}function LN(l,o){for(var u=0;u<l.length;u++)o.writeSFixed64(l[u])}function Iv(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function nd(l,o,u){l[u]=o,l[u+1]=o>>>8,l[u+2]=o>>>16,l[u+3]=o>>>24}function fI(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}Qn.prototype={destroy:function(){this.buf=null},readFields:function(l,o,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),d=f>>3,_=this.pos;this.type=7&f,l(d,o,this),this.pos===_&&this.skip(f)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=Iv(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=fI(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=Iv(this.buf,this.pos)+Iv(this.buf,this.pos+4)*jx;return this.pos+=8,l},readSFixed64:function(){var l=Iv(this.buf,this.pos)+fI(this.buf,this.pos+4)*jx;return this.pos+=8,l},readFloat:function(){var l=aI(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=aI(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,u,f=this.buf;return o=127&(u=f[this.pos++]),u<128?o:(o|=(127&(u=f[this.pos++]))<<7,u<128?o:(o|=(127&(u=f[this.pos++]))<<14,u<128?o:(o|=(127&(u=f[this.pos++]))<<21,u<128?o:function(d,_,x){var T,P,C=x.buf;if(T=(112&(P=C[x.pos++]))>>4,P<128||(T|=(127&(P=C[x.pos++]))<<3,P<128)||(T|=(127&(P=C[x.pos++]))<<10,P<128)||(T|=(127&(P=C[x.pos++]))<<17,P<128)||(T|=(127&(P=C[x.pos++]))<<24,P<128)||(T|=(1&(P=C[x.pos++]))<<31,P<128))return rd(d,T,_);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=f[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&cI?function(u,f,d){return cI.decode(u.subarray(f,d))}(this.buf,o,l):function(u,f,d){for(var _="",x=f;x<d;){var T,P,C,O=u[x],R=null,F=O>239?4:O>223?3:O>191?2:1;if(x+F>d)break;F===1?O<128&&(R=O):F===2?(192&(T=u[x+1]))==128&&(R=(31&O)<<6|63&T)<=127&&(R=null):F===3?(P=u[x+2],(192&(T=u[x+1]))==128&&(192&P)==128&&((R=(15&O)<<12|(63&T)<<6|63&P)<=2047||R>=55296&&R<=57343)&&(R=null)):F===4&&(P=u[x+2],C=u[x+3],(192&(T=u[x+1]))==128&&(192&P)==128&&(192&C)==128&&((R=(15&O)<<18|(63&T)<<12|(63&P)<<6|63&C)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,F=1):R>65535&&(R-=65536,_+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),_+=String.fromCharCode(R),x+=F}return _}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==Qn.Bytes)return l.push(this.readVarint(o));var u=hc(this);for(l=l||[];this.pos<u;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==Qn.Bytes)return l.push(this.readSVarint());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Qn.Bytes)return l.push(this.readBoolean());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Qn.Bytes)return l.push(this.readFloat());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Qn.Bytes)return l.push(this.readDouble());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Qn.Bytes)return l.push(this.readFixed32());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Qn.Bytes)return l.push(this.readSFixed32());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Qn.Bytes)return l.push(this.readFixed64());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Qn.Bytes)return l.push(this.readSFixed64());var o=hc(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(o===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Qn.Fixed32)this.pos+=4;else{if(o!==Qn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),nd(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),nd(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),nd(this.buf,-1&l,this.pos),nd(this.buf,Math.floor(l*uI),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),nd(this.buf,-1&l,this.pos),nd(this.buf,Math.floor(l*uI),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,u){var f,d;if(o>=0?(f=o%4294967296|0,d=o/4294967296|0):(d=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,d=d+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(_,x,T){T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7)}(f,0,u),function(_,x){var T=(7&_)<<4;x.buf[x.pos++]|=T|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(d,u)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(f,d,_){for(var x,T,P=0;P<d.length;P++){if((x=d.charCodeAt(P))>55295&&x<57344){if(!T){x>56319||P+1===d.length?(f[_++]=239,f[_++]=191,f[_++]=189):T=x;continue}if(x<56320){f[_++]=239,f[_++]=191,f[_++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[_++]=239,f[_++]=191,f[_++]=189,T=null);x<128?f[_++]=x:(x<2048?f[_++]=x>>6|192:(x<65536?f[_++]=x>>12|224:(f[_++]=x>>18|240,f[_++]=x>>12&63|128),f[_++]=x>>6&63|128),f[_++]=63&x|128)}return _}(this.buf,l,this.pos);var u=this.pos-o;u>=128&&hI(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(l){this.realloc(4),lI(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),lI(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=l[u]},writeRawMessage:function(l,o){this.pos++;var u=this.pos;l(o,this);var f=this.pos-u;f>=128&&hI(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(l,o,u){this.writeTag(l,Qn.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,bN,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,TN,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,PN,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,SN,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,IN,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,CN,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,AN,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,MN,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,LN,o)},writeBytesField:function(l,o){this.writeTag(l,Qn.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,Qn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,Qn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,Qn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,Qn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,Qn.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,Qn.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,Qn.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,Qn.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,Qn.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,!!o)}};var Pv=k(sI);const qx=3;function ON(l,o,u){o.glyphs=[],l===1&&u.readMessage(DN,o)}function DN(l,o,u){if(l===3){const{id:f,bitmap:d,width:_,height:x,left:T,top:P,advance:C}=u.readMessage(NN,{});o.glyphs.push({id:f,bitmap:new cc({width:_+2*qx,height:x+2*qx},d),metrics:{width:_,height:x,left:T,top:P,advance:C}})}else l===4?o.ascender=u.readSVarint():l===5&&(o.descender=u.readSVarint())}function NN(l,o,u){l===1?o.id=u.readVarint():l===2?o.bitmap=u.readBytes():l===3?o.width=u.readVarint():l===4?o.height=u.readVarint():l===5?o.left=u.readSVarint():l===6?o.top=u.readSVarint():l===7&&(o.advance=u.readVarint())}const pI=qx;function $x(l){let o=0,u=0;for(const x of l)o+=x.w*x.h,u=Math.max(u,x.w);l.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let d=0,_=0;for(const x of l)for(let T=f.length-1;T>=0;T--){const P=f[T];if(!(x.w>P.w||x.h>P.h)){if(x.x=P.x,x.y=P.y,_=Math.max(_,x.y+x.h),d=Math.max(d,x.x+x.w),x.w===P.w&&x.h===P.h){const C=f.pop();T<f.length&&(f[T]=C)}else x.h===P.h?(P.x+=x.w,P.w-=x.w):x.w===P.w?(P.y+=x.h,P.h-=x.h):(f.push({x:P.x+x.w,y:P.y,w:P.w-x.w,h:x.h}),P.y+=x.h,P.h-=x.h);break}}return{w:d,h:_,fill:o/(d*_)||0}}const Gs=1;class Zx{constructor(o,{pixelRatio:u,version:f,stretchX:d,stretchY:_,content:x}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=d,this.stretchY=_,this.content=x,this.version=f}get tl(){return[this.paddedRect.x+Gs,this.paddedRect.y+Gs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Gs,this.paddedRect.y+this.paddedRect.h-Gs]}get displaySize(){return[(this.paddedRect.w-2*Gs)/this.pixelRatio,(this.paddedRect.h-2*Gs)/this.pixelRatio]}}class dI{constructor(o,u){const f={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(o,f,_),this.addImages(u,d,_);const{w:x,h:T}=$x(_),P=new oa({width:x||1,height:T||1});for(const C in o){const O=o[C],R=f[C].paddedRect;oa.copy(O.data,P,{x:0,y:0},{x:R.x+Gs,y:R.y+Gs},O.data)}for(const C in u){const O=u[C],R=d[C].paddedRect,F=R.x+Gs,G=R.y+Gs,q=O.data.width,K=O.data.height;oa.copy(O.data,P,{x:0,y:0},{x:F,y:G},O.data),oa.copy(O.data,P,{x:0,y:K-1},{x:F,y:G-1},{width:q,height:1}),oa.copy(O.data,P,{x:0,y:0},{x:F,y:G+K},{width:q,height:1}),oa.copy(O.data,P,{x:q-1,y:0},{x:F-1,y:G},{width:1,height:K}),oa.copy(O.data,P,{x:0,y:0},{x:F+q,y:G},{width:1,height:K})}this.image=P,this.iconPositions=f,this.patternPositions=d}addImages(o,u,f){for(const d in o){const _=o[d],x={x:0,y:0,w:_.data.width+2*Gs,h:_.data.height+2*Gs};f.push(x),u[d]=new Zx(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>o.hasImage(f)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)}patchUpdatedImage(o,u,f){if(!o||!u||o.version===u.version)return;o.version=u.version;const[d,_]=o.tl;f.update(u.data,void 0,{x:d,y:_})}}Bt(Zx,"ImagePosition"),Bt(dI,"ImageAtlas");const Ma={horizontal:1,vertical:2,horizontalOnly:3},gI=-17;class Um{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const f=new Um;return f.scale=o||1,f.fontStack=u,f}static forImage(o){const u=new Um;return u.imageName=o,u}}class id{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const f=new id;for(let d=0;d<o.sections.length;d++){const _=o.sections[d];_.image?f.addImageSection(_):f.addTextSection(_,u)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(u,f){let d="";for(let _=0;_<u.length;_++){const x=u.charCodeAt(_+1)||null,T=u.charCodeAt(_-1)||null;d+=!f&&(x&&rv(x)&&!Bm[u[_+1]]||T&&rv(T)&&!Bm[u[_-1]])||!Bm[u[_]]?u[_]:Bm[u[_]]}return d}(this.text,o)}trim(){let o=0;for(let f=0;f<this.text.length&&Cv[this.text.charCodeAt(f)];f++)o++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&Cv[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const f=new id;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(Um.forText(o.scale,o.fontStack||u));const f=this.sections.length-1;for(let d=0;d<o.text.length;++d)this.sectionIndex.push(f)}addImageSection(o){const u=o.image?o.image.name:"";if(u.length===0)return void Qe("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Um.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xx(l,o,u,f,d,_,x,T,P,C,O,R,F,G,q){const K=id.fromFeature(l,d);R===Ma.vertical&&K.verticalizePunctuation(F);let re=[];const he=function(ve,Ue,ke,Je,ht,je){if(!ve)return[];const nt=[],it=function(Ct,Vt,Lt,vr,yt,Kt){let xr=0;for(let Tn=0;Tn<Ct.length();Tn++){const wr=Ct.getSection(Tn);xr+=mI(Ct.getCharCode(Tn),wr,vr,yt,Vt,Kt)}return xr/Math.max(1,Math.ceil(xr/Lt))}(ve,Ue,ke,Je,ht,je),lt=ve.text.indexOf("")>=0;let gt=0;for(let Ct=0;Ct<ve.length();Ct++){const Vt=ve.getSection(Ct),Lt=ve.getCharCode(Ct);if(Cv[Lt]||(gt+=mI(Lt,Vt,Je,ht,Ue,je)),Ct<ve.length()-1){const vr=!((He=Lt)<11904||!(Ot["Bopomofo Extended"](He)||Ot.Bopomofo(He)||Ot["CJK Compatibility Forms"](He)||Ot["CJK Compatibility Ideographs"](He)||Ot["CJK Compatibility"](He)||Ot["CJK Radicals Supplement"](He)||Ot["CJK Strokes"](He)||Ot["CJK Symbols and Punctuation"](He)||Ot["CJK Unified Ideographs Extension A"](He)||Ot["CJK Unified Ideographs"](He)||Ot["Enclosed CJK Letters and Months"](He)||Ot["Halfwidth and Fullwidth Forms"](He)||Ot.Hiragana(He)||Ot["Ideographic Description Characters"](He)||Ot["Kangxi Radicals"](He)||Ot["Katakana Phonetic Extensions"](He)||Ot.Katakana(He)||Ot["Vertical Forms"](He)||Ot["Yi Radicals"](He)||Ot["Yi Syllables"](He)));(RN[Lt]||vr||Vt.imageName)&&nt.push(_I(Ct+1,gt,it,nt,kN(Lt,ve.getCharCode(Ct+1),vr&&lt),!1))}}var He;return vI(_I(ve.length(),gt,it,nt,0,!0))}(K,C,_,o,f,G),{processBidirectionalText:_e,processStyledBidirectionalText:fe}=L;if(_e&&K.sections.length===1){const ve=_e(K.toString(),he);for(const Ue of ve){const ke=new id;ke.text=Ue,ke.sections=K.sections;for(let Je=0;Je<Ue.length;Je++)ke.sectionIndex.push(0);re.push(ke)}}else if(fe){const ve=fe(K.text,K.sectionIndex,he);for(const Ue of ve){const ke=new id;ke.text=Ue[0],ke.sectionIndex=Ue[1],ke.sections=K.sections,re.push(ke)}}else re=function(ve,Ue){const ke=[],Je=ve.text;let ht=0;for(const je of Ue)ke.push(ve.substring(ht,je)),ht=je;return ht<Je.length&&ke.push(ve.substring(ht,Je.length)),ke}(K,he);const me=[],xe={positionedLines:me,text:K.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ve,Ue,ke,Je,ht,je,nt,it,lt,gt,He,Ct){let Vt=0,Lt=0,vr=0;const yt=it==="right"?1:it==="left"?0:.5;let Kt=!1;for(const Sr of ht){const Ir=Sr.getSections();for(const Wn of Ir){if(Wn.imageName)continue;const ei=Ue[Wn.fontStack];if(ei&&(Kt=ei.ascender!==void 0&&ei.descender!==void 0,!Kt))break}if(!Kt)break}let xr=0;for(const Sr of ht){Sr.trim();const Ir=Sr.getMaxScale(),Wn=(Ir-1)*Fo,ei={positionedGlyphs:[],lineOffset:0};ve.positionedLines[xr]=ei;const ti=ei.positionedGlyphs;let Hn=0;if(!Sr.length()){Lt+=je,++xr;continue}let bi=0,Oi=0;for(let Kn=0;Kn<Sr.length();Kn++){const uo=Sr.getSection(Kn),Ji=Sr.getSectionIndex(Kn),Pi=Sr.getCharCode(Kn);let Pn=uo.scale,Qi=null,ri=null,Ps=null,eo=Fo,zo=0;const bo=!(lt===Ma.horizontal||!He&&!pm(Pi)||He&&(Cv[Pi]||(Tn=Pi,Ot.Arabic(Tn)||Ot["Arabic Supplement"](Tn)||Ot["Arabic Extended-A"](Tn)||Ot["Arabic Presentation Forms-A"](Tn)||Ot["Arabic Presentation Forms-B"](Tn))));if(uo.imageName){const Cs=Je[uo.imageName];if(!Cs)continue;Ps=uo.imageName,ve.iconsInText=ve.iconsInText||!0,ri=Cs.paddedRect;const To=Cs.displaySize;Pn=Pn*Fo/Ct,Qi={width:To[0],height:To[1],left:Gs,top:-pI,advance:bo?To[1]:To[0],localGlyph:!1},zo=Kt?-Qi.height*Pn:gI+Ir*Fo-To[1]*Pn,eo=Qi.advance;const jl=(bo?To[0]:To[1])*Pn-Fo*Ir;jl>0&&jl>Hn&&(Hn=jl)}else{const Cs=ke[uo.fontStack];if(!Cs)continue;Cs[Pi]&&(ri=Cs[Pi]);const To=Ue[uo.fontStack];if(!To)continue;const jl=To.glyphs[Pi];if(!jl)continue;if(Qi=jl.metrics,eo=Pi!==8203?Fo:0,Kt){const hd=To.ascender!==void 0?Math.abs(To.ascender):0,Km=To.descender!==void 0?Math.abs(To.descender):0,Ym=(hd+Km)*Pn;bi<Ym&&(bi=Ym,Oi=(hd-Km)/2*Pn),zo=-hd*Pn}else zo=gI+(Ir-Pn)*Fo}bo?(ve.verticalizable=!0,ti.push({glyph:Pi,imageName:Ps,x:Vt,y:Lt+zo,vertical:bo,scale:Pn,localGlyph:Qi.localGlyph,fontStack:uo.fontStack,sectionIndex:Ji,metrics:Qi,rect:ri}),Vt+=eo*Pn+gt):(ti.push({glyph:Pi,imageName:Ps,x:Vt,y:Lt+zo,vertical:bo,scale:Pn,localGlyph:Qi.localGlyph,fontStack:uo.fontStack,sectionIndex:Ji,metrics:Qi,rect:ri}),Vt+=Qi.advance*Pn+gt)}ti.length!==0&&(vr=Math.max(Vt-gt,vr),Kt?xI(ti,yt,Hn,Oi,je*Ir/2):xI(ti,yt,Hn,0,je/2)),Vt=0;const Yi=je*Ir+Hn;ei.lineOffset=Math.max(Hn,Wn),Lt+=Yi,++xr}var Tn;const wr=Lt,{horizontalAlign:ar,verticalAlign:ai}=Wx(nt);(function(Sr,Ir,Wn,ei,ti,Hn){const bi=(Ir-Wn)*ti,Oi=-Hn*ei;for(const Yi of Sr)for(const Kn of Yi.positionedGlyphs)Kn.x+=bi,Kn.y+=Oi})(ve.positionedLines,yt,ar,ai,vr,wr),ve.top+=-ai*wr,ve.bottom=ve.top+wr,ve.left+=-ar*vr,ve.right=ve.left+vr,ve.hasBaseline=Kt}(xe,o,u,f,re,x,T,P,R,C,F,q),!function(ve){for(const Ue of ve)if(Ue.positionedGlyphs.length!==0)return!1;return!0}(me)&&xe}const Cv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},RN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mI(l,o,u,f,d,_){if(o.imageName){const x=f[o.imageName];return x?x.displaySize[0]*o.scale*Fo/_+d:0}{const x=u[o.fontStack],T=x&&x.glyphs[l];return T?T.metrics.advance*o.scale+d:0}}function yI(l,o,u,f){const d=Math.pow(l-o,2);return f?l<o?d/2:2*d:d+Math.abs(u)*u}function kN(l,o,u){let f=0;return l===10&&(f-=1e4),u&&(f+=150),l!==40&&l!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function _I(l,o,u,f,d,_){let x=null,T=yI(o,u,d,_);for(const P of f){const C=yI(o-P.x,u,d,_)+P.badness;C<=T&&(x=P,T=C)}return{index:l,x:o,priorBreak:x,badness:T}}function vI(l){return l?vI(l.priorBreak).concat(l.index):[]}function Wx(l){let o=.5,u=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function xI(l,o,u,f,d){if(!(o||u||f||d))return;const _=l.length-1,x=l[_],T=(x.x+x.metrics.advance*x.scale)*o;for(let P=0;P<=_;P++)l[P].x-=T,l[P].y+=u+f+d}function FN(l,o,u){const{horizontalAlign:f,verticalAlign:d}=Wx(u),_=o[0]-l.displaySize[0]*f,x=o[1]-l.displaySize[1]*d;return{image:l,top:x,bottom:x+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function wI(l,o,u,f,d,_){const x=l.image;let T;if(x.content){const re=x.content,he=x.pixelRatio||1;T=[re[0]/he,re[1]/he,x.displaySize[0]-re[2]/he,x.displaySize[1]-re[3]/he]}const P=o.left*_,C=o.right*_;let O,R,F,G;u==="width"||u==="both"?(G=d[0]+P-f[3],R=d[0]+C+f[1]):(G=d[0]+(P+C-x.displaySize[0])/2,R=G+x.displaySize[0]);const q=o.top*_,K=o.bottom*_;return u==="height"||u==="both"?(O=d[1]+q-f[0],F=d[1]+K+f[2]):(O=d[1]+(q+K-x.displaySize[1])/2,F=O+x.displaySize[1]),{image:x,top:O,right:R,bottom:F,left:G,collisionPadding:T}}class fc extends W{constructor(o,u,f,d,_){super(o,u),this.angle=d,this.z=f,_!==void 0&&(this.segment=_)}clone(){return new fc(this.x,this.y,this.z,this.angle,this.segment)}}function EI(l,o,u,f,d){if(o.segment===void 0)return!0;let _=o,x=o.segment+1,T=0;for(;T>-u/2;){if(x--,x<0)return!1;T-=l[x].dist(_),_=l[x]}T+=l[x].dist(l[x+1]),x++;const P=[];let C=0;for(;T<u/2;){const O=l[x],R=l[x+1];if(!R)return!1;let F=l[x-1].angleTo(O)-O.angleTo(R);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:T,angleDelta:F}),C+=F;T-P[0].distance>f;)C-=P.shift().angleDelta;if(C>d)return!1;x++,T+=O.dist(R)}return!0}function bI(l){let o=0;for(let u=0;u<l.length-1;u++)o+=l[u].dist(l[u+1]);return o}function TI(l,o,u){return l?.6*o*u:0}function SI(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function zN(l,o,u,f,d,_){const x=TI(u,d,_),T=SI(u,f)*_;let P=0;const C=bI(l)/2;for(let O=0;O<l.length-1;O++){const R=l[O],F=l[O+1],G=R.dist(F);if(P+G>C){const q=(C-P)/G,K=Hr(R.x,F.x,q),re=Hr(R.y,F.y,q),he=new fc(K,re,0,F.angleTo(R),O);return!x||EI(l,he,T,x,o)?he:void 0}P+=G}}function BN(l,o,u,f,d,_,x,T,P){const C=TI(f,_,x),O=SI(f,d),R=O*x,F=l[0].x===0||l[0].x===P||l[0].y===0||l[0].y===P;return o-R<o/4&&(o=R+o/4),II(l,F?o/2*T%o:(O/2+2*_)*x*T%o,o,C,u,R,F,!1,P)}function II(l,o,u,f,d,_,x,T,P){const C=_/2,O=bI(l);let R=0,F=o-u,G=[];for(let q=0;q<l.length-1;q++){const K=l[q],re=l[q+1],he=K.dist(re),_e=re.angleTo(K);for(;F+u<R+he;){F+=u;const fe=(F-R)/he,me=Hr(K.x,re.x,fe),xe=Hr(K.y,re.y,fe);if(me>=0&&me<P&&xe>=0&&xe<P&&F-C>=0&&F+C<=O){const ve=new fc(me,xe,0,_e,q);ve._round(),f&&!EI(l,ve,_,f,d)||G.push(ve)}}R+=he}return T||G.length||x||(G=II(l,R/2,u,f,d,_,x,!0,P)),G}function PI(l,o,u,f,d){const _=[];for(let x=0;x<l.length;x++){const T=l[x];let P;for(let C=0;C<T.length-1;C++){let O=T[C],R=T[C+1];O.x<o&&R.x<o||(O.x<o?O=new W(o,O.y+(o-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x<o&&(R=new W(o,O.y+(o-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y<u&&R.y<u||(O.y<u?O=new W(O.x+(u-O.y)/(R.y-O.y)*(R.x-O.x),u)._round():R.y<u&&(R=new W(O.x+(u-O.y)/(R.y-O.y)*(R.x-O.x),u)._round()),O.x>=f&&R.x>=f||(O.x>=f?O=new W(f,O.y+(f-O.x)/(R.x-O.x)*(R.y-O.y))._round():R.x>=f&&(R=new W(f,O.y+(f-O.x)/(R.x-O.x)*(R.y-O.y))._round()),O.y>=d&&R.y>=d||(O.y>=d?O=new W(O.x+(d-O.y)/(R.y-O.y)*(R.x-O.x),d)._round():R.y>=d&&(R=new W(O.x+(d-O.y)/(R.y-O.y)*(R.x-O.x),d)._round()),P&&O.equals(P[P.length-1])||(P=[O],_.push(P)),P.push(R)))))}}return _}Bt(fc,"Anchor");const Gm=1e20;function CI(l,o,u,f,d,_,x,T,P){for(let C=o;C<o+f;C++)AI(l,u*_+C,_,d,x,T,P);for(let C=u;C<u+d;C++)AI(l,C*_+o,1,f,x,T,P)}function AI(l,o,u,f,d,_,x){_[0]=0,x[0]=-Gm,x[1]=Gm,d[0]=l[o];for(let T=1,P=0,C=0;T<f;T++){d[T]=l[o+T*u];const O=T*T;do{const R=_[P];C=(d[T]-d[R]+O-R*R)/(T-R)/2}while(C<=x[P]&&--P>-1);P++,_[P]=T,x[P]=C,x[P+1]=Gm}for(let T=0,P=0;T<f;T++){for(;x[P+1]<T;)P++;const C=_[P],O=T-C;l[o+T*u]=d[C]+O*O}}const Gl=2,Hx={none:0,ideographs:1,all:2};class od{constructor(o,u,f){this.requestManager=o,this.localGlyphMode=u,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,u){const f=[];for(const d in o)for(const _ of o[d])f.push({stack:d,id:_});bt(f,({stack:d,id:_},x)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=T.glyphs[_];if(P!==void 0)return void x(null,{stack:d,id:_,glyph:P});if(P=this._tinySDF(T,d,_),P)return T.glyphs[_]=P,void x(null,{stack:d,id:_,glyph:P});const C=Math.floor(_/256);if(256*C>65535)return void x(new Error("glyphs > 65535 not supported"));if(T.ranges[C])return void x(null,{stack:d,id:_,glyph:P});let O=T.requests[C];O||(O=T.requests[C]=[],od.loadGlyphRange(d,C,this.url,this.requestManager,(R,F)=>{if(F){T.ascender=F.ascender,T.descender=F.descender;for(const G in F.glyphs)this._doesCharSupportLocalGlyph(+G)||(T.glyphs[+G]=F.glyphs[+G]);T.ranges[C]=!0}for(const G of O)G(R,F);delete T.requests[C]})),O.push((R,F)=>{R?x(R):F&&x(null,{stack:d,id:_,glyph:F.glyphs[_]||null})})},(d,_)=>{if(d)u(d);else if(_){const x={};for(const{stack:T,id:P,glyph:C}of _)x[T]===void 0&&(x[T]={}),x[T].glyphs===void 0&&(x[T].glyphs={}),x[T].glyphs[P]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;u(null,x)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==Hx.none&&(this.localGlyphMode===Hx.all?!!this.localFontFamily:!!this.localFontFamily&&(Ot["CJK Unified Ideographs"](o)||Ot["Hangul Syllables"](o)||Ot.Hiragana(o)||Ot.Katakana(o)||Ot["CJK Symbols and Punctuation"](o)))}_tinySDF(o,u,f){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(f))return;let _=o.tinySDF;if(!_){let K="400";/bold/i.test(u)?K="900":/medium/i.test(u)?K="500":/light/i.test(u)&&(K="200"),_=o.tinySDF=new od.TinySDF({fontFamily:d,fontWeight:K,fontSize:24*Gl,buffer:3*Gl,radius:8*Gl}),_.fontWeight=K}if(this.localGlyphs[_.fontWeight][f])return this.localGlyphs[_.fontWeight][f];const x=String.fromCharCode(f),{data:T,width:P,height:C,glyphWidth:O,glyphHeight:R,glyphLeft:F,glyphTop:G,glyphAdvance:q}=_.draw(x);return this.localGlyphs[_.fontWeight][f]={id:f,bitmap:new cc({width:P,height:C},T),metrics:{width:O/Gl,height:R/Gl,left:F/Gl,top:G/Gl-27,advance:q/Gl,localGlyph:!0}}}}od.loadGlyphRange=function(l,o,u,f,d){const _=256*o,x=_+255,T=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",l).replace("{range}",`${_}-${x}`),zs.Glyphs);bl(T,(P,C)=>{if(P)d(P);else if(C){const O={},R=function(F){return new Pv(F).readFields(ON,{})}(C);for(const F of R.glyphs)O[F.id]=F;d(null,{glyphs:O,ascender:R.ascender,descender:R.descender})}})},od.TinySDF=class{constructor({fontSize:l=24,buffer:o=3,radius:u=8,cutoff:f=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=u;const T=this.size=l+4*o,P=this._createCanvas(T),C=this.ctx=P.getContext("2d",{willReadFrequently:!0});C.font=`${x} ${_} ${l}px ${d}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(l){const o=document.createElement("canvas");return o.width=o.height=l,o}draw(l){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(l),x=Math.ceil(u),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),P=Math.min(this.size-this.buffer,x+Math.ceil(f)),C=T+2*this.buffer,O=P+2*this.buffer,R=Math.max(C*O,0),F=new Uint8ClampedArray(R),G={data:F,width:C,height:O,glyphWidth:T,glyphHeight:P,glyphTop:x,glyphLeft:0,glyphAdvance:o};if(T===0||P===0)return G;const{ctx:q,buffer:K,gridInner:re,gridOuter:he}=this;q.clearRect(K,K,T,P),q.fillText(l,K,K+x);const _e=q.getImageData(K,K,T,P);he.fill(Gm,0,R),re.fill(0,0,R);for(let fe=0;fe<P;fe++)for(let me=0;me<T;me++){const xe=_e.data[4*(fe*T+me)+3]/255;if(xe===0)continue;const ve=(fe+K)*C+me+K;if(xe===1)he[ve]=0,re[ve]=Gm;else{const Ue=.5-xe;he[ve]=Ue>0?Ue*Ue:0,re[ve]=Ue<0?Ue*Ue:0}}CI(he,0,0,C,O,C,this.f,this.v,this.z),CI(re,K,K,T,P,C,this.f,this.v,this.z);for(let fe=0;fe<R;fe++){const me=Math.sqrt(he[fe])-Math.sqrt(re[fe]);F[fe]=Math.round(255-255*(me/this.radius+this.cutoff))}return G}};const sd=Gs;function MI(l,o,u,f){const d=[],_=l.image,x=_.pixelRatio,T=_.paddedRect.w-2*sd,P=_.paddedRect.h-2*sd,C=l.right-l.left,O=l.bottom-l.top,R=_.stretchX||[[0,T]],F=_.stretchY||[[0,P]],G=(je,nt)=>je+nt[1]-nt[0],q=R.reduce(G,0),K=F.reduce(G,0),re=T-q,he=P-K;let _e=0,fe=q,me=0,xe=K,ve=0,Ue=re,ke=0,Je=he;if(_.content&&f){const je=_.content;_e=Av(R,0,je[0]),me=Av(F,0,je[1]),fe=Av(R,je[0],je[2]),xe=Av(F,je[1],je[3]),ve=je[0]-_e,ke=je[1]-me,Ue=je[2]-je[0]-fe,Je=je[3]-je[1]-xe}const ht=(je,nt,it,lt)=>{const gt=Mv(je.stretch-_e,fe,C,l.left),He=Lv(je.fixed-ve,Ue,je.stretch,q),Ct=Mv(nt.stretch-me,xe,O,l.top),Vt=Lv(nt.fixed-ke,Je,nt.stretch,K),Lt=Mv(it.stretch-_e,fe,C,l.left),vr=Lv(it.fixed-ve,Ue,it.stretch,q),yt=Mv(lt.stretch-me,xe,O,l.top),Kt=Lv(lt.fixed-ke,Je,lt.stretch,K),xr=new W(gt,Ct),Tn=new W(Lt,Ct),wr=new W(Lt,yt),ar=new W(gt,yt),ai=new W(He/x,Vt/x),Sr=new W(vr/x,Kt/x),Ir=o*Math.PI/180;if(Ir){const ti=Math.sin(Ir),Hn=Math.cos(Ir),bi=[Hn,-ti,ti,Hn];xr._matMult(bi),Tn._matMult(bi),ar._matMult(bi),wr._matMult(bi)}const Wn=je.stretch+je.fixed,ei=nt.stretch+nt.fixed;return{tl:xr,tr:Tn,bl:ar,br:wr,tex:{x:_.paddedRect.x+sd+Wn,y:_.paddedRect.y+sd+ei,w:it.stretch+it.fixed-Wn,h:lt.stretch+lt.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ai,pixelOffsetBR:Sr,minFontScaleX:Ue/x/C,minFontScaleY:Je/x/O,isSDF:u}};if(f&&(_.stretchX||_.stretchY)){const je=LI(R,re,q),nt=LI(F,he,K);for(let it=0;it<je.length-1;it++){const lt=je[it],gt=je[it+1];for(let He=0;He<nt.length-1;He++)d.push(ht(lt,nt[He],gt,nt[He+1]))}}else d.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return d}function Av(l,o,u){let f=0;for(const d of l)f+=Math.max(o,Math.min(u,d[1]))-Math.max(o,Math.min(u,d[0]));return f}function LI(l,o,u){const f=[{fixed:-sd,stretch:0}];for(const[d,_]of l){const x=f[f.length-1];f.push({fixed:d-x.stretch,stretch:x.stretch}),f.push({fixed:d-x.stretch,stretch:x.stretch+(_-d)})}return f.push({fixed:o+sd,stretch:u}),f}function Mv(l,o,u,f){return l/o*u+f}function Lv(l,o,u,f){return l-o*u/f}function UN(l,o,u,f){const d=o+l.positionedLines[f].lineOffset;return f===0?u+d/2:u+(d+(o+l.positionedLines[f-1].lineOffset))/2}class GN{constructor(o=[],u=VN){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:f}=this,d=u[o];for(;o>0;){const _=o-1>>1,x=u[_];if(f(d,x)>=0)break;u[o]=x,o=_}u[o]=d}_down(o){const{data:u,compare:f}=this,d=this.length>>1,_=u[o];for(;o<d;){let x=1+(o<<1),T=u[x];const P=x+1;if(P<this.length&&f(u[P],T)<0&&(x=P,T=u[P]),f(T,_)>=0)break;u[o]=T,o=x}u[o]=_}}function VN(l,o){return l<o?-1:l>o?1:0}function jN(l,o=1,u=!1){let f=1/0,d=1/0,_=-1/0,x=-1/0;const T=l[0];for(let G=0;G<T.length;G++){const q=T[G];(!G||q.x<f)&&(f=q.x),(!G||q.y<d)&&(d=q.y),(!G||q.x>_)&&(_=q.x),(!G||q.y>x)&&(x=q.y)}const P=Math.min(_-f,x-d);let C=P/2;const O=new GN([],qN);if(P===0)return new W(f,d);for(let G=f;G<_;G+=P)for(let q=d;q<x;q+=P)O.push(new ad(G+C,q+C,C,l));let R=function(G){let q=0,K=0,re=0;const he=G[0];for(let _e=0,fe=he.length,me=fe-1;_e<fe;me=_e++){const xe=he[_e],ve=he[me],Ue=xe.x*ve.y-ve.x*xe.y;K+=(xe.x+ve.x)*Ue,re+=(xe.y+ve.y)*Ue,q+=3*Ue}return new ad(K/q,re/q,0,G)}(l),F=O.length;for(;O.length;){const G=O.pop();(G.d>R.d||!R.d)&&(R=G,u&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,F)),G.max-R.d<=o||(C=G.h/2,O.push(new ad(G.p.x-C,G.p.y-C,C,l)),O.push(new ad(G.p.x+C,G.p.y-C,C,l)),O.push(new ad(G.p.x-C,G.p.y+C,C,l)),O.push(new ad(G.p.x+C,G.p.y+C,C,l)),F+=4)}return u&&(console.log(`num probes: ${F}`),console.log(`best distance: ${R.d}`)),R.p}function qN(l,o){return o.max-l.max}class ad{constructor(o,u,f,d){this.p=new W(o,u),this.h=f,this.d=function(_,x){let T=!1,P=1/0;for(let C=0;C<x.length;C++){const O=x[C];for(let R=0,F=O.length,G=F-1;R<F;G=R++){const q=O[R],K=O[G];q.y>_.y!=K.y>_.y&&_.x<(K.x-q.x)*(_.y-q.y)/(K.y-q.y)+q.x&&(T=!T),P=Math.min(P,IS(_,q,K))}}return(T?1:-1)*Math.sqrt(P)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const ld=7,Kx=Number.POSITIVE_INFINITY,$N=Math.sqrt(2);function OI(l,[o,u]){let f=0,d=0;if(u===Kx){o<0&&(o=0);const _=o/$N;switch(l){case"top-right":case"top-left":d=_-ld;break;case"bottom-right":case"bottom-left":d=-_+ld;break;case"bottom":d=-o+ld;break;case"top":d=o-ld}switch(l){case"top-right":case"bottom-right":f=-_;break;case"top-left":case"bottom-left":f=_;break;case"left":f=o;break;case"right":f=-o}}else{switch(o=Math.abs(o),u=Math.abs(u),l){case"top-right":case"top-left":case"top":d=u-ld;break;case"bottom-right":case"bottom-left":case"bottom":d=-u+ld}switch(l){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}}return[f,d]}function ZN(l,o,u,f,d,_,x,T,P,C){l.createArrays(),l.tilePixelRatio=er/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const O=l.layers[0].layout,R=l.layers[0]._unevaluatedLayout._values,F={};if(l.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:re}=l.textSizeData;F.compositeTextSizes=[R["text-size"].possiblyEvaluate(new N(K),T),R["text-size"].possiblyEvaluate(new N(re),T)]}if(l.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:re}=l.iconSizeData;F.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new N(K),T),R["icon-size"].possiblyEvaluate(new N(re),T)]}F.layoutTextSize=R["text-size"].possiblyEvaluate(new N(P+1),T),F.layoutIconSize=R["icon-size"].possiblyEvaluate(new N(P+1),T),F.textMaxSize=R["text-size"].possiblyEvaluate(new N(18),T);const G=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",q=O.get("text-size");for(const K of l.features){const re=O.get("text-font").evaluate(K,{},T).join(","),he=q.evaluate(K,{},T),_e=F.layoutTextSize.evaluate(K,{},T),fe=(F.layoutIconSize.evaluate(K,{},T),{horizontal:{},vertical:void 0}),me=K.text;let xe,ve=[0,0];if(me){const Je=me.toString(),ht=O.get("text-letter-spacing").evaluate(K,{},T)*Fo,je=O.get("text-line-height").evaluate(K,{},T)*Fo,nt=ox(Je)?ht:0,it=O.get("text-anchor").evaluate(K,{},T),lt=O.get("text-variable-anchor");if(!lt){const Lt=O.get("text-radial-offset").evaluate(K,{},T);ve=Lt?OI(it,[Lt*Fo,Kx]):O.get("text-offset").evaluate(K,{},T).map(vr=>vr*Fo)}let gt=G?"center":O.get("text-justify").evaluate(K,{},T);const He=O.get("symbol-placement")==="point",Ct=He?O.get("text-max-width").evaluate(K,{},T)*Fo:1/0,Vt=Lt=>{l.allowVerticalPlacement&&fm(Je)&&(fe.vertical=Xx(me,o,u,d,re,Ct,je,it,Lt,nt,ve,Ma.vertical,!0,_e,he))};if(!G&&lt){const Lt=gt==="auto"?lt.map(yt=>Yx(yt)):[gt];let vr=!1;for(let yt=0;yt<Lt.length;yt++){const Kt=Lt[yt];if(!fe.horizontal[Kt])if(vr)fe.horizontal[Kt]=fe.horizontal[0];else{const xr=Xx(me,o,u,d,re,Ct,je,"center",Kt,nt,ve,Ma.horizontal,!1,_e,he);xr&&(fe.horizontal[Kt]=xr,vr=xr.positionedLines.length===1)}}Vt("left")}else{if(gt==="auto"&&(gt=Yx(it)),He||O.get("text-writing-mode").indexOf("horizontal")>=0||!fm(Je)){const Lt=Xx(me,o,u,d,re,Ct,je,it,gt,nt,ve,Ma.horizontal,!1,_e,he);Lt&&(fe.horizontal[gt]=Lt)}Vt(He?"left":gt)}}let Ue=!1;if(K.icon&&K.icon.name){const Je=f[K.icon.name];Je&&(xe=FN(d[K.icon.name],O.get("icon-offset").evaluate(K,{},T),O.get("icon-anchor").evaluate(K,{},T)),Ue=Je.sdf,l.sdfIcons===void 0?l.sdfIcons=Je.sdf:l.sdfIcons!==Je.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==l.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const ke=NI(fe.horizontal)||fe.vertical;l.iconsInText||(l.iconsInText=!!ke&&ke.iconsInText),(ke||xe)&&XN(l,K,fe,xe,f,F,_e,0,ve,Ue,x,T,C)}_&&l.generateCollisionDebugBuffers(P,l.collisionBoxArray)}function Yx(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function XN(l,o,u,f,d,_,x,T,P,C,O,R,F){let G=_.textMaxSize.evaluate(o,{},R);G===void 0&&(G=x);const q=l.layers[0].layout,K=q.get("icon-offset").evaluate(o,{},R),re=NI(u.horizontal)||u.vertical,he=F.name==="globe",_e=Fo,fe=x/_e,me=l.tilePixelRatio*G/_e,xe=(it=l.overscaling,l.zoom>18&&it>2&&(it>>=1),Math.max(er/(512*it),1)*q.get("symbol-spacing")),ve=q.get("text-padding")*l.tilePixelRatio,Ue=q.get("icon-padding")*l.tilePixelRatio,ke=ze(q.get("text-max-angle")),Je=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",ht=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",je=q.get("symbol-placement"),nt=xe/2;var it;const lt=q.get("icon-text-fit");let gt;f&&lt!=="none"&&(l.allowVerticalPlacement&&u.vertical&&(gt=wI(f,u.vertical,lt,q.get("icon-text-fit-padding"),K,fe)),re&&(f=wI(f,re,lt,q.get("icon-text-fit-padding"),K,fe)));const He=(Ct,Vt,Lt)=>{if(Vt.x<0||Vt.x>=er||Vt.y<0||Vt.y>=er)return;let vr=null;if(he){const{x:yt,y:Kt,z:xr}=F.projectTilePoint(Vt.x,Vt.y,Lt);vr={anchor:new fc(yt,Kt,xr,0,void 0),up:F.upVector(Lt,Vt.x,Vt.y)}}(function(yt,Kt,xr,Tn,wr,ar,ai,Sr,Ir,Wn,ei,ti,Hn,bi,Oi,Yi,Kn,uo,Ji,Pi,Pn,Qi,ri,Ps,eo){const zo=yt.addToLineVertexArray(Kt,Tn);let bo,Cs,To,jl,hd,Km,Ym,p2=0,d2=0,g2=0,m2=0,fw=-1,pw=-1;const Tu={};let y2=lx("");const If=xr?xr.anchor:Kt;let dw=0,gw=0;if(Ir._unevaluatedLayout.getValue("text-radial-offset")===void 0?[dw,gw]=Ir.layout.get("text-offset").evaluate(Pn,{},eo).map(sa=>sa*Fo):(dw=Ir.layout.get("text-radial-offset").evaluate(Pn,{},eo)*Fo,gw=Kx),yt.allowVerticalPlacement&&wr.vertical){const sa=wr.vertical;if(Oi)Km=Jx(sa),Sr&&(Ym=Jx(Sr));else{const aa=Ir.layout.get("text-rotate").evaluate(Pn,{},eo)+90;To=Ov(Wn,If,Kt,ei,ti,Hn,sa,bi,aa,Yi),Sr&&(jl=Ov(Wn,If,Kt,ei,ti,Hn,Sr,uo,aa))}}if(ar){const sa=Ir.layout.get("icon-rotate").evaluate(Pn,{},eo),aa=Ir.layout.get("icon-text-fit")!=="none",Jm=MI(ar,sa,ri,aa),yw=Sr?MI(Sr,sa,ri,aa):void 0;Cs=Ov(Wn,If,Kt,ei,ti,Hn,ar,uo,sa),p2=4*Jm.length;const _2=yt.iconSizeData;let Pf=null;_2.kind==="source"?(Pf=[Ul*Ir.layout.get("icon-size").evaluate(Pn,{},eo)],Pf[0]>sh&&Qe(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Vm}. Reduce your "icon-size".`)):_2.kind==="composite"&&(Pf=[Ul*Qi.compositeIconSizes[0].evaluate(Pn,{},eo),Ul*Qi.compositeIconSizes[1].evaluate(Pn,{},eo)],(Pf[0]>sh||Pf[1]>sh)&&Qe(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Vm}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,Jm,Pf,Pi,Ji,Pn,!1,xr,Kt,zo.lineStartIndex,zo.lineLength,-1,Ps,eo),fw=yt.icon.placedSymbolArray.length-1,yw&&(d2=4*yw.length,yt.addSymbols(yt.icon,yw,Pf,Pi,Ji,Pn,Ma.vertical,xr,Kt,zo.lineStartIndex,zo.lineLength,-1,Ps,eo),pw=yt.icon.placedSymbolArray.length-1)}for(const sa in wr.horizontal){const aa=wr.horizontal[sa];bo||(y2=lx(aa.text),Oi?hd=Jx(aa):bo=Ov(Wn,If,Kt,ei,ti,Hn,aa,bi,Ir.layout.get("text-rotate").evaluate(Pn,{},eo),Yi));const Jm=aa.positionedLines.length===1;if(g2+=DI(yt,xr,Kt,aa,ai,Ir,Oi,Pn,Yi,zo,wr.vertical?Ma.horizontal:Ma.horizontalOnly,Jm?Object.keys(wr.horizontal):[sa],Tu,fw,Qi,Ps,eo),Jm)break}wr.vertical&&(m2+=DI(yt,xr,Kt,wr.vertical,ai,Ir,Oi,Pn,Yi,zo,Ma.vertical,["vertical"],Tu,pw,Qi,Ps,eo));let fh=-1;const mw=(sa,aa)=>sa?Math.max(sa,aa):aa;fh=mw(hd,fh),fh=mw(Km,fh),fh=mw(Ym,fh);const wR=fh>-1?1:0;yt.glyphOffsetArray.length>=lh.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pn.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,Pn.sortKey),yt.symbolInstances.emplaceBack(If.x,If.y,If.z,Kt.x,Kt.y,Tu.right>=0?Tu.right:-1,Tu.center>=0?Tu.center:-1,Tu.left>=0?Tu.left:-1,Tu.vertical>=0?Tu.vertical:-1,fw,pw,y2,bo!==void 0?bo:yt.collisionBoxArray.length,bo!==void 0?bo+1:yt.collisionBoxArray.length,To!==void 0?To:yt.collisionBoxArray.length,To!==void 0?To+1:yt.collisionBoxArray.length,Cs!==void 0?Cs:yt.collisionBoxArray.length,Cs!==void 0?Cs+1:yt.collisionBoxArray.length,jl||yt.collisionBoxArray.length,jl?jl+1:yt.collisionBoxArray.length,ei,g2,m2,p2,d2,wR,0,dw,gw,fh)})(l,Vt,vr,Ct,u,f,d,gt,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,ve,Je,P,0,Ue,ht,K,o,_,C,O,R)};if(je==="line")for(const Ct of PI(o.geometry,0,0,er,er)){const Vt=BN(Ct,xe,ke,u.vertical||re,f,_e,me,l.overscaling,er);for(const Lt of Vt)re&&WN(l,re.text,nt,Lt)||He(Ct,Lt,R)}else if(je==="line-center"){for(const Ct of o.geometry)if(Ct.length>1){const Vt=zN(Ct,ke,u.vertical||re,f,_e,me);Vt&&He(Ct,Vt,R)}}else if(o.type==="Polygon")for(const Ct of zx(o.geometry,0)){const Vt=jN(Ct,16);He(Ct[0],new fc(Vt.x,Vt.y,0,0,void 0),R)}else if(o.type==="LineString")for(const Ct of o.geometry)He(Ct,new fc(Ct[0].x,Ct[0].y,0,0,void 0),R);else if(o.type==="Point")for(const Ct of o.geometry)for(const Vt of Ct)He([Vt],new fc(Vt.x,Vt.y,0,0,void 0),R)}const Vm=255,sh=Vm*Ul;function DI(l,o,u,f,d,_,x,T,P,C,O,R,F,G,q,K,re){const he=function(me,xe,ve,Ue,ke,Je,ht,je){const nt=[];if(xe.positionedLines.length===0)return nt;const it=Ue.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,lt=function(Lt){const vr=Lt[0],yt=Lt[1],Kt=vr*yt;return Kt>0?[vr,-yt]:Kt<0?[-vr,yt]:vr===0?[yt,vr]:[yt,-vr]}(ve);let gt=Math.abs(xe.top-xe.bottom);for(const Lt of xe.positionedLines)gt-=Lt.lineOffset;const He=xe.positionedLines.length,Ct=gt/He;let Vt=xe.top-ve[1];for(let Lt=0;Lt<He;++Lt){const vr=xe.positionedLines[Lt];Vt=UN(xe,Ct,Vt,Lt);for(const yt of vr.positionedGlyphs){if(!yt.rect)continue;const Kt=yt.rect||{};let xr=pI+1,Tn=!0,wr=1,ar=0;if(yt.imageName){const ri=ht[yt.imageName];if(!ri)continue;if(ri.sdf){Qe("SDF images are not supported in formatted text and will be ignored.");continue}Tn=!1,wr=ri.pixelRatio,xr=Gs/wr}const ai=(ke||je)&&yt.vertical,Sr=yt.metrics.advance*yt.scale/2,Ir=yt.metrics,Wn=yt.rect;if(Wn===null)continue;je&&xe.verticalizable&&(ar=yt.imageName?Sr-yt.metrics.width*yt.scale/2:0);const ei=ke?[yt.x+Sr,yt.y]:[0,0];let ti=[0,0],Hn=[0,0],bi=!1;ke||(ai?(Hn=[yt.x+Sr+lt[0],yt.y+lt[1]-ar],bi=!0):ti=[yt.x+Sr+ve[0],yt.y+ve[1]-ar]);const Oi=Wn.w*yt.scale/(wr*(yt.localGlyph?Gl:1)),Yi=Wn.h*yt.scale/(wr*(yt.localGlyph?Gl:1));let Kn,uo,Ji,Pi;if(ai){const ri=yt.y-Vt,Ps=new W(-Sr,Sr-ri),eo=-Math.PI/2,zo=new W(...Hn);Kn=new W(-Sr+ti[0],ti[1]),Kn._rotateAround(eo,Ps)._add(zo),Kn.x+=-ri+Sr,Kn.y-=(Ir.left-xr)*yt.scale;const bo=yt.imageName?Ir.advance*yt.scale:Fo*yt.scale,Cs=String.fromCharCode(yt.glyph);wN(Cs)?Kn.x+=(1-xr)*yt.scale:EN(Cs)?Kn.x+=bo-Ir.height*yt.scale+(-xr-1)*yt.scale:Kn.x+=yt.imageName||Ir.width+2*xr===Wn.w&&Ir.height+2*xr===Wn.h?(bo-Yi)/2:(bo-(Ir.height+2*xr)*yt.scale)/2,uo=new W(Kn.x,Kn.y-Oi),Ji=new W(Kn.x+Yi,Kn.y),Pi=new W(Kn.x+Yi,Kn.y-Oi)}else{const ri=(Ir.left-xr)*yt.scale-Sr+ti[0],Ps=(-Ir.top-xr)*yt.scale+ti[1],eo=ri+Oi,zo=Ps+Yi;Kn=new W(ri,Ps),uo=new W(eo,Ps),Ji=new W(ri,zo),Pi=new W(eo,zo)}if(it){let ri;ri=ke?new W(0,0):bi?new W(lt[0],lt[1]):new W(ve[0],ve[1]),Kn._rotateAround(it,ri),uo._rotateAround(it,ri),Ji._rotateAround(it,ri),Pi._rotateAround(it,ri)}const Pn=new W(0,0),Qi=new W(0,0);nt.push({tl:Kn,tr:uo,bl:Ji,br:Pi,tex:Kt,writingMode:xe.writingMode,glyphOffset:ei,sectionIndex:yt.sectionIndex,isSDF:Tn,pixelOffsetTL:Pn,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return nt}(0,f,P,_,x,T,d,l.allowVerticalPlacement),_e=l.textSizeData;let fe=null;_e.kind==="source"?(fe=[Ul*_.layout.get("text-size").evaluate(T,{},re)],fe[0]>sh&&Qe(`${l.layerIds[0]}: Value for "text-size" is >= ${Vm}. Reduce your "text-size".`)):_e.kind==="composite"&&(fe=[Ul*q.compositeTextSizes[0].evaluate(T,{},re),Ul*q.compositeTextSizes[1].evaluate(T,{},re)],(fe[0]>sh||fe[1]>sh)&&Qe(`${l.layerIds[0]}: Value for "text-size" is >= ${Vm}. Reduce your "text-size".`)),l.addSymbols(l.text,he,fe,P,x,T,O,o,u,C.lineStartIndex,C.lineLength,G,K,re);for(const me of R)F[me]=l.text.placedSymbolArray.length-1;return 4*he.length}function NI(l){for(const o in l)return l[o];return null}function Ov(l,o,u,f,d,_,x,T,P,C){let O=x.top,R=x.bottom,F=x.left,G=x.right;const q=x.collisionPadding;if(q&&(F-=q[0],O-=q[1],G+=q[2],R+=q[3]),P){const K=new W(F,O),re=new W(G,O),he=new W(F,R),_e=new W(G,R),fe=ze(P);let me=new W(0,0);C&&(me=new W(C[0],C[1])),K._rotateAround(fe,me),re._rotateAround(fe,me),he._rotateAround(fe,me),_e._rotateAround(fe,me),F=Math.min(K.x,re.x,he.x,_e.x),G=Math.max(K.x,re.x,he.x,_e.x),O=Math.min(K.y,re.y,he.y,_e.y),R=Math.max(K.y,re.y,he.y,_e.y)}return l.emplaceBack(o.x,o.y,o.z,u.x,u.y,F,O,G,R,T,f,d,_),l.length-1}function Jx(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const o=l.bottom-l.top;return o>0?Math.max(10,o):null}function WN(l,o,u,f){const d=l.compareText;if(o in d){const _=d[o];for(let x=_.length-1;x>=0;x--)if(f.dist(_[x])<u)return!0}else d[o]=[];return d[o].push(f),!1}function RI(l,o){const u=l.fovAboveCenter,f=l.elevation?l.elevation.getMinElevationBelowMSL()*o:0,d=(l._camera.position[2]*l.worldSize-f)/Math.cos(l._pitch),_=Math.sin(u)*d/Math.sin(Math.max(Math.PI/2-l._pitch-u,.01)),x=Math.sin(l._pitch)*_+d;return Math.min(1.01*x,d*(1/l._horizonShift))}function Tf(l,o){if(!o.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:o};const u=Math.pow(2,-l.z),f=l.x*u,d=(l.x+1)*u,_=l.y*u,x=(l.y+1)*u,T=Aa(f),P=Aa(d),C=Ko(_),O=Ko(x),R=o.project(T,C),F=o.project(P,C),G=o.project(P,O),q=o.project(T,O);let K=Math.min(R.x,F.x,G.x,q.x),re=Math.min(R.y,F.y,G.y,q.y),he=Math.max(R.x,F.x,G.x,q.x),_e=Math.max(R.y,F.y,G.y,q.y);const fe=u/16;function me(ve,Ue,ke,Je,ht,je){const nt=(ke+ht)/2,it=(Je+je)/2,lt=o.project(Aa(nt),Ko(it)),gt=Math.max(0,K-lt.x,re-lt.y,lt.x-he,lt.y-_e);K=Math.min(K,lt.x),he=Math.max(he,lt.x),re=Math.min(re,lt.y),_e=Math.max(_e,lt.y),gt>fe&&(me(ve,lt,ke,Je,nt,it),me(lt,Ue,nt,it,ht,je))}me(R,F,f,_,d,_),me(F,G,d,_,d,x),me(G,q,d,x,f,x),me(q,R,f,x,f,_),K-=fe,re-=fe,he+=fe,_e+=fe;const xe=1/Math.max(he-K,_e-re);return{scale:xe,x:K*xe,y:re*xe,x2:he*xe,y2:_e*xe,projection:o}}const HN=Fl(new Float32Array(16));class ah{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,u){return{x:0,y:0,z:0}}unproject(o,u){return new Xn(0,0)}projectTilePoint(o,u,f){return{x:o,y:u,z:0}}locationPoint(o,u,f=!0){return o._coordinatePoint(o.locationCoordinate(u),f)}pixelsPerMeter(o,u){return Bl(1,o)*u}pixelSpaceConversion(o,u,f){return 1}farthestPixelDistance(o){return RI(o,o.pixelsPerMeter)}pointCoordinate(o,u,f,d){const _=o.horizonLineFromTop(!1),x=new W(u,Math.max(_,f));return o.rayIntersectionCoordinate(o.pointRayIntersection(x,d))}pointCoordinate3D(o,u,f){const d=new W(u,f);if(o.elevation)return o.elevation.pointCoordinate(d);{const _=this.pointCoordinate(o,d.x,d.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(o,u){if(o.elevation)return!this.pointCoordinate3D(o,u.x,u.y);const f=o.horizonLineFromTop();return u.y<f}createInversionMatrix(o,u){return HN}createTileMatrix(o,u,f){let d,_,x;const T=f.canonical,P=Fl(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=Tf(T,this);d=1,_=C.x+f.wrap*C.scale,x=C.y,yf(P,P,[d/C.scale,d/C.scale,o.pixelsPerMeter/u])}else d=u/o.zoomScale(T.z),_=(T.x+Math.pow(2,T.z)*f.wrap)*d,x=T.y*d;return vm(P,P,[_,x,0]),yf(P,P,[d/er,d/er,1]),P}upVector(o,u,f){return[0,0,1]}upVectorScale(o,u,f){return{metersToTile:1}}}class KN extends ah{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[u,f]=this.parallels=o.parallels||[29.5,45.5],d=Math.sin(ze(u));this.n=(d+Math.sin(ze(f)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(o,u){const{n:f,c:d,r0:_}=this,x=ze(o-this.center[0]),T=ze(u),P=Math.sqrt(d-2*f*Math.sin(T))/f;return{x:P*Math.sin(x*f),y:P*Math.cos(x*f)-_,z:0}}unproject(o,u){const{n:f,c:d,r0:_}=this,x=_+u;let T=Math.atan2(o,Math.abs(x))*Math.sign(x);x*f<0&&(T-=Math.PI*Math.sign(o)*Math.sign(x));const P=ze(this.center[0])*f;T=mt(T,-Math.PI-P,Math.PI-P);const C=et(We(T/f)+this.center[0],-180,180),O=Math.asin(et((d-(o*o+x*x)*f*f)/(2*f),-1,1)),R=et(We(O),-Yo,Yo);return new Xn(C,R)}}const jm=1.340264,qm=-.081106,$m=893e-6,Zm=.003796,Dv=Math.sqrt(3)/2;class YN extends ah{project(o,u){u=u/180*Math.PI,o=o/180*Math.PI;const f=Math.asin(Dv*Math.sin(u)),d=f*f,_=d*d*d;return{x:.5*(o*Math.cos(f)/(Dv*(jm+3*qm*d+_*(7*$m+9*Zm*d)))/Math.PI+.5),y:1-.5*(f*(jm+qm*d+_*($m+Zm*d))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,d=f*f,_=d*d*d;for(let O,R,F,G=0;G<12&&(R=f*(jm+qm*d+_*($m+Zm*d))-u,F=jm+3*qm*d+_*(7*$m+9*Zm*d),O=R/F,f=et(f-O,-Math.PI/3,Math.PI/3),d=f*f,_=d*d*d,!(Math.abs(O)<1e-12));++G);const x=Dv*o*(jm+3*qm*d+_*(7*$m+9*Zm*d))/Math.cos(f),T=Math.asin(Math.sin(f)/Dv),P=et(180*x/Math.PI,-180,180),C=et(180*T/Math.PI,-Yo,Yo);return new Xn(P,C)}}class JN extends ah{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){return{x:.5+o/360,y:.5-u/360,z:0}}unproject(o,u){const f=360*(o-.5),d=et(360*(.5-u),-Yo,Yo);return new Xn(f,d)}}const ud=Math.PI/2;function Nv(l){return Math.tan((ud+l)/2)}class QN extends ah{constructor(o){super(o),this.center=o.center||[0,30];const[u,f]=this.parallels=o.parallels||[30,30];let d=ze(u),_=ze(f);this.southernCenter=d+_<0,this.southernCenter&&(d=-d,_=-_);const x=Math.cos(d),T=Nv(d);this.n=d===_?Math.sin(d):Math.log(x/Math.cos(_))/Math.log(Nv(_)/T),this.f=x*Math.pow(Nv(d),this.n)/this.n}project(o,u){u=ze(u),this.southernCenter&&(u=-u),o=ze(o-this.center[0]);const f=1e-6,{n:d,f:_}=this;_>0?u<-ud+f&&(u=-ud+f):u>ud-f&&(u=ud-f);const x=_/Math.pow(Nv(u),d);let T=x*Math.sin(d*o),P=_-x*Math.cos(d*o);return T=.5*(T/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:T,y:this.southernCenter?P:1-P,z:0}}unproject(o,u){o=(2*o-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:f,f:d}=this,_=d-u,x=Math.sign(_),T=Math.sign(f)*Math.sqrt(o*o+_*_);let P=Math.atan2(o,Math.abs(_))*x;_*f<0&&(P-=Math.PI*Math.sign(o)*x);const C=et(We(P/f)+this.center[0],-180,180),O=et(We(2*Math.atan(Math.pow(d/T,1/f))-ud),-Yo,Yo);return new Xn(C,this.southernCenter?-O:O)}}class kI extends ah{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,u){return{x:vu(o),y:xu(u),z:0}}unproject(o,u){const f=Aa(o),d=Ko(u);return new Xn(f,d)}}const FI=ze(Yo);class eR extends ah{project(o,u){const f=(u=ze(u))*u,d=f*f;return{x:.5*((o=ze(o))*(.8707-.131979*f+d*(d*(.003971*f-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+f*(.015085+d*(.028874*f-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,d=25,_=0,x=f*f;do{x=f*f;const C=x*x;_=(f*(1.007226+x*(.015085+C*(.028874*x-.044475-.005916*C)))-u)/(1.007226+x*(.045255+C*(.259866*x-.311325-.005916*11*C))),f=et(f-_,-FI,FI)}while(Math.abs(_)>1e-6&&--d>0);x=f*f;const T=et(We(o/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),P=We(f);return new Xn(T,P)}}const zI=ze(Yo);class tR extends ah{project(o,u){u=ze(u),o=ze(o);const f=Math.cos(u),d=2/Math.PI,_=Math.acos(f*Math.cos(o/2)),x=Math.sin(_)/_,T=.5*(o*d+2*f*Math.sin(o/2)/x)||0,P=.5*(u+Math.sin(u)/x)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(o,u){let f=o=(2*o-.5)*Math.PI,d=u=(2*(1-u)-1)*Math.PI,_=25;const x=1e-6;let T=0,P=0;do{const C=Math.cos(d),O=Math.sin(d),R=2*O*C,F=O*O,G=C*C,q=Math.cos(f/2),K=Math.sin(f/2),re=2*q*K,he=K*K,_e=1-G*q*q,fe=_e?1/_e:0,me=_e?Math.acos(C*q)*Math.sqrt(1/_e):0,xe=.5*(2*me*C*K+2*f/Math.PI)-o,ve=.5*(me*O+d)-u,Ue=.5*fe*(G*he+me*C*q*F)+1/Math.PI,ke=fe*(re*R/4-me*O*K),Je=.125*fe*(R*K-me*O*G*re),ht=.5*fe*(F*q+me*he*C)+.5,je=ke*Je-ht*Ue;T=(ve*ke-xe*ht)/je,P=(xe*Je-ve*Ue)/je,f=et(f-T,-Math.PI,Math.PI),d=et(d-P,-zI,zI)}while((Math.abs(T)>x||Math.abs(P)>x)&&--_>0);return new Xn(We(f),We(d))}}class BI extends ah{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){const{scale:f,cosPhi:d}=this;return{x:ze(o)*d*f+.5,y:-Math.sin(ze(u))/d*f+.5,z:0}}unproject(o,u){const{scale:f,cosPhi:d}=this,_=-(u-.5)/f,x=et(We((o-.5)/f)/d,-180,180),T=Math.asin(et(_*d,-1,1)),P=et(We(T),-Yo,Yo);return new Xn(x,P)}}class rR extends kI{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,u,f){const d=Pm(o,u,f);return Ui(d,d,Cm(_u(f))),{x:d[0],y:d[1],z:d[2]}}locationPoint(o,u){const f=Wp(u.lat,u.lng),d=Ts([],f),_=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(u),o._centerAltitude):o._centerAltitude;bm(f,f,d,Bl(1,0)*er*_);const x=Fl(new Float64Array(16));return mf(x,o.pixelMatrix,o.globeMatrix),Ui(f,f,x),new W(f[0],f[1])}pixelsPerMeter(o,u){return Bl(1,0)*u}pixelSpaceConversion(o,u,f){const d=Bl(1,o)*u,_=Hr(Bl(1,45)*u,d,f);return this.pixelsPerMeter(o,u)/_}createTileMatrix(o,u,f){const d=Ex(_u(f.canonical));return mf(new Float64Array(16),o.globeMatrix,d)}createInversionMatrix(o,u){const{center:f}=o,d=Cm(_u(u));return lv(d,d,ze(f.lng)),fx(d,d,ze(f.lat)),yf(d,d,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(o,u,f,d){return fS(o,u,f,!0)||new Kp(0,0)}pointCoordinate3D(o,u,f){const d=this.pointCoordinate(o,u,f,0);return[d.x,d.y,d.z]}isPointAboveHorizon(o,u){return!fS(o,u.x,u.y,!1)}farthestPixelDistance(o){const u=function(d,_){const x=d.cameraToCenterDistance,T=d._centerAltitude*_,P=d._camera,C=d._camera.forward(),O=lc([],Ca([],C,-x),[0,0,T]),R=d.worldSize/(2*Math.PI),F=[0,0,-R],G=d.width/d.height,q=Math.tan(d.fovAboveCenter),K=Ca([],P.up(),q),re=Ca([],P.right(),q*G),he=Ts([],lc([],lc([],C,K),re)),_e=[];let fe;if(new mx(O,he).closestPointOnSphere(F,R,_e)){const me=lc([],_e,F),xe=zl([],me,O);fe=Math.cos(d.fovAboveCenter)*xm(xe)}else{const me=zl([],O,F),xe=zl([],F,O);Ts(xe,xe);const ve=xm(me)-R;fe=Math.sqrt(ve*(ve+2*R));const Ue=Math.acos(fe/(R+ve))-Math.acos(Ka(C,xe));fe*=Math.cos(Ue)}return 1.01*fe}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),f=Hp(o.zoom);if(f>0){const d=RI(o,Bl(1,o.center.lat)*o.worldSize),_=o.worldSize/(2*Math.PI),x=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Hr(u,d+_*(1-Math.cos(x)),Math.pow(f,10))}return u}upVector(o,u,f){return Pm(u,f,o,1)}upVectorScale(o){return{metersToTile:uv(hv(_u(o)))}}}function UI(l){const o=l.parallels,u=!!o&&Math.abs(o[0]+o[1])<.01;switch(l.name){case"mercator":return new kI(l);case"equirectangular":return new JN(l);case"naturalEarth":return new eR(l);case"equalEarth":return new YN(l);case"winkelTripel":return new tR(l);case"albers":return u?new BI(l):new KN(l);case"lambertConformalConic":return u?new BI(l):new QN(l);case"globe":return new rR(l)}throw new Error(`Invalid projection name: ${l.name}`)}const nR=wv.types,iR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rv(l,o,u,f,d,_,x,T,P,C,O,R,F){const G=T?Math.min(sh,Math.round(T[0])):0,q=T?Math.min(sh,Math.round(T[1])):0;l.emplaceBack(o,u,Math.round(32*f),Math.round(32*d),_,x,(G<<1)+(P?1:0),q,16*C,16*O,256*R,256*F)}function kv(l,o,u,f,d,_,x){l.emplaceBack(o,u,f,d,_,x)}function Fv(l,o,u,f,d){l.emplaceBack(o,u,f,d),l.emplaceBack(o,u,f,d),l.emplaceBack(o,u,f,d),l.emplaceBack(o,u,f,d)}function oR(l){for(const o of l.sections)if(ax(o.text))return!0;return!1}class Qx{constructor(o){this.layoutVertexArray=new st,this.indexArray=new Xt,this.programConfigurations=o,this.segments=new Hi,this.dynamicLayoutVertexArray=new ut,this.opacityVertexArray=new Ht,this.placedSymbolArray=new Wi,this.globeExtVertexArray=new pt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,u,f,d){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,pN.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,gN.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,iR,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,dN.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||d)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Bt(Qx,"SymbolBuffers");class ew{constructor(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Hi,this.collisionVertexArray=new kr,this.collisionVertexArrayExt=new Dr}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,mN.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,yN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(ew,"CollisionBuffers");class lh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(x=>x.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Fl([]),this.placementViewportMatrix=Fl([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vx(this.zoom,u["text-size"]),this.iconSizeData=Vx(this.zoom,u["icon-size"]);const f=this.layers[0].layout,d=f.get("symbol-sort-key"),_=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(x=>Ma[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Qx(new gf(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Qx(new gf(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new bs,this.lineVertexArray=new jp,this.symbolInstances=new li}calculateGlyphDependencies(o,u,f,d,_){for(let x=0;x<o.length;x++)if(u[o.charCodeAt(x)]=!0,d&&_){const T=Bm[o.charAt(x)];T&&(u[T.charCodeAt(0)]=!0)}}populate(o,u,f,d){const _=this.layers[0],x=_.layout,T=this.projection.name==="globe",P=x.get("text-font"),C=x.get("text-field"),O=x.get("icon-image"),R=(C.value.kind!=="constant"||C.value.value instanceof Es&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),F=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,G=x.get("symbol-sort-key");if(this.features=[],!R&&!F)return;const q=u.iconDependencies,K=u.glyphDependencies,re=u.availableImages,he=new N(this.zoom);for(const{feature:_e,id:fe,index:me,sourceLayerIndex:xe}of o){const ve=_._featureFilter.needGeometry,Ue=wf(_e,ve);if(!_._featureFilter.filter(he,Ue,f))continue;if(ve||(Ue.geometry=uc(_e,f,d)),T&&_e.type!==1&&f.z<=5){const je=Ue.geometry,nt=.98078528056,it=(lt,gt)=>Ka(Pm(lt.x,lt.y,f,1),Pm(gt.x,gt.y,f,1))<nt;for(let lt=0;lt<je.length;lt++)je[lt]=g3(je[lt],it)}let ke,Je;if(R){const je=_.getValueAndResolveTokens("text-field",Ue,f,re),nt=Es.factory(je);oR(nt)&&(this.hasRTLText=!0),(!this.hasRTLText||S()==="unavailable"||this.hasRTLText&&L.isParsed())&&(ke=xN(nt,_,Ue))}if(F){const je=_.getValueAndResolveTokens("icon-image",Ue,f,re);Je=je instanceof ea?je:ea.fromString(je)}if(!ke&&!Je)continue;const ht=this.sortFeaturesByKey?G.evaluate(Ue,{},f):void 0;if(this.features.push({id:fe,text:ke,icon:Je,index:me,sourceLayerIndex:xe,geometry:Ue.geometry,properties:_e.properties,type:nR[_e.type],sortKey:ht}),Je&&(q[Je.name]=!0),ke){const je=P.evaluate(Ue,{},f).join(","),nt=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ma.vertical)>=0;for(const it of ke.sections)if(it.image)q[it.image.name]=!0;else{const lt=fm(ke.toString()),gt=it.fontStack||je,He=K[gt]=K[gt]||{};this.calculateGlyphDependencies(it.text,He,nt,this.allowVerticalPlacement,lt)}}}x.get("symbol-placement")==="line"&&(this.features=function(_e){const fe={},me={},xe=[];let ve=0;function Ue(je){xe.push(_e[je]),ve++}function ke(je,nt,it){const lt=me[je];return delete me[je],me[nt]=lt,xe[lt].geometry[0].pop(),xe[lt].geometry[0]=xe[lt].geometry[0].concat(it[0]),lt}function Je(je,nt,it){const lt=fe[nt];return delete fe[nt],fe[je]=lt,xe[lt].geometry[0].shift(),xe[lt].geometry[0]=it[0].concat(xe[lt].geometry[0]),lt}function ht(je,nt,it){const lt=it?nt[0][nt[0].length-1]:nt[0][0];return`${je}:${lt.x}:${lt.y}`}for(let je=0;je<_e.length;je++){const nt=_e[je],it=nt.geometry,lt=nt.text?nt.text.toString():null;if(!lt){Ue(je);continue}const gt=ht(lt,it),He=ht(lt,it,!0);if(gt in me&&He in fe&&me[gt]!==fe[He]){const Ct=Je(gt,He,it),Vt=ke(gt,He,xe[Ct].geometry);delete fe[gt],delete me[He],me[ht(lt,xe[Vt].geometry,!0)]=Vt,xe[Ct].geometry=null}else gt in me?ke(gt,He,it):He in fe?Je(gt,He,it):(Ue(je),fe[gt]=ve-1,me[He]=ve-1)}return xe.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,fe)=>_e.sortKey-fe.sortKey)}update(o,u,f,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f,d),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=UI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const f=this.lineVertexArray.length;if(o.segment!==void 0)for(const{x:d,y:_}of u)this.lineVertexArray.emplaceBack(d,_);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,u,f,d,_,x,T,P,C,O,R,F,G,q){const K=o.indexArray,re=o.layoutVertexArray,he=o.globeExtVertexArray,_e=o.segments.prepareSegment(4*u.length,re,K,this.canOverlap?x.sortKey:void 0),fe=this.glyphOffsetArray.length,me=_e.vertexLength,xe=this.allowVerticalPlacement&&T===Ma.vertical?Math.PI/2:0,ve=x.text&&x.text.sections;for(let ke=0;ke<u.length;ke++){const{tl:Je,tr:ht,bl:je,br:nt,tex:it,pixelOffsetTL:lt,pixelOffsetBR:gt,minFontScaleX:He,minFontScaleY:Ct,glyphOffset:Vt,isSDF:Lt,sectionIndex:vr}=u[ke],yt=_e.vertexLength,Kt=Vt[1];if(Rv(re,C.x,C.y,Je.x,Kt+Je.y,it.x,it.y,f,Lt,lt.x,lt.y,He,Ct),Rv(re,C.x,C.y,ht.x,Kt+ht.y,it.x+it.w,it.y,f,Lt,gt.x,lt.y,He,Ct),Rv(re,C.x,C.y,je.x,Kt+je.y,it.x,it.y+it.h,f,Lt,lt.x,gt.y,He,Ct),Rv(re,C.x,C.y,nt.x,Kt+nt.y,it.x+it.w,it.y+it.h,f,Lt,gt.x,gt.y,He,Ct),P){const{x:xr,y:Tn,z:wr}=P.anchor,[ar,ai,Sr]=P.up;kv(he,xr,Tn,wr,ar,ai,Sr),kv(he,xr,Tn,wr,ar,ai,Sr),kv(he,xr,Tn,wr,ar,ai,Sr),kv(he,xr,Tn,wr,ar,ai,Sr),Fv(o.dynamicLayoutVertexArray,xr,Tn,wr,xe)}else Fv(o.dynamicLayoutVertexArray,C.x,C.y,C.z,xe);K.emplaceBack(yt,yt+1,yt+2),K.emplaceBack(yt+1,yt+2,yt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),ke!==u.length-1&&vr===u[ke+1].sectionIndex||o.programConfigurations.populatePaintArrays(re.length,x,x.index,{},G,q,ve&&ve[vr])}const Ue=P?P.anchor:C;o.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,C.x,C.y,fe,this.glyphOffsetArray.length-fe,me,O,R,C.segment,f?f[0]:0,f?f[1]:0,d[0],d[1],T,0,!1,0,F,0)}_commitLayoutVertex(o,u,f,d,_,x,T){o.emplaceBack(u,f,d,_,x,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(o,u,f,d,_,x,T){const P=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),C=P.vertexLength,O=T.tileAnchorX,R=T.tileAnchorY;for(let G=0;G<4;G++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(u,-o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,o.padding),f.collisionVertexArrayExt.emplaceBack(u,-o.padding,o.padding),this._commitLayoutVertex(f.layoutVertexArray,d,_,x,O,R,new W(o.x1,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,d,_,x,O,R,new W(o.x2,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,d,_,x,O,R,new W(o.x2,o.y2)),this._commitLayoutVertex(f.layoutVertexArray,d,_,x,O,R,new W(o.x1,o.y2)),P.vertexLength+=4;const F=f.indexArray;F.emplaceBack(C,C+1),F.emplaceBack(C+1,C+2),F.emplaceBack(C+2,C+3),F.emplaceBack(C+3,C),P.primitiveLength+=4}_addTextDebugCollisionBoxes(o,u,f,d,_,x){for(let T=d;T<_;T++){const P=f.get(T),C=this.getSymbolInstanceTextSize(o,x,u,T);this._addCollisionDebugVertices(P,C,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(o,u,f,d,_,x){for(let T=d;T<_;T++){const P=f.get(T),C=this.getSymbolInstanceIconSize(o,u,x.placedIconSymbolIndex);this._addCollisionDebugVertices(P,C,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,x)}}generateCollisionDebugBuffers(o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ew(Gt,oI.members,Eo),this.iconCollisionBox=new ew(Gt,oI.members,Eo);const f=td(this.iconSizeData,o),d=td(this.textSizeData,o);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(d,o,u,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(d,o,u,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(f,o,u,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(f,o,u,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(o,u,f,d){const _=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:d),x=Sv(this.textSizeData,o,_)/Fo;return this.tilePixelRatio*x}getSymbolInstanceIconSize(o,u,f){const d=this.icon.placedSymbolArray.get(f),_=Sv(this.iconSizeData,o,d);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(o,u,f){o.emplaceBack(u,-f,-f),o.emplaceBack(u,f,-f),o.emplaceBack(u,f,f),o.emplaceBack(u,-f,f)}_updateTextDebugCollisionBoxes(o,u,f,d,_,x){for(let T=d;T<_;T++){const P=f.get(T),C=this.getSymbolInstanceTextSize(o,x,u,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,P.padding)}}_updateIconDebugCollisionBoxes(o,u,f,d,_,x){for(let T=d;T<_;T++){const P=f.get(T),C=this.getSymbolInstanceIconSize(o,u,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,P.padding)}}updateCollisionDebugBuffers(o,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=td(this.iconSizeData,o),d=td(this.textSizeData,o);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(d,o,u,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(d,o,u,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(f,o,u,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,o,u,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,u,f,d,_,x,T,P,C){const O={};if(u<f){const{x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me,featureIndex:xe}=o.get(u);O.textBox={x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me},O.textFeatureIndex=xe}if(d<_){const{x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me,featureIndex:xe}=o.get(d);O.verticalTextBox={x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me},O.verticalTextFeatureIndex=xe}if(x<T){const{x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me,featureIndex:xe}=o.get(x);O.iconBox={x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me},O.iconFeatureIndex=xe}if(P<C){const{x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me,featureIndex:xe}=o.get(P);O.verticalIconBox={x1:R,y1:F,x2:G,y2:q,padding:K,projectedAnchorX:re,projectedAnchorY:he,projectedAnchorZ:_e,tileAnchorX:fe,tileAnchorY:me},O.verticalIconFeatureIndex=xe}return O}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const f=o.placedSymbolArray.get(u),d=f.vertexStartIndex+4*f.numGlyphs;for(let _=f.vertexStartIndex;_<d;_+=4)o.indexArray.emplaceBack(_,_+1,_+2),o.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(o),f=Math.cos(o),d=[],_=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const P=this.symbolInstances.get(T);d.push(0|Math.round(u*P.tileAnchorX+f*P.tileAnchorY)),_.push(P.featureIndex)}return x.sort((T,P)=>d[T]-d[P]||_[P]-_[T]),x}addToSortKeyRanges(o,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:C}=f;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==d&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(lh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lh.MAX_GLYPHS=65535,lh.addDynamicAttributes=Fv;const sR=new de({"symbol-placement":new X(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new X(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new X(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new oe(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new X(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new X(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new X(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new X(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new X(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new oe(Ye.layout_symbol["icon-size"]),"icon-text-fit":new X(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new X(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new oe(Ye.layout_symbol["icon-image"]),"icon-rotate":new oe(Ye.layout_symbol["icon-rotate"]),"icon-padding":new X(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new X(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new oe(Ye.layout_symbol["icon-offset"]),"icon-anchor":new oe(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new X(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new X(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new X(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new oe(Ye.layout_symbol["text-field"]),"text-font":new oe(Ye.layout_symbol["text-font"]),"text-size":new oe(Ye.layout_symbol["text-size"]),"text-max-width":new oe(Ye.layout_symbol["text-max-width"]),"text-line-height":new oe(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new oe(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new oe(Ye.layout_symbol["text-justify"]),"text-radial-offset":new oe(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new X(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new oe(Ye.layout_symbol["text-anchor"]),"text-max-angle":new X(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new X(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new oe(Ye.layout_symbol["text-rotate"]),"text-padding":new X(Ye.layout_symbol["text-padding"]),"text-keep-upright":new X(Ye.layout_symbol["text-keep-upright"]),"text-transform":new oe(Ye.layout_symbol["text-transform"]),"text-offset":new oe(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new X(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new X(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new X(Ye.layout_symbol["text-optional"])});var tw={paint:new de({"icon-opacity":new oe(Ye.paint_symbol["icon-opacity"]),"icon-color":new oe(Ye.paint_symbol["icon-color"]),"icon-halo-color":new oe(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new oe(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new oe(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new X(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new X(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new oe(Ye.paint_symbol["text-opacity"]),"text-color":new oe(Ye.paint_symbol["text-color"],{runtimeType:Bs,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new oe(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new oe(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new oe(Ye.paint_symbol["text-halo-blur"]),"text-translate":new X(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new X(Ye.paint_symbol["text-translate-anchor"])}),layout:sR};class GI{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:zc,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(GI,"FormatSectionOverride",{omit:["defaultValue"]});class zv extends kl{constructor(o){super(o,tw)}recalculate(o,u){super.recalculate(o,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const d=[];for(const _ of f)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,u,f,d){const _=this.layout.get(o).evaluate(u,{},f,d),x=this._unevaluatedLayout._values[o];return x.isDataDriven()||Kc(x.value)||!_?_:function(T,P){return P.replace(/{([^{}]+)}/g,(C,O)=>O in T?String(T[O]):"")}(u.properties,_)}createBucket(o){return new lh(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of tw.paint.overridableProperties){if(!zv.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),f=new GI(u),d=new Rp(f,u.property.specification);let _=null;_=u.value.kind==="constant"||u.value.kind==="source"?new tm("source",d):new sf("composite",d,u.value.zoomStops,u.value._interpolationType),this.paint._values[o]=new le(u.property,_,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&zv.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const f=o.get("text-field"),d=tw.paint.properties[u];let _=!1;const x=T=>{for(const P of T)if(d.overrides&&d.overrides.hasOverride(P))return void(_=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Es)x(f.value.value.sections);else if(f.value.kind==="source"){const T=C=>{_||(C instanceof Yu&&Li(C.value)===Vh?x(C.value.sections):C instanceof du?x(C.sections):C.eachChild(T))},P=f.value;P._styleExpression&&T(P._styleExpression.expression)}return _}getProgramConfiguration(o){return new nh(this,o)}}var aR={paint:new de({"background-color":new X(Ye.paint_background["background-color"]),"background-pattern":new X(Ye.paint_background["background-pattern"]),"background-opacity":new X(Ye.paint_background["background-opacity"])})},lR={paint:new de({"raster-opacity":new X(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new X(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new X(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new X(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new X(Ye.paint_raster["raster-saturation"]),"raster-contrast":new X(Ye.paint_raster["raster-contrast"]),"raster-resampling":new X(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new X(Ye.paint_raster["raster-fade-duration"])})};class uR extends kl{constructor(o){super(o,{}),this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var cR={paint:new de({"sky-type":new X(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new X(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new X(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new X(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new X(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new pe(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new X(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new X(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new X(Ye.paint_sky["sky-opacity"])})};function rw(l,o,u){const f=[0,0,1],d=sS([]);return lS(d,d,u?-ze(l)+Math.PI:ze(l)),aS(d,d,-ze(o)),rS(f,f,d),Ts(f,f)}const hR={circle:class extends kl{constructor(l){super(l,E3)}createBucket(l){return new Cx(l)}queryRadius(l){const o=l;return Yp("circle-radius",this,o)+Yp("circle-stroke-width",this,o)+dv(this.paint.get("circle-translate"))}queryIntersectsFeature(l,o,u,f,d,_,x,T){const P=MS(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u);return LS(l,f,_,x,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,C)}getProgramIds(){return["circle"]}getProgramConfiguration(l){return new nh(this,l)}},heatmap:class extends kl{createBucket(l){return new DS(l)}constructor(l){super(l,I3),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ox({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return Yp("heatmap-radius",this,l)}queryIntersectsFeature(l,o,u,f,d,_,x,T){const P=this.paint.get("heatmap-radius").evaluate(o,u);return LS(l,f,_,x,T,!0,!0,new W(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(l){return new nh(this,l)}},hillshade:class extends kl{constructor(l){super(l,P3)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends kl{constructor(l){super(l,j3)}getProgramIds(){const l=this.paint.get("fill-pattern"),o=l&&l.constantOr(1),u=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(l){return new nh(this,l)}recalculate(l,o){super.recalculate(l,o);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new vv(l)}queryRadius(){return dv(this.paint.get("fill-translate"))}queryIntersectsFeature(l,o,u,f,d,_){return!l.queryGeometry.isAboveHorizon&&SS(AS(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends kl{constructor(l){super(l,oN)}createBucket(l){return new km(l)}queryRadius(){return dv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(l){return new nh(this,l)}queryIntersectsFeature(l,o,u,f,d,_,x,T,P){const C=MS(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(o,u),R=this.paint.get("fill-extrusion-base").evaluate(o,u),F=[0,0],G=T&&_.elevation,q=_.elevation?_.elevation.exaggeration():1,K=l.tile.getBucket(this);if(G&&K instanceof km){const me=K.centroidVertexArray,xe=P+1;xe<me.length&&(F[0]=me.geta_centroid_pos0(xe),F[1]=me.geta_centroid_pos1(xe))}if(F[0]===0&&F[1]===1)return!1;_.projection.name==="globe"&&(f=YS([f],[new W(0,0),new W(er,er)],l.tileID.canonical).map(me=>me.polygon).flat());const re=G?T:null,[he,_e]=function(me,xe,ve,Ue,ke,Je,ht,je,nt,it,lt){return me.projection.name==="globe"?function(gt,He,Ct,Vt,Lt,vr,yt,Kt,xr,Tn,wr){const ar=[],ai=[],Sr=gt.projection.upVectorScale(wr,gt.center.lat,gt.worldSize).metersToTile,Ir=[0,0,0,1],Wn=[0,0,0,1],ei=(Hn,bi,Oi,Yi)=>{Hn[0]=bi,Hn[1]=Oi,Hn[2]=Yi,Hn[3]=1},ti=KS();Ct>0&&(Ct+=ti),Vt+=ti;for(const Hn of He){const bi=[],Oi=[];for(const Yi of Hn){const Kn=Yi.x+Lt.x,uo=Yi.y+Lt.y,Ji=gt.projection.projectTilePoint(Kn,uo,wr),Pi=gt.projection.upVector(wr,Yi.x,Yi.y);let Pn=Ct,Qi=Vt;if(yt){const ri=tI(Kn,uo,Ct,Vt,yt,Kt,xr,Tn);Pn+=ri.base,Qi+=ri.top}Ct!==0?ei(Ir,Ji.x+Pi[0]*Sr*Pn,Ji.y+Pi[1]*Sr*Pn,Ji.z+Pi[2]*Sr*Pn):ei(Ir,Ji.x,Ji.y,Ji.z),ei(Wn,Ji.x+Pi[0]*Sr*Qi,Ji.y+Pi[1]*Sr*Qi,Ji.z+Pi[2]*Sr*Qi),Ui(Ir,Ir,vr),Ui(Wn,Wn,vr),bi.push(new ed(Ir[0],Ir[1],Ir[2])),Oi.push(new ed(Wn[0],Wn[1],Wn[2]))}ar.push(bi),ai.push(Oi)}return[ar,ai]}(me,xe,ve,Ue,ke,Je,ht,je,nt,it,lt):ht?function(gt,He,Ct,Vt,Lt,vr,yt,Kt,xr){const Tn=[],wr=[],ar=[0,0,0,1];for(const ai of gt){const Sr=[],Ir=[];for(const Wn of ai){const ei=Wn.x+Vt.x,ti=Wn.y+Vt.y,Hn=tI(ei,ti,He,Ct,vr,yt,Kt,xr);ar[0]=ei,ar[1]=ti,ar[2]=Hn.base,ar[3]=1,_f(ar,ar,Lt),ar[3]=Math.max(ar[3],1e-5);const bi=new ed(ar[0]/ar[3],ar[1]/ar[3],ar[2]/ar[3]);ar[0]=ei,ar[1]=ti,ar[2]=Hn.top,ar[3]=1,_f(ar,ar,Lt),ar[3]=Math.max(ar[3],1e-5);const Oi=new ed(ar[0]/ar[3],ar[1]/ar[3],ar[2]/ar[3]);Sr.push(bi),Ir.push(Oi)}Tn.push(Sr),wr.push(Ir)}return[Tn,wr]}(xe,ve,Ue,ke,Je,ht,je,nt,it):function(gt,He,Ct,Vt,Lt){const vr=[],yt=[],Kt=Lt[8]*He,xr=Lt[9]*He,Tn=Lt[10]*He,wr=Lt[11]*He,ar=Lt[8]*Ct,ai=Lt[9]*Ct,Sr=Lt[10]*Ct,Ir=Lt[11]*Ct;for(const Wn of gt){const ei=[],ti=[];for(const Hn of Wn){const bi=Hn.x+Vt.x,Oi=Hn.y+Vt.y,Yi=Lt[0]*bi+Lt[4]*Oi+Lt[12],Kn=Lt[1]*bi+Lt[5]*Oi+Lt[13],uo=Lt[2]*bi+Lt[6]*Oi+Lt[14],Ji=Lt[3]*bi+Lt[7]*Oi+Lt[15],Pi=Yi+Kt,Pn=Kn+xr,Qi=uo+Tn,ri=Math.max(Ji+wr,1e-5),Ps=Yi+ar,eo=Kn+ai,zo=uo+Sr,bo=Math.max(Ji+Ir,1e-5);ei.push(new ed(Pi/ri,Pn/ri,Qi/ri)),ti.push(new ed(Ps/bo,eo/bo,zo/bo))}vr.push(ei),yt.push(ti)}return[vr,yt]}(xe,ve,Ue,ke,Je)}(_,f,R,O,C,x,re,F,q,_.center.lat,l.tileID.canonical),fe=l.queryGeometry;return function(me,xe,ve){let Ue=1/0;SS(ve,xe)&&(Ue=eI(ve,xe[0]));for(let ke=0;ke<xe.length;ke++){const Je=xe[ke],ht=me[ke];for(let je=0;je<Je.length-1;je++){const nt=Je[je],it=[nt,Je[je+1],ht[je+1],ht[je],nt];TS(ve,it)&&(Ue=Math.min(Ue,eI(ve,it)))}}return Ue!==1/0&&Ue}(he,_e,fe.isPointQuery()?fe.screenBounds:fe.screenGeometry)}},line:class extends kl{constructor(l){super(l,rI),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Vg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,o){super.recalculate(l,o),this.paint._values["line-floorwidth"]=nI.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Tv(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(l){return new nh(this,l)}queryRadius(l){const o=l,u=iI(Yp("line-width",this,o),Yp("line-gap-width",this,o)),f=Yp("line-offset",this,o);return u/2+Math.abs(f)+dv(this.paint.get("line-translate"))}queryIntersectsFeature(l,o,u,f,d,_){if(l.queryGeometry.isAboveHorizon)return!1;const x=AS(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),T=l.pixelToTileUnitsFactor/2*iI(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),P=this.paint.get("line-offset").evaluate(o,u);return P&&(f=function(C,O){const R=[],F=new W(0,0);for(let G=0;G<C.length;G++){const q=C[G],K=[];for(let re=0;re<q.length;re++){const he=q[re],_e=q[re+1],fe=re===0?F:he.sub(q[re-1])._unit()._perp(),me=re===q.length-1?F:_e.sub(he)._unit()._perp(),xe=fe._add(me)._unit();xe._mult(1/(xe.x*me.x+xe.y*me.y)),K.push(xe._mult(O)._add(he))}R.push(K)}return R}(f,P*l.pixelToTileUnitsFactor)),function(C,O,R){for(let F=0;F<O.length;F++){const G=O[F];if(C.length>=3){for(let q=0;q<G.length;q++)if(Ef(C,G[q]))return!0}if(_3(C,G,R))return!0}return!1}(x,f,T)}isTileClipped(){return!0}},symbol:zv,background:class extends kl{constructor(l){super(l,aR)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends kl{constructor(l){super(l,lR)}getProgramIds(){return["raster"]}},sky:class extends kl{constructor(l){super(l,cR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ox({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(l,o){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),d=!f,_=l.style.light,x=_.properties.get("position");return d&&_.properties.get("anchor")==="viewport"&&Qe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?rw(x.azimuthal,90-x.polar,o):rw(f[0],90-f[1],o)}const u=this.paint.get("sky-gradient-center");return rw(u[0],90-u[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}}};class Xm{constructor(o,u,f,d){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,d)}update(o,u,f){const{width:d,height:_}=o,{context:x}=this,{gl:T}=x,{HTMLImageElement:P,HTMLCanvasElement:C,HTMLVideoElement:O,ImageData:R,ImageBitmap:F}=g;if(T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!u||u.premultiply!==!1)),f||this.size&&this.size[0]===d&&this.size[1]===_){const{x:G,y:q}=f||{x:0,y:0};o instanceof P||o instanceof C||o instanceof O||o instanceof R||F&&o instanceof F?T.texSubImage2D(T.TEXTURE_2D,0,G,q,T.RGBA,T.UNSIGNED_BYTE,o):T.texSubImage2D(T.TEXTURE_2D,0,G,q,d,_,T.RGBA,T.UNSIGNED_BYTE,o.data)}else this.size=[d,_],o instanceof P||o instanceof C||o instanceof O||o instanceof R||F&&o instanceof F?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,o):T.texImage2D(T.TEXTURE_2D,0,this.format,d,_,0,this.format,T.UNSIGNED_BYTE,o.data);this.useMipmap=!!(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(o,u){const{context:f}=this,{gl:d}=f;d.bindTexture(d.TEXTURE_2D,this.texture),o!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?o===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:o),this.filter=o),u!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class fR{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class pR{constructor(){this.tasks={},this.taskQueue=[],Xr(["process"],this),this.invoker=new fR(this.process),this.nextId=0}add(o,u){const f=this.nextId++,d=function({type:_,isSymbolTile:x,zoom:T}){return T=T||0,_==="message"?0:_!=="maybePrepare"||x?_!=="parseTile"||x?_==="parseTile"&&x?300-T:_==="maybePrepare"&&x?400-T:500:200-T:100-T}(u);if(d===0){Mt();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:o,metadata:u,priority:d,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){Mt();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const o=this.pick();if(o===null)return;const u=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let o=null,u=1/0;for(let d=0;d<this.taskQueue.length;d++){const _=this.tasks[this.taskQueue[d]];_.priority<u&&(u=_.priority,o=d)}if(o===null)return null;const f=this.taskQueue[o];return this.taskQueue.splice(o,1),f}remove(){this.invoker.remove()}}class VI{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const dR=["tile","layer","source","sourceLayer","state"];class jI{constructor(o,u,f,d,_){this.type="Feature",this._vectorTileFeature=o,this._z=u,this._x=f,this._y=d,this.properties=o.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(o.id=this.id);for(const u of dR)this[u]!==void 0&&(o[u]=this[u]);return o}}const Qa=32,wu=33,uh=new Uint16Array(8184);for(let l=0;l<2046;l++){let o=l+2,u=0,f=0,d=0,_=0,x=0,T=0;for(1&o?d=_=x=Qa:u=f=T=Qa;(o>>=1)>1;){const C=u+d>>1,O=f+_>>1;1&o?(d=u,_=f,u=x,f=T):(u=d,f=_,d=x,_=T),x=C,T=O}const P=4*l;uh[P+0]=u,uh[P+1]=f,uh[P+2]=d,uh[P+3]=_}const Eu=new Uint16Array(2178),ch=new Uint8Array(1089),Bv=new Uint16Array(1089);function qI(l){return l===0?-.03125:l===32?.03125:0}var $I=Ae([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ZI={type:2,extent:er,loadGeometry:()=>[[new W(0,0),new W(er+1,0),new W(er+1,er+1),new W(0,er+1),new W(0,0)]]};class nw{constructor(o,u,f,d,_){this.tileID=o,this.uid=yr(),this.uses=0,this.tileSize=u,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(o){const u=o+this.timeAdded;u<Tl.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Tf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(d,_){const x={};if(!_)return x;for(const T of d){const P=T.layerIds.map(C=>_.getLayer(C)).filter(Boolean);if(P.length!==0){T.layers=P,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(C=>P.filter(O=>O.id===C)[0]));for(const C of P)x[C.id]=T}}return x}(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof lh){if(this.hasSymbolBuckets=!0,!f)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof lh&&_.hasRTLText){this.hasRTLText=!0,L.isLoading()||L.isLoaded()||S()!=="deferred"||M();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(d).queryRadius(_))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Zn}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const f in this.buckets){const d=this.buckets[f];d.uploadPending()&&d.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xm(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xm(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Xm(o,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,f,d,_,x,T,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:T,transform:x,params:_,tileTransform:this.tileTransform},o,u,f):{}}querySourceFeatures(o,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const d=f.loadVTLayers(),_=u?u.sourceLayer:"",x=d._geojsonTileLayer||d[_];if(!x)return;const T=Bp(u&&u.filter),{z:P,x:C,y:O}=this.tileID.canonical,R={z:P,x:C,y:O};for(let F=0;F<x.length;F++){const G=x.feature(F);if(T.needGeometry){const re=wf(G,!0);if(!T.filter(new N(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!T.filter(new N(this.tileID.overscaledZ),G))continue;const q=f.getId(G,_),K=new jI(G,P,C,O,q);K.tile=R,o.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const f=_t(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const f=Date.now();let d=!1;if(this.expirationTime>f)d=!1;else if(u)if(this.expirationTime<u)d=!0;else{const _=this.expirationTime-u;_?this.expirationTime=f+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0||!u)return;const f=this.latestFeatureIndex.loadVTLayers(),d=u.style.listImages();for(const _ in this.buckets){if(!u.style.hasLayer(_))continue;const x=this.buckets[_],T=x.layers[0].sourceLayer||"_geojsonTileLayer",P=f[T],C=o[T];if(!P||!C||Object.keys(C).length===0)continue;if(x.update(C,P,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Tv||x instanceof vv){const R=u.style._getSourceCache(x.layers[0].source);u._terrain&&u._terrain.enabled&&R&&x.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(R.id,this.tileID)}const O=u&&u.style&&u.style.getLayer(_);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Tl.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Tl.now()+o}setTexture(o,u){const f=u.context,d=f.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Xm(f,o,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(o,u){const f={};for(const d of u)f[d]=!0;this.dependencies[o]=f}hasDependency(o,u){for(const f of o){const d=this.dependencies[f];if(d){for(const _ of u)if(d[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const f=uc(ZI,this.tileID.canonical,this.tileTransform)[0],d=new ct,_=new na;for(let x=0;x<f.length;x++){const{x:T,y:P}=f[x];d.emplaceBack(T,P),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(_),this._tileDebugBuffer=o.createVertexBuffer(d,Sm.members),this._tileDebugSegments=Hi.simpleSegment(0,0,d.length,_.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const f=uc(ZI,this.tileID.canonical,this.tileTransform)[0];let d,_;if(this.isRaster){const x=function(T,P){const C=Tf(T,P),O=Math.pow(2,T.z);for(let re=0;re<wu;re++)for(let he=0;he<wu;he++){const _e=Aa((T.x+(he+qI(he))/Qa)/O),fe=Ko((T.y+(re+qI(re))/Qa)/O),me=P.project(_e,fe),xe=re*wu+he;Eu[2*xe+0]=Math.round((me.x*C.scale-C.x)*er),Eu[2*xe+1]=Math.round((me.y*C.scale-C.y)*er)}ch.fill(0),Bv.fill(0);for(let re=2045;re>=0;re--){const he=4*re,_e=uh[he+0],fe=uh[he+1],me=uh[he+2],xe=uh[he+3],ve=_e+me>>1,Ue=fe+xe>>1,ke=ve+Ue-fe,Je=Ue+_e-ve,ht=fe*wu+_e,je=xe*wu+me,nt=Ue*wu+ve,it=Math.hypot((Eu[2*ht+0]+Eu[2*je+0])/2-Eu[2*nt+0],(Eu[2*ht+1]+Eu[2*je+1])/2-Eu[2*nt+1])>=16;ch[nt]=ch[nt]||(it?1:0),re<1022&&(ch[nt]=ch[nt]||ch[(fe+Je>>1)*wu+(_e+ke>>1)]||ch[(xe+Je>>1)*wu+(me+ke>>1)])}const R=new rt,F=new Xt;let G=0;function q(re,he){const _e=he*wu+re;return Bv[_e]===0&&(R.emplaceBack(Eu[2*_e+0],Eu[2*_e+1],re*er/Qa,he*er/Qa),Bv[_e]=++G),Bv[_e]-1}function K(re,he,_e,fe,me,xe){const ve=re+_e>>1,Ue=he+fe>>1;if(Math.abs(re-me)+Math.abs(he-xe)>1&&ch[Ue*wu+ve])K(me,xe,re,he,ve,Ue),K(_e,fe,me,xe,ve,Ue);else{const ke=q(re,he),Je=q(_e,fe),ht=q(me,xe);F.emplaceBack(ke,Je,ht)}}return K(0,0,Qa,Qa,Qa,0),K(Qa,Qa,0,0,0,Qa),{vertices:R,indices:F}}(this.tileID.canonical,u);d=x.vertices,_=x.indices}else{d=new rt,_=new Xt;for(const{x:T,y:P}of f)d.emplaceBack(T,P,0,0);const x=Fx(d.int16,void 0,4);for(let T=0;T<x.length;T+=3)_.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=o.createVertexBuffer(d,$I.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(_),this._tileBoundsSegments=Hi.simpleSegment(0,0,d.length,_.length)}_makeGlobeTileDebugBuffers(o,u){const f=u.projection;if(!f||f.name!=="globe"||u.freezeTileCoverage)return;const d=this.tileID.canonical,_=Cm(pS(d,u)),x=Hp(u.zoom);let T;x>0&&(T=hx(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,d,u,_,T,x),this._makeGlobeTileDebugTextBuffer(o,d,u,_,T,x)}_globePoint(o,u,f,d,_,x,T){let P=Pm(o,u,f);if(x){const C=1<<f.z,O=vu(d.center.lng),R=xu(d.center.lat),F=(f.x+.5)/C-O;let G=0;F>.5?G=-1:F<-.5&&(G=1);let q=(o/er+f.x)/C+G,K=(u/er+f.y)/C;q=(q-O)*d._pixelsPerMercatorPixel+O,K=(K-R)*d._pixelsPerMercatorPixel+R;const re=[q*d.worldSize,K*d.worldSize,0];Ui(re,re,x),P=xf(P,re,T)}return Ui(P,P,_)}_makeGlobeTileDebugBorderBuffer(o,u,f,d,_,x){const T=new ct,P=new na,C=new Re,O=(F,G,q,K,re)=>{const he=(q-F)/(re-1),_e=(K-G)/(re-1),fe=T.length;for(let me=0;me<re;me++){const xe=F+me*he,ve=G+me*_e;T.emplaceBack(xe,ve);const Ue=this._globePoint(xe,ve,u,f,d,_,x);C.emplaceBack(Ue[0],Ue[1],Ue[2]),P.emplaceBack(fe+me)}},R=er;O(0,0,R,0,16),O(R,0,R,R,16),O(R,R,0,R,16),O(0,R,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(P),this._tileDebugBuffer=o.createVertexBuffer(T,Sm.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(C,cS.members),this._tileDebugSegments=Hi.simpleSegment(0,0,T.length,P.length)}_makeGlobeTileDebugTextBuffer(o,u,f,d,_,x){const T=er/4,P=new ct,C=new Xt,O=new Re,R=25;C.reserve(32),P.reserve(R),O.reserve(R);const F=(G,q)=>R*G+q;for(let G=0;G<R;G++){const q=G*T;for(let K=0;K<R;K++){const re=K*T;P.emplaceBack(re,q);const he=this._globePoint(re,q,u,f,d,_,x);O.emplaceBack(he[0],he[1],he[2])}}for(let G=0;G<4;G++)for(let q=0;q<4;q++){const K=F(G,q),re=F(G,q+1),he=F(G+1,q),_e=F(G+1,q+1);C.emplaceBack(K,re,he),C.emplaceBack(he,re,_e)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(C),this._tileDebugTextBuffer=o.createVertexBuffer(P,Sm.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(O,cS.members),this._tileDebugTextSegments=Hi.simpleSegment(0,0,R,32)}}class gR{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,f){const d=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][d]=this.stateChanges[o][d]||{},jt(this.stateChanges[o][d],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(const _ in this.state[o])_!==d&&(this.deletedStates[o][_]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][d]===null){this.deletedStates[o][d]={};for(const _ in this.state[o][d])f[_]||(this.deletedStates[o][d][_]=null)}else for(const _ in f)this.deletedStates[o]&&this.deletedStates[o][d]&&this.deletedStates[o][d][_]===null&&delete this.deletedStates[o][d][_]}removeFeatureState(o,u,f){if(this.deletedStates[o]===null)return;const d=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&u!==void 0)this.deletedStates[o][d]!==null&&(this.deletedStates[o][d]=this.deletedStates[o][d]||{},this.deletedStates[o][d][f]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][d])for(f in this.deletedStates[o][d]={},this.stateChanges[o][d])this.deletedStates[o][d][f]=null;else this.deletedStates[o][d]=null;else this.deletedStates[o]=null}getState(o,u){const f=String(u),d=jt({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const _=this.deletedStates[o][u];if(_===null)return{};for(const x in _)delete d[x]}return d}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const f={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const x in this.stateChanges[d])this.state[d][x]||(this.state[d][x]={}),jt(this.state[d][x],this.stateChanges[d][x]),_[x]=this.state[d][x];f[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const x in this.state[d])_[x]={},this.state[d][x]={};else for(const x in this.deletedStates[d]){if(this.deletedStates[d][x]===null)this.state[d][x]={};else if(this.state[d][x])for(const T of Object.keys(this.deletedStates[d][x]))delete this.state[d][x][T];_[x]=this.state[d][x]}f[d]=f[d]||{},jt(f[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const d in o)o[d].setFeatureState(f,u)}}class XI{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,u){const f=this.toIdx(o,u);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(o,u){return this.leaves[this.toIdx(o,u)]}toIdx(o,u){return u*this.size+o}}function WI(l,o,u,f){let d=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(f[x])<1e-15){if(u[x]<l[x]||u[x]>o[x])return null}else{const T=1/f[x];let P=(l[x]-u[x])*T,C=(o[x]-u[x])*T;if(P>C){const O=P;P=C,C=O}if(P>d&&(d=P),C<_&&(_=C),d>_)return null}return d}function HI(l,o,u,f,d,_,x,T,P,C,O){const R=f-l,F=d-o,G=_-u,q=x-l,K=T-o,re=P-u,he=O[1]*re-O[2]*K,_e=O[2]*q-O[0]*re,fe=O[0]*K-O[1]*q,me=R*he+F*_e+G*fe;if(Math.abs(me)<1e-15)return null;const xe=1/me,ve=C[0]-l,Ue=C[1]-o,ke=C[2]-u,Je=(ve*he+Ue*_e+ke*fe)*xe;if(Je<0||Je>1)return null;const ht=Ue*G-ke*F,je=ke*R-ve*G,nt=ve*F-Ue*R,it=(O[0]*ht+O[1]*je+O[2]*nt)*xe;return it<0||Je+it>1?null:(q*ht+K*je+re*nt)*xe}function KI(l,o,u){return(l-o)/(u-o)}function YI(l,o,u,f,d,_,x,T,P){const C=1<<u,O=_-f,R=x-d,F=(l+1)/C*O+f,G=(o+0)/C*R+d,q=(o+1)/C*R+d;T[0]=(l+0)/C*O+f,T[1]=G,P[0]=F,P[1]=q}class JI{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(_){const x=Math.ceil(Math.log2(_.dim/8)),T=[];let P=Math.ceil(Math.pow(2,x));const C=1/P,O=(G,q,K,re,he)=>{const _e=re?1:0,fe=(G+1)*K-_e,me=q*K,xe=(q+1)*K-_e;he[0]=G*K,he[1]=me,he[2]=fe,he[3]=xe};let R=new XI(P);const F=[];for(let G=0;G<P*P;G++){O(G%P,Math.floor(G/P),C,!1,F);const q=hh(F[0],F[1],_),K=hh(F[2],F[1],_),re=hh(F[2],F[3],_),he=hh(F[0],F[3],_);R.minimums.push(Math.min(q,K,re,he)),R.maximums.push(Math.max(q,K,re,he)),R.leaves.push(1)}for(T.push(R),P/=2;P>=1;P/=2){const G=T[T.length-1];R=new XI(P);for(let q=0;q<P*P;q++){O(q%P,Math.floor(q/P),2,!0,F);const K=G.getElevation(F[0],F[1]),re=G.getElevation(F[2],F[1]),he=G.getElevation(F[2],F[3]),_e=G.getElevation(F[0],F[3]),fe=G.isLeaf(F[0],F[1]),me=G.isLeaf(F[2],F[1]),xe=G.isLeaf(F[2],F[3]),ve=G.isLeaf(F[0],F[3]),Ue=Math.min(K.min,re.min,he.min,_e.min),ke=Math.max(K.max,re.max,he.max,_e.max),Je=fe&&me&&xe&&ve;R.maximums.push(ke),R.minimums.push(Ue),R.leaves.push(ke-Ue<=5&&Je?1:0)}T.push(R)}return T}(this.dem),f=u.length-1,d=u[f];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(u,0,0,f,0)}raycastRoot(o,u,f,d,_,x,T=1){return WI([o,u,-100],[f,d,this.maximums[0]*T],_,x)}raycast(o,u,f,d,_,x,T=1){if(!this.nodeCount)return null;const P=this.raycastRoot(o,u,f,d,_,x,T);if(P==null)return null;const C=[],O=[],R=[],F=[],G=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:q,t:K,nodex:re,nodey:he,depth:_e}=G.pop();if(this.leaves[q]){YI(re,he,_e,o,u,f,d,R,F);const me=1<<_e,xe=(re+0)/me,ve=(re+1)/me,Ue=(he+0)/me,ke=(he+1)/me,Je=hh(xe,Ue,this.dem)*T,ht=hh(ve,Ue,this.dem)*T,je=hh(ve,ke,this.dem)*T,nt=hh(xe,ke,this.dem)*T,it=HI(R[0],R[1],Je,F[0],R[1],ht,F[0],F[1],je,_,x),lt=HI(F[0],F[1],je,R[0],F[1],nt,R[0],R[1],Je,_,x),gt=Math.min(it!==null?it:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(gt!==Number.MAX_VALUE)return gt;{const He=bm([],_,x,K);if(QI(Je,ht,nt,je,KI(He[0],R[0],F[0]),KI(He[1],R[1],F[1]))>=He[2])return K}continue}let fe=0;for(let me=0;me<this._siblingOffset.length;me++){YI((re<<1)+this._siblingOffset[me][0],(he<<1)+this._siblingOffset[me][1],_e+1,o,u,f,d,R,F),R[2]=-100,F[2]=this.maximums[this.childOffsets[q]+me]*T;const xe=WI(R,F,_,x);if(xe!=null){const ve=xe;C[me]=ve;let Ue=!1;for(let ke=0;ke<fe&&!Ue;ke++)ve>=C[O[ke]]&&(O.splice(ke,0,me),Ue=!0);Ue||(O[fe]=me),fe++}}for(let me=0;me<fe;me++){const xe=O[me];G.push({idx:this.childOffsets[q]+xe,t:C[xe],nodex:(re<<1)+this._siblingOffset[xe][0],nodey:(he<<1)+this._siblingOffset[xe][1],depth:_e+1})}}return null}_addNode(o,u,f){return this.minimums.push(o),this.maximums.push(u),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(o,u,f,d,_){if(o[d].isLeaf(u,f)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=d-1,T=o[x];let P=0,C=0;for(let O=0;O<this._siblingOffset.length;O++){const R=2*u+this._siblingOffset[O][0],F=2*f+this._siblingOffset[O][1],G=T.getElevation(R,F),q=T.isLeaf(R,F),K=this._addNode(G.min,G.max,q);q&&(P|=1<<O),C||(C=K)}for(let O=0;O<this._siblingOffset.length;O++)P&1<<O||this._construct(o,2*u+this._siblingOffset[O][0],2*f+this._siblingOffset[O][1],x,C+O)}}function QI(l,o,u,f,d,_){return Hr(Hr(l,u,_),Hr(o,f,_),d)}function hh(l,o,u){const f=u.dim,d=et(l*f-.5,0,f-1),_=et(o*f-.5,0,f-1),x=Math.floor(d),T=Math.floor(_),P=Math.min(x+1,f-1),C=Math.min(T+1,f-1);return QI(u.get(x,T),u.get(P,T),u.get(x,C),u.get(P,C),d-x,_-T)}const e2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mR(l,o,u){return(256*l*256+256*o+u)/10-1e4}function yR(l,o,u){return 256*l+o+u/256-32768}class Uv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,u,f,d=!1,_=!1){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return Qe(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const x=this.dim=u.height-2,T=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=f||"mapbox",this.borderReady=d,!d){for(let P=0;P<x;P++)T[this._idx(-1,P)]=T[this._idx(0,P)],T[this._idx(x,P)]=T[this._idx(x-1,P)],T[this._idx(P,-1)]=T[this._idx(P,0)],T[this._idx(P,x)]=T[this._idx(P,x-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(x,-1)]=T[this._idx(x-1,0)],T[this._idx(-1,x)]=T[this._idx(0,x-1)],T[this._idx(x,x)]=T[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new JI(this)}get(o,u,f=!1){f&&(o=et(o,-1,this.dim),u=et(u,-1,this.dim));const d=4*this._idx(o,u);return(this.encoding==="terrarium"?yR:mR)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(o){return e2[o]}get unpackVector(){return e2[this.encoding]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}static pack(o,u){const f=[0,0,0,0],d=Uv.getUnpackVector(u);let _=Math.floor((o+d[3])/d[2]);return f[2]=_%256,_=Math.floor(_/256),f[1]=_%256,_=Math.floor(_/256),f[0]=_,f}getPixels(){return new oa({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let d=u*this.dim,_=u*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:d=_-1;break;case 1:_=d+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const P=-u*this.dim,C=-f*this.dim;for(let O=x;O<T;O++)for(let R=d;R<_;R++){const F=4*this._idx(R,O),G=4*this._idx(R+P,O+C);this.pixels[F+0]=o.pixels[G+0],this.pixels[F+1]=o.pixels[G+1],this.pixels[F+2]=o.pixels[G+2],this.pixels[F+3]=o.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(Uv,"DEMData"),Bt(JI,"DemMinMaxQuadTree",{omit:["dem"]});class _R{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,f){const d=o.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:u,timeout:void 0};if(f!==void 0&&(_.timeout=setTimeout(()=>{this.remove(o,_)},f)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const f=o.wrapped().key,d=u===void 0?0:this.data[f].indexOf(u),_=this.data[f][d];return this.data[f].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(_.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const f in this.data)for(const d of this.data[f])o(d.value)||u.push(d);for(const f of u)this.remove(f.value.tileID,f)}}class cd{constructor(o,u,f){this.func=o,this.mask=u,this.range=f}}cd.ReadOnly=!1,cd.ReadWrite=!0,cd.disabled=new cd(519,cd.ReadOnly,[0,1]);const iw=7680;class ow{constructor(o,u,f,d,_,x){this.test=o,this.ref=u,this.mask=f,this.fail=d,this.depthFail=_,this.pass=x}}ow.disabled=new ow({func:519,mask:0},0,0,iw,iw,iw);class bu{constructor(o,u,f){this.blendFunction=o,this.blendColor=u,this.mask=f}}bu.Replace=[1,0],bu.disabled=new bu(bu.Replace,Bi.transparent,[!1,!1,!1,!1]),bu.unblended=new bu(bu.Replace,Bi.transparent,[!0,!0,!0,!0]),bu.alphaBlended=new bu([1,771],Bi.transparent,[!0,!0,!0,!0]);const sw=1029,aw=2305;class Vl{constructor(o,u,f){this.enable=o,this.mode=u,this.frontFace=f}}Vl.disabled=new Vl(!1,sw,aw),Vl.backCCW=new Vl(!0,sw,aw),Vl.backCW=new Vl(!0,sw,2304),Vl.frontCW=new Vl(!0,1028,2304),Vl.frontCCW=new Vl(!0,1028,aw);class Sf extends Gh{constructor(o,u,f){super(),this.id=o,this._onlySymbols=f,u.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new _R(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new gR,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const u=this._tiles[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(o),f.prepare(this.map.style.imageManager)}}getIds(){return It(this._tiles).map(o=>o.tileID).sort(t2).map(o=>o.key)}getRenderableIds(o){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,o)&&u.push(this._tiles[f]);return o?u.sort((f,d)=>{const _=f.tileID,x=d.tileID,T=new W(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),P=new W(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||P.y-T.y||P.x-T.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(t2).map(f=>f.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,o,u)))}_tileLoaded(o,u,f,d){if(d)if(o.state="errored",d.status!==404)this._source.fire(new Sl(d,{tile:o}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Tl.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Hu("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let d=0;d<u.length;d++){const _=u[d];if(o.neighboringTiles&&o.neighboringTiles[_]){const x=this.getTileByID(_);f(o,x),f(x,o)}}function f(d,_){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-d.tileID.canonical.x;const T=_.tileID.canonical.y-d.tileID.canonical.y,P=Math.pow(2,d.tileID.canonical.z),C=_.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+P)===1?x+=P:Math.abs(x-P)===1&&(x-=P)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,x,T),d.neighboringTiles&&d.neighboringTiles[C]&&(d.neighboringTiles[C].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,f,d){for(const _ in this._tiles){let x=this._tiles[_];if(d[_]||!x.hasData()||x.tileID.overscaledZ<=u||x.tileID.overscaledZ>f)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>u+1;){const C=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[C.key],x&&x.hasData()&&(T=C)}let P=T;for(;P.overscaledZ>u;)if(P=P.scaledTo(P.overscaledZ-1),o[P.key]){d[T.key]=T;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=o.overscaledZ-1;f>=u;f--){const d=o.scaledTo(f),_=this._getLoadedTile(d);if(_)return _}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const f=Math.ceil(o.width/u)+1,d=Math.ceil(o.height/u)+1,_=Math.floor(f*d*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(o){const u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){const f={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+u),f[_.tileID.key]=_}this._tiles=f;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(o,u,f){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let d;this.updateCacheSize(o,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new Is(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(d=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(T=>this._source.hasTile(T)))):d=[];const _=this._updateRetainedTiles(d);if(r2(this._source.type)&&d.length!==0){const T={},P={},C=Object.keys(_);for(const R of C){const F=_[R],G=this._tiles[R];if(!G||G.fadeEndTime&&G.fadeEndTime<=Tl.now())continue;const q=this.findLoadedParent(F,Math.max(F.overscaledZ-Sf.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),T[q.tileID.key]=q.tileID),P[R]=F}const O=d[d.length-1].overscaledZ;for(const R in this._tiles){const F=this._tiles[R];if(_[R]||!F.hasData())continue;let G=F.tileID;for(;G.overscaledZ>O;){G=G.scaledTo(G.overscaledZ-1);const q=this._tiles[G.key];if(q&&q.hasData()&&P[G.key]){_[R]=F.tileID;break}}}for(const R in T)_[R]||(this._coveredTiles[R]=!0,_[R]=T[R])}for(const T in _)this._tiles[T].clearFadeHold();const x=function(T,P){const C=[];for(const O in T)O in P||C.push(O);return C}(this._tiles,_);for(const T of x){const P=this._tiles[T];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(o.length===0)return u;const f={},d=o.reduce((C,O)=>Math.min(C,O.overscaledZ),1/0),_=o[0].overscaledZ,x=Math.max(_-Sf.maxOverzooming,this._source.minzoom),T=Math.max(_+Sf.maxUnderzooming,this._source.minzoom),P={};for(const C of o){const O=this._addTile(C);u[C.key]=C,O.hasData()||d<this._source.maxzoom&&(P[C.key]=C)}this._retainLoadedChildren(P,d,T,u);for(const C of o){let O=this._tiles[C.key];if(O.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const F=C.children(this._source.maxzoom)[0],G=this.getTile(F);if(G&&G.hasData()){u[F.key]=F;continue}}else{const F=C.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let R=O.wasRequested();for(let F=C.overscaledZ-1;F>=x;--F){const G=C.scaledTo(F);if(f[G.key]||(f[G.key]=!0,O=this.getTile(G),!O&&R&&(O=this._addTile(G)),O&&(u[G.key]=G,R=O.wasRequested(),O.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let f,d=this._tiles[o].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){f=this._loadedParentTiles[d.key];break}u.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(f=this._getLoadedTile(_),f)break;d=_}for(const _ of u)this._loadedParentTiles[_]=f}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const f=!!u;if(!f){const d=this.map?this.map.painter:null;u=new nw(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u?(u.uses++,this._tiles[o.key]=u,f||this._source.fire(new Hu("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const f=u.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,f){const d=[],_=this.transform;if(!_)return d;const x=_.projection.name==="globe",T=vu(_.center.lng);for(const P in this._tiles){const C=this._tiles[P];if(f&&C.clearQueryDebugViz(),C.holdingForFade())continue;let O;if(x){const R=C.tileID.canonical;if(R.z===0){const F=[Math.abs(et(T,...Wm(R,-1))-T),Math.abs(et(T,...Wm(R,1))-T)];O=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(et(T,...Wm(R,-1))-T),Math.abs(et(T,...Wm(R,0))-T),Math.abs(et(T,...Wm(R,1))-T)];O=[F.indexOf(Math.min(...F))-1]}}else O=[0];for(const R of O){const F=o.containsTile(C,_,u,R);F&&d.push(F)}}return d}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(f=>this._tiles[f].tileID);for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(r2(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=Tl.now())return!0}return!1}setFeatureState(o,u,f){this._state.updateState(o=o||"_geojsonTileLayer",u,f)}removeFeatureState(o,u,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,f)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,f){const d=this._tiles[o];d&&d.setDependencies(u,f)}reloadTilesForDependencies(o,u){for(const f in this._tiles)this._tiles[f].hasDependency(o,u)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,u))}_preloadTiles(o,u){if(!this._sourceLoaded){const T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(o,u))};return void this._source.on("data",T)}const f=new Map,d=Array.isArray(o)?o:[o],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const T of d){const P=T.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of P)f.set(C.key,C);this.usedForTerrain&&T.updateElevation(!1)}bt(Array.from(f.values()),(T,P)=>{const C=new nw(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,O=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),P(O,C)})},u)}}function t2(l,o){const u=Math.abs(2*l.wrap)-+(l.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return l.overscaledZ-o.overscaledZ||f-u||o.canonical.y-l.canonical.y||o.canonical.x-l.canonical.x}function r2(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function Wm(l,o){const u=1<<l.z;return[l.x/u+o,(l.x+1)/u+o]}Sf.maxOverzooming=10,Sf.maxUnderzooming=3;class Gv{constructor(o,u,f){this._demTile=o,this._dem=this._demTile.dem,this._scale=u,this._offset=f}static create(o,u,f){const d=f||o.findDEMTileFor(u);if(!d||!d.dem)return;const _=d.dem,x=d.tileID,T=1<<u.canonical.z-x.canonical.z;return new Gv(d,d.tileSize/er/T,[(u.canonical.x/T-x.canonical.x)*_.dim,(u.canonical.y/T-x.canonical.y)*_.dim])}tileCoordToPixel(o,u){const f=u*this._scale+this._offset[1],d=Math.floor(o*this._scale+this._offset[0]),_=Math.floor(f);return new W(d,_)}getElevationAt(o,u,f,d){const _=o*this._scale+this._offset[0],x=u*this._scale+this._offset[1],T=Math.floor(_),P=Math.floor(x),C=this._dem;return d=!!d,f?Hr(Hr(C.get(T,P,d),C.get(T,P+1,d),x-P),Hr(C.get(T+1,P,d),C.get(T+1,P+1,d),x-P),_-T):C.get(T,P,d)}getElevationAtPixel(o,u,f){return this._dem.get(o,u,!!f)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Bl(1,o)*this._dem.stride}}class n2{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new rc(er,16,0),this.featureIndexArray=new pf,this.promoteId=u}insert(o,u,f,d,_,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,d,_,x);const P=this.grid;for(let C=0;C<u.length;C++){const O=u[C],R=[1/0,1/0,-1/0,-1/0];for(let F=0;F<O.length;F++){const G=O[F];R[0]=Math.min(R[0],G.x),R[1]=Math.min(R[1],G.y),R[2]=Math.max(R[2],G.x),R[3]=Math.max(R[3],G.y)}R[0]<er&&R[1]<er&&R[2]>=0&&R[3]>=0&&P.insert(T,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Gx(new Pv(this.rawTileData)).layers,this.sourceLayerCoder=new VI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,u,f,d){this.loadVTLayers();const _=o.params||{},x=Bp(_.filter),T=o.tileResult,P=o.transform,C=T.bufferedTilespaceBounds,O=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(q,K,re,he)=>CS(T.bufferedTilespaceGeometry,q,K,re,he));O.sort(vR);let R=null;P.elevation&&O.length>0&&(R=Gv.create(P.elevation,this.tileID));const F={};let G;for(let q=0;q<O.length;q++){const K=O[q];if(K===G)continue;G=K;const re=this.featureIndexArray.get(K);let he=null;this.loadMatchingFeature(F,re,x,_.layers,_.availableImages,u,f,d,(_e,fe,me,xe=0)=>(he||(he=uc(_e,this.tileID.canonical,o.tileTransform)),fe.queryIntersectsFeature(T,_e,me,he,this.z,o.transform,o.pixelPosMatrix,R,xe)))}return F}loadMatchingFeature(o,u,f,d,_,x,T,P,C){const{featureIndex:O,bucketIndex:R,sourceLayerIndex:F,layoutVertexArrayOffset:G}=u,q=this.bucketLayerIDs[R];if(d&&!function(_e,fe){for(let me=0;me<_e.length;me++)if(fe.indexOf(_e[me])>=0)return!0;return!1}(d,q))return;const K=this.sourceLayerCoder.decode(F),re=this.vtLayers[K].feature(O);if(f.needGeometry){const _e=wf(re,!0);if(!f.filter(new N(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!f.filter(new N(this.tileID.overscaledZ),re))return;const he=this.getId(re,K);for(let _e=0;_e<q.length;_e++){const fe=q[_e];if(d&&d.indexOf(fe)<0)continue;const me=x[fe];if(!me)continue;let xe={};he!==void 0&&P&&(xe=P.getState(me.sourceLayer||"_geojsonTileLayer",he));const ve=jt({},T[fe]);ve.paint=i2(ve.paint,me.paint,re,xe,_),ve.layout=i2(ve.layout,me.layout,re,xe,_);const Ue=!C||C(re,me,xe,G);if(!Ue)continue;const ke=new jI(re,this.z,this.x,this.y,he);ke.layer=ve;let Je=o[fe];Je===void 0&&(Je=o[fe]=[]),Je.push({featureIndex:O,feature:ke,intersectionZ:Ue})}}lookupSymbolFeatures(o,u,f,d,_,x,T,P){const C={};this.loadVTLayers();const O=Bp(_);for(const R of o)this.loadMatchingFeature(C,{bucketIndex:f,sourceLayerIndex:d,featureIndex:R,layoutVertexArrayOffset:0},O,x,T,P,u);return C}loadFeature(o){const{featureIndex:u,sourceLayerIndex:f}=o;this.loadVTLayers();const d=this.sourceLayerCoder.decode(f),_=this.vtFeatures[d];if(_[u])return _[u];const x=this.vtLayers[d].feature(u);return _[u]=x,x}hasLayer(o){for(const u of this.bucketLayerIDs)for(const f of u)if(o===f)return!0;return!1}getId(o,u){let f=o.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[u];d!=null&&(f=o.properties[d]),typeof f=="boolean"&&(f=Number(f))}return f}}function i2(l,o,u,f,d){return nr(l,(_,x)=>{const T=o instanceof ce?o.get(x):null;return T&&T.evaluate?T.evaluate(u,f,d):T})}function vR(l,o){return o-l}Bt(n2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class o2{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.image=new cc({width:o,height:u}),this.positions={},this.uploaded=!1}getDash(o,u){const f=this.getKey(o,u);return this.positions[f]}trim(){const o=this.width,u=this.height=Ar(this.nextRow);this.image.resize({width:o,height:u})}getKey(o,u){return o.join(",")+u}getDashRanges(o,u,f){const d=[];let _=o.length%2==1?-o[o.length-1]*f:0,x=o[0]*f,T=!0;d.push({left:_,right:x,isDash:T,zeroLength:o[0]===0});let P=o[0];for(let C=1;C<o.length;C++){T=!T;const O=o[C];_=P*f,P+=O,x=P*f,d.push({left:_,right:x,isDash:T,zeroLength:O===0})}return d}addRoundDash(o,u,f){const d=u/2;for(let _=-f;_<=f;_++){const x=this.width*(this.nextRow+f+_);let T=0,P=o[T];for(let C=0;C<this.width;C++){C/P.right>1&&(P=o[++T]);const O=Math.abs(C-P.left),R=Math.abs(C-P.right),F=Math.min(O,R);let G;const q=_/f*(d+1);if(P.isDash){const K=d-Math.abs(q);G=Math.sqrt(F*F+K*K)}else G=d-Math.sqrt(F*F+q*q);this.image.data[x+C]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(o,u){for(let P=o.length-1;P>=0;--P){const C=o[P],O=o[P+1];C.zeroLength?o.splice(P,1):O&&O.isDash===C.isDash&&(O.left=C.left,o.splice(P,1))}const f=o[0],d=o[o.length-1];f.isDash===d.isDash&&(f.left=d.left-this.width,d.right=f.right+this.width);const _=this.width*this.nextRow;let x=0,T=o[x];for(let P=0;P<this.width;P++){P/T.right>1&&(T=o[++x]);const C=Math.abs(P-T.left),O=Math.abs(P-T.right),R=Math.min(C,O);this.image.data[_+P]=Math.max(0,Math.min(255,(T.isDash?R:-R)+u+128))}}addDash(o,u){const f=this.getKey(o,u);if(this.positions[f])return this.positions[f];const d=u==="round",_=d?7:0,x=2*_+1;if(this.nextRow+x>this.height)return Qe("LineAtlas out of space"),null;o.length===0&&o.push(1);let T=0;for(let O=0;O<o.length;O++)o[O]<0&&(Qe("Negative value is found in line dasharray, replacing values with 0"),o[O]=0),T+=o[O];if(T!==0){const O=this.width/T,R=this.getDashRanges(o,this.width,O);d?this.addRoundDash(R,O,_):this.addRegularDash(R,u==="square"?.5*O:0)}const P=this.nextRow+_;this.nextRow+=x;const C={tl:[P,_],br:[T,0]};return this.positions[f]=C,C}}Bt(o2,"LineAtlas");const s2=1*Gl;class a2{constructor(o){const u={},f=[];for(const T in o){const P=o[T],C=u[T]={};for(const O in P.glyphs){const R=P.glyphs[+O];if(!R||R.bitmap.width===0||R.bitmap.height===0)continue;const F=R.metrics.localGlyph?s2:1,G={x:0,y:0,w:R.bitmap.width+2*F,h:R.bitmap.height+2*F};f.push(G),C[O]=G}}const{w:d,h:_}=$x(f),x=new cc({width:d||1,height:_||1});for(const T in o){const P=o[T];for(const C in P.glyphs){const O=P.glyphs[+C];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;const R=u[T][C],F=O.metrics.localGlyph?s2:1;cc.copy(O.bitmap,x,{x:0,y:0},{x:R.x+F,y:R.y+F},O.bitmap)}}this.image=x,this.positions=u}}Bt(a2,"GlyphAtlas");class xR{constructor(o){this.tileID=new Is(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Tf(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,u,f,d,_){this.status="parsing",this.data=o,this.collisionBoxArray=new Zn;const x=new VI(Object.keys(o.layers).sort()),T=new n2(this.tileID,this.promoteId);T.bucketLayerIDs=[];const P={},C=new o2(256,256),O={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:f},R=u.familiesBySource[this.source];for(const xe in R){const ve=o.layers[xe];if(!ve)continue;let Ue=!1,ke=!1;for(const je of R[xe])je[0].type==="symbol"?Ue=!0:ke=!0;if(this.isSymbolTile===!0&&!Ue||this.isSymbolTile===!1&&!ke)continue;ve.version===1&&Qe(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Je=x.encode(xe),ht=[];for(let je=0;je<ve.length;je++){const nt=ve.feature(je),it=T.getId(nt,xe);ht.push({feature:nt,id:it,index:je,sourceLayerIndex:Je})}for(const je of R[xe]){const nt=je[0];this.isSymbolTile!==void 0&&nt.type==="symbol"!==this.isSymbolTile||nt.minzoom&&this.zoom<Math.floor(nt.minzoom)||nt.maxzoom&&this.zoom>=nt.maxzoom||nt.visibility!=="none"&&(lw(je,this.zoom,f),(P[nt.id]=nt.createBucket({index:T.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Je,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(ht,O,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(je.map(it=>it.id)))}}let F,G,q,K;C.trim();const re={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},he=()=>{if(F)return _(F);if(G&&q&&K){const xe=new a2(G),ve=new dI(q,K);for(const Ue in P){const ke=P[Ue];ke instanceof lh?(lw(ke.layers,this.zoom,f),ZN(ke,G,xe.positions,q,ve.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof Tv||ke instanceof vv||ke instanceof km)&&(lw(ke.layers,this.zoom,f),ke.addFeatures(O,this.tileID.canonical,ve.patternPositions,f,this.tileTransform))}this.status="done",_(null,{buckets:It(P).filter(Ue=>!Ue.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:C,imageAtlas:ve,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?q:null,glyphPositions:this.returnDependencies?xe.positions:null})}},_e=nr(O.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(_e).length?d.send("getGlyphs",{uid:this.uid,stacks:_e},(xe,ve)=>{F||(F=xe,G=ve,he())},void 0,!1,re):G={};const fe=Object.keys(O.iconDependencies);fe.length?d.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"icons"},(xe,ve)=>{F||(F=xe,q=ve,he())},void 0,!1,re):q={};const me=Object.keys(O.patternDependencies);me.length?d.send("getImages",{icons:me,source:this.source,tileID:this.tileID,type:"patterns"},(xe,ve)=>{F||(F=xe,K=ve,he())},void 0,!1,re):K={},he()}}function lw(l,o,u){const f=new N(o);for(const d of l)d.recalculate(f,u)}class l2{constructor(o){this.entries={},this.scheduler=o}request(o,u,f,d){const _=this.entries[o]=this.entries[o]||{callbacks:[]};if(_.result){const[x,T]=_.result;return this.scheduler?this.scheduler.add(()=>{d(x,T)},u):d(x,T),()=>{}}return _.callbacks.push(d),_.cancel||(_.cancel=f((x,T)=>{_.result=[x,T];for(const P of _.callbacks)this.scheduler?this.scheduler.add(()=>{P(x,T)},u):P(x,T);setTimeout(()=>delete this.entries[o],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==d),_.callbacks.length||(_.cancel(),delete this.entries[o]))}}}function u2(l,o,u){const f=JSON.stringify(l.request);return l.data&&(this.deduped.entries[f]={result:[null,l.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},d=>{const _=bl(l.request,(x,T,P,C)=>{x?d(x):T&&d(null,{vectorTile:u?void 0:new Gx(new Pv(T)),rawData:T,cacheControl:P,expires:C})});return()=>{_.cancel(),d()}},o)}const c2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uw{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(o,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=f>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=c2[15&f];if(!_)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(o,2,1),[T]=new Uint32Array(o,4,1);return new uw(T,x,_,o)}constructor(o,u=64,f=Float64Array,d){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const _=c2.indexOf(this.ArrayType),x=2*o*this.ArrayType.BYTES_PER_ELEMENT,T=o*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${f}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+P,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+P),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+P,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=o)}add(o,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=u,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return cw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,u,f,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:T}=this,P=[0,_.length-1,0],C=[];for(;P.length;){const O=P.pop()||0,R=P.pop()||0,F=P.pop()||0;if(R-F<=T){for(let re=F;re<=R;re++){const he=x[2*re],_e=x[2*re+1];he>=o&&he<=f&&_e>=u&&_e<=d&&C.push(_[re])}continue}const G=F+R>>1,q=x[2*G],K=x[2*G+1];q>=o&&q<=f&&K>=u&&K<=d&&C.push(_[G]),(O===0?o<=q:u<=K)&&(P.push(F),P.push(G-1),P.push(1-O)),(O===0?f>=q:d>=K)&&(P.push(G+1),P.push(R),P.push(1-O))}return C}within(o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:x}=this,T=[0,d.length-1,0],P=[],C=f*f;for(;T.length;){const O=T.pop()||0,R=T.pop()||0,F=T.pop()||0;if(R-F<=x){for(let re=F;re<=R;re++)f2(_[2*re],_[2*re+1],o,u)<=C&&P.push(d[re]);continue}const G=F+R>>1,q=_[2*G],K=_[2*G+1];f2(q,K,o,u)<=C&&P.push(d[G]),(O===0?o-f<=q:u-f<=K)&&(T.push(F),T.push(G-1),T.push(1-O)),(O===0?o+f>=q:u+f>=K)&&(T.push(G+1),T.push(R),T.push(1-O))}return P}}function cw(l,o,u,f,d,_){if(d-f<=u)return;const x=f+d>>1;h2(l,o,x,f,d,_),cw(l,o,u,f,x-1,1-_),cw(l,o,u,x+1,d,1-_)}function h2(l,o,u,f,d,_){for(;d>f;){if(d-f>600){const C=d-f+1,O=u-f+1,R=Math.log(C),F=.5*Math.exp(2*R/3),G=.5*Math.sqrt(R*F*(C-F)/C)*(O-C/2<0?-1:1);h2(l,o,u,Math.max(f,Math.floor(u-O*F/C+G)),Math.min(d,Math.floor(u+(C-O)*F/C+G)),_)}const x=o[2*u+_];let T=f,P=d;for(Hm(l,o,f,u),o[2*d+_]>x&&Hm(l,o,f,d);T<P;){for(Hm(l,o,T,P),T++,P--;o[2*T+_]<x;)T++;for(;o[2*P+_]>x;)P--}o[2*f+_]===x?Hm(l,o,f,P):(P++,Hm(l,o,P,d)),P<=u&&(f=P+1),u<=P&&(d=P-1)}}function Hm(l,o,u,f){hw(l,u,f),hw(o,2*u,2*f),hw(o,2*u+1,2*f+1)}function hw(l,o,u){const f=l[o];l[o]=l[u],l[u]=f}function f2(l,o,u,f){const d=l-u,_=o-f;return d*d+_*_}s.ARRAY_TYPE=ia,s.AUTH_ERR_MSG=we,s.Aabb=Ss,s.Actor=class{constructor(l,o,u){this.target=l,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Xr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Mt()?l:g,this.scheduler=new pR}send(l,o,u,f,d=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[x]=u);const T=xt(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:l,hasCallback:!!u,targetMapId:f,mustQueue:d,sourceMapId:this.mapId,data:eh(o,T)},T),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(l){const o=l.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||Mt()){const f=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"})}else this.processTask(u,o)}processTask(l,o){if(o.type==="<response>"){const u=this.callbacks[l];delete this.callbacks[l],u&&(o.error?u(nc(o.error)):u(null,nc(o.data)))}else{const u=xt(this.globalScope)?void 0:[],f=o.hasCallback?(_,x)=>{delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:_?eh(_):null,data:eh(x,u)},u)}:_=>{},d=nc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,d,f);else if(this.parent.getWorkerSource){const _=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,_[0],d.source)[_[1]](d,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=bv,s.Color=Bi,s.ColorMode=bu,s.CullFaceMode=Vl,s.DEMData=Uv,s.DataConstantProperty=X,s.DedupedRequest=l2,s.DepthMode=cd,s.EXTENT=er,s.Elevation=class{isDataAvailableAtPoint(l){const o=this._source();if(this.isUsingMockSource()||!o||l.y<0||l.y>1)return!1;const u=o.getSource().maxzoom,f=1<<u,d=Math.floor(l.x),_=Math.floor((l.x-d)*f),x=Math.floor(l.y*f),T=this.findDEMTileFor(new Is(u,d,u,_,x));return!(!T||!T.dem)}getAtPointOrZero(l,o=0){return this.getAtPoint(l,o)||0}getAtPoint(l,o,u=!0){if(this.isUsingMockSource())return null;o==null&&(o=null);const f=this._source();if(!f||l.y<0||l.y>1)return o;const d=f.getSource().maxzoom,_=1<<d,x=Math.floor(l.x),T=l.x-x,P=new Is(d,x,d,Math.floor(T*_),Math.floor(l.y*_)),C=this.findDEMTileFor(P);if(!C||!C.dem)return o;const O=C.dem,R=1<<C.tileID.canonical.z,F=(T*R-C.tileID.canonical.x)*O.dim,G=(l.y*R-C.tileID.canonical.y)*O.dim,q=Math.floor(F),K=Math.floor(G);return(u?this.exaggeration():1)*Hr(Hr(O.get(q,K),O.get(q,K+1),G-K),Hr(O.get(q+1,K),O.get(q+1,K+1),G-K),F-q)}getAtTileOffset(l,o,u){const f=1<<l.canonical.z;return this.getAtPointOrZero(new Kp(l.wrap+(l.canonical.x+o/er)/f,(l.canonical.y+u/er)/f))}getAtTileOffsetFunc(l,o,u,f){return d=>{const _=this.getAtTileOffset(l,d.x,d.y),x=f.upVector(l.canonical,d.x,d.y);return Ca(x,x,_*f.upVectorScale(l.canonical,o,u).metersToTile),x}}getForTilePoints(l,o,u,f){if(this.isUsingMockSource())return!1;const d=Gv.create(this,l,f);return!!d&&(o.forEach(_=>{_[2]=this.exaggeration()*d.getElevationAt(_[0],_[1],u)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(l);if(!o||!o.dem)return null;const u=o.dem.tree,f=o.tileID,d=1<<l.canonical.z-f.canonical.z;let _=l.canonical.x/d-f.canonical.x,x=l.canonical.y/d-f.canonical.y,T=0;for(let P=0;P<l.canonical.z-f.canonical.z&&!u.leaves[T];P++){_*=2,x*=2;const C=2*Math.floor(x)+Math.floor(_);T=u.childOffsets[T]+C,_%=1,x%=1}return{min:this.exaggeration()*u.minimums[T],max:this.exaggeration()*u.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,o,u){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Sl,s.EvaluationParameters=N,s.Event=Hu,s.Evented=Gh,s.FillExtrusionBucket=km,s.Frustum=_x,s.FrustumCorners=yx,s.GLOBE_RADIUS=yu,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=hS,s.GLOBE_ZOOM_THRESHOLD_MIN=vx,s.GlobeSharedBuffers=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const l of this._wireframeSegments)l.destroy()}}_fillGridMeshWithLods(l,o){const u=new ct,f=new Xt,d=[],_=l+1+2,x=o[0]+1,T=o[0]+1+(1+o.length),P=(C,O,R)=>{let F=C===_-1?C-2:C===0?C:C-1;return F+=R?24575:0,[F,O]};for(let C=0;C<_;++C)u.emplaceBack(...P(C,0,!0));for(let C=0;C<x;++C)for(let O=0;O<_;++O)u.emplaceBack(...P(O,C,(O===0||O===_-1)&&!0));for(let C=0;C<o.length;++C){const O=o[C];for(let R=0;R<_;++R)u.emplaceBack(...P(R,O,!0))}for(let C=0;C<o.length;++C){const O=f.length,R=o[C]+1+2,F=new Xt;for(let K=0;K<R-1;K++){const re=K===R-2,he=re?_*(T-o.length+C-K):_;for(let _e=0;_e<_-1;_e++){const fe=K*_+_e;K===0||re||_e===0||_e===_-2?(F.emplaceBack(fe+1,fe,fe+he),F.emplaceBack(fe+he,fe+he+1,fe+1)):(f.emplaceBack(fe+1,fe,fe+he),f.emplaceBack(fe+he,fe+he+1,fe+1))}}const G=Hi.simpleSegment(0,O,u.length,f.length-O);for(let K=0;K<F.uint16.length;K+=3)f.emplaceBack(F.uint16[K],F.uint16[K+1],F.uint16[K+2]);const q=Hi.simpleSegment(0,O,u.length,f.length-O);d.push({withoutSkirts:G,withSkirts:q})}return{vertices:u,indices:f,segments:d}}_createGrid(l){const o=this._fillGridMeshWithLods(vf,Im);this._gridSegments=o.segments,this._gridBuffer=l.createVertexBuffer(o.vertices,Sm.members),this._gridIndexBuffer=l.createIndexBuffer(o.indices,!0)}_createPoles(l){const o=new Xt;for(let d=0;d<=vf;d++)o.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=l.createIndexBuffer(o,!0);const u=new $n,f=new $n;this._poleSegments=[];for(let d=0,_=0;d<vx;d++){const x=360/(1<<d);u.emplaceBack(0,-yu,0,.5,0),f.emplaceBack(0,-yu,0,.5,1);for(let T=0;T<=vf;T++){const P=T/vf,C=Hr(0,x,P),[O,R,F]=Xp(p3,d3,C,yu);u.emplaceBack(O,R,F,P,0),f.emplaceBack(O,R,F,P,1)}this._poleSegments.push(Hi.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(u,uS,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(f,uS,!1)}getGridBuffers(l,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}getWirefameBuffers(l,o){if(!this._wireframeSegments){const u=new Eo,f=vf,d=f+1+2,_=1;this._wireframeSegments=[];for(let x=0,T=0;x<Im.length;x++){const P=Im[x];for(let O=_;O<P+_;O++)for(let R=_;R<f+_;R++){const F=O*d+R;u.emplaceBack(F,F+1),u.emplaceBack(F,F+d),u.emplaceBack(F,F+d+1)}const C=P*f*3;this._wireframeSegments.push(Hi.simpleSegment(0,T,(P+1)*d,C)),T+=C}this._wireframeIndexBuffer=l.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},s.GlyphManager=od,s.ImagePosition=Zx,s.KDBush=uw,s.LivePerformanceUtils=B1,s.LngLat=Xn,s.LngLatBounds=ih,s.LocalGlyphMode=Hx,s.MAX_MERCATOR_LATITUDE=Yo,s.MercatorCoordinate=Kp,s.ONE_EM=Fo,s.OverscaledTileID=Is,s.PerformanceMarkers=Fc,s.Point=W,s.Properties=de,s.RGBAImage=oa,s.Ray=mx,s.RequestManager=class{constructor(l,o,u){this._transformRequestFn=l,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const l=function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",D,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,o){return this._transformRequestFn&&this._transformRequestFn(l,o)||{url:l}}normalizeStyleURL(l,o){if(!Pe(l))return l;const u=Tt(l);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(l,o){if(!Pe(l))return l;const u=Tt(l);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(l,o,u,f){if(!Pe(l))return l;const d=Tt(l);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),u&&d.params.push(`language=${u}`),f&&d.params.push(`worldview=${f}`),this._makeAPIURL(d,this._customAccessToken||o)}normalizeSpriteURL(l,o,u,f){const d=Tt(l);return Pe(l)?(d.path=`/styles/v1${d.path}/sprite${o}${u}`,this._makeAPIURL(d,this._customAccessToken||f)):(d.path+=`${o}${u}`,dt(d))}normalizeTileURL(l,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!Pe(l))return l;const f=Tt(l);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&f.authority!=="raster"&&u===512?"@2x":""}${I.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${b.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${b.TILE_URL_VERSION}${f.path}`);const d=this._customAccessToken||function(_){for(const x of _){const T=x.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(f.params)||b.ACCESS_TOKEN;return b.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,d)}canonicalizeTileURL(l,o){const u=Tt(l);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return l;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${b.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${b.TILE_URL_VERSION}/`,"")}`;let d=u.params;return o&&(d=d.filter(_=>!_.match(/^access_token=/))),d.length&&(f+=`?${d.join("&")}`),f}canonicalizeTileset(l,o){const u=!!o&&Pe(o),f=[];for(const d of l.tiles||[])Ne(d)?f.push(this.canonicalizeTileURL(d,u)):f.push(d);return f}_makeAPIURL(l,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Tt(b.API_URL);if(l.protocol=f.protocol,l.authority=f.authority,l.protocol==="http"){const d=l.params.indexOf("secure");d>=0&&l.params.splice(d,1)}if(f.path!=="/"&&(l.path=`${f.path}${l.path}`),!b.REQUIRE_ACCESS_TOKEN)return dt(l);if(o=o||b.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return l.params=l.params.filter(d=>d.indexOf("access_token")===-1),l.params.push(`access_token=${o||""}`),dt(l)}},s.ResourceType=zs,s.SegmentVector=Hi,s.SourceCache=Sf,s.StencilMode=ow,s.StructArrayLayout1ui2=na,s.StructArrayLayout2f1f2i16=or,s.StructArrayLayout2i4=ct,s.StructArrayLayout2ui4=Eo,s.StructArrayLayout3f12=Dr,s.StructArrayLayout3ui6=Xt,s.StructArrayLayout4i8=rt,s.StructArrayLayout5f20=$n,s.Texture=Xm,s.Tile=nw,s.Transitionable=$,s.Uniform1f=sv,s.Uniform1i=class extends sc{constructor(l){super(l),this.current=0}set(l,o,u){this.fetchUniformLocation(l,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},s.Uniform2f=class extends sc{constructor(l){super(l),this.current=[0,0]}set(l,o,u){this.fetchUniformLocation(l,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},s.Uniform3f=class extends sc{constructor(l){super(l),this.current=[0,0,0]}set(l,o,u){this.fetchUniformLocation(l,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},s.Uniform4f=ZT,s.UniformColor=XT,s.UniformMatrix2f=class extends sc{constructor(l){super(l),this.current=YD}set(l,o,u){if(this.fetchUniformLocation(l,o)){for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}},s.UniformMatrix3f=class extends sc{constructor(l){super(l),this.current=KD}set(l,o,u){if(this.fetchUniformLocation(l,o)){for(let f=0;f<9;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}}},s.UniformMatrix4f=class extends sc{constructor(l){super(l),this.current=HD}set(l,o,u){if(this.fetchUniformLocation(l,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},s.UnwrappedTileID=QS,s.ValidationError=Rt,s.VectorTileFeature=wv,s.VectorTileWorkerSource=class extends Gh{constructor(l,o,u,f,d){super(),this.actor=l,this.layerIndex=o,this.availableImages=u,this.loadVectorData=d||u2,this.loading={},this.loaded={},this.deduped=new l2(l.scheduler),this.isSpriteLoaded=f,this.scheduler=l.scheduler}loadTile(l,o){const u=l.uid,f=l&&l.request,d=f&&f.collectResourceTiming,_=this.loading[u]=new xR(l);_.abort=this.loadVectorData(l,(x,T)=>{const P=!this.loading[u];if(delete this.loading[u],P||x||!T)return _.status="done",P||(this.loaded[u]=_),o(x);const C=T.rawData,O={};T.expires&&(O.expires=T.expires),T.cacheControl&&(O.cacheControl=T.cacheControl),_.vectorTile=T.vectorTile||new Gx(new Pv(C));const R=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,G)=>{if(F||!G)return o(F);const q={};if(d){const K=Eg(f);K.length>0&&(q.resourceTiming=JSON.parse(JSON.stringify(K)))}o(null,jt({rawTileData:C.slice(0)},G,O,q))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[u]=_})}reloadTile(l,o){const u=this.loaded,f=l.uid,d=this;if(u&&u[f]){const _=u[f];_.showCollisionBoxes=l.showCollisionBoxes,_.enableTerrain=!!l.enableTerrain,_.projection=l.projection,_.tileTransform=Tf(l.tileID.canonical,l.projection);const x=(T,P)=>{const C=_.reloadCallback;C&&(delete _.reloadCallback,_.parse(_.vectorTile,d.layerIndex,this.availableImages,d.actor,C)),o(T,P)};_.status==="parsing"?_.reloadCallback=x:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(l,o){const u=l.uid,f=this.loading[u];f&&(f.abort&&f.abort(),delete this.loading[u]),o()}removeTile(l,o){const u=this.loaded,f=l.uid;u&&u[f]&&delete u[f],o()}},s.WritingMode=Ma,s.ZoomDependentExpression=sf,s.add=lc,s.addDynamicAttributes=Fv,s.adjoint=function(l,o){var u=o[0],f=o[1],d=o[2],_=o[3],x=o[4],T=o[5],P=o[6],C=o[7],O=o[8];return l[0]=x*O-T*C,l[1]=d*C-f*O,l[2]=f*T-d*x,l[3]=T*P-_*O,l[4]=u*O-d*P,l[5]=d*_-u*T,l[6]=_*C-x*P,l[7]=f*P-u*C,l[8]=u*x-f*_,l},s.asyncAll=bt,s.bezier=at,s.bindAll=Xr,s.boundsAttributes=$I,s.bufferConvexPolygon=function(l,o){const u=[];for(let f=0;f<l.length;f++){const d=mt(f-1,-1,l.length-1),_=mt(f+1,-1,l.length-1),x=l[f],T=l[_],P=l[d].sub(x).unit(),C=T.sub(x).unit(),O=C.angleWithSep(P.x,P.y),R=P.add(C).unit().mult(-1*o/Math.sin(O/2));u.push(x.add(R))}return u},s.cacheEntryPossiblyAdded=function(l){pu++,pu>Mr&&(l.getActor().send("enforceCacheSizeLimit",fr),pu=0)},s.calculateGlobeLabelMatrix=function(l,o){const{x:u,y:f}=l.point,d=mS(u,f,l.worldSize/l._pixelsPerMercatorPixel,0,0);return mf(d,d,Ex(_u(o)))},s.calculateGlobeMatrix=function(l){const{x:o,y:u}=l.point,{lng:f,lat:d}=l._center;return mS(o,u,l.worldSize,f,d)},s.calculateGlobeMercatorMatrix=function(l){const o=l.pixelsPerMeter,u=o/Bl(1,l.center.lat),f=Fl(new Float64Array(16));return vm(f,f,[l.point.x,l.point.y,0]),yf(f,f,[u,u,o]),Float32Array.from(f)},s.circumferenceAtLatitude=Tx,s.clamp=et,s.clearTileCache=function(l){if(!di())return;const o=g.caches.delete(Qt);l&&o.catch(l).then(()=>l())},s.clipLine=PI,s.clone=function(l){var o=new ia(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},s.clone$1=Ce,s.collisionCircleLayout=_N,s.config=b,s.conjugate=function(l,o){return l[0]=-o[0],l[1]=-o[1],l[2]=-o[2],l[3]=o[3],l},s.create=function(){var l=new ia(16);return ia!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},s.create$1=KT,s.createExpression=Yc,s.createLayout=Ae,s.createStyleLayer=function(l){return l.type==="custom"?new uR(l):new hR[l.type](l)},s.cross=gx,s.degToRad=ze,s.distance=function(l,o){return Math.hypot(o[0]-l[0],o[1]-l[1],o[2]-l[2])},s.div=function(l,o,u){return l[0]=o[0]/u[0],l[1]=o[1]/u[1],l[2]=o[2]/u[2],l},s.dot=Ka,s.earthRadius=Am,s.ease=St,s.easeCubicInOut=Pt,s.ecefToLatLng=function([l,o,u]){const f=Math.hypot(l,o,u),d=Math.atan2(l,u),_=.5*Math.PI-Math.acos(-o/f);return new Xn(We(d),We(_))},s.emitValidationErrors=ev,s.endsWith=si,s.enforceCacheSizeLimit=function(l){co(),jr&&jr.then(o=>{o.keys().then(u=>{for(let f=0;f<u.length-l;f++)o.delete(u[f])})})},s.evaluateSizeForFeature=Sv,s.evaluateSizeForZoom=td,s.evaluateVariableOffset=OI,s.evented=E,s.exactEquals=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]&&l[3]===o[3]},s.exactEquals$1=function(l,o){return l[0]===o[0]&&l[1]===o[1]&&l[2]===o[2]},s.exported=Tl,s.exported$1=I,s.extend=jt,s.extend$1=Il,s.fillExtrusionHeightLift=KS,s.filterObject=Ee,s.fromMat4=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[4],l[4]=o[5],l[5]=o[6],l[6]=o[8],l[7]=o[9],l[8]=o[10],l},s.fromQuat=function(l,o){var u=o[0],f=o[1],d=o[2],_=o[3],x=u+u,T=f+f,P=d+d,C=u*x,O=f*x,R=f*T,F=d*x,G=d*T,q=d*P,K=_*x,re=_*T,he=_*P;return l[0]=1-R-q,l[1]=O+he,l[2]=F-re,l[3]=0,l[4]=O-he,l[5]=1-C-q,l[6]=G+K,l[7]=0,l[8]=F+re,l[9]=G-K,l[10]=1-C-R,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},s.fromRotation=function(l,o){var u=Math.sin(o),f=Math.cos(o);return l[0]=f,l[1]=u,l[2]=0,l[3]=-u,l[4]=f,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},s.fromScaling=JT,s.furthestTileCorner=function(l){const o=Math.round((l+45+360)%360/90)%4;return Ze[o]},s.getAABBPointSquareDist=function(l,o,u){let f=0;for(let d=0;d<2;++d){const _=u?u[d]:0;l[d]>_&&(f+=(l[d]-_)*(l[d]-_)),o[d]<_&&(f+=(_-o[d])*(_-o[d]))}return f},s.getAnchorAlignment=Wx,s.getAnchorJustification=Yx,s.getBounds=function(l){let o=1/0,u=1/0,f=-1/0,d=-1/0;for(const _ of l)o=Math.min(o,_.x),u=Math.min(u,_.y),f=Math.max(f,_.x),d=Math.max(d,_.y);return{min:new W(o,u),max:new W(f,d)}},s.getColumn=$t,s.getDefaultExportFromCjs=k,s.getGridMatrix=function(l,o,u,f){const d=o.getNorth(),_=o.getSouth(),x=o.getWest(),T=o.getEast(),P=1<<l.z,C=T-x,O=d-_,R=C/vf,F=-O/Im[u],G=[0,R,0,F,0,0,d,x,0];if(l.z>0){const q=180/f;YT(G,G,[q/C+1,0,0,0,q/O+1,0,-.5*q/R,.5*q/F,1])}return G[2]=P,G[5]=l.x,G[8]=l.y,G},s.getImage=ge,s.getJSON=function(l,o){return _o(jt(l,{type:"json"}),o)},s.getLatitudinalLod=function(l){const o=Yo-5;l=et(l,-o,o)/o*90;const u=Math.pow(Math.abs(Math.sin(ze(l))),3);return Math.round(u*(Im.length-1))},s.getMapSessionAPI=vo,s.getPerformanceMeasurement=Eg,s.getProjection=UI,s.getRTLTextPluginStatus=S,s.getReferrer=$i,s.getTilePoint=function(l,{x:o,y:u},f=0){return new W(((o-f)*l.scale-l.x)*er,(u*l.scale-l.y)*er)},s.getTileVec3=function(l,o,u=0){return Zp(((o.x-u)*l.scale-l.x)*er,(o.y*l.scale-l.y)*er,xS(o.z,o.y))},s.getVideo=function(l,o){const u=g.document.createElement("video");u.muted=!0,u.onloadstart=function(){o(null,u)};for(let f=0;f<l.length;f++){const d=g.document.createElement("source");dp(l[f])||(u.crossOrigin="Anonymous"),d.src=l[f],u.appendChild(d)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(l){const o=[0,0,0],u=Fl(new Float64Array(16));return mf(u,l.pixelMatrix,l.globeMatrix),Ui(o,o,u),new W(o[0],o[1])},s.globeDenormalizeECEF=Ex,s.globeECEFOrigin=function(l,o){const u=[0,0,0];return Ui(u,u,Cm(_u(o.canonical))),Ui(u,u,l),u},s.globeMetersToEcef=uv,s.globeNormalizeECEF=Cm,s.globePixelsToTileUnits=function(l,o){return er/(512*Math.pow(2,l))*hv(_u(o))},s.globePoleMatrixForTile=function(l,o,u){const f=Fl(new Float64Array(16)),d=(o/(1<<l)-.5)*Math.PI*2;return lv(f,u.globeMatrix,d),Float32Array.from(f)},s.globeTileBounds=_u,s.globeTiltAtLngLat=yS,s.globeToMercatorTransition=Hp,s.globeUseCustomAntiAliasing=function(l,o,u){const f=Hp(u.zoom),d=l.style.map._antialias,_=!!o.extStandardDerivatives,x=o.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return f===0&&!d&&!x&&_},s.identity=Fl,s.identity$1=sS,s.invert=hx,s.isFullscreen=function(){return!!g.document.fullscreenElement||!!g.document.webkitFullscreenElement},s.isLngLatBehindGlobe=bx,s.isMapAuthenticated=function(l){return hs.has(l)},s.isMapboxURL=Pe,s.isSafariWithAntialiasingBug=function(l){const o=l.navigator?l.navigator.userAgent:null;return!!xt(l)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Ko,s.latLngToECEF=Wp,s.len=s3,s.length=xm,s.length$1=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},s.lngFromMercatorX=Aa,s.loadVectorTile=u2,s.makeRequest=_o,s.mapValue=function(l,o,u,f,d){return et((l-o)/(u-o)*(d-f)+f,f,d)},s.mercatorScale=wS,s.mercatorXfromLng=vu,s.mercatorYfromLat=xu,s.mercatorZfromAltitude=Bl,s.mul=i3,s.mul$1=o3,s.multiply=mf,s.multiply$1=YT,s.multiply$2=tS,s.nextPowerOfTwo=Ar,s.normalize=Ts,s.normalize$1=a3,s.normalize$2=iS,s.number=Hr,s.ortho=function(l,o,u,f,d,_,x){var T=1/(o-u),P=1/(f-d),C=1/(_-x);return l[0]=-2*T,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*P,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*C,l[11]=0,l[12]=(o+u)*T,l[13]=(d+f)*P,l[14]=(x+_)*C,l[15]=1,l},s.pbf=sI,s.perspective=function(l,o,u,f,d){var _,x=1/Math.tan(o/2);return l[0]=x/u,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=x,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,d!=null&&d!==1/0?(l[10]=(d+f)*(_=1/(f-d)),l[14]=2*d*f*_):(l[10]=-1,l[14]=-2*f),l},s.pick=function(l,o){const u={};for(let f=0;f<o.length;f++){const d=o[f];d in l&&(u[d]=l[d])}return u},s.plugin=L,s.pointGeometry=ne,s.polesInViewport=function(l){const o=Fl(new Float64Array(16));mf(o,l.pixelMatrix,l.globeMatrix);const u=[0,Ya,0],f=[0,Ja,0];return Ui(u,u,o),Ui(f,f,o),[u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!bx(l,new Xn(l.center.lat,90)),f[0]>0&&f[0]<=l.width&&f[1]>0&&f[1]<=l.height&&!bx(l,new Xn(l.center.lat,-90))]},s.polygonContainsPoint=Ef,s.polygonIntersectsBox=CS,s.polygonIntersectsPolygon=TS,s.polygonizeBounds=function(l,o,u=0,f=!0){const d=new W(u,u),_=l.sub(d),x=o.add(d),T=[_,new W(x.x,_.y),x,new W(_.x,x.y)];return f&&T.push(_.clone()),T},s.posAttributes=Sm,s.postMapLoadEvent=Zi,s.postPerformanceEvent=lo,s.postTurnstileEvent=Vr,s.potpack=$x,s.prevPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},s.radToDeg=We,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(l){return l({pluginStatus:y,pluginURL:c}),E.on("pluginStateChange",l),l},s.removeAuthState=function(l){hs.delete(l)},s.renderColorRamp=Ox,s.resample=ES,s.rotateX=fx,s.rotateX$1=aS,s.rotateY=lv,s.rotateY$1=lS,s.rotateZ=function(l,o,u){var f=Math.sin(u),d=Math.cos(u),_=o[0],x=o[1],T=o[2],P=o[3],C=o[4],O=o[5],R=o[6],F=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=_*d+C*f,l[1]=x*d+O*f,l[2]=T*d+R*f,l[3]=P*d+F*f,l[4]=C*d-_*f,l[5]=O*d-x*f,l[6]=R*d-T*f,l[7]=F*d-P*f,l},s.rotateZ$1=function(l,o,u){u*=.5;var f=o[0],d=o[1],_=o[2],x=o[3],T=Math.sin(u),P=Math.cos(u);return l[0]=f*P+d*T,l[1]=d*P-f*T,l[2]=_*P+x*T,l[3]=x*P-_*T,l},s.scale=yf,s.scale$1=nS,s.scale$2=Ca,s.scaleAndAdd=bm,s.set=function(l,o,u,f){return l[0]=o,l[1]=u,l[2]=f,l},s.setCacheLimits=function(l,o){fr=l,Mr=o},s.setColumn=function(l,o,u){l[4*o+0]=u[0],l[4*o+1]=u[1],l[4*o+2]=u[2],l[4*o+3]=u[3]},s.setRTLTextPlugin=function(l,o,u=!1){if(y===dm||y===gm||y===mm)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=Tl.resolveURL(l),y=dm,th=o,v(),u||M()},s.smoothstep=zt,s.spec=Ye,s.squaredLength=function(l){var o=l[0],u=l[1],f=l[2];return o*o+u*u+f*f},s.storeAuthState=function(l,o){o?hs.add(l):hs.delete(l)},s.sub=zl,s.subtract=dx,s.symbolSize=vN,s.tileAABB=function(l,o,u,f,d,_,x,T,P){if(P.name==="globe")return f3(l,o,new bv(u,f,d));const C=Tf({z:u,x:f,y:d},P);return new Ss([(_+C.x/C.scale)*o,o*(C.y/C.scale),x],[(_+C.x2/C.scale)*o,o*(C.y2/C.scale),T])},s.tileCornersToBounds=cv,s.tileTransform=Tf,s.transformMat3=function(l,o,u){var f=o[0],d=o[1],_=o[2];return l[0]=f*u[0]+d*u[3]+_*u[6],l[1]=f*u[1]+d*u[4]+_*u[7],l[2]=f*u[2]+d*u[5]+_*u[8],l},s.transformMat4=Ui,s.transformMat4$1=_f,s.transformQuat=rS,s.transitionTileAABBinECEF=pS,s.translate=vm,s.transpose=function(l,o){if(l===o){var u=o[1],f=o[2],d=o[5];l[1]=o[3],l[2]=o[6],l[3]=u,l[5]=o[7],l[6]=f,l[7]=d}else l[0]=o[0],l[1]=o[3],l[2]=o[6],l[3]=o[1],l[4]=o[4],l[5]=o[7],l[6]=o[2],l[7]=o[5],l[8]=o[8];return l},s.triggerPluginCompletionEvent=p,s.uniqueId=yr,s.updateGlobeVertexNormal=function(l,o,u,f,d){const _=5*o+2;l.float32[_+0]=u,l.float32[_+1]=f,l.float32[_+2]=d},s.validateCustomStyleLayer=function(l){const o=[],u=l.id;return u===void 0&&o.push({message:`layers.${u}: missing required property "id"`}),l.render===void 0&&o.push({message:`layers.${u}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},s.validateFilter=l=>ra(hf(l)),s.validateFog=l=>ra(Y_(l)),s.validateLayer=l=>ra(X_(l)),s.validateLight=l=>ra(K_(l)),s.validateSource=l=>ra(H_(l)),s.validateStyle=Q_,s.validateTerrain=l=>ra(um(l)),s.values=It,s.vectorTile=xv,s.version=m,s.warnOnce=Qe,s.window=g,s.wrap=mt}),a(["./shared"],function(s){function g(ye){if(typeof ye=="number"||typeof ye=="boolean"||typeof ye=="string"||ye==null)return JSON.stringify(ye);if(Array.isArray(ye)){let Q="[";for(const ge of ye)Q+=`${g(ge)},`;return`${Q}]`}let J="{";for(const Q of Object.keys(ye).sort())J+=`${Q}:${g(ye[Q])},`;return`${J}}`}function m(ye){let J="";for(const Q of s.refProperties)J+=`/${g(ye[Q])}`;return J}class w{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,Q){for(const we of J)this._layerConfigs[we.id]=we,(this._layers[we.id]=s.createStyleLayer(we)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of Q)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ge=function(we,Pe){const Ne={};for(let Ie=0;Ie<we.length;Ie++){const qe=Pe&&Pe[we[Ie].id]||m(we[Ie]);Pe&&(Pe[we[Ie].id]=qe);let vt=Ne[qe];vt||(vt=Ne[qe]=[]),vt.push(we[Ie])}const De=[];for(const Ie in Ne)De.push(Ne[Ie]);return De}(s.values(this._layerConfigs),this.keyCache);for(const we of ge){const Pe=we.map(Tt=>this._layers[Tt.id]),Ne=Pe[0];if(Ne.visibility==="none")continue;const De=Ne.source||"";let Ie=this.familiesBySource[De];Ie||(Ie=this.familiesBySource[De]={});const qe=Ne.sourceLayer||"_geojsonTileLayer";let vt=Ie[qe];vt||(vt=Ie[qe]=[]),vt.push(Pe)}}}class b{loadTile(J,Q){const{uid:ge,encoding:we,rawImageData:Pe,padding:Ne,buildQuadTree:De}=J,Ie=s.window.ImageBitmap&&Pe instanceof s.window.ImageBitmap?this.getImageData(Pe,Ne):Pe;Q(null,new s.DEMData(ge,Ie,we,Ne<1,De))}getImageData(J,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const ge=this.offscreenCanvasContext.getImageData(-Q,-Q,J.width+2*Q,J.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}function I(ye,J){if(ye.length!==0){A(ye[0],J);for(var Q=1;Q<ye.length;Q++)A(ye[Q],!J)}}function A(ye,J){for(var Q=0,ge=0,we=0,Pe=ye.length,Ne=Pe-1;we<Pe;Ne=we++){var De=(ye[we][0]-ye[Ne][0])*(ye[Ne][1]+ye[we][1]),Ie=Q+De;ge+=Math.abs(Q)>=Math.abs(De)?Q-Ie+De:De-Ie+Q,Q=Ie}Q+ge>=0!=!!J&&ye.reverse()}var z=s.getDefaultExportFromCjs(function ye(J,Q){var ge,we=J&&J.type;if(we==="FeatureCollection")for(ge=0;ge<J.features.length;ge++)ye(J.features[ge],Q);else if(we==="GeometryCollection")for(ge=0;ge<J.geometries.length;ge++)ye(J.geometries[ge],Q);else if(we==="Feature")ye(J.geometry,Q);else if(we==="Polygon")I(J.coordinates,Q);else if(we==="MultiPolygon")for(ge=0;ge<J.coordinates.length;ge++)I(J.coordinates[ge],Q);return J});const V=s.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},Z=s.pointGeometry,D=s.vectorTile.VectorTileFeature,k=j;function j(ye,J){this.options=J||{},this.features=ye,this.length=ye.length}function Y(ye,J){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=J||4096}j.prototype.feature=function(ye){return new Y(this.features[ye],this.options.extent)},Y.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var J=0;J<ye.length;J++){for(var Q=ye[J],ge=[],we=0;we<Q.length;we++)ge.push(new Z(Q[we][0],Q[we][1]));this.geometry.push(ge)}return this.geometry},Y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,J=1/0,Q=-1/0,ge=1/0,we=-1/0,Pe=0;Pe<ye.length;Pe++)for(var Ne=ye[Pe],De=0;De<Ne.length;De++){var Ie=Ne[De];J=Math.min(J,Ie.x),Q=Math.max(Q,Ie.x),ge=Math.min(ge,Ie.y),we=Math.max(we,Ie.y)}return[J,ge,Q,we]},Y.prototype.toGeoJSON=D.prototype.toGeoJSON;var ie=s.pbf,ne=k;function ae(ye){var J=new ie;return function(Q,ge){for(var we in Q.layers)ge.writeMessage(3,W,Q.layers[we])}(ye,J),J.finish()}function W(ye,J){var Q;J.writeVarintField(15,ye.version||1),J.writeStringField(1,ye.name||""),J.writeVarintField(5,ye.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<ye.length;Q++)ge.feature=ye.feature(Q),J.writeMessage(2,$e,ge);var we=ge.keys;for(Q=0;Q<we.length;Q++)J.writeStringField(3,we[Q]);var Pe=ge.values;for(Q=0;Q<Pe.length;Q++)J.writeMessage(4,Pt,Pe[Q])}function $e(ye,J){var Q=ye.feature;Q.id!==void 0&&J.writeVarintField(1,Q.id),J.writeMessage(2,Oe,ye),J.writeVarintField(3,Q.type),J.writeMessage(4,Ze,Q)}function Oe(ye,J){var Q=ye.feature,ge=ye.keys,we=ye.values,Pe=ye.keycache,Ne=ye.valuecache;for(var De in Q.properties){var Ie=Q.properties[De],qe=Pe[De];if(Ie!==null){qe===void 0&&(ge.push(De),Pe[De]=qe=ge.length-1),J.writeVarint(qe);var vt=typeof Ie;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(Ie=JSON.stringify(Ie));var Tt=vt+":"+Ie,dt=Ne[Tt];dt===void 0&&(we.push(Ie),Ne[Tt]=dt=we.length-1),J.writeVarint(dt)}}}function ze(ye,J){return(J<<3)+(7&ye)}function We(ye){return ye<<1^ye>>31}function Ze(ye,J){for(var Q=ye.loadGeometry(),ge=ye.type,we=0,Pe=0,Ne=Q.length,De=0;De<Ne;De++){var Ie=Q[De],qe=1;ge===1&&(qe=Ie.length),J.writeVarint(ze(1,qe));for(var vt=ge===3?Ie.length-1:Ie.length,Tt=0;Tt<vt;Tt++){Tt===1&&ge!==1&&J.writeVarint(ze(2,vt-1));var dt=Ie[Tt].x-we,br=Ie[Tt].y-Pe;J.writeVarint(We(dt)),J.writeVarint(We(br)),we+=dt,Pe+=br}ge===3&&J.writeVarint(ze(7,1))}}function Pt(ye,J){var Q=typeof ye;Q==="string"?J.writeStringField(1,ye):Q==="boolean"?J.writeBooleanField(7,ye):Q==="number"&&(ye%1!=0?J.writeDoubleField(3,ye):ye<0?J.writeSVarintField(6,ye):J.writeVarintField(5,ye))}H.exports=ae,H.exports.fromVectorTileJs=ae,H.exports.fromGeojsonVt=function(ye,J){J=J||{};var Q={};for(var ge in ye)Q[ge]=new ne(ye[ge].features,J),Q[ge].name=ge,Q[ge].version=J.version,Q[ge].extent=J.extent;return ae({layers:Q})},H.exports.GeoJSONWrapper=ne;var at=s.getDefaultExportFromCjs(H.exports);const St={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},et=Math.fround||(zt=new Float32Array(1),ye=>(zt[0]=+ye,zt[0]));var zt;const mt=3,bt=5,It=6;class jt{constructor(J){this.options=Object.assign(Object.create(St),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:Q,minZoom:ge,maxZoom:we}=this.options;Q&&console.time("total time");const Pe=`prepare ${J.length} points`;Q&&console.time(Pe),this.points=J;const Ne=[];for(let Ie=0;Ie<J.length;Ie++){const qe=J[Ie];if(!qe.geometry)continue;const[vt,Tt]=qe.geometry.coordinates,dt=et(rr(vt)),br=et(Ar(Tt));Ne.push(dt,br,1/0,Ie,-1,1),this.options.reduce&&Ne.push(0)}let De=this.trees[we+1]=this._createTree(Ne);Q&&console.timeEnd(Pe);for(let Ie=we;Ie>=ge;Ie--){const qe=+Date.now();De=this.trees[Ie]=this._createTree(this._cluster(De,Ie)),Q&&console.log("z%d: %d clusters in %dms",Ie,De.numItems,+Date.now()-qe)}return Q&&console.timeEnd("total time"),this}getClusters(J,Q){let ge=((J[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,J[1]));let Pe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ge=-180,Pe=180;else if(ge>Pe){const Tt=this.getClusters([ge,we,180,Ne],Q),dt=this.getClusters([-180,we,Pe,Ne],Q);return Tt.concat(dt)}const De=this.trees[this._limitZoom(Q)],Ie=De.range(rr(ge),Ar(Ne),rr(Pe),Ar(we)),qe=De.data,vt=[];for(const Tt of Ie){const dt=this.stride*Tt;vt.push(qe[dt+bt]>1?Jt(qe,dt,this.clusterProps):this.points[qe[dt+mt]])}return vt}getChildren(J){const Q=this._getOriginId(J),ge=this._getOriginZoom(J),we="No cluster with the specified id.",Pe=this.trees[ge];if(!Pe)throw new Error(we);const Ne=Pe.data;if(Q*this.stride>=Ne.length)throw new Error(we);const De=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Ie=Pe.within(Ne[Q*this.stride],Ne[Q*this.stride+1],De),qe=[];for(const vt of Ie){const Tt=vt*this.stride;Ne[Tt+4]===J&&qe.push(Ne[Tt+bt]>1?Jt(Ne,Tt,this.clusterProps):this.points[Ne[Tt+mt]])}if(qe.length===0)throw new Error(we);return qe}getLeaves(J,Q,ge){const we=[];return this._appendLeaves(we,J,Q=Q||10,ge=ge||0,0),we}getTile(J,Q,ge){const we=this.trees[this._limitZoom(J)],Pe=Math.pow(2,J),{extent:Ne,radius:De}=this.options,Ie=De/Ne,qe=(ge-Ie)/Pe,vt=(ge+1+Ie)/Pe,Tt={features:[]};return this._addTileFeatures(we.range((Q-Ie)/Pe,qe,(Q+1+Ie)/Pe,vt),we.data,Q,ge,Pe,Tt),Q===0&&this._addTileFeatures(we.range(1-Ie/Pe,qe,1,vt),we.data,Pe,ge,Pe,Tt),Q===Pe-1&&this._addTileFeatures(we.range(0,qe,Ie/Pe,vt),we.data,-1,ge,Pe,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(J){let Q=this._getOriginZoom(J)-1;for(;Q<=this.options.maxZoom;){const ge=this.getChildren(J);if(Q++,ge.length!==1)break;J=ge[0].properties.cluster_id}return Q}_appendLeaves(J,Q,ge,we,Pe){const Ne=this.getChildren(Q);for(const De of Ne){const Ie=De.properties;if(Ie&&Ie.cluster?Pe+Ie.point_count<=we?Pe+=Ie.point_count:Pe=this._appendLeaves(J,Ie.cluster_id,ge,we,Pe):Pe<we?Pe++:J.push(De),J.length===ge)break}return Pe}_createTree(J){const Q=new s.KDBush(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<J.length;ge+=this.stride)Q.add(J[ge],J[ge+1]);return Q.finish(),Q.data=J,Q}_addTileFeatures(J,Q,ge,we,Pe,Ne){for(const De of J){const Ie=De*this.stride,qe=Q[Ie+bt]>1;let vt,Tt,dt;if(qe)vt=yr(Q,Ie,this.clusterProps),Tt=Q[Ie],dt=Q[Ie+1];else{const Tr=this.points[Q[Ie+mt]];vt=Tr.properties;const[Or,Vr]=Tr.geometry.coordinates;Tt=rr(Or),dt=Ar(Vr)}const br={type:1,geometry:[[Math.round(this.options.extent*(Tt*Pe-ge)),Math.round(this.options.extent*(dt*Pe-we))]],tags:vt};let Lr;Lr=qe||this.options.generateId?Q[Ie+mt]:this.points[Q[Ie+mt]].id,Lr!==void 0&&(br.id=Lr),Ne.features.push(br)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Q){const{radius:ge,extent:we,reduce:Pe,minPoints:Ne}=this.options,De=ge/(we*Math.pow(2,Q)),Ie=J.data,qe=[],vt=this.stride;for(let Tt=0;Tt<Ie.length;Tt+=vt){if(Ie[Tt+2]<=Q)continue;Ie[Tt+2]=Q;const dt=Ie[Tt],br=Ie[Tt+1],Lr=J.within(Ie[Tt],Ie[Tt+1],De),Tr=Ie[Tt+bt];let Or=Tr;for(const Vr of Lr){const Ei=Vr*vt;Ie[Ei+2]>Q&&(Or+=Ie[Ei+bt])}if(Or>Tr&&Or>=Ne){let Vr,Ei=dt*Tr,Zi=br*Tr,Xo=-1;const lo=((Tt/vt|0)<<5)+(Q+1)+this.points.length;for(const ja of Lr){const vo=ja*vt;if(Ie[vo+2]<=Q)continue;Ie[vo+2]=Q;const hs=Ie[vo+bt];Ei+=Ie[vo]*hs,Zi+=Ie[vo+1]*hs,Ie[vo+4]=lo,Pe&&(Vr||(Vr=this._map(Ie,Tt,!0),Xo=this.clusterProps.length,this.clusterProps.push(Vr)),Pe(Vr,this._map(Ie,vo)))}Ie[Tt+4]=lo,qe.push(Ei/Or,Zi/Or,1/0,lo,-1,Or),Pe&&qe.push(Xo)}else{for(let Vr=0;Vr<vt;Vr++)qe.push(Ie[Tt+Vr]);if(Or>1)for(const Vr of Lr){const Ei=Vr*vt;if(!(Ie[Ei+2]<=Q)){Ie[Ei+2]=Q;for(let Zi=0;Zi<vt;Zi++)qe.push(Ie[Ei+Zi])}}}}return qe}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Q,ge){if(J[Q+bt]>1){const Ne=this.clusterProps[J[Q+It]];return ge?Object.assign({},Ne):Ne}const we=this.points[J[Q+mt]].properties,Pe=this.options.map(we);return ge&&Pe===we?Object.assign({},Pe):Pe}}function Jt(ye,J,Q){return{type:"Feature",id:ye[J+mt],properties:yr(ye,J,Q),geometry:{type:"Point",coordinates:[(ge=ye[J],360*(ge-.5)),Ii(ye[J+1])]}};var ge}function yr(ye,J,Q){const ge=ye[J+bt],we=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Pe=ye[J+It],Ne=Pe===-1?{}:Object.assign({},Q[Pe]);return Object.assign(Ne,{cluster:!0,cluster_id:ye[J+mt],point_count:ge,point_count_abbreviated:we})}function rr(ye){return ye/360+.5}function Ar(ye){const J=Math.sin(ye*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function Ii(ye){const J=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Xr(ye,J,Q,ge){for(var we,Pe=ge,Ne=Q-J>>1,De=Q-J,Ie=ye[J],qe=ye[J+1],vt=ye[Q],Tt=ye[Q+1],dt=J+3;dt<Q;dt+=3){var br=si(ye[dt],ye[dt+1],Ie,qe,vt,Tt);if(br>Pe)we=dt,Pe=br;else if(br===Pe){var Lr=Math.abs(dt-Ne);Lr<De&&(we=dt,De=Lr)}}Pe>ge&&(we-J>3&&Xr(ye,J,we,ge),ye[we+2]=Pe,Q-we>3&&Xr(ye,we,Q,ge))}function si(ye,J,Q,ge,we,Pe){var Ne=we-Q,De=Pe-ge;if(Ne!==0||De!==0){var Ie=((ye-Q)*Ne+(J-ge)*De)/(Ne*Ne+De*De);Ie>1?(Q=we,ge=Pe):Ie>0&&(Q+=Ne*Ie,ge+=De*Ie)}return(Ne=ye-Q)*Ne+(De=J-ge)*De}function nr(ye,J,Q,ge){var we={id:ye===void 0?null:ye,type:J,geometry:Q,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var Ne=Pe.geometry,De=Pe.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ee(Pe,Ne);else if(De==="Polygon"||De==="MultiLineString")for(var Ie=0;Ie<Ne.length;Ie++)Ee(Pe,Ne[Ie]);else if(De==="MultiPolygon")for(Ie=0;Ie<Ne.length;Ie++)for(var qe=0;qe<Ne[Ie].length;qe++)Ee(Pe,Ne[Ie][qe])}(we),we}function Ee(ye,J){for(var Q=0;Q<J.length;Q+=3)ye.minX=Math.min(ye.minX,J[Q]),ye.minY=Math.min(ye.minY,J[Q+1]),ye.maxX=Math.max(ye.maxX,J[Q]),ye.maxY=Math.max(ye.maxY,J[Q+1])}function Ce(ye,J,Q,ge){if(J.geometry){var we=J.geometry.coordinates,Pe=J.geometry.type,Ne=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),De=[],Ie=J.id;if(Q.promoteId?Ie=J.properties[Q.promoteId]:Q.generateId&&(Ie=ge||0),Pe==="Point")Ke(we,De);else if(Pe==="MultiPoint")for(var qe=0;qe<we.length;qe++)Ke(we[qe],De);else if(Pe==="LineString")Qe(we,De,Ne,!1);else if(Pe==="MultiLineString"){if(Q.lineMetrics){for(qe=0;qe<we.length;qe++)Qe(we[qe],De=[],Ne,!1),ye.push(nr(Ie,"LineString",De,J.properties));return}ot(we,De,Ne,!1)}else if(Pe==="Polygon")ot(we,De,Ne,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(qe=0;qe<J.geometry.geometries.length;qe++)Ce(ye,{id:Ie,geometry:J.geometry.geometries[qe],properties:J.properties},Q,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<we.length;qe++){var vt=[];ot(we[qe],vt,Ne,!0),De.push(vt)}}ye.push(nr(Ie,Pe,De,J.properties))}}function Ke(ye,J){J.push(wt(ye[0])),J.push(Mt(ye[1])),J.push(0)}function Qe(ye,J,Q,ge){for(var we,Pe,Ne=0,De=0;De<ye.length;De++){var Ie=wt(ye[De][0]),qe=Mt(ye[De][1]);J.push(Ie),J.push(qe),J.push(0),De>0&&(Ne+=ge?(we*qe-Ie*Pe)/2:Math.sqrt(Math.pow(Ie-we,2)+Math.pow(qe-Pe,2))),we=Ie,Pe=qe}var vt=J.length-3;J[2]=1,Xr(J,0,vt,Q),J[vt+2]=1,J.size=Math.abs(Ne),J.start=0,J.end=J.size}function ot(ye,J,Q,ge){for(var we=0;we<ye.length;we++){var Pe=[];Qe(ye[we],Pe,Q,ge),J.push(Pe)}}function wt(ye){return ye/360+.5}function Mt(ye){var J=Math.sin(ye*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function _t(ye,J,Q,ge,we,Pe,Ne,De){if(ge/=J,Pe>=(Q/=J)&&Ne<ge)return ye;if(Ne<Q||Pe>=ge)return null;for(var Ie=[],qe=0;qe<ye.length;qe++){var vt=ye[qe],Tt=vt.geometry,dt=vt.type,br=we===0?vt.minX:vt.minY,Lr=we===0?vt.maxX:vt.maxY;if(br>=Q&&Lr<ge)Ie.push(vt);else if(!(Lr<Q||br>=ge)){var Tr=[];if(dt==="Point"||dt==="MultiPoint")Nt(Tt,Tr,Q,ge,we);else if(dt==="LineString")xt(Tt,Tr,Q,ge,we,!1,De.lineMetrics);else if(dt==="MultiLineString")$t(Tt,Tr,Q,ge,we,!1);else if(dt==="Polygon")$t(Tt,Tr,Q,ge,we,!0);else if(dt==="MultiPolygon")for(var Or=0;Or<Tt.length;Or++){var Vr=[];$t(Tt[Or],Vr,Q,ge,we,!0),Vr.length&&Tr.push(Vr)}if(Tr.length){if(De.lineMetrics&&dt==="LineString"){for(Or=0;Or<Tr.length;Or++)Ie.push(nr(vt.id,dt,Tr[Or],vt.tags));continue}dt!=="LineString"&&dt!=="MultiLineString"||(Tr.length===1?(dt="LineString",Tr=Tr[0]):dt="MultiLineString"),dt!=="Point"&&dt!=="MultiPoint"||(dt=Tr.length===3?"Point":"MultiPoint"),Ie.push(nr(vt.id,dt,Tr,vt.tags))}}}return Ie.length?Ie:null}function Nt(ye,J,Q,ge,we){for(var Pe=0;Pe<ye.length;Pe+=3){var Ne=ye[Pe+we];Ne>=Q&&Ne<=ge&&(J.push(ye[Pe]),J.push(ye[Pe+1]),J.push(ye[Pe+2]))}}function xt(ye,J,Q,ge,we,Pe,Ne){for(var De,Ie,qe=ir(ye),vt=we===0?fr:Mr,Tt=ye.start,dt=0;dt<ye.length-3;dt+=3){var br=ye[dt],Lr=ye[dt+1],Tr=ye[dt+2],Or=ye[dt+3],Vr=ye[dt+4],Ei=we===0?br:Lr,Zi=we===0?Or:Vr,Xo=!1;Ne&&(De=Math.sqrt(Math.pow(br-Or,2)+Math.pow(Lr-Vr,2))),Ei<Q?Zi>Q&&(Ie=vt(qe,br,Lr,Or,Vr,Q),Ne&&(qe.start=Tt+De*Ie)):Ei>ge?Zi<ge&&(Ie=vt(qe,br,Lr,Or,Vr,ge),Ne&&(qe.start=Tt+De*Ie)):Qt(qe,br,Lr,Tr),Zi<Q&&Ei>=Q&&(Ie=vt(qe,br,Lr,Or,Vr,Q),Xo=!0),Zi>ge&&Ei<=ge&&(Ie=vt(qe,br,Lr,Or,Vr,ge),Xo=!0),!Pe&&Xo&&(Ne&&(qe.end=Tt+De*Ie),J.push(qe),qe=ir(ye)),Ne&&(Tt+=De)}var lo=ye.length-3;br=ye[lo],Lr=ye[lo+1],Tr=ye[lo+2],(Ei=we===0?br:Lr)>=Q&&Ei<=ge&&Qt(qe,br,Lr,Tr),lo=qe.length-3,Pe&&lo>=3&&(qe[lo]!==qe[0]||qe[lo+1]!==qe[1])&&Qt(qe,qe[0],qe[1],qe[2]),qe.length&&J.push(qe)}function ir(ye){var J=[];return J.size=ye.size,J.start=ye.start,J.end=ye.end,J}function $t(ye,J,Q,ge,we,Pe){for(var Ne=0;Ne<ye.length;Ne++)xt(ye[Ne],J,Q,ge,we,Pe,!1)}function Qt(ye,J,Q,ge){ye.push(J),ye.push(Q),ye.push(ge)}function fr(ye,J,Q,ge,we,Pe){var Ne=(Pe-J)/(ge-J);return ye.push(Pe),ye.push(Q+(we-Q)*Ne),ye.push(1),Ne}function Mr(ye,J,Q,ge,we,Pe){var Ne=(Pe-Q)/(we-Q);return ye.push(J+(ge-J)*Ne),ye.push(Pe),ye.push(1),Ne}function jr(ye,J){for(var Q=[],ge=0;ge<ye.length;ge++){var we,Pe=ye[ge],Ne=Pe.type;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")we=Wr(Pe.geometry,J);else if(Ne==="MultiLineString"||Ne==="Polygon"){we=[];for(var De=0;De<Pe.geometry.length;De++)we.push(Wr(Pe.geometry[De],J))}else if(Ne==="MultiPolygon")for(we=[],De=0;De<Pe.geometry.length;De++){for(var Ie=[],qe=0;qe<Pe.geometry[De].length;qe++)Ie.push(Wr(Pe.geometry[De][qe],J));we.push(Ie)}Q.push(nr(Pe.id,Ne,we,Pe.tags))}return Q}function Wr(ye,J){var Q=[];Q.size=ye.size,ye.start!==void 0&&(Q.start=ye.start,Q.end=ye.end);for(var ge=0;ge<ye.length;ge+=3)Q.push(ye[ge]+J,ye[ge+1],ye[ge+2]);return Q}function di(ye,J){if(ye.transformed)return ye;var Q,ge,we,Pe=1<<ye.z,Ne=ye.x,De=ye.y;for(Q=0;Q<ye.features.length;Q++){var Ie=ye.features[Q],qe=Ie.geometry,vt=Ie.type;if(Ie.geometry=[],vt===1)for(ge=0;ge<qe.length;ge+=2)Ie.geometry.push(co(qe[ge],qe[ge+1],J,Pe,Ne,De));else for(ge=0;ge<qe.length;ge++){var Tt=[];for(we=0;we<qe[ge].length;we+=2)Tt.push(co(qe[ge][we],qe[ge][we+1],J,Pe,Ne,De));Ie.geometry.push(Tt)}}return ye.transformed=!0,ye}function co(ye,J,Q,ge,we,Pe){return[Math.round(Q*(ye*ge-we)),Math.round(Q*(J*ge-Pe))]}function Fs(ye,J,Q,ge,we){for(var Pe=J===we.maxZoom?0:we.tolerance/((1<<J)*we.extent),Ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:ge,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},De=0;De<ye.length;De++){Ne.numFeatures++,pu(Ne,ye[De],Pe,we);var Ie=ye[De].minX,qe=ye[De].minY,vt=ye[De].maxX,Tt=ye[De].maxY;Ie<Ne.minX&&(Ne.minX=Ie),qe<Ne.minY&&(Ne.minY=qe),vt>Ne.maxX&&(Ne.maxX=vt),Tt>Ne.maxY&&(Ne.maxY=Tt)}return Ne}function pu(ye,J,Q,ge){var we=J.geometry,Pe=J.type,Ne=[];if(Pe==="Point"||Pe==="MultiPoint")for(var De=0;De<we.length;De+=3)Ne.push(we[De]),Ne.push(we[De+1]),ye.numPoints++,ye.numSimplified++;else if(Pe==="LineString")zs(Ne,we,ye,Q,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(De=0;De<we.length;De++)zs(Ne,we[De],ye,Q,Pe==="Polygon",De===0);else if(Pe==="MultiPolygon")for(var Ie=0;Ie<we.length;Ie++){var qe=we[Ie];for(De=0;De<qe.length;De++)zs(Ne,qe[De],ye,Q,!0,De===0)}if(Ne.length){var vt=J.tags||null;if(Pe==="LineString"&&ge.lineMetrics){for(var Tt in vt={},J.tags)vt[Tt]=J.tags[Tt];vt.mapbox_clip_start=we.start/we.size,vt.mapbox_clip_end=we.end/we.size}var dt={geometry:Ne,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:vt};J.id!==null&&(dt.id=J.id),ye.features.push(dt)}}function zs(ye,J,Q,ge,we,Pe){var Ne=ge*ge;if(ge>0&&J.size<(we?Ne:ge))Q.numPoints+=J.length/3;else{for(var De=[],Ie=0;Ie<J.length;Ie+=3)(ge===0||J[Ie+2]>Ne)&&(Q.numSimplified++,De.push(J[Ie]),De.push(J[Ie+1])),Q.numPoints++;we&&function(qe,vt){for(var Tt=0,dt=0,br=qe.length,Lr=br-2;dt<br;Lr=dt,dt+=2)Tt+=(qe[dt]-qe[Lr])*(qe[dt+1]+qe[Lr+1]);if(Tt>0===vt)for(dt=0,br=qe.length;dt<br/2;dt+=2){var Tr=qe[dt],Or=qe[dt+1];qe[dt]=qe[br-2-dt],qe[dt+1]=qe[br-1-dt],qe[br-2-dt]=Tr,qe[br-1-dt]=Or}}(De,Pe),ye.push(De)}}function Ta(ye,J){var Q=(J=this.options=function(we,Pe){for(var Ne in Pe)we[Ne]=Pe[Ne];return we}(Object.create(this.options),J)).debug;if(Q&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(we,Pe){var Ne=[];if(we.type==="FeatureCollection")for(var De=0;De<we.features.length;De++)Ce(Ne,we.features[De],Pe,De);else Ce(Ne,we.type==="Feature"?we:{geometry:we},Pe);return Ne}(ye,J);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(we,Pe){var Ne=Pe.buffer/Pe.extent,De=we,Ie=_t(we,1,-1-Ne,Ne,0,-1,2,Pe),qe=_t(we,1,1-Ne,2+Ne,0,-1,2,Pe);return(Ie||qe)&&(De=_t(we,1,-Ne,1+Ne,0,-1,2,Pe)||[],Ie&&(De=jr(Ie,1).concat(De)),qe&&(De=De.concat(jr(qe,-1)))),De}(ge,J),ge.length&&this.splitTile(ge,0,0,0),Q&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $i(ye,J,Q){return 32*((1<<ye)*Q+J)+ye}function _o(ye,J){const Q=ye.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);const ge=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!ge)return J(null,null);const we=new class{constructor(Ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Ne.length,this._features=Ne}feature(Ne){return new class{constructor(De){this._feature=De,this.extent=s.EXTENT,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){const De=[];for(const Ie of this._feature.geometry)De.push([new s.Point(Ie[0],Ie[1])]);return De}{const De=[];for(const Ie of this._feature.geometry){const qe=[];for(const vt of Ie)qe.push(new s.Point(vt[0],vt[1]));De.push(qe)}return De}}toGeoJSON(De,Ie,qe){return V.call(this,De,Ie,qe)}}(this._features[Ne])}}(ge.features);let Pe=at(we);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),J(null,{vectorTile:we,rawData:Pe.buffer})}Ta.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ta.prototype.splitTile=function(ye,J,Q,ge,we,Pe,Ne){for(var De=[ye,J,Q,ge],Ie=this.options,qe=Ie.debug;De.length;){ge=De.pop(),Q=De.pop(),J=De.pop(),ye=De.pop();var vt=1<<J,Tt=$i(J,Q,ge),dt=this.tiles[Tt];if(!dt&&(qe>1&&console.time("creation"),dt=this.tiles[Tt]=Fs(ye,J,Q,ge,Ie),this.tileCoords.push({z:J,x:Q,y:ge}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,Q,ge,dt.numFeatures,dt.numPoints,dt.numSimplified),console.timeEnd("creation"));var br="z"+J;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(dt.source=ye,we){if(J===Ie.maxZoom||J===we)continue;var Lr=1<<we-J;if(Q!==Math.floor(Pe/Lr)||ge!==Math.floor(Ne/Lr))continue}else if(J===Ie.indexMaxZoom||dt.numPoints<=Ie.indexMaxPoints)continue;if(dt.source=null,ye.length!==0){qe>1&&console.time("clipping");var Tr,Or,Vr,Ei,Zi,Xo,lo=.5*Ie.buffer/Ie.extent,ja=.5-lo,vo=.5+lo,hs=1+lo;Tr=Or=Vr=Ei=null,Zi=_t(ye,vt,Q-lo,Q+vo,0,dt.minX,dt.maxX,Ie),Xo=_t(ye,vt,Q+ja,Q+hs,0,dt.minX,dt.maxX,Ie),ye=null,Zi&&(Tr=_t(Zi,vt,ge-lo,ge+vo,1,dt.minY,dt.maxY,Ie),Or=_t(Zi,vt,ge+ja,ge+hs,1,dt.minY,dt.maxY,Ie),Zi=null),Xo&&(Vr=_t(Xo,vt,ge-lo,ge+vo,1,dt.minY,dt.maxY,Ie),Ei=_t(Xo,vt,ge+ja,ge+hs,1,dt.minY,dt.maxY,Ie),Xo=null),qe>1&&console.timeEnd("clipping"),De.push(Tr||[],J+1,2*Q,2*ge),De.push(Or||[],J+1,2*Q,2*ge+1),De.push(Vr||[],J+1,2*Q+1,2*ge),De.push(Ei||[],J+1,2*Q+1,2*ge+1)}}},Ta.prototype.getTile=function(ye,J,Q){var ge=this.options,we=ge.extent,Pe=ge.debug;if(ye<0||ye>24)return null;var Ne=1<<ye,De=$i(ye,J=(J%Ne+Ne)%Ne,Q);if(this.tiles[De])return di(this.tiles[De],we);Pe>1&&console.log("drilling down to z%d-%d-%d",ye,J,Q);for(var Ie,qe=ye,vt=J,Tt=Q;!Ie&&qe>0;)qe--,vt=Math.floor(vt/2),Tt=Math.floor(Tt/2),Ie=this.tiles[$i(qe,vt,Tt)];return Ie&&Ie.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",qe,vt,Tt),Pe>1&&console.time("drilling down"),this.splitTile(Ie.source,qe,vt,Tt,ye,J,Q),Pe>1&&console.timeEnd("drilling down"),this.tiles[De]?di(this.tiles[De],we):null):null};class bl extends s.VectorTileWorkerSource{constructor(J,Q,ge,we,Pe){super(J,Q,ge,we,_o),Pe&&(this.loadGeoJSON=Pe)}loadData(J,Q){const ge=J&&J.request,we=ge&&ge.collectResourceTiming;this.loadGeoJSON(J,(Pe,Ne)=>{if(Pe||!Ne)return Q(Pe);if(typeof Ne!="object")return Q(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{z(Ne,!0);try{if(J.filter){const Ie=s.createExpression(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));Ne={type:"FeatureCollection",features:Ne.features.filter(vt=>Ie.value.evaluate({zoom:0},vt))}}this._geoJSONIndex=J.cluster?new jt(function({superclusterOptions:Ie,clusterProperties:qe}){if(!qe||!Ie)return Ie;const vt={},Tt={},dt={accumulated:null,zoom:0},br={properties:null},Lr=Object.keys(qe);for(const Tr of Lr){const[Or,Vr]=qe[Tr],Ei=s.createExpression(Vr),Zi=s.createExpression(typeof Or=="string"?[Or,["accumulated"],["get",Tr]]:Or);vt[Tr]=Ei.value,Tt[Tr]=Zi.value}return Ie.map=Tr=>{br.properties=Tr;const Or={};for(const Vr of Lr)Or[Vr]=vt[Vr].evaluate(dt,br);return Or},Ie.reduce=(Tr,Or)=>{br.properties=Or;for(const Vr of Lr)dt.accumulated=Tr[Vr],Tr[Vr]=Tt[Vr].evaluate(dt,br)},Ie}(J)).load(Ne.features):function(Ie,qe){return new Ta(Ie,qe)}(Ne,J.geojsonVtOptions)}catch(Ie){return Q(Ie)}this.loaded={};const De={};if(we){const Ie=s.getPerformanceMeasurement(ge);Ie&&(De.resourceTiming={},De.resourceTiming[J.source]=JSON.parse(JSON.stringify(Ie)))}Q(null,De)}})}reloadTile(J,Q){const ge=this.loaded;return ge&&ge[J.uid]?super.reloadTile(J,Q):this.loadTile(J,Q)}loadGeoJSON(J,Q){if(J.request)s.getJSON(J.request,Q);else{if(typeof J.data!="string")return Q(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse(J.data))}catch{return Q(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(ge){Q(ge)}}getClusterChildren(J,Q){try{Q(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(ge){Q(ge)}}getClusterLeaves(J,Q){try{Q(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(ge){Q(ge)}}}class dp{constructor(J){this.self=J,this.actor=new s.Actor(J,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:bl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,ge)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=ge},this.self.registerRTLTextPlugin=Q=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=Q.applyArabicShaping,s.plugin.processBidirectionalText=Q.processBidirectionalText,s.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}}clearCaches(J,Q,ge){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],ge()}checkIfReady(J,Q,ge){ge()}setReferrer(J,Q){this.referrer=Q}spriteLoaded(J,Q){this.isSpriteLoaded[J]=Q;for(const ge in this.workerSources[J]){const we=this.workerSources[J][ge];for(const Pe in we)we[Pe]instanceof s.VectorTileWorkerSource&&(we[Pe].isSpriteLoaded=Q,we[Pe].fire(new s.Event("isSpriteLoaded")))}}setImages(J,Q,ge){this.availableImages[J]=Q;for(const we in this.workerSources[J]){const Pe=this.workerSources[J][we];for(const Ne in Pe)Pe[Ne].availableImages=Q}ge()}enableTerrain(J,Q,ge){this.terrain=Q,ge()}setProjection(J,Q){this.projections[J]=s.getProjection(Q)}setLayers(J,Q,ge){this.getLayerIndex(J).replace(Q),ge()}updateLayers(J,Q,ge){this.getLayerIndex(J).update(Q.layers,Q.removedIds),ge()}loadTile(J,Q,ge){const we=this.enableTerrain?s.extend({enableTerrain:this.terrain},Q):Q;we.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,Q.type,Q.source).loadTile(we,ge)}loadDEMTile(J,Q,ge){const we=this.enableTerrain?s.extend({buildQuadTree:this.terrain},Q):Q;this.getDEMWorkerSource(J,Q.source).loadTile(we,ge)}reloadTile(J,Q,ge){const we=this.enableTerrain?s.extend({enableTerrain:this.terrain},Q):Q;we.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,Q.type,Q.source).reloadTile(we,ge)}abortTile(J,Q,ge){this.getWorkerSource(J,Q.type,Q.source).abortTile(Q,ge)}removeTile(J,Q,ge){this.getWorkerSource(J,Q.type,Q.source).removeTile(Q,ge)}removeSource(J,Q,ge){if(!this.workerSources[J]||!this.workerSources[J][Q.type]||!this.workerSources[J][Q.type][Q.source])return;const we=this.workerSources[J][Q.type][Q.source];delete this.workerSources[J][Q.type][Q.source],we.removeSource!==void 0?we.removeSource(Q,ge):ge()}loadWorkerSource(J,Q,ge){try{this.self.importScripts(Q.url),ge()}catch(we){ge(we.toString())}}syncRTLPluginState(J,Q,ge){try{s.plugin.setState(Q);const we=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&we!=null){this.self.importScripts(we);const Pe=s.plugin.isParsed();ge(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),Pe)}}catch(we){ge(we.toString())}}getAvailableImages(J){let Q=this.availableImages[J];return Q||(Q=[]),Q}getLayerIndex(J){let Q=this.layerIndexes[J];return Q||(Q=this.layerIndexes[J]=new w),Q}getWorkerSource(J,Q,ge){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Q]||(this.workerSources[J][Q]={}),!this.workerSources[J][Q][ge]){const we={send:(Pe,Ne,De,Ie,qe,vt)=>{this.actor.send(Pe,Ne,De,J,qe,vt)},scheduler:this.actor.scheduler};this.workerSources[J][Q][ge]=new this.workerSourceTypes[Q](we,this.getLayerIndex(J),this.getAvailableImages(J),this.isSpriteLoaded[J])}return this.workerSources[J][Q][ge]}getDEMWorkerSource(J,Q){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Q]||(this.demWorkerSources[J][Q]=new b),this.demWorkerSources[J][Q]}enforceCacheSizeLimit(J,Q){s.enforceCacheSizeLimit(Q)}getWorkerPerformanceMetrics(J,Q,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new dp(self)),dp}),a(["./shared"],function(s){function g(y,c){if(Array.isArray(y)){if(!Array.isArray(c)||y.length!==c.length)return!1;for(let p=0;p<y.length;p++)if(!g(y[p],c[p]))return!1;return!0}if(typeof y=="object"&&y!==null&&c!==null){if(typeof c!="object"||Object.keys(y).length!==Object.keys(c).length)return!1;for(const p in y)if(!g(y[p],c[p]))return!1;return!0}return y===c}var m=w;function w(y){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,E,S=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(S);try{E=new Worker(M),v=!0}catch{v=!1}return E&&E.terminate(),URL.revokeObjectURL(M),v}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var v=document.createElement("canvas");v.width=v.height=1;var E=v.getContext("2d");if(!E)return!1;var S=E.getImageData(0,0,1,1);return S&&S.width===v.width}()?(b[p=c&&c.failIfMajorPerformanceCaveat]===void 0&&(b[p]=function(v){var E,S=function(M){var L=document.createElement("canvas"),N=Object.create(w.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=M,L.getContext("webgl",N)||L.getContext("experimental-webgl",N)}(v);if(!S)return!1;try{E=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!E||S.isContextLost())&&(S.shaderSource(E,"void main() {}"),S.compileShader(E),S.getShaderParameter(E,S.COMPILE_STATUS)===!0)}(p)),b[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var p}(y)}var b={};function I(y,c,p){const v=s.window.document.createElement(y);return c!==void 0&&(v.className=c),p&&p.appendChild(v),v}function A(y,c,p){const v=s.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const E of Object.keys(c))v.setAttributeNS(null,E,c[E]);return p&&p.appendChild(v),v}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const z=s.window.document&&s.window.document.documentElement.style,V=z&&z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let H;function Z(){z&&V&&(H=z[V],z[V]="none")}function D(){z&&V&&(z[V]=H)}function k(y){y.preventDefault(),y.stopPropagation(),s.window.removeEventListener("click",k,!0)}function j(){s.window.addEventListener("click",k,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",k,!0)},0)}function Y(y,c){const p=y.getBoundingClientRect();return ae(y,p,c)}function ie(y,c){const p=y.getBoundingClientRect(),v=[];for(let E=0;E<c.length;E++)v.push(ae(y,p,c[E]));return v}function ne(y){return s.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function ae(y,c,p){const v=y.offsetWidth===c.width?1:y.offsetWidth/c.width;return new s.Point((p.clientX-c.left)*v,(p.clientY-c.top)*v)}function W(y,c){var p=c[0],v=c[1],E=c[2],S=c[3],M=p*S-E*v;return M?(y[0]=S*(M=1/M),y[1]=-v*M,y[2]=-E*M,y[3]=p*M,y):null}function $e(y){const{userImage:c}=y;return!!(c&&c.render&&c.render())&&(y.data.replace(new Uint8Array(c.data.buffer)),!0)}class Oe extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:p,callback:v}of this.requestors)this._notify(p,v);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,p){this._validate(c,p)&&(this.images[c]=p)}_validate(c,p){let v=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(p.content,p)||(this.fire(new s.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,p){if(!c)return!0;let v=0;for(const E of c){if(E[0]<v||E[1]<E[0]||p<E[1])return!1;v=E[1]}return!0}_validateContent(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0}removeImage(c){const p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,p){let v=!0;if(!this.isLoaded())for(const E of c)this.images[E]||(v=!1);this.isLoaded()||v?this._notify(c,p):this.requestors.push({ids:c,callback:p})}_notify(c,p){const v={};for(const E of c){this.images[E]||this.fire(new s.Event("styleimagemissing",{id:E}));const S=this.images[E];S?v[E]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:s.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,v)}getPixelSize(){const{width:c,height:p}=this.atlasImage;return{width:c,height:p}}getPattern(c){const p=this.patterns[c],v=this.getImage(c);if(!v)return null;if(p&&p.position.version===v.version)return p.position;if(p)p.position.version=v.version;else{const E={w:v.data.width+2,h:v.data.height+2,x:0,y:0},S=new s.ImagePosition(E,v);this.patterns[c]={bin:E,position:S}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture&&this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const S in this.patterns)c.push(this.patterns[S].bin);const{w:p,h:v}=s.potpack(c),E=this.atlasImage;E.resize({width:p||1,height:v||1});for(const S in this.patterns){const{bin:M}=this.patterns[S],L=M.x+1,N=M.y+1,U=this.images[S].data,B=U.width,$=U.height;s.RGBAImage.copy(U,E,{x:0,y:0},{x:L,y:N},{width:B,height:$}),s.RGBAImage.copy(U,E,{x:0,y:$-1},{x:L,y:N-1},{width:B,height:1}),s.RGBAImage.copy(U,E,{x:0,y:0},{x:L,y:N+$},{width:B,height:1}),s.RGBAImage.copy(U,E,{x:B-1,y:0},{x:L-1,y:N},{width:1,height:$}),s.RGBAImage.copy(U,E,{x:0,y:0},{x:L+B,y:N},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const p of c){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const v=this.images[p];$e(v)&&this.updateImage(p,v)}}}const ze=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(y,c){return function([p,v,E]){const S=s.degToRad(v+90),M=s.degToRad(E);return{x:p*Math.cos(S)*Math.sin(M),y:p*Math.sin(S)*Math.sin(M),z:p*Math.cos(M),azimuthal:v,polar:E}}(y.expression.evaluate(c))}interpolate(y,c,p){return{x:s.number(y.x,c.x,p),y:s.number(y.y,c.y,p),z:s.number(y.z,c.z,p),azimuthal:s.number(y.azimuthal,c.azimuthal,p),polar:s.number(y.polar,c.polar,p)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class We extends s.Evented{constructor(c){super(),this._transitionable=new s.Transitionable(ze),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,p={}){if(!this._validate(s.validateLight,c,p))for(const v in c){const E=c[v];s.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),E):this._transitionable.setValue(v,E)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||v.validate!==!1)&&s.emitValidationErrors(this,c.call(s.validateStyle,s.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ze=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Pt=class extends s.Evented{constructor(y,c){super(),this._transitionable=new s.Transitionable(Ze),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(y){for(const c in y){const p=y[c];s.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),p):this._transitionable.setValue(c,p)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function at(y,c,p,v){const E=s.smoothstep(45,65,p),[S,M]=St(y,v),L=s.length(c);let N=1-Math.min(1,Math.exp((L-S)/(M-S)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*E*y.alpha}function St(y,c){const p=.5/Math.tan(.5*c);return[y.range[0]+p,y.range[1]+p]}const et=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class zt extends s.Evented{constructor(c,p){super(),this._transitionable=new s.Transitionable(et),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=p}get state(){const c=this._transform,p=c.projection.name==="globe",v=s.globeToMercatorTransition(c.zoom),E=this.properties.get("range"),S=[.5,3];return{range:p?[s.number(S[0],E[0],v),s.number(S[1],E[1],v)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,p={}){if(!this._validate(s.validateFog,c,p)){for(const v of Object.keys(s.spec.fog))c&&c[v]===void 0&&(c[v]=s.spec.fog[v].default);for(const v in c){const E=c[v];s.endsWith(v,"-transition")?this._transitionable.setTransition(v.slice(0,-11),E):this._transitionable.setValue(v,E)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,c))*p.a}getOpacityAtLatLng(c,p){return this._transform.projection.supportsFog?function(v,E,S){const M=s.MercatorCoordinate.fromLngLat(E),L=S.elevation?S.elevation.getAtPointOrZero(M):0,N=[M.x,M.y,L];return s.transformMat4(N,N,S.mercatorFogMatrix),at(v,N,S.pitch,S._fov)}(this.state,c,p):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?St(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,v){return(!v||v.validate!==!1)&&s.emitValidationErrors(this,c.call(s.validateStyle,s.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class mt{constructor(c,p){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const v=this.workerPool.acquire(this.id);for(let E=0;E<v.length;E++){const S=new mt.Actor(v[E],p,this.id);S.name=`Worker ${E}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,p,v){s.asyncAll(this.actors,(E,S)=>{E.send(c,p,S)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function bt(y,c,p){return c*(s.EXTENT/(y.tileSize*Math.pow(2,p-y.tileID.overscaledZ)))}mt.Actor=s.Actor;class It{constructor(c,p,v,E){this.screenBounds=c,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,E)}static createFromScreenPoints(c,p){let v,E;if(c instanceof s.Point||typeof c[0]=="number"){const S=s.Point.convert(c);v=[S],E=p.isPointAboveHorizon(S)}else{const S=s.Point.convert(c[0]),M=s.Point.convert(c[1]);v=[S,M],E=s.polygonizeBounds(S,M).every(L=>p.isPointAboveHorizon(L))}return new It(v,p.getCameraPoint(),E,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const p=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],E=s.polygonizeBounds(p,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<v.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?E[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(E[3]=this.cameraPoint)),s.bufferConvexPolygon(E,c)}bufferedCameraGeometryGlobe(c){const p=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],E=s.polygonizeBounds(p,v,c),S=this.cameraPoint.clone();switch(3*((S.y>p.y)+(S.y>v.y))+((S.x>p.x)+(S.x>v.x))){case 0:E[0]=S,E[4]=S.clone();break;case 1:E.splice(1,0,S);break;case 2:E[1]=S;break;case 3:E.splice(4,0,S);break;case 5:E.splice(2,0,S);break;case 6:E[3]=S;break;case 7:E.splice(3,0,S);break;case 8:E[2]=S}return E}containsTile(c,p,v,E=0){const S=c.queryPadding/p._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(S,p):this._bufferedScreenMercator(S,p);let L=c.tileID.wrap+(M.unwrapped?E:0);const N=M.polygon.map(ce=>s.getTilePoint(c.tileTransform,ce,L));if(!s.polygonIntersectsBox(N,0,0,s.EXTENT,s.EXTENT))return;L=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const U=this.screenGeometryMercator.polygon.map(ce=>s.getTileVec3(c.tileTransform,ce,L)),B=U.map(ce=>new s.Point(ce[0],ce[1])),$=p.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),te=s.getTileVec3(c.tileTransform,$,L),se=U.map(ce=>{const X=s.sub(ce,ce,te);return s.normalize(X,X),new s.Ray(te,X)}),ue=bt(c,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:se,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(le=s.getBounds(N),le.min.x=s.clamp(le.min.x,0,s.EXTENT),le.min.y=s.clamp(le.min.y,0,s.EXTENT),le.max.x=s.clamp(le.max.x,0,s.EXTENT),le.max.y=s.clamp(le.max.y,0,s.EXTENT),le),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ue};var le}_bufferedScreenMercator(c,p){const v=yr(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),p):{polygon:this.bufferedScreenGeometry(c).map(S=>p.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[v]=E,E}}_bufferedCameraMercator(c,p){const v=yr(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),p):{polygon:this.bufferedCameraGeometry(c).map(S=>p.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[v]=E,E}}_projectAndResample(c,p){const v=function(S,M){const L=s.multiply([],M.pixelMatrix,M.globeMatrix),N=[0,-s.GLOBE_RADIUS,0,1],U=[0,s.GLOBE_RADIUS,0,1],B=[0,0,0,1];s.transformMat4$1(N,N,L),s.transformMat4$1(U,U,L),s.transformMat4$1(B,B,L);const $=new s.Point(N[0]/N[3],N[1]/N[3]),te=new s.Point(U[0]/U[3],U[1]/U[3]),se=s.polygonContainsPoint(S,$)&&N[3]<B[3],ue=s.polygonContainsPoint(S,te)&&U[3]<B[3];if(!se&&!ue)return null;const le=function(Te,Me,Ae){for(let Be=1;Be<Te.length;Be++){const ct=Jt(Me.pointCoordinate3D(Te[Be-1]).x),Re=Jt(Me.pointCoordinate3D(Te[Be]).x);if(Ae<0){if(ct<Re)return{idx:Be,t:-ct/(Re-1-ct)}}else if(Re<ct)return{idx:Be,t:(1-ct)/(Re+1-ct)}}return null}(S,M,se?-1:1);if(!le)return null;const{idx:ce,t:X}=le;let oe=ce>1?jt(S.slice(0,ce),M):[],pe=ce<S.length?jt(S.slice(ce),M):[];oe=oe.map(Te=>new s.Point(Jt(Te.x),Te.y)),pe=pe.map(Te=>new s.Point(Jt(Te.x),Te.y));const de=[...oe];de.length===0&&de.push(pe[pe.length-1]);const be=s.number(de[de.length-1].y,(pe.length===0?oe[0]:pe[0]).y,X);let Se;return Se=se?[new s.Point(0,be),new s.Point(0,0),new s.Point(1,0),new s.Point(1,be)]:[new s.Point(1,be),new s.Point(1,1),new s.Point(0,1),new s.Point(0,be)],de.push(...Se),pe.length===0?de.push(oe[0]):de.push(...pe),{polygon:de.map(Te=>new s.MercatorCoordinate(Te.x,Te.y)),unwrapped:!1}}(c,p);if(v)return v;const E=function(S,M){let L=!1,N=-1/0,U=0;for(let $=0;$<S.length-1;$++)S[$].x>N&&(N=S[$].x,U=$);for(let $=0;$<S.length-1;$++){const te=(U+$)%(S.length-1),se=S[te],ue=S[te+1];Math.abs(se.x-ue.x)>.5&&(se.x<ue.x?(se.x+=1,te===0&&(S[S.length-1].x+=1)):(ue.x+=1,te+1===S.length-1&&(S[0].x+=1)),L=!0)}const B=s.mercatorXfromLng(M.center.lng);return L&&B<Math.abs(B-1)&&S.forEach($=>{$.x-=1}),{polygon:S,unwrapped:L}}(jt(c,p).map(S=>new s.Point(Jt(S.x),S.y)),p);return{polygon:E.polygon.map(S=>new s.MercatorCoordinate(S.x,S.y)),unwrapped:E.unwrapped}}}function jt(y,c){return s.resample(y,p=>{const v=c.pointCoordinate3D(p);p.x=v.x,p.y=v.y},1/256)}function Jt(y){return y<0?1+y%1:y%1}function yr(y){return 100*y|0}function rr(y,c,p,v,E){const S=function(M,L){if(M)return E(M);if(L){y.url&&L.tiles&&y.tiles&&delete y.tiles;const N=s.pick(s.extend(L,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(N.vectorLayers=L.vector_layers,N.vectorLayerIds=N.vectorLayers.map(U=>U.id)),N.tiles=c.canonicalizeTileset(N,y.url),E(null,N)}};return y.url?s.getJSON(c.transformRequest(c.normalizeSourceURL(y.url,null,p,v),s.ResourceType.Source),S):s.exported.frame(()=>S(null,y))}class Ar{constructor(c,p,v){this.bounds=s.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const p=Math.pow(2,c.z),v=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*p),E=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*p),S=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*p),M=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*p);return c.x>=v&&c.x<S&&c.y>=E&&c.y<M}}class Ii{constructor(c,p,v){this.context=c;const E=c.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class si{constructor(c,p,v,E){this.length=p.length,this.attributes=v,this.itemSize=p.bytesPerElement,this.dynamicDraw=E,this.context=c;const S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,p){for(let v=0;v<this.attributes.length;v++){const E=p.attributes[this.attributes[v].name];E!==void 0&&c.enableVertexAttribArray(E)}}setVertexAttribPointers(c,p,v){for(let E=0;E<this.attributes.length;E++){const S=this.attributes[E],M=p.attributes[S.name];M!==void 0&&c.vertexAttribPointer(M,S.components,c[Xr[S.type]],!1,this.itemSize,S.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class nr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ee extends nr{getDefault(){return s.Color.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ce extends nr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ke extends nr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Qe extends nr{getDefault(){return[!0,!0,!0,!0]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ot extends nr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class wt extends nr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Mt extends nr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class _t extends nr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Nt extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}}class xt extends nr{getDefault(){return[0,1]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ir extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}}class $t extends nr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Qt extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}}class fr extends nr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Mr extends nr{getDefault(){return s.Color.transparent}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class jr extends nr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Wr extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}}class di extends nr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class co extends nr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let Fs,pu=class extends nr{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class zs extends nr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Ta extends nr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class $i extends nr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class _o extends nr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class bl extends nr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class dp extends nr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ye extends nr{getDefault(){return null}set(c){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class J extends nr{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Q extends nr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class ge extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class we extends nr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Pe extends nr{constructor(c,p){super(c),this.context=c,this.parent=p}getDefault(){return null}}class Ne extends Pe{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class De extends Pe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ie extends De{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class qe{constructor(c,p,v,E){this.context=c,this.width=p,this.height=v;const S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Ne(c,S),E&&(this.depthAttachment=new De(c,S))}destroy(){const c=this.context.gl,p=this.colorAttachment.get();if(p&&c.deleteTexture(p),this.depthAttachment){const v=this.depthAttachment.get();v&&c.deleteRenderbuffer(v)}c.deleteFramebuffer(this.framebuffer)}}class vt{constructor(c,p=!1){if(this.gl=c,this.isWebGL2=p,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),p){const v=c;this.extVertexArrayObject={createVertexArrayOES:v.createVertexArray.bind(c),deleteVertexArrayOES:v.deleteVertexArray.bind(c),bindVertexArrayOES:v.bindVertexArray.bind(c)}}this.clearColor=new Ee(this),this.clearDepth=new Ce(this),this.clearStencil=new Ke(this),this.colorMask=new Qe(this),this.depthMask=new ot(this),this.stencilMask=new wt(this),this.stencilFunc=new Mt(this),this.stencilOp=new _t(this),this.stencilTest=new Nt(this),this.depthRange=new xt(this),this.depthTest=new ir(this),this.depthFunc=new $t(this),this.blend=new Qt(this),this.blendFunc=new fr(this),this.blendColor=new Mr(this),this.blendEquation=new jr(this),this.cullFace=new Wr(this),this.cullFaceSide=new di(this),this.frontFace=new co(this),this.program=new pu(this),this.activeTexture=new zs(this),this.viewport=new Ta(this),this.bindFramebuffer=new $i(this),this.bindRenderbuffer=new _o(this),this.bindTexture=new bl(this),this.bindVertexBuffer=new dp(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new J(this),this.pixelStoreUnpack=new Q(this),this.pixelStoreUnpackPremultiplyAlpha=new ge(this),this.pixelStoreUnpackFlipY=new we(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),p||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(p||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=p||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,p){return new Ii(this,c,p)}createVertexBuffer(c,p,v){return new si(this,c,p,v)}createRenderbuffer(c,p,v){const E=this.gl,S=E.createRenderbuffer();return this.bindRenderbuffer.set(S),E.renderbufferStorage(E.RENDERBUFFER,c,p,v),this.bindRenderbuffer.set(null),S}createFramebuffer(c,p,v){return new qe(this,c,p,v)}clear({color:c,depth:p,stencil:v}){const E=this.gl;let S=0;c&&(S|=E.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),v!==void 0&&(S|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(S)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){g(c.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Tt extends s.Evented{constructor(c,p,v,E){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(p,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=rr(this._options,this.map._requestManager,p,v,(E,S)=>{this._tileJSONRequest=null,this._loaded=!0,E?(p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new s.ErrorEvent(E))):S&&(s.extend(this,S),S.bounds&&(this.tileBounds=new Ar(S.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(E)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(c,p){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),E={request:this.map._requestManager.transformRequest(v,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(E.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",E,S.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",E,S.bind(this),void 0,!0);else{const M=s.loadVectorTile.call({deduped:this._deduped},E,(L,N)=>{L||!N?S.call(this,L):(E.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},c.actor&&c.actor.send("loadTile",E,S.bind(this),void 0,!0))},!0);c.request={cancel:M}}function S(M,L){return delete c.request,c.aborted?p(null):M&&M.status!==404?p(M):(L&&L.resourceTiming&&(c.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&c.setExpiryData(L),c.loadVectorData(L,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dt extends s.Evented{constructor(c,p,v,E){super(),this.id=c,this.dispatcher=v,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},p),s.extend(this,s.pick(p,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rr(this._options,this.map._requestManager,null,null,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.ErrorEvent(p)):v&&(s.extend(this,v),v.bounds&&(this.tileBounds=new Ar(v.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(v.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(p)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,p){const v=s.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=s.getImage(this.map._requestManager.transformRequest(E,s.ResourceType.Tile),(S,M,L,N)=>(delete c.request,c.aborted?(c.state="unloaded",p(null)):S?(c.state="errored",p(S)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:L,expires:N}),c.setTexture(M,this.map.painter),c.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void p(null)):p(null)))}static loadTileData(c,p,v){c.setTexture(p,v)}static unloadTileData(c,p){c.texture&&p.saveTileTexture(c.texture)}abortTile(c,p){c.request&&(c.request.cancel(),delete c.request),p()}unloadTile(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function br(y,c,p,v,E,S,M,L){const N=[y,p,E,c,v,S,1,1,1],U=[M,L,1],B=s.adjoint([],N),[$,te,se]=s.transformMat3(U,U,s.transpose(B,B));return s.multiply$1(N,[$,0,0,0,te,0,0,0,se],N)}class Lr extends s.Evented{constructor(c,p,v,E){super(),this.id=c,this.dispatcher=v,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=p,this._dirty=!1}load(c,p){this._loaded=p||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(v,E)=>{if(this._imageRequest=null,this._loaded=!0,v)this.fire(new s.ErrorEvent(v));else if(E){const{HTMLImageElement:S}=s.window;this.image=E instanceof S?s.exported.getImageData(E):E,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const p=c.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let E=1/0,S=1/0,M=-1/0,L=-1/0;for(const $ of v)E=Math.min(E,$.x),S=Math.min(S,$.y),M=Math.max(M,$.x),L=Math.max(L,$.y);const N=Math.max(M-E,L-S),U=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),B=Math.pow(2,U);return new s.CanonicalTileID(U,Math.floor((E+M)/2*B),Math.floor((S+L)/2*B))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const N in this.tiles){const U=this.tiles[N];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray)return;const p=s.tileTransform(this.tileID,this.map.transform.projection),[v,E,S,M]=this.coordinates.map(N=>{const U=p.projection.project(N[0],N[1]);return s.getTilePoint(p,U)._round()});this.perspectiveTransform=function(N,U,B,$,te,se,ue,le,ce,X){const oe=br(0,0,N,0,0,U,N,U),pe=br(B,$,te,se,ue,le,ce,X);return s.multiply$1(pe,s.adjoint(oe,oe),pe),[pe[6]/pe[8]*N/s.EXTENT,pe[7]/pe[8]*U/s.EXTENT]}(this.width,this.height,v.x,v.y,E.x,E.y,M.x,M.y,S.x,S.y);const L=this._boundsArray=new s.StructArrayLayout4i8;L.emplaceBack(v.x,v.y,0,0),L.emplaceBack(E.x,E.y,s.EXTENT,0),L.emplaceBack(M.x,M.y,0,s.EXTENT),L.emplaceBack(S.x,S.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(L,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,p=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Tr={vector:Tt,raster:dt,"raster-dem":class extends dt{constructor(y,c,p,v){super(y,c,p,v),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(y,c){const p=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(E,S){E&&(y.state="errored",c(E)),S&&(y.dem=S,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",c(null))}y.request=s.getImage(this.map._requestManager.transformRequest(p,s.ResourceType.Tile),(function(E,S,M,L){if(delete y.request,y.aborted)y.state="unloaded",c(null);else if(E)y.state="errored",c(E);else if(S){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:M,expires:L});const N=s.window.ImageBitmap&&S instanceof s.window.ImageBitmap&&(Fs==null&&(Fs=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Fs),U=1-(S.width-s.prevPowerOfTwo(S.width))/2;U<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const B=N?S:s.exported.getImageData(S,U),$={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:B,encoding:this.encoding,padding:U};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",$,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const c=y.canonical,p=Math.pow(2,c.z),v=(c.x-1+p)%p,E=c.x===0?y.wrap-1:y.wrap,S=(c.x+1+p)%p,M=c.x+1===p?y.wrap+1:y.wrap,L={};return L[new s.OverscaledTileID(y.overscaledZ,E,c.z,v,c.y).key]={backfilled:!1},L[new s.OverscaledTileID(y.overscaledZ,M,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(L[new s.OverscaledTileID(y.overscaledZ,E,c.z,v,c.y-1).key]={backfilled:!1},L[new s.OverscaledTileID(y.overscaledZ,y.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},L[new s.OverscaledTileID(y.overscaledZ,M,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<p&&(L[new s.OverscaledTileID(y.overscaledZ,E,c.z,v,c.y+1).key]={backfilled:!1},L[new s.OverscaledTileID(y.overscaledZ,y.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},L[new s.OverscaledTileID(y.overscaledZ,M,c.z,S,c.y+1).key]={backfilled:!1}),L}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends s.Evented{constructor(y,c,p,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(v),this._data=c.data,this._options=s.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const E=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*E,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*E,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:s.EXTENT,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*E,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},c),this}getClusterChildren(y,c){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},c),this}getClusterLeaves(y,c,p,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:c,offset:p},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=s.extend({},this.workerOptions),c=this._data;typeof c=="string"?(y.request=this.map._requestManager.transformRequest(s.exported.resolveURL(c),s.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,(p,v)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.ErrorEvent(p));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(E.resourceTiming=v.resourceTiming[this.id]),this.fire(new s.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(y,c){const p=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(p,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,E)=>(delete y.request,y.unloadVectorData(),y.aborted?c(null):v?c(v):(y.loadVectorData(E,this.map.painter,p==="reloadTile"),c(null))),void 0,p==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Lr{constructor(y,c,p,v){super(y,c,p,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const c of y.urls)this.urls.push(this.map._requestManager.transformRequest(c,s.ResourceType.Source).url);s.getVideo(this.urls,(c,p)=>{this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const c=this.video.seekable;y<c.start(0)||y>c.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,c=y.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(y,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Lr,canvas:class extends Lr{constructor(y,c,p,v){super(y,c,p,v),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(S=>typeof S!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends s.Evented{constructor(y,c,p,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ar(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:c,y:p,z:v}=y.canonical;return this._implementation.hasTile({x:c,y:p,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,c){const{x:p,y:v,z:E}=y.tileID.canonical,S=new s.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:p,y:v,z:E},{signal:S.signal})).then((function(M){return delete y.request,y.aborted?(y.state="unloaded",c(null)):M===void 0?(y.state="errored",c(null)):M===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",c(null)):function(L){return L instanceof s.window.ImageData||L instanceof s.window.HTMLCanvasElement||L instanceof s.window.ImageBitmap||L instanceof s.window.HTMLImageElement}(M)?(this.loadTileData(y,M),y.state="loaded",void c(null)):(y.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.code!==20&&(y.state="errored",c(M))}),y.request.cancel=()=>S.abort()}loadTileData(y,c){dt.loadTileData(y,c,this._map.painter)}unloadTileData(y){dt.unloadTileData(y,this._map.painter)}unloadTile(y,c){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:p,y:v,z:E}=y.tileID.canonical;this._implementation.unloadTile({x:p,y:v,z:E})}c()}abortTile(y,c){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Or=function(y,c,p,v){const E=new Tr[c.type](y,c,p,v);if(E.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${E.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],E),E};function Vr(y,c){const p=s.identity([]);return s.scale(p,p,[.5*y.width,.5*-y.height,1]),s.translate(p,p,[1,-1,0]),s.multiply(p,p,y.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(p)}function Ei(y,c,p,v,E,S,M,L=!1){const N=y.tilesIn(v,M,L);N.sort(Xo);const U=[];for(const $ of N)U.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(c,p,y._state,$,E,S,Vr(y.transform,$.tile.tileID),L)});const B=function($){const te={},se={};for(const ue of $){const le=ue.queryResults,ce=ue.wrappedTileID,X=se[ce]=se[ce]||{};for(const oe in le){const pe=le[oe],de=X[oe]=X[oe]||{},be=te[oe]=te[oe]||[];for(const Se of pe)de[Se.featureIndex]||(de[Se.featureIndex]=!0,be.push(Se))}}return te}(U);for(const $ in B)B[$].forEach(te=>{const se=te.feature,ue=se.layer;ue&&ue.type!=="background"&&ue.type!=="sky"&&(se.source=ue.source,ue["source-layer"]&&(se.sourceLayer=ue["source-layer"]),se.state=se.id!==void 0?y.getFeatureState(ue["source-layer"],se.id):{})});return B}function Zi(y,c){const p=y.getRenderableIds().map(S=>y.getTileByID(S)),v=[],E={};for(let S=0;S<p.length;S++){const M=p[S],L=M.tileID.canonical.key;E[L]||(E[L]=!0,M.querySourceFeatures(v,c))}return v}function Xo(y,c){const p=y.tileID,v=c.tileID;return p.overscaledZ-v.overscaledZ||p.canonical.y-v.canonical.y||p.wrap-v.wrap||p.canonical.x-v.canonical.x}function lo(){return th.workerClass!=null?new th.workerClass:new s.window.Worker(th.workerUrl)}const ja="mapboxgl_preloaded_worker_pool";class vo{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<vo.workerCount;)this.workers.push(new lo);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ja]}numActive(){return Object.keys(this.active).length}}let hs;function Fc(){return hs||(hs=new vo),hs}function B1(y,c){const p={};for(const v in y)v!=="ref"&&(p[v]=y[v]);return s.refProperties.forEach(v=>{v in c&&(p[v]=c[v])}),p}function y_(y){y=y.slice();const c=Object.create(null);for(let p=0;p<y.length;p++)c[y[p].id]=y[p];for(let p=0;p<y.length;p++)"ref"in y[p]&&(y[p]=B1(y[p],c[y[p].ref]));return y}vo.workerCount=2;const On={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Eg(y,c,p){p.push({command:On.addSource,args:[y,c[y]]})}function Uh(y,c,p){c.push({command:On.removeSource,args:[y]}),p[y]=!0}function bg(y,c,p,v){Uh(y,p,v),Eg(y,c,p)}function gp(y,c,p){let v;for(v in y[p])if(y[p].hasOwnProperty(v)&&v!=="data"&&!g(y[p][v],c[p][v]))return!1;for(v in c[p])if(c[p].hasOwnProperty(v)&&v!=="data"&&!g(y[p][v],c[p][v]))return!1;return!0}function qa(y,c,p,v,E,S){let M;for(M in c=c||{},y=y||{})y.hasOwnProperty(M)&&(g(y[M],c[M])||p.push({command:S,args:[v,M,c[M],E]}));for(M in c)c.hasOwnProperty(M)&&!y.hasOwnProperty(M)&&(g(y[M],c[M])||p.push({command:S,args:[v,M,c[M],E]}))}function Tl(y){return y.id}function Tg(y,c){return y[c.id]=c,y}class Sg{constructor(c,p){this.reset(c,p)}reset(c,p){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=s.clamp(c,0,1);let p=1,v=this._distances[p];const E=c*this.paddedLength+this.padding;for(;v<E&&p<this._distances.length;)v=this._distances[++p];const S=p-1,M=this._distances[S],L=v-M,N=L>0?(E-M)/L:0;return this.points[S].mult(1-N).add(this.points[p].mult(N))}}class Hu{constructor(c,p,v){const E=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(p/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)E.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,p,v,E,S){this._forEachCell(p,v,E,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(S)}insertCircle(c,p,v,E){this._forEachCell(p-E,v-E,p+E,v+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(v),this.circles.push(E)}_insertBoxCell(c,p,v,E,S,M){this.boxCells[S].push(M)}_insertCircleCell(c,p,v,E,S,M){this.circleCells[S].push(M)}_query(c,p,v,E,S,M){if(v<0||c>this.width||E<0||p>this.height)return!S&&[];const L=[];if(c<=0&&p<=0&&this.width<=v&&this.height<=E){if(S)return!0;for(let N=0;N<this.boxKeys.length;N++)L.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const U=this.circles[3*N],B=this.circles[3*N+1],$=this.circles[3*N+2];L.push({key:this.circleKeys[N],x1:U-$,y1:B-$,x2:U+$,y2:B+$})}return M?L.filter(M):L}return this._forEachCell(c,p,v,E,this._queryCell,L,{hitTest:S,seenUids:{box:{},circle:{}}},M),S?L.length>0:L}_queryCircle(c,p,v,E,S){const M=c-v,L=c+v,N=p-v,U=p+v;if(L<0||M>this.width||U<0||N>this.height)return!E&&[];const B=[];return this._forEachCell(M,N,L,U,this._queryCellCircle,B,{hitTest:E,circle:{x:c,y:p,radius:v},seenUids:{box:{},circle:{}}},S),E?B.length>0:B}query(c,p,v,E,S){return this._query(c,p,v,E,!1,S)}hitTest(c,p,v,E,S){return this._query(c,p,v,E,!0,S)}hitTestCircle(c,p,v,E){return this._queryCircle(c,p,v,!0,E)}_queryCell(c,p,v,E,S,M,L,N){const U=L.seenUids,B=this.boxCells[S];if(B!==null){const te=this.bboxes;for(const se of B)if(!U.box[se]){U.box[se]=!0;const ue=4*se;if(c<=te[ue+2]&&p<=te[ue+3]&&v>=te[ue+0]&&E>=te[ue+1]&&(!N||N(this.boxKeys[se]))){if(L.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[se],x1:te[ue],y1:te[ue+1],x2:te[ue+2],y2:te[ue+3]})}}}const $=this.circleCells[S];if($!==null){const te=this.circles;for(const se of $)if(!U.circle[se]){U.circle[se]=!0;const ue=3*se;if(this._circleAndRectCollide(te[ue],te[ue+1],te[ue+2],c,p,v,E)&&(!N||N(this.circleKeys[se]))){if(L.hitTest)return M.push(!0),!0;{const le=te[ue],ce=te[ue+1],X=te[ue+2];M.push({key:this.circleKeys[se],x1:le-X,y1:ce-X,x2:le+X,y2:ce+X})}}}}}_queryCellCircle(c,p,v,E,S,M,L,N){const U=L.circle,B=L.seenUids,$=this.boxCells[S];if($!==null){const se=this.bboxes;for(const ue of $)if(!B.box[ue]){B.box[ue]=!0;const le=4*ue;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[le+0],se[le+1],se[le+2],se[le+3])&&(!N||N(this.boxKeys[ue])))return M.push(!0),!0}}const te=this.circleCells[S];if(te!==null){const se=this.circles;for(const ue of te)if(!B.circle[ue]){B.circle[ue]=!0;const le=3*ue;if(this._circlesCollide(se[le],se[le+1],se[le+2],U.x,U.y,U.radius)&&(!N||N(this.circleKeys[ue])))return M.push(!0),!0}}}_forEachCell(c,p,v,E,S,M,L,N){const U=this._convertToXCellCoord(c),B=this._convertToYCellCoord(p),$=this._convertToXCellCoord(v),te=this._convertToYCellCoord(E);for(let se=U;se<=$;se++)for(let ue=B;ue<=te;ue++)if(S.call(this,c,p,v,E,this.xCellCount*ue+se,M,L,N))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,p,v,E,S,M){const L=E-c,N=S-p,U=v+M;return U*U>L*L+N*N}_circleAndRectCollide(c,p,v,E,S,M,L){const N=(M-E)/2,U=Math.abs(c-(E+N));if(U>N+v)return!1;const B=(L-S)/2,$=Math.abs(p-(S+B));if($>B+v)return!1;if(U<=N||$<=B)return!0;const te=U-N,se=$-B;return te*te+se*se<=v*v}}const Sl={unknown:0,flipRequired:1,flipNotRequired:2},Gh=Math.tan(85*Math.PI/180);function Ye(y,c,p,v,E,S,M){const L=s.create();if(p)if(S.name==="globe"){const N=s.calculateGlobeLabelMatrix(E,c);s.multiply(L,L,N)}else{const N=W([],M);L[0]=N[0],L[1]=N[1],L[4]=N[2],L[5]=N[3],v||s.rotateZ(L,L,E.angle)}else s.multiply(L,E.labelPlaneMatrix,y);return L}function Il(y,c,p,v,E,S,M){const L=Ye(y,c,p,v,E,S,M);return S.name==="globe"&&p||(L[2]=L[6]=L[10]=L[14]=0),L}function Xi(y,c,p,v,E,S,M){if(p){if(S.name==="globe"){const L=Ye(y,c,p,v,E,S,M);return s.invert(L,L),s.multiply(L,y,L),L}{const L=s.clone(y),N=s.identity([]);return N[0]=M[0],N[1]=M[1],N[4]=M[2],N[5]=M[3],s.multiply(L,L,N),v||s.rotateZ(L,L,-E.angle),L}}return E.glCoordMatrix}function xo(y,c,p,v){const E=[y,c,p,1];p?s.transformMat4$1(E,E,v):Rr(E,E,v);const S=E[3];return E[0]/=S,E[1]/=S,E[2]/=S,E}function __(y,c){return Math.min(.5+y/c*.5,1.5)}function $a(y,c){const p=y[0]/y[3],v=y[1]/y[3];return p>=-c[0]&&p<=c[0]&&v>=-c[1]&&v<=c[1]}function Ig(y,c,p,v,E,S,M,L,N,U){const B=p.transform,$=v?y.textSizeData:y.iconSizeData,te=s.evaluateSizeForZoom($,p.transform.zoom),se=B.projection.name==="globe",ue=[256/p.width*2+1,256/p.height*2+1],le=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;le.clear();let ce=null;se&&(ce=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const X=y.lineVertexArray,oe=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,pe=p.transform.width/p.transform.height;let de,be=!1;for(let Se=0;Se<oe.length;Se++){const Te=oe.get(Se),{numGlyphs:Me,writingMode:Ae}=Te;if(Ae!==s.WritingMode.vertical||be||de===s.WritingMode.horizontal||(be=!0),de=Ae,(Te.hidden||Ae===s.WritingMode.vertical)&&!be){Sa(Me,le);continue}be=!1;const Be=new s.Point(Te.tileAnchorX,Te.tileAnchorY);let{x:ct,y:Re,z:rt}=B.projection.projectTilePoint(Be.x,Be.y,U.canonical);if(N){const[pr,Gt,or]=N(Be);ct+=pr,Re+=Gt,rt+=or}const Ve=[ct,Re,rt,1];if(s.transformMat4$1(Ve,Ve,c),!$a(Ve,ue)){Sa(Me,le);continue}const ut=__(p.transform.cameraToCenterDistance,Ve[3]),Fe=s.evaluateSizeForFeature($,te,Te),tt=M?Fe/ut:Fe*ut,ft=xo(ct,Re,rt,E);if(ft[3]<=0){Sa(Me,le);continue}let st={};const pt=M?null:N,Ht=Dt(Te,tt,!1,L,c,E,S,y.glyphOffsetArray,X,le,ce,ft,Be,st,pe,pt,B.projection,U,M);be=Ht.useVertical,pt&&Ht.needsFlipping&&(st={}),(Ht.notEnoughRoom||be||Ht.needsFlipping&&Dt(Te,tt,!0,L,c,E,S,y.glyphOffsetArray,X,le,ce,ft,Be,st,pe,pt,B.projection,U,M).notEnoughRoom)&&Sa(Me,le)}v?(y.text.dynamicLayoutVertexBuffer.updateData(le),ce&&y.text.globeExtVertexBuffer.updateData(ce)):(y.icon.dynamicLayoutVertexBuffer.updateData(le),ce&&y.icon.globeExtVertexBuffer.updateData(ce))}function v_(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le){const{lineStartIndex:ce,glyphStartIndex:X,segment:oe}=L,pe=X+L.numGlyphs,de=ce+L.lineLength,be=c.getoffsetX(X),Se=c.getoffsetX(pe-1),Te=Bs(y*be,p,v,E,S,M,oe,ce,de,N,U,B,$,te,!0,se,ue,le);if(!Te)return null;const Me=Bs(y*Se,p,v,E,S,M,oe,ce,de,N,U,B,$,te,!0,se,ue,le);return Me?{first:Te,last:Me}:null}function zc(y,c,p,v){return y===s.WritingMode.horizontal&&Math.abs(v)>Math.abs(p)?{useVertical:!0}:y===s.WritingMode.vertical?v>0?{needsFlipping:!0}:null:c!==Sl.unknown&&function(E,S){return E===0||Math.abs(S/E)>Gh}(p,v)?c===Sl.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function Dt(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le,ce,X,oe){const pe=c/24,de=y.lineOffsetX*pe,be=y.lineOffsetY*pe,{lineStartIndex:Se,glyphStartIndex:Te,numGlyphs:Me,segment:Ae,writingMode:Be,flipState:ct}=y,Re=Se+y.lineLength,rt=Ve=>{if(B){const[ft,st,pt]=Ve.up,Ht=U.length;s.updateGlobeVertexNormal(B,Ht+0,ft,st,pt),s.updateGlobeVertexNormal(B,Ht+1,ft,st,pt),s.updateGlobeVertexNormal(B,Ht+2,ft,st,pt),s.updateGlobeVertexNormal(B,Ht+3,ft,st,pt)}const[ut,Fe,tt]=Ve.point;s.addDynamicAttributes(U,ut,Fe,tt,Ve.angle)};if(Me>1){const Ve=v_(pe,L,de,be,p,$,te,y,N,S,se,le,!1,ce,X,oe);if(!Ve)return{notEnoughRoom:!0};if(v&&!p){let[ut,Fe,tt]=Ve.first.point,[ft,st,pt]=Ve.last.point;[ut,Fe]=xo(ut,Fe,tt,M),[ft,st]=xo(ft,st,pt,M);const Ht=zc(Be,ct,(ft-ut)*ue,st-Fe);if(y.flipState=Ht&&Ht.needsFlipping?Sl.flipRequired:Sl.flipNotRequired,Ht)return Ht}rt(Ve.first);for(let ut=Te+1;ut<Te+Me-1;ut++){const Fe=Bs(pe*L.getoffsetX(ut),de,be,p,$,te,Ae,Se,Re,N,S,se,le,!1,!1,ce,X,oe);if(!Fe)return U.length-=4*(ut-Te),{notEnoughRoom:!0};rt(Fe)}rt(Ve.last)}else{if(v&&!p){const ut=xo(te.x,te.y,0,E),Fe=Se+Ae+1,tt=new s.Point(N.getx(Fe),N.gety(Fe)),ft=xo(tt.x,tt.y,0,E),st=ft[3]>0?ft:Nr(te,tt,ut,1,E,void 0,ce,X.canonical),pt=zc(Be,ct,(st[0]-ut[0])*ue,st[1]-ut[1]);if(y.flipState=pt&&pt.needsFlipping?Sl.flipRequired:Sl.flipNotRequired,pt)return pt}const Ve=Bs(pe*L.getoffsetX(Te),de,be,p,$,te,Ae,Se,Re,N,S,se,le,!1,!1,ce,X,oe);if(!Ve)return{notEnoughRoom:!0};rt(Ve)}return{}}function Ur(y,c,p,v,E){const{x:S,y:M,z:L}=v.projectTilePoint(y.x,y.y,c);if(!E)return xo(S,M,L,p);const[N,U,B]=E(y);return xo(S+N,M+U,L+B,p)}function Nr(y,c,p,v,E,S,M,L){const N=Ur(y.sub(c)._unit()._add(y),L,E,M,S);return s.sub(N,p,N),s.normalize(N,N),s.scaleAndAdd(N,p,N,v)}function Bs(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le,ce,X){const oe=v?y-c:y+c;let pe=oe>0?1:-1,de=0;v&&(pe*=-1,de=Math.PI),pe<0&&(de+=Math.PI);let be=L+M+(pe>0?0:1)|0,Se=E,Te=E,Me=0,Ae=0;const Be=Math.abs(oe),ct=[],Re=[];let rt=S,Ve=rt;const ut=()=>Nr(Ve,rt,Te,Be-Me+1,B,te,le,ce.canonical);for(;Me+Ae<=Be;){if(be+=pe,be<L||be>=N)return null;if(Te=Se,Ve=rt,ct.push(Te),se&&Re.push(Ve),rt=new s.Point(U.getx(be),U.gety(be)),Se=$[be],!Se){const or=Ur(rt,ce.canonical,B,le,te);Se=or[3]>0?$[be]=or:ut()}Me+=Ae,Ae=s.distance(Te,Se)}ue&&te&&($[be]&&(Se=ut(),Ae=s.distance(Te,Se)),$[be]=Se);const Fe=(Be-Me)/Ae,tt=rt.sub(Ve)._mult(Fe)._add(Ve),ft=s.sub([],Se,Te),st=s.scaleAndAdd([],Te,ft,Fe);let pt=[0,0,1],Ht=ft[0],pr=ft[1];if(X&&(pt=le.upVector(ce.canonical,tt.x,tt.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const or=[pt[2],0,-pt[0]],kr=s.cross([],pt,or);s.normalize(or,or),s.normalize(kr,kr),Ht=s.dot(ft,or),pr=s.dot(ft,kr)}if(p){const or=s.cross([],pt,ft);s.normalize(or,or),s.scaleAndAdd(st,st,or,p*pe)}const Gt=de+Math.atan2(pr,Ht);return ct.push(st),se&&Re.push(tt),{point:st,angle:Gt,path:ct,tilePath:Re,up:pt}}function Sa(y,c){const p=c.length,v=p+4*y;c.resize(v),c.float32.fill(-1/0,4*p,4*v)}function Rr(y,c,p){const v=c[0],E=c[1];return y[0]=p[0]*v+p[4]*E+p[12],y[1]=p[1]*v+p[5]*E+p[13],y[3]=p[3]*v+p[7]*E+p[15],y}const Us=100;class Vh{constructor(c,p,v=new Hu(c.width+200,c.height+200,25),E=new Hu(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=E,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Us,this.screenBottomBoundary=c.height+Us,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=p}placeCollisionBox(c,p,v,E,S,M,L,N){let U=v.projectedAnchorX,B=v.projectedAnchorY,$=v.projectedAnchorZ;const te=v.elevation,se=v.tileID,ue=c.getProjection();if(te&&se){const[Se,Te,Me]=ue.upVector(se.canonical,v.tileAnchorX,v.tileAnchorY),Ae=ue.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=Se*te*Ae,B+=Te*te*Ae,$+=Me*te*Ae}const le=this.projectAndGetPerspectiveRatio(L,U,B,$,v.tileID,ue.name==="globe"||!!te||this.transform.pitch>0,ue),ce=M*le.perspectiveRatio,X=(v.x1*p+E.x-v.padding)*ce+le.point.x,oe=(v.y1*p+E.y-v.padding)*ce+le.point.y,pe=(v.x2*p+E.x+v.padding)*ce+le.point.x,de=(v.y2*p+E.y+v.padding)*ce+le.point.y,be=le.perspectiveRatio<=.55||le.occluded;return!this.isInsideGrid(X,oe,pe,de)||!S&&this.grid.hitTest(X,oe,pe,de,N)||be?{box:[],offscreen:!1,occluded:le.occluded}:{box:[X,oe,pe,de],offscreen:this.isOffscreen(X,oe,pe,de),occluded:!1}}placeCollisionCircles(c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le){const ce=[],X=this.transform.elevation,oe=c.getProjection(),pe=X?X.getAtTileOffsetFunc(le,this.transform.center.lat,this.transform.worldSize,oe):null,de=new s.Point(v.tileAnchorX,v.tileAnchorY);let{x:be,y:Se,z:Te}=oe.projectTilePoint(de.x,de.y,le.canonical);if(pe){const[tt,ft,st]=pe(de);be+=tt,Se+=ft,Te+=st}const Me=oe.name==="globe",Ae=this.projectAndGetPerspectiveRatio(L,be,Se,Te,le,Me||!!X||this.transform.pitch>0,oe),{perspectiveRatio:Be}=Ae,ct=($?M/Be:M*Be)/s.ONE_EM,Re=xo(be,Se,Te,N),rt=Ae.signedDistanceFromCamera>0?v_(ct,S,v.lineOffsetX*ct,v.lineOffsetY*ct,!1,Re,de,v,E,N,{},X&&!$?pe:null,$&&!!X,oe,le,$):null;let Ve=!1,ut=!1,Fe=!0;if(rt&&!Ae.occluded){const tt=.5*se*Be+ue,ft=new s.Point(-100,-100),st=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),pt=new Sg,{first:Ht,last:pr}=rt,Gt=Ht.path.length;let or=[];for(let Xt=Gt-1;Xt>=1;Xt--)or.push(Ht.path[Xt]);for(let Xt=1;Xt<pr.path.length;Xt++)or.push(pr.path[Xt]);const kr=2.5*tt;U&&(or=or.map(([Xt,Fn,jn],qn)=>(pe&&!Me&&(jn=pe(qn<Gt-1?Ht.tilePath[Gt-1-qn]:pr.tilePath[qn-Gt+2])[2]),xo(Xt,Fn,jn,U))),or.some(Xt=>Xt[3]<=0)&&(or=[]));let Dr=[];if(or.length>0){let Xt=1/0,Fn=-1/0,jn=1/0,qn=-1/0;for(const $n of or)Xt=Math.min(Xt,$n[0]),jn=Math.min(jn,$n[1]),Fn=Math.max(Fn,$n[0]),qn=Math.max(qn,$n[1]);Fn>=ft.x&&Xt<=st.x&&qn>=ft.y&&jn<=st.y&&(Dr=[or.map($n=>new s.Point($n[0],$n[1]))],(Xt<ft.x||Fn>st.x||jn<ft.y||qn>st.y)&&(Dr=s.clipLine(Dr,ft.x,ft.y,st.x,st.y)))}for(const Xt of Dr){pt.reset(Xt,.25*tt);let Fn=0;Fn=pt.length<=.5*tt?1:Math.ceil(pt.paddedLength/kr)+1;for(let jn=0;jn<Fn;jn++){const qn=jn/Math.max(Fn-1,1),$n=pt.lerp(qn),Ho=$n.x+Us,Eo=$n.y+Us;ce.push(Ho,Eo,tt,0);const na=Ho-tt,Ha=Eo-tt,mi=Ho+tt,Zn=Eo+tt;if(Fe=Fe&&this.isOffscreen(na,Ha,mi,Zn),ut=ut||this.isInsideGrid(na,Ha,mi,Zn),!p&&this.grid.hitTestCircle(Ho,Eo,tt,te)&&(Ve=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!B&&Ve||!ut?[]:ce,offscreen:Fe,collisionDetected:Ve,occluded:Ae.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let v=1/0,E=1/0,S=-1/0,M=-1/0;for(const B of c){const $=new s.Point(B.x+Us,B.y+Us);v=Math.min(v,$.x),E=Math.min(E,$.y),S=Math.max(S,$.x),M=Math.max(M,$.y),p.push($)}const L=this.grid.query(v,E,S,M).concat(this.ignoredGrid.query(v,E,S,M)),N={},U={};for(const B of L){const $=B.key;if(N[$.bucketInstanceId]===void 0&&(N[$.bucketInstanceId]={}),N[$.bucketInstanceId][$.featureIndex])continue;const te=[new s.Point(B.x1,B.y1),new s.Point(B.x2,B.y1),new s.Point(B.x2,B.y2),new s.Point(B.x1,B.y2)];s.polygonIntersectsPolygon(p,te)&&(N[$.bucketInstanceId][$.featureIndex]=!0,U[$.bucketInstanceId]===void 0&&(U[$.bucketInstanceId]=[]),U[$.bucketInstanceId].push($.featureIndex))}return U}insertCollisionBox(c,p,v,E,S){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:S},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,p,v,E,S){const M=p?this.ignoredGrid:this.grid,L={bucketInstanceId:v,featureIndex:E,collisionGroupID:S};for(let N=0;N<c.length;N+=4)M.insertCircle(L,c[N],c[N+1],c[N+2])}projectAndGetPerspectiveRatio(c,p,v,E,S,M,L){const N=[p,v,E,1];let U=!1;E||this.transform.pitch>0?(s.transformMat4$1(N,N,c),this.fogState&&S&&L.name!=="globe"&&(U=function(te,se,ue,le,ce,X){const oe=X.calculateFogTileMatrix(ce),pe=[se,ue,le];return s.transformMat4(pe,pe,oe),at(te,pe,X.pitch,X._fov)}(this.fogState,p,v,E,S.toUnwrapped(),this.transform)>.9)):Rr(N,N,c);const B=N[3];return{point:new s.Point((N[0]/B+1)/2*this.transform.width+Us,(-N[1]/B+1)/2*this.transform.height+Us),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/B*.5,1.5),signedDistanceFromCamera:B,occluded:M&&N[2]>B||U}}isOffscreen(c,p,v,E){return v<Us||c>=this.screenRightBoundary||E<Us||p>this.screenBottomBoundary}isInsideGrid(c,p,v,E){return v>=0&&c<this.gridRightBoundary&&E>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const c=s.identity([]);return s.translate(c,c,[-100,-100,0]),c}}function Ku(y,c,p){const v=c.createTileMatrix(y,y.worldSize,p.toUnwrapped());return s.multiply(new Float32Array(16),y.projMatrix,v)}function Qs(y,c,p){if(c.projection.name===p.projection.name)return y.projMatrix;const v=p.clone();return v.setProjection(c.projection),Ku(v,c.getProjection(),y)}function gi(y,c,p){return c.name===p.projection.name?y.projMatrix:Ku(p,c,y)}class x_{constructor(c,p,v,E){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):E&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class Pl{constructor(c,p,v,E,S,M=!1){this.text=new x_(c?c.text:null,p,v,S),this.icon=new x_(c?c.icon:null,p,E,S),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jh{constructor(c,p,v,E=!1){this.text=c,this.icon=p,this.skipFade=v,this.clipped=E}}class qh{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Pg{constructor(c,p,v,E,S){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=v,this.bucketIndex=E,this.tileID=S}}class w_{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:v=>v.collisionGroupID===p}}return this.collisionGroups[c]}}function $h(y,c,p,v,E){const{horizontalAlign:S,verticalAlign:M}=s.getAnchorAlignment(y),L=-(S-.5)*c,N=-(M-.5)*p,U=s.evaluateVariableOffset(y,v);return new s.Point(L+U[0]*E,N+U[1]*E)}function Zh(y,c,p,v,E){const S=new s.Point(y,c);return p&&S._rotate(v?E:-E),S}class mp{constructor(c,p,v,E,S){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Vh(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new w_(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,p,v,E){const S=v.getBucket(p),M=v.latestFeatureIndex;if(!S||!M||p.id!==S.layerIds[0])return;const L=S.layers[0].layout,N=v.collisionBoxArray,U=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),B=v.tileSize/s.EXTENT,$=v.tileID.toUnwrapped();this.transform.setProjection(S.projection);const te=(se=v.tileID,ue=S.getProjection(),le=this.transform,ue.name===this.projection?le.calculateProjMatrix(se.toUnwrapped()):Ku(le,ue,se));var se,ue,le;const ce=L.get("text-pitch-alignment")==="map",X=L.get("text-rotation-alignment")==="map";p.compileFilter();const oe=p.dynamicFilter(),pe=p.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(v),be=Il(te,v.tileID.canonical,ce,X,this.transform,S.getProjection(),de);let Se=null;if(ce){const Ae=Xi(te,v.tileID.canonical,ce,X,this.transform,S.getProjection(),de);Se=s.multiply([],this.transform.labelPlaneMatrix,Ae)}let Te=null;oe&&v.latestFeatureIndex&&(Te={unwrappedTileID:$,dynamicFilter:oe,dynamicFilterNeedsFeature:pe,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Pg(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,v.tileID);const Me={bucket:S,layout:L,posMatrix:te,textLabelPlaneMatrix:be,labelToScreenMatrix:Se,clippingData:Te,scale:U,textPixelRatio:B,holdingForFade:v.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(E)for(const Ae of S.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:ct,symbolInstanceEnd:Re}=Ae;c.push({sortKey:Be,symbolInstanceStart:ct,symbolInstanceEnd:Re,parameters:Me})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le,ce,X,oe){const{textOffset0:pe,textOffset1:de,crossTileID:be}=te,Se=[pe,de],Te=$h(c,v,E,Se,S),Me=this.collisionIndex.placeCollisionBox(ue,S,p,Zh(Te.x,Te.y,M,L,this.transform.angle),$,N,U,B.predicate);if(ce){const Ae=ue.getSymbolInstanceIconSize(oe,this.transform.zoom,te.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ue,Ae,ce,Zh(Te.x,Te.y,M,L,this.transform.angle),$,N,U,B.predicate).box.length===0)return}if(Me.box.length>0){let Ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ae=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Se,width:v,height:E,anchor:c,textScale:S,prevAnchor:Ae},this.markUsedJustification(ue,c,te,le),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,le,te),this.placedOrientations[be]=le),{shift:Te,placedGlyphBoxes:Me}}}placeLayerBucketPart(c,p,v,E){const{bucket:S,layout:M,posMatrix:L,textLabelPlaneMatrix:N,labelToScreenMatrix:U,clippingData:B,textPixelRatio:$,holdingForFade:te,collisionBoxArray:se,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:le,collisionGroup:ce}=c.parameters,X=M.get("text-optional"),oe=M.get("icon-optional"),pe=M.get("text-allow-overlap"),de=M.get("icon-allow-overlap"),be=M.get("text-rotation-alignment")==="map",Se=M.get("text-pitch-alignment")==="map",Te=M.get("icon-text-fit")!=="none",Me=M.get("symbol-z-order")==="viewport-y";this.transform.setProjection(S.projection);let Ae=pe&&(de||!S.hasIconData()||oe),Be=de&&(pe||!S.hasTextData()||X);!S.collisionArrays&&se&&S.deserializeCollisionBoxes(se),v&&E&&S.updateCollisionDebugBuffers(this.transform.zoom,se);const ct=(Re,rt,Ve)=>{const{crossTileID:ut,numVerticalGlyphVertices:Fe}=Re;if(B){const mi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zn=null;if(B.dynamicFilterNeedsFeature){const In=this.retainedQueryData[S.bucketInstanceId];Zn=B.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:In.bucketIndex,sourceLayerIndex:In.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(mi,Zn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new s.Point(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[ut]=new jh(!1,!1,!1,!0),void p.add(ut)}if(p.has(ut))return;if(te)return void(this.placements[ut]=new jh(!1,!1,!1));let tt=!1,ft=!1,st=!0,pt=!1,Ht=!1,pr=null,Gt={box:null,offscreen:null,occluded:null},or={box:null,offscreen:null,occluded:null},kr=null,Dr=null,Xt=null,Fn=0,jn=0,qn=0;Ve.textFeatureIndex?Fn=Ve.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Fn=Re.featureIndex),Ve.verticalTextFeatureIndex&&(jn=Ve.verticalTextFeatureIndex);const $n=mi=>{mi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Zn=this.transform.elevation;(Zn||mi.elevation)&&(mi.elevation=Zn?Zn.getAtTileOffset(mi.tileID,mi.tileAnchorX,mi.tileAnchorY):0)},Ho=Ve.textBox;if(Ho){$n(Ho);const mi=In=>{let Wi=s.WritingMode.horizontal;if(S.allowVerticalPlacement&&!In&&this.prevPlacement){const fs=this.prevPlacement.placedOrientations[ut];fs&&(this.placedOrientations[ut]=fs,Wi=fs,this.markUsedOrientation(S,Wi,Re))}return Wi},Zn=(In,Wi)=>{if(S.allowVerticalPlacement&&Fe>0&&Ve.verticalTextBox){for(const fs of S.writingModes)if(fs===s.WritingMode.vertical?(Gt=Wi(),or=Gt):Gt=In(),Gt&&Gt.box&&Gt.box.length)break}else Gt=In()};if(M.get("text-variable-anchor")){let In=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ut]){const li=this.prevPlacement.variableOffsets[ut];In.indexOf(li.anchor)>0&&(In=In.filter(bs=>bs!==li.anchor),In.unshift(li.anchor))}const Wi=(li,bs,jp)=>{const ic=S.getSymbolInstanceTextSize(ue,Re,this.transform.zoom,rt),pf=(li.x2-li.x1)*ic+2*li.padding,Nl=(li.y2-li.y1)*ic+2*li.padding,mu=Te&&!de?bs:null;mu&&$n(mu);let oc={box:[],offscreen:!1,occluded:!1};const qp=pe?2*In.length:In.length;for(let df=0;df<qp;++df){const ym=this.attemptAnchorPlacement(In[df%In.length],li,pf,Nl,ic,be,Se,$,L,ce,df>=In.length,Re,rt,S,jp,mu,ue,le);if(ym&&(oc=ym.placedGlyphBoxes,oc&&oc.box&&oc.box.length)){tt=!0,pr=ym.shift;break}}return oc};Zn(()=>Wi(Ho,Ve.iconBox,s.WritingMode.horizontal),()=>{const li=Ve.verticalTextBox;return li&&$n(li),S.allowVerticalPlacement&&!(Gt&&Gt.box&&Gt.box.length)&&Fe>0&&li?Wi(li,Ve.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Gt&&(tt=Gt.box,st=Gt.offscreen,pt=Gt.occluded);const fs=mi(!(!Gt||!Gt.box));if(!tt&&this.prevPlacement){const li=this.prevPlacement.variableOffsets[ut];li&&(this.variableOffsets[ut]=li,this.markUsedJustification(S,li.anchor,Re,fs))}}else{const In=(Wi,fs)=>{const li=S.getSymbolInstanceTextSize(ue,Re,this.transform.zoom,rt),bs=this.collisionIndex.placeCollisionBox(S,li,Wi,new s.Point(0,0),pe,$,L,ce.predicate);return bs&&bs.box&&bs.box.length&&(this.markUsedOrientation(S,fs,Re),this.placedOrientations[ut]=fs),bs};Zn(()=>In(Ho,s.WritingMode.horizontal),()=>{const Wi=Ve.verticalTextBox;return S.allowVerticalPlacement&&Fe>0&&Wi?($n(Wi),In(Wi,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),mi(!!(Gt&&Gt.box&&Gt.box.length))}}if(kr=Gt,tt=kr&&kr.box&&kr.box.length>0,st=kr&&kr.offscreen,pt=kr&&kr.occluded,Re.useRuntimeCollisionCircles){const mi=S.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),Zn=s.evaluateSizeForFeature(S.textSizeData,ue,mi),In=M.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(S,pe,mi,S.lineVertexArray,S.glyphOffsetArray,Zn,L,N,U,v,Se,ce.predicate,Re.collisionCircleDiameter*Zn/s.ONE_EM,In,this.retainedQueryData[S.bucketInstanceId].tileID),tt=pe||Dr.circles.length>0&&!Dr.collisionDetected,st=st&&Dr.offscreen,pt=Dr.occluded}if(Ve.iconFeatureIndex&&(qn=Ve.iconFeatureIndex),Ve.iconBox){const mi=Zn=>{$n(Zn);const In=Te&&pr?Zh(pr.x,pr.y,be,Se,this.transform.angle):new s.Point(0,0),Wi=S.getSymbolInstanceIconSize(le,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Wi,Zn,In,de,$,L,ce.predicate)};or&&or.box&&or.box.length&&Ve.verticalIconBox?(Xt=mi(Ve.verticalIconBox),ft=Xt.box.length>0):(Xt=mi(Ve.iconBox),ft=Xt.box.length>0),st=st&&Xt.offscreen,Ht=Xt.occluded}const Eo=X||Re.numHorizontalGlyphVertices===0&&Fe===0,na=oe||Re.numIconVertices===0;if(Eo||na?na?Eo||(ft=ft&&tt):tt=ft&&tt:ft=tt=ft&&tt,tt&&kr&&kr.box&&this.collisionIndex.insertCollisionBox(kr.box,M.get("text-ignore-placement"),S.bucketInstanceId,or&&or.box&&jn?jn:Fn,ce.ID),ft&&Xt&&this.collisionIndex.insertCollisionBox(Xt.box,M.get("icon-ignore-placement"),S.bucketInstanceId,qn,ce.ID),Dr&&(tt&&this.collisionIndex.insertCollisionCircles(Dr.circles,M.get("text-ignore-placement"),S.bucketInstanceId,Fn,ce.ID),v)){const mi=S.bucketInstanceId;let Zn=this.collisionCircleArrays[mi];Zn===void 0&&(Zn=this.collisionCircleArrays[mi]=new qh);for(let In=0;In<Dr.circles.length;In+=4)Zn.circles.push(Dr.circles[In+0]),Zn.circles.push(Dr.circles[In+1]),Zn.circles.push(Dr.circles[In+2]),Zn.circles.push(Dr.collisionDetected?1:0)}const Ha=S.projection.name!=="globe";Ae=Ae&&(Ha||!pt),Be=Be&&(Ha||!Ht),this.placements[ut]=new jh(tt||Ae,ft||Be,st||S.justReloaded),p.add(ut)};if(Me){const Re=S.getSortedSymbolIndexes(this.transform.angle);for(let rt=Re.length-1;rt>=0;--rt){const Ve=Re[rt];ct(S.symbolInstances.get(Ve),Ve,S.collisionArrays[Ve])}}else for(let Re=c.symbolInstanceStart;Re<c.symbolInstanceEnd;Re++)ct(S.symbolInstances.get(Re),Re,S.collisionArrays[Re]);if(v&&S.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[S.bucketInstanceId];s.invert(Re.invProjMatrix,L),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(c,p,v,E){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:N,crossTileID:U}=v,B=s.getAnchorJustification(p),$=E===s.WritingMode.vertical?N:B==="left"?S:B==="center"?M:B==="right"?L:-1;S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=$>=0&&S!==$?0:U),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=$>=0&&M!==$?0:U),L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=$>=0&&L!==$?0:U),N>=0&&(c.text.placedSymbolArray.get(N).crossTileID=$>=0&&N!==$?0:U)}markUsedOrientation(c,p,v){const E=p===s.WritingMode.horizontal||p===s.WritingMode.horizontalOnly?p:0,S=p===s.WritingMode.vertical?p:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:U}=v,B=c.text.placedSymbolArray;M>=0&&(B.get(M).placedOrientation=E),L>=0&&(B.get(L).placedOrientation=E),N>=0&&(B.get(N).placedOrientation=E),U>=0&&(B.get(U).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let v=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const E=p?p.symbolFadeChange(c):1,S=p?p.opacities:{},M=p?p.variableOffsets:{},L=p?p.placedOrientations:{};for(const N in this.placements){const U=this.placements[N],B=S[N];B?(this.opacities[N]=new Pl(B,E,U.text,U.icon,null,U.clipped),v=v||U.text!==B.text.placed||U.icon!==B.icon.placed):(this.opacities[N]=new Pl(null,E,U.text,U.icon,U.skipFade,U.clipped),v=v||U.text||U.icon)}for(const N in S){const U=S[N];if(!this.opacities[N]){const B=new Pl(U,E,!1,!1);B.isHidden()||(this.opacities[N]=B,v=v||U.text.placed||U.icon.placed)}}for(const N in M)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=M[N]);for(const N in L)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=L[N]);v?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)}updateLayerOpacities(c,p){const v=new Set;for(const E of p){const S=E.getBucket(c);S&&E.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,v,E.collisionBoxArray)}}updateBucketOpacities(c,p,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const E=c.layers[0].layout,S=!!c.layers[0].dynamicFilter(),M=new Pl(null,0,!1,!1,!0),L=E.get("text-allow-overlap"),N=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),B=E.get("text-rotation-alignment")==="map",$=E.get("text-pitch-alignment")==="map",te=E.get("icon-text-fit")!=="none",se=new Pl(null,0,L&&(N||!c.hasIconData()||E.get("icon-optional")),N&&(L||!c.hasTextData()||E.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const ue=(ce,X,oe)=>{for(let pe=0;pe<X/4;pe++)ce.opacityVertexArray.emplaceBack(oe)};let le=0;for(let ce=0;ce<c.symbolInstances.length;ce++){const X=c.symbolInstances.get(ce),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:pe,crossTileID:de,numIconVertices:be}=X,Se=p.has(de);let Te=this.opacities[de];Se?Te=M:Te||(Te=se,this.opacities[de]=Te),p.add(de);const Me=oe>0||pe>0,Ae=be>0,Be=this.placedOrientations[de],ct=Be===s.WritingMode.vertical,Re=Be===s.WritingMode.horizontal||Be===s.WritingMode.horizontalOnly;if(!Me&&!Ae||Te.isHidden()||le++,Me){const rt=Xh(Te.text);ue(c.text,oe,ct?Li:rt),ue(c.text,pe,Re?Li:rt);const Ve=Te.text.isHidden(),{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:Fe,rightJustifiedTextSymbolIndex:tt,verticalPlacedTextSymbolIndex:ft}=X,st=c.text.placedSymbolArray,pt=Ve||ct?1:0;ut>=0&&(st.get(ut).hidden=pt),Fe>=0&&(st.get(Fe).hidden=pt),tt>=0&&(st.get(tt).hidden=pt),ft>=0&&(st.get(ft).hidden=Ve||Re?1:0);const Ht=this.variableOffsets[de];Ht&&this.markUsedJustification(c,Ht.anchor,X,Be);const pr=this.placedOrientations[de];pr&&(this.markUsedJustification(c,"left",X,pr),this.markUsedOrientation(c,pr,X))}if(Ae){const rt=Xh(Te.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:ut}=X,Fe=c.icon.placedSymbolArray,tt=Te.icon.isHidden()?1:0;Ve>=0&&(ue(c.icon,be,ct?Li:rt),Fe.get(Ve).hidden=tt),ut>=0&&(ue(c.icon,X.numVerticalIconVertices,Re?Li:rt),Fe.get(ut).hidden=tt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const rt=c.collisionArrays[ce];if(rt){let Ve=new s.Point(0,0),ut=!0;if(rt.textBox||rt.verticalTextBox){if(U){const tt=this.variableOffsets[de];tt?(Ve=$h(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textScale),B&&Ve._rotate($?this.transform.angle:-this.transform.angle)):ut=!1}S&&(ut=!Te.clipped),rt.textBox&&Bc(c.textCollisionBox.collisionVertexArray,Te.text.placed,!ut||ct,Ve.x,Ve.y),rt.verticalTextBox&&Bc(c.textCollisionBox.collisionVertexArray,Te.text.placed,!ut||Re,Ve.x,Ve.y)}const Fe=ut&&!!(!Re&&rt.verticalIconBox);rt.iconBox&&Bc(c.iconCollisionBox.collisionVertexArray,Te.icon.placed,Fe,te?Ve.x:0,te?Ve.y:0),rt.verticalIconBox&&Bc(c.iconCollisionBox.collisionVertexArray,Te.icon.placed,!Fe,te?Ve.x:0,te?Ve.y:0)}}}if(c.fullyClipped=le===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ce.invProjMatrix,c.placementViewportMatrix=ce.viewportMatrix,c.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,p){const v=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function Bc(y,c,p,v,E){y.emplaceBack(c?1:0,p?1:0,v||0,E||0),y.emplaceBack(c?1:0,p?1:0,v||0,E||0),y.emplaceBack(c?1:0,p?1:0,v||0,E||0),y.emplaceBack(c?1:0,p?1:0,v||0,E||0)}const ws=Math.pow(2,25),Bi=Math.pow(2,24),Cg=Math.pow(2,17),Ag=Math.pow(2,16),Es=Math.pow(2,9),ea=Math.pow(2,8),E_=Math.pow(2,1);function Xh(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const c=y.placed?1:0,p=Math.floor(127*y.opacity);return p*ws+c*Bi+p*Cg+c*Ag+p*Es+c*ea+p*E_+c}const Li=0;class Wh{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,p,v,E,S){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(p.getBucketParts(M,E,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((L,N)=>L.sortKey-N.sortKey));this._currentPartIndex<M.length;){const L=M[this._currentPartIndex];if(p.placeLayerBucketPart(L,this._seenCrossTileIDs,v,L.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class Mg{constructor(c,p,v,E,S,M,L,N){this.placement=new mp(c,S,M,L,N),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(c,p,v){const E=s.exported.now(),S=()=>{const M=s.exported.now()-E;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=p[c[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Wh(M)),this._inProgressLayer.continuePlacement(v[M.source],this.placement,this._showCollisionBoxes,M,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Yu=512/s.EXTENT/2;class ko{constructor(c,p,v){this.tileID=c,this.bucketInstanceId=v,this.index=new s.KDBush(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=c.canonical.x*s.EXTENT,S=c.canonical.y*s.EXTENT;for(let M=0;M<p.length;M++){const{key:L,crossTileID:N,tileAnchorX:U,tileAnchorY:B}=p.get(M),$=Math.floor((E+U)*Yu),te=Math.floor((S+B)*Yu);this.index.add($,te),this.keys.push(L),this.crossTileIDs.push(N)}this.index.finish()}findMatches(c,p,v){const E=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),S=Yu/Math.pow(2,p.canonical.z-this.tileID.canonical.z),M=p.canonical.x*s.EXTENT,L=p.canonical.y*s.EXTENT;for(let N=0;N<c.length;N++){const U=c.get(N);if(U.crossTileID)continue;const{key:B,tileAnchorX:$,tileAnchorY:te}=U,se=Math.floor((M+$)*S),ue=Math.floor((L+te)*S),le=this.index.range(se-E,ue-E,se+E,ue+E);for(const ce of le){const X=this.crossTileIDs[ce];if(this.keys[ce]===B&&!v.has(X)){v.add(X),U.crossTileID=X;break}}}}}class Lg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Og{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const p=Math.round((c-this.lng)/360);if(p!==0)for(const v in this.indexes){const E=this.indexes[v],S={};for(const M in E){const L=E[M];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+p),S[L.tileID.key]=L}this.indexes[v]=S}this.lng=c}addBucket(c,p,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<p.symbolInstances.length;S++)p.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const E=this.usedCrossTileIDs[c.overscaledZ];for(const S in this.indexes){const M=this.indexes[S];if(Number(S)>c.overscaledZ)for(const L in M){const N=M[L];N.tileID.isChildOf(c)&&N.findMatches(p.symbolInstances,c,E)}else{const L=M[c.scaledTo(Number(S)).key];L&&L.findMatches(p.symbolInstances,c,E)}}for(let S=0;S<p.symbolInstances.length;S++){const M=p.symbolInstances.get(S);M.crossTileID||(M.crossTileID=v.generate(),E.add(M.crossTileID))}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new ko(c,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(c,p){for(const v of p.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let p=!1;for(const v in this.indexes){const E=this.indexes[v];for(const S in E)c[E[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,E[S]),delete E[S],p=!0)}return p}}class Cl{constructor(){this.layerIndexes={},this.crossTileIDs=new Lg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,p,v,E){let S=this.layerIndexes[c.id];S===void 0&&(S=this.layerIndexes[c.id]=new Og);let M=!1;const L={};E.name!=="globe"&&S.handleWrapJump(v);for(const N of p){const U=N.getBucket(c);U&&c.id===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(N.tileID,U,this.crossTileIDs)&&(M=!0),L[U.bucketInstanceId]=!0)}return S.removeStaleBuckets(L)&&(M=!0),M}pruneUnusedLayers(c){const p={};c.forEach(v=>{p[v]=!0});for(const v in this.layerIndexes)p[v]||delete this.layerIndexes[v]}}const du=(y,c)=>s.emitValidationErrors(y,c&&c.filter(p=>p.identifier!=="source.canvas")),yp=s.pick(On,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),U1=s.pick(On,["setCenter","setZoom","setBearing","setPitch"]),Dg={version:8,layers:[],sources:{}},Uc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Za extends s.Evented{constructor(c,p={}){super(),this.map=c,this.dispatcher=new mt(Fc(),this),this.imageManager=new Oe,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(c._requestManager,p.localFontFamily?s.LocalGlyphMode.all:p.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,p.localFontFamily||p.localIdeographFontFamily),this.crossTileSymbolIndex=new Cl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const v=this;this._rtlTextPluginCallback=Za.registerForPluginStateChange(E=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(S,M)=>{if(s.triggerPluginCompletionEvent(S),M&&M.every(L=>L))for(const L in v._sourceCaches){const N=v._sourceCaches[L],U=N.getSource().type;U!=="vector"&&U!=="geojson"||N.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const S=this.getSource(E.sourceId);if(S&&S.vectorLayerIds)for(const M in this._layers){const L=this._layers[M];L.source===S.id&&this._validateLayer(L)}})}loadURL(c,p={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const v=typeof p.validate=="boolean"?p.validate:!s.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);const E=this.map._requestManager.transformRequest(c,s.ResourceType.Style);this._request=s.getJSON(E,(S,M)=>{this._request=null,S?this.fire(new s.ErrorEvent(S)):M&&this._load(M,v)})}loadJSON(c,p={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(c,p.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Dg,!1)}_updateLayerCount(c,p){const v=p?1:-1;c.is3D()&&(this._num3DLayers+=v),c.type==="circle"&&(this._numCircleLayers+=v),c.type==="symbol"&&(this._numSymbolLayers+=v)}_load(c,p){if(p&&du(this,s.validateStyle(c)))return;this._loaded=!0,this.stylesheet=s.clone$1(c),this._updateMapProjection();for(const E in c.sources)this.addSource(E,c.sources[E],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const v=y_(this.stylesheet.layers);this._order=v.map(E=>E.id),this._layers={},this._serializedLayers={};for(const E of v){const S=s.createStyleLayer(E);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new We(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(p,v,E){let S,M,L;const N=s.exported.devicePixelRatio>1?"@2x":"";let U=s.getJSON(v.transformRequest(v.normalizeSpriteURL(p,N,".json"),s.ResourceType.SpriteJSON),(te,se)=>{U=null,L||(L=te,S=se,$())}),B=s.getImage(v.transformRequest(v.normalizeSpriteURL(p,N,".png"),s.ResourceType.SpriteImage),(te,se)=>{B=null,L||(L=te,M=se,$())});function $(){if(L)E(L);else if(S&&M){const te=s.exported.getImageData(M),se={};for(const ue in S){const{width:le,height:ce,x:X,y:oe,sdf:pe,pixelRatio:de,stretchX:be,stretchY:Se,content:Te}=S[ue],Me=new s.RGBAImage({width:le,height:ce});s.RGBAImage.copy(te,Me,{x:X,y:oe},{x:0,y:0},{width:le,height:ce}),se[ue]={data:Me,pixelRatio:de,sdf:pe,stretchX:be,stretchY:Se,content:Te}}E(null,se)}}return{cancel(){U&&(U.cancel(),U=null),B&&(B.cancel(),B=null)}}}(c,this.map._requestManager,(p,v)=>{if(this._spriteRequest=null,p)this.fire(new s.ErrorEvent(p));else if(v)for(const E in v)this.imageManager.addImage(E,v[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(c){const p=this.getSource(c.source);if(!p)return;const v=c.sourceLayer;v&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${p.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const p=[];for(const v of c){const E=this._layers[v];E.type!=="custom"&&p.push(E.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped():Uc[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const p=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(E.length||S.length)&&this._updateWorkerLayers(E,S);for(const M in this._updatedSources){const L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const v={};for(const E in this._sourceCaches){const S=this._sourceCaches[E];v[E]=S.used,S.used=!1}for(const E of this._order){const S=this._layers[E];if(S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)){const L=this._getLayerSourceCache(S);L&&(L.used=!0)}const M=this.map.painter;if(M){const L=S.getProgramIds();if(!L)continue;const N=S.getProgramConfiguration(c.zoom);for(const U of L)M.useProgram(U,N)}}for(const E in v){const S=this._sourceCaches[E];v[E]!==S.used&&S.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),du(this,s.validateStyle(c)))return!1;(c=s.clone$1(c)).layers=y_(c.layers);const p=function(E,S){if(!E)return[{command:On.setStyle,args:[S]}];let M=[];try{if(!g(E.version,S.version))return[{command:On.setStyle,args:[S]}];g(E.center,S.center)||M.push({command:On.setCenter,args:[S.center]}),g(E.zoom,S.zoom)||M.push({command:On.setZoom,args:[S.zoom]}),g(E.bearing,S.bearing)||M.push({command:On.setBearing,args:[S.bearing]}),g(E.pitch,S.pitch)||M.push({command:On.setPitch,args:[S.pitch]}),g(E.sprite,S.sprite)||M.push({command:On.setSprite,args:[S.sprite]}),g(E.glyphs,S.glyphs)||M.push({command:On.setGlyphs,args:[S.glyphs]}),g(E.transition,S.transition)||M.push({command:On.setTransition,args:[S.transition]}),g(E.light,S.light)||M.push({command:On.setLight,args:[S.light]}),g(E.fog,S.fog)||M.push({command:On.setFog,args:[S.fog]}),g(E.projection,S.projection)||M.push({command:On.setProjection,args:[S.projection]});const L={},N=[];(function($,te,se,ue){let le;for(le in te=te||{},$=$||{})$.hasOwnProperty(le)&&(te.hasOwnProperty(le)||Uh(le,se,ue));for(le in te){if(!te.hasOwnProperty(le))continue;const ce=te[le];$.hasOwnProperty(le)?g($[le],ce)||($[le].type==="geojson"&&ce.type==="geojson"&&gp($,te,le)?se.push({command:On.setGeoJSONSourceData,args:[le,ce.data]}):bg(le,te,se,ue)):Eg(le,te,se)}})(E.sources,S.sources,N,L);const U=[];E.layers&&E.layers.forEach($=>{$.source&&L[$.source]?M.push({command:On.removeLayer,args:[$.id]}):U.push($)});let B=E.terrain;B&&L[B.source]&&(M.push({command:On.setTerrain,args:[void 0]}),B=void 0),M=M.concat(N),g(B,S.terrain)||M.push({command:On.setTerrain,args:[S.terrain]}),function($,te,se){te=te||[];const ue=($=$||[]).map(Tl),le=te.map(Tl),ce=$.reduce(Tg,{}),X=te.reduce(Tg,{}),oe=ue.slice(),pe=Object.create(null);let de,be,Se,Te,Me,Ae,Be;for(de=0,be=0;de<ue.length;de++)Se=ue[de],X.hasOwnProperty(Se)?be++:(se.push({command:On.removeLayer,args:[Se]}),oe.splice(oe.indexOf(Se,be),1));for(de=0,be=0;de<le.length;de++)Se=le[le.length-1-de],oe[oe.length-1-de]!==Se&&(ce.hasOwnProperty(Se)?(se.push({command:On.removeLayer,args:[Se]}),oe.splice(oe.lastIndexOf(Se,oe.length-be),1)):be++,Ae=oe[oe.length-de],se.push({command:On.addLayer,args:[X[Se],Ae]}),oe.splice(oe.length-de,0,Se),pe[Se]=!0);for(de=0;de<le.length;de++)if(Se=le[de],Te=ce[Se],Me=X[Se],!pe[Se]&&!g(Te,Me))if(g(Te.source,Me.source)&&g(Te["source-layer"],Me["source-layer"])&&g(Te.type,Me.type)){for(Be in qa(Te.layout,Me.layout,se,Se,null,On.setLayoutProperty),qa(Te.paint,Me.paint,se,Se,null,On.setPaintProperty),g(Te.filter,Me.filter)||se.push({command:On.setFilter,args:[Se,Me.filter]}),g(Te.minzoom,Me.minzoom)&&g(Te.maxzoom,Me.maxzoom)||se.push({command:On.setLayerZoomRange,args:[Se,Me.minzoom,Me.maxzoom]}),Te)Te.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?qa(Te[Be],Me[Be],se,Se,Be.slice(6),On.setPaintProperty):g(Te[Be],Me[Be])||se.push({command:On.setLayerProperty,args:[Se,Be,Me[Be]]}));for(Be in Me)Me.hasOwnProperty(Be)&&!Te.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?qa(Te[Be],Me[Be],se,Se,Be.slice(6),On.setPaintProperty):g(Te[Be],Me[Be])||se.push({command:On.setLayerProperty,args:[Se,Be,Me[Be]]}))}else se.push({command:On.removeLayer,args:[Se]}),Ae=oe[oe.lastIndexOf(Se)+1],se.push({command:On.addLayer,args:[Me,Ae]})}(U,S.layers,M)}catch(L){console.warn("Unable to compute style diff:",L),M=[{command:On.setStyle,args:[S]}]}return M}(this.serialize(),c).filter(E=>!(E.command in U1));if(p.length===0)return!1;const v=p.filter(E=>!(E.command in yp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);return p.forEach(E=>{E.command!=="setTransition"&&E.command!=="setProjection"&&this[E.command].apply(this,E.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,p){return this.getImage(c)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,p),this._afterImageUpdated(c),this)}updateImage(c,p){this.imageManager.updateImage(c,p)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,p,v={}){if(this._checkLoaded(),this.getSource(c)!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(s.validateSource,`sources.${c}`,p,null,v))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const E=Or(c,p,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:E.serialize(),sourceId:c}));const S=M=>{const L=(M?"symbol:":"other:")+c,N=this._sourceCaches[L]=new s.SourceCache(L,E,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[c]=N,N.style=this,N.onAdd(this.map)};S(!1),p.type!=="vector"&&p.type!=="geojson"||S(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const p=this.getSource(c);if(!p)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===c)return this.fire(new s.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new s.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(c);for(const E of v)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,p){this._checkLoaded(),this.getSource(c).setData(p),this._changed=!0}getSource(c){const p=this._getSourceCache(c);return p&&p.getSource()}_getSources(){const c=[];for(const p in this._otherSourceCaches){const v=this._getSourceCache(p);v&&c.push(v.getSource())}return c}addLayer(c,p,v={}){this._checkLoaded();const E=c.id;if(this.getLayer(E))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let S;if(c.type==="custom"){if(du(this,s.validateCustomStyleLayer(c)))return;S=s.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(E,c.source),c=s.clone$1(c),c=s.extend(c,{source:E})),this._validate(s.validateLayer,`layers.${E}`,c,{arrayIndex:-1},v))return;S=s.createStyleLayer(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const M=p?this._order.indexOf(p):this._order.length;if(p&&M===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`)));this._order.splice(M,0,E),this._layerOrderChanged=!0,this._layers[E]=S;const L=this._getLayerSourceCache(S);if(this._removedLayers[E]&&S.source&&L&&S.type!=="custom"){const N=this._removedLayers[E];delete this._removedLayers[E],N.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",L.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,p){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===p)return;const v=this._order.indexOf(c);this._order.splice(v,1);const E=p?this._order.indexOf(p):this._order.length;p&&E===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`))):(this._order.splice(E,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const p=this._layers[c];if(!p)return void this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));p.setEventedParent(null),this._updateLayerCount(p,!1);const v=this._order.indexOf(c);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const p in this._layers)if(this._layers[p].type===c)return!0;return!1}setLayerZoomRange(c,p,v){this._checkLoaded();const E=this.getLayer(c);E?E.minzoom===p&&E.maxzoom===v||(p!=null&&(E.minzoom=p),v!=null&&(E.maxzoom=v),this._updateLayer(E)):this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,p,v={}){this._checkLoaded();const E=this.getLayer(c);if(E){if(!g(E.filter,p))return p==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(s.validateFilter,`layers.${E.id}.filter`,p,{layerType:E.type},v)||(E.filter=s.clone$1(p),this._updateLayer(E)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const p=this.getLayer(c);return p&&s.clone$1(p.filter)}setLayoutProperty(c,p,v,E={}){this._checkLoaded();const S=this.getLayer(c);S?g(S.getLayoutProperty(p),v)||(S.setLayoutProperty(p,v,E),this._updateLayer(S)):this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,p){const v=this.getLayer(c);if(v)return v.getLayoutProperty(p);this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,p,v,E={}){this._checkLoaded();const S=this.getLayer(c);S?g(S.getPaintProperty(p),v)||(S.setPaintProperty(p,v,E)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,p){const v=this.getLayer(c);return v&&v.getPaintProperty(p)}setFeatureState(c,p){this._checkLoaded();const v=c.source,E=c.sourceLayer,S=this.getSource(v);if(!S)return void this.fire(new s.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=S.type;if(M==="geojson"&&E)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!E)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const L=this._getSourceCaches(v);for(const N of L)N.setFeatureState(E,c.id,p)}removeFeatureState(c,p){this._checkLoaded();const v=c.source,E=this.getSource(v);if(!E)return void this.fire(new s.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const S=E.type,M=S==="vector"?c.sourceLayer:void 0;if(S==="vector"&&!M)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const L=this._getSourceCaches(v);for(const N of L)N.removeFeatureState(M,c.id,p)}getFeatureState(c){this._checkLoaded();const p=c.source,v=c.sourceLayer,E=this.getSource(p);if(E){if(E.type!=="vector"||v)return c.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(p)[0].getFeatureState(v,c.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const p in this._sourceCaches){const v=this._sourceCaches[p].getSource();c[v.id]||(c[v.id]=v.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0;const p=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&p&&p.getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",p.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const p=M=>this._layers[M].type==="fill-extrusion",v={},E=[];for(let M=this._order.length-1;M>=0;M--){const L=this._order[M];if(p(L)){v[L]=M;for(const N of c){const U=N[L];if(U)for(const B of U)E.push(B)}}}E.sort((M,L)=>L.intersectionZ-M.intersectionZ);const S=[];for(let M=this._order.length-1;M>=0;M--){const L=this._order[M];if(p(L))for(let N=E.length-1;N>=0;N--){const U=E[N].feature;if(v[U.layer.id]<M)break;S.push(U),E.pop()}else for(const N of c){const U=N[L];if(U)for(const B of U)S.push(B.feature)}}return S}queryRenderedFeatures(c,p,v){p&&p.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",p.filter,null,p);const E={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of p.layers){const U=this._layers[N];if(!U)return this.fire(new s.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];E[U.source]=!0}}const S=[];p.availableImages=this._availableImages;const M=p&&p.layers?p.layers.some(N=>{const U=this.getLayer(N);return U&&U.is3D()}):this.has3DLayers(),L=It.createFromScreenPoints(c,v);for(const N in this._sourceCaches){const U=this._sourceCaches[N].getSource().id;p.layers&&!E[U]||S.push(Ei(this._sourceCaches[N],this._layers,this._serializedLayers,L,p,v,M,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(N,U,B,$,te,se,ue){const le={},ce=se.queryRenderedSymbols($),X=[];for(const oe of Object.keys(ce).map(Number))X.push(ue[oe]);X.sort(Xo);for(const oe of X){const pe=oe.featureIndex.lookupSymbolFeatures(ce[oe.bucketInstanceId],U,oe.bucketIndex,oe.sourceLayerIndex,te.filter,te.layers,te.availableImages,N);for(const de in pe){const be=le[de]=le[de]||[],Se=pe[de];Se.sort((Te,Me)=>{const Ae=oe.featureSortOrder;if(Ae){const Be=Ae.indexOf(Te.featureIndex);return Ae.indexOf(Me.featureIndex)-Be}return Me.featureIndex-Te.featureIndex});for(const Te of Se)be.push(Te)}}for(const oe in le)le[oe].forEach(pe=>{const de=pe.feature,be=B(N[oe]);if(!be)return;const Se=be.getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=Se});return le}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),L.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,p){p&&p.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",p.filter,null,p);const v=this._getSourceCaches(c);let E=[];for(const S of v)E=E.concat(Zi(S,p));return E}addSourceType(c,p,v){return Za.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(Za.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(c,p={}){this._checkLoaded();const v=this.light.getLight();let E=!1;for(const M in c)if(!g(c[M],v[M])){E=!0;break}if(!E)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,p),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,p=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;if(p===1){if(typeof v.source=="object"){const E="terrain-dem-src";this.addSource(E,v.source),v=s.clone$1(v),v=s.extend(v,{source:E})}if(this._validate(s.validateTerrain,"terrain",v))return}if(!this.terrain||this.terrain&&p!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,p)}else{const E=this.terrain,S=E.get();for(const M of Object.keys(s.spec.terrain))!v.hasOwnProperty(M)&&s.spec.terrain[M].default&&(v[M]=s.spec.terrain[M].default);for(const M in v)if(!g(v[M],S[M])){E.set(v),this.stylesheet.terrain=v;const L=this._setTransitionParameters({duration:0});E.updateTransitions(L);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const p=this.fog=new zt(c,this.map.transform);this.stylesheet.fog=c;const v=this._setTransitionParameters({duration:0});p.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog,v=p.get();Object.keys(c).length===0&&p.set(c);for(const E in c)if(!g(c[E],v[E])){p.set(c),this.stylesheet.fog=c;const S=this._setTransitionParameters({duration:0});p.updateTransitions(S);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:s.exported.now(),transition:s.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(v=>this.isLayerDraped(this._layers[v])),p=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...p)}_createTerrain(c,p){const v=this.terrain=new Pt(c,p);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const E=this._setTransitionParameters({duration:0});v.updateTransitions(E)}_force3DLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="symbol"&&this._updateLayer(p)}}_validate(c,p,v,E,S={}){return(!S||S.validate!==!1)&&du(this,c.call(s.validateStyle,s.extend({key:p,style:this.serialize(),value:v,styleSpec:s.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const p=this._getSourceCaches(c);for(const v of p)v.clearTiles()}_reloadSource(c){const p=this._getSourceCaches(c);for(const v of p)v.resume(),v.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const p in this._sourceCaches)this._sourceCaches[p].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const p=this._sourceCaches[c];p.resume(),p.reload()}}_updatePlacement(c,p,v,E,S=!1){let M=!1,L=!1;const N={};for(const U of this._order){const B=this._layers[U];if(B.type!=="symbol")continue;if(!N[B.source]){const te=this._getLayerSourceCache(B);if(!te)continue;N[B.source]=te.getRenderableIds(!0).map(se=>te.getTileByID(se)).sort((se,ue)=>ue.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(ue.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(B,N[B.source],c.center.lng,c.projection);M=M||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),c.zoom))&&(this.pauseablePlacement=new Mg(c,this._order,S,p,v,E,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),L=!0),M&&this.pauseablePlacement.placement.setStale()),L||M)for(const U of this._order){const B=this._layers[U];B.type==="symbol"&&this.placement.updateLayerOpacities(B,N[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,p,v){this.imageManager.getImages(p.icons,v),this._updateTilesForChangedImages();const E=S=>{S&&S.setDependencies(p.tileID.key,p.type,p.icons)};E(this._otherSourceCaches[p.source]),E(this._symbolSourceCaches[p.source])}getGlyphs(c,p,v){this.glyphManager.getGlyphs(p.stacks,v)}getResource(c,p,v){return s.makeRequest(p,v)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const p=[];return this._otherSourceCaches[c]&&p.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&p.push(this._symbolSourceCaches[c]),p}_isSourceCacheLoaded(c){const p=this._getSourceCaches(c);return p.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):p.every(v=>v.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Za.getSourceType=function(y){return Tr[y]},Za.setSourceType=function(y,c){Tr[y]=c},Za.registerForPluginStateChange=s.registerForPluginStateChange;var Ng=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ju="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Al=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Hh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ml=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let _p={},Gc={};const Kh=[];Vc(Ng,Kh),Vc(Al,Kh),Vc(Hh,Kh),Vc(Ml,Kh),_p=Dn("",Al),Gc=Dn(Ml,Hh);const b_=Dn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),vp=Ng,Rg=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var kg={background:Dn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Dn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Dn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Dn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Dn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Dn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Dn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Dn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Dn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Dn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Dn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Dn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Dn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Dn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Dn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Dn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Dn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Dn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Dn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Dn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Dn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ju),skyboxGradient:Dn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ju),skyboxCapture:Dn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Dn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Vc(y,c){const p=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of p)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=v.split(" ");for(const S of E)c.includes(S)||c.push(S)}}function Dn(y,c){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E={},S=[...Kh];return Vc(y,S),Vc(c,S),{fragmentSource:y=y.replace(p,(M,L,N,U,B)=>(E[B]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${N} ${U} ${B};
#else
uniform ${N} ${U} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${N} ${U} ${B} = u_${B};
#endif
`)),vertexSource:c=c.replace(p,(M,L,N,U,B)=>{const $=U==="float"?"vec2":"vec4",te=B.match(/color/)?"color":$;return E[B]?L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${N} ${$} a_${B};
varying ${N} ${U} ${B};
#else
uniform ${N} ${U} u_${B};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${N} ${U} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${te}(a_${B}, u_${B}_t);
#else
    ${N} ${U} ${B} = u_${B};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${N} ${$} a_${B};
#else
uniform ${N} ${U} u_${B};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${N} ${U} ${B} = a_${B};
#else
    ${N} ${U} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${N} ${U} ${B} = unpack_mix_${te}(a_${B}, u_${B}_t);
#else
    ${N} ${U} ${B} = u_${B};
#endif
`}),staticAttributes:v,usedDefines:S}}class G1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,p,v,E,S,M,L){this.context=c;let N=this.boundPaintVertexBuffers.length!==E.length;for(let B=0;!N&&B<E.length;B++)this.boundPaintVertexBuffers[B]!==E[B]&&(N=!0);let U=this.boundDynamicVertexBuffers.length!==L.length;for(let B=0;!U&&B<L.length;B++)this.boundDynamicVertexBuffers[B]!==L[B]&&(U=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==v||N||U||this.boundIndexBuffer!==S||this.boundVertexOffset!==M)this.freshBind(p,v,E,S,M,L);else{c.bindVertexArrayOES.set(this.vao);for(const B of L)B&&B.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(c,p,v,E,S,M){let L;const N=c.numAttributes,U=this.context,B=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=E,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=M;else{L=U.currentNumAttributes||0;for(let $=N;$<L;$++)B.disableVertexAttribArray($)}p.enableAttributes(B,c),p.bind(),p.setVertexAttribPointers(B,c,S);for(const $ of v)$.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,S);for(const $ of M)$&&($.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,S));E&&E.bind(),U.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fg(y,c){const p=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new s.MercatorCoordinate(0,v/p).toLngLat().lat,new s.MercatorCoordinate(0,(v+1)/p).toLngLat().lat]}function T_(y,c,p,v,E,S,M){const L=y.context,N=L.gl,U=p.fbo;if(!U)return;y.prepareDrawTile();const B=y.useProgram("hillshade");L.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,U.colorAttachment.get());const $=((le,ce,X,oe)=>{const pe=X.paint.get("hillshade-shadow-color"),de=X.paint.get("hillshade-highlight-color"),be=X.paint.get("hillshade-accent-color");let Se=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(Se-=le.transform.angle);const Te=!le.options.moving;return{u_matrix:oe||le.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Te),u_image:0,u_latrange:Fg(0,ce.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Se],u_shadow:pe,u_highlight:de,u_accent:be}})(y,p,v,y.terrain?c.projMatrix:null);y.prepareDrawProgram(L,B,c.toUnwrapped());const{tileBoundsBuffer:te,tileBoundsIndexBuffer:se,tileBoundsSegments:ue}=y.getTileBoundsBuffers(p);B.draw(L,N.TRIANGLES,E,S,M,s.CullFaceMode.disabled,$,v.id,te,se,ue)}function zg(y,c,p){if(!c.needsDEMTextureUpload)return;const v=y.context,E=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||y.getTileTexture(p.stride);const S=p.getPixels();c.demTexture?c.demTexture.update(S,{premultiply:!1}):c.demTexture=new s.Texture(v,S,E.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function S_(y,c,p,v,E,S){const M=y.context,L=M.gl;if(!c.dem)return;const N=c.dem;if(M.activeTexture.set(L.TEXTURE1),zg(y,c,N),!c.demTexture)return;c.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);const U=N.dim;M.activeTexture.set(L.TEXTURE0);let B=c.fbo;if(!B){const ue=new s.Texture(M,{width:U,height:U,data:null},L.RGBA);ue.bind(L.LINEAR,L.CLAMP_TO_EDGE),B=c.fbo=M.createFramebuffer(U,U,!0),B.colorAttachment.set(ue.texture)}M.bindFramebuffer.set(B.framebuffer),M.viewport.set([0,0,U,U]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:te,tileBoundsSegments:se}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,v,E,S,s.CullFaceMode.disabled,((ue,le)=>{const ce=le.stride,X=s.create();return s.ortho(X,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(X,X,[0,-s.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[ce,ce],u_zoom:ue.overscaledZ,u_unpack:le.unpackVector}})(c.tileID,N),p.id,$,te,se),c.needsHillshadePrepare=!1}const Bg=y=>({u_matrix:new s.UniformMatrix4f(y),u_image0:new s.Uniform1i(y),u_skirt_height:new s.Uniform1f(y)}),jc=(y,c)=>({u_matrix:y,u_image0:0,u_skirt_height:c}),xp=(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:p,u_zoom_transition:E,u_merc_center:S,u_image0:0,u_frustum_tl:M,u_frustum_tr:L,u_frustum_br:N,u_frustum_bl:U,u_globe_pos:B,u_globe_radius:$,u_viewport:te,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:se});function qc(y,c){return y!=null&&c!=null&&!(!y.hasData()||!c.hasData())&&y.demTexture!=null&&c.demTexture!=null&&y.tileID.key!==c.tileID.key}const Ll=new class{constructor(){this.operations={}}newMorphing(y,c,p,v,E){if(y in this.operations){const S=this.operations[y];S.to.tileID.key!==p.tileID.key&&(S.queued=p)}else this.operations[y]={startTime:v,phase:0,duration:E,from:c,to:p,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const c=this.operations[y];return{from:c.from,to:c.to,phase:c.phase}}update(y){for(const c in this.operations){const p=this.operations[c];for(p.phase=(y-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,y)){delete this.operations[c];break}}}_nextOp(y,c){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=c,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Qu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function wp(y){return 6*Math.pow(1.5,22-y)}function I_(y,c){const p=1<<y.z;return!c&&(y.x===0||y.x===p-1)||y.y===0||y.y===p-1}const Yh=y=>({u_matrix:y});function Ug(y,c,p,v,E){if(E>0){const S=s.exported.now(),M=(S-y.timeAdded)/E,L=c?(S-c.timeAdded)/E:-1,N=p.getSource(),U=v.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),B=!c||Math.abs(c.tileID.overscaledZ-U)>Math.abs(y.tileID.overscaledZ-U),$=B&&y.refreshedUponExpiration?1:s.clamp(B?M:1-L,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),c?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class Gg extends s.SourceCache{constructor(c){const p={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new mt(Fc(),null),E=Or("mock-dem",p,v,c.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,p){c.state="loaded",p(null)}}class Ep extends s.SourceCache{constructor(c){const p=Or("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new mt(Fc(),null),c.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,p,v){if(c.freezeTileCoverage)return;this.transform=c;const E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,M)=>{if(S[M.key]="",!this._tiles[M.key]){const L=new s.Tile(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);L.state="loaded",this._tiles[M.key]=L}return S},{});for(const S in this._tiles)S in E||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(c){const p=this.proxyCachedFBO[c];if(p!==void 0){const v=Object.values(p);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bp extends s.OverscaledTileID{constructor(c,p,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=p,this.projMatrix=v}}class Vg extends s.Elevation{constructor(c,p){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,E,S]=function(N){const U=new s.StructArrayLayout2i4,B=new s.StructArrayLayout3ui6,$=131;U.reserve(17161),B.reserve(33800);const te=s.EXTENT/128,se=s.EXTENT+te/2,ue=se+te;for(let ce=-te;ce<ue;ce+=te)for(let X=-te;X<ue;X+=te){const oe=X<0||X>se||ce<0||ce>se?24575:0,pe=s.clamp(Math.round(X),0,s.EXTENT),de=s.clamp(Math.round(ce),0,s.EXTENT);U.emplaceBack(pe+oe,de)}const le=(ce,X)=>{const oe=X*$+ce;B.emplaceBack(oe+1,oe,oe+$),B.emplaceBack(oe+$,oe+$+1,oe+1)};for(let ce=1;ce<129;ce++)for(let X=1;X<129;X++)le(X,ce);return[0,129].forEach(ce=>{for(let X=0;X<130;X++)le(X,ce),le(ce,X)}),[U,B,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,s.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(E),this.gridSegments=s.SegmentVector.simpleSegment(0,0,v.length,E.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,v.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ep(p.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const L=M.gl;this._overlapStencilMode=new s.StencilMode({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gg(p.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,p,v){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const E=c.terrain.properties;this.sourceCache=c.terrain.drapeRenderMode===0?this._mockSourceCache:c._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const S=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(p,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),p.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||c.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=p.getIds().map(N=>{const U=p.getTileByID(N).tileID;return U.projMatrix=v.calculateProjMatrix(U.toUnwrapped()),U});(function(N,U){const B=U.transform.pointCoordinate(U.transform.getCameraPoint()),$=new s.Point(B.x,B.y);N.sort((te,se)=>{if(se.overscaledZ-te.overscaledZ)return se.overscaledZ-te.overscaledZ;const ue=new s.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),le=new s.Point(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),ce=$.mult(1<<te.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(ue)-ce.distSqr(le)})})(E,this.painter),this._previousZoom=v.zoom;const S=this.proxyToSource||{};this.proxyToSource={},E.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const N in M){const U=M[N];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,c[N],S),U.usedForTerrain))continue;const B=c[N];U.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[p.id]=E.map(N=>new bp(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const L={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const U=this.terrainTileForTile[N.key];if(!U)continue;const B=U.tileID.key;B in L||(this._visibleDemTiles.push(U),L[B]=B)}}_assignTerrainTiles(c){this._initializing||c.forEach(p=>{if(this.terrainTileForTile[p.key])return;const v=this._findTileCoveringTileID(p,this.sourceCache);v&&(this.terrainTileForTile[p.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,p=c.gl;for(const v in this.terrainTileForTile){const E=this.terrainTileForTile[v],S=E.dem;!S||E.demTexture&&!E.needsDEMTextureUpload||(c.activeTexture.set(p.TEXTURE1),zg(this.painter,E,S))}}_prepareDemTileUniforms(c,p,v,E){if(!p||p.demTexture==null)return!1;const S=c.tileID.canonical,M=Math.pow(2,p.tileID.canonical.z-S.z),L=E||"";return v[`u_dem_tl${L}`]=[S.x*M%1,S.y*M%1],v[`u_dem_scale${L}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,p=c.gl;if(!this._emptyDepthBufferTexture){const v=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(c,v,p.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const p=this._visibleDemTiles.reduce((v,E)=>{if(!E.dem)return v;const S=E.dem.tree.minimums[0];return S>0&&c++,v+S},0);return c?p/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,p=c.gl;c.activeTexture.set(p.TEXTURE2);const v=this._getLoadedAreaMinimum(),E=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(v,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(E,{premultiply:!1}):S=this._emptyDEMTexture=new s.Texture(c,E,p.RGBA,{premultiply:!1}),S}setupElevationDraw(c,p,v){const E=this.painter.context,S=E.gl,M=(L=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(L),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var L;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let N=null,U=null,B=1;if(v&&v.morphing&&this._useVertexMorphing){const $=v.morphing.srcDemTile,te=v.morphing.dstDemTile;B=v.morphing.phase,$&&te&&(this._prepareDemTileUniforms(c,$,M,"_prev")&&(U=$),this._prepareDemTileUniforms(c,te,M)&&(N=te))}if(U&&N?(E.activeTexture.set(S.TEXTURE2),N.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),E.activeTexture.set(S.TEXTURE4),U.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),M.u_dem_lerp=B):(N=this.terrainTileForTile[c.tileID.key],E.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(c,N,M)?N.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),E.activeTexture.set(S.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&N){const $=(1<<N.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=$}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),p.setTerrainUniformValues(E,M),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);p.setGlobeUniformValues(E,$)}}globeUniformValues(c,p,v){const E=c.projection;return{u_tile_tl_up:E.upVector(p,0,0),u_tile_tr_up:E.upVector(p,s.EXTENT,0),u_tile_br_up:E.upVector(p,s.EXTENT,s.EXTENT),u_tile_bl_up:E.upVector(p,0,s.EXTENT),u_tile_up_scale:v?s.globeMetersToEcef(1):E.upVectorScale(p,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const p=this.painter,v=this.painter.context;c.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,S,M,L,N){if(E.transform.projection.name==="globe")(function(U,B,$,te,se){const ue=U.context,le=ue.gl;let ce,X;const oe=U.options.showTerrainWireframe?2:0,pe=U.transform,de=s.globeUseCustomAntiAliasing(U,ue,pe),be=(ut,Fe)=>{if(X===ut)return;const tt=[Qu[ut],"PROJECTION_GLOBE_VIEW"];de&&tt.push("CUSTOM_ANTIALIASING"),Fe&&tt.push(Qu[oe]),ce=U.useProgram("globeRaster",null,tt),X=ut},Se=U.colorModeForRenderPass(),Te=new s.DepthMode(le.LEQUAL,s.DepthMode.ReadWrite,U.depthRangeFor3D);Ll.update(se);const Me=s.calculateGlobeMercatorMatrix(pe),Ae=[s.mercatorXfromLng(pe.center.lng),s.mercatorYfromLat(pe.center.lat)],Be=oe?[!1,!0]:[!1],ct=U.globeSharedBuffers,Re=[pe.width*s.exported.devicePixelRatio,pe.height*s.exported.devicePixelRatio],rt=Float32Array.from(pe.globeMatrix),Ve={useDenormalizedUpVectorScale:!0};if(Be.forEach(ut=>{const Fe=U.transform,tt=wp(Fe.zoom)*B.exaggeration();X=-1;const ft=ut?le.LINES:le.TRIANGLES;for(const st of te){const pt=$.getTile(st),Ht=s.StencilMode.disabled,pr=B.prevTerrainTileForTile[st.key],Gt=B.terrainTileForTile[st.key];qc(pr,Gt)&&Ll.newMorphing(st.key,pr,Gt,se,250),ue.activeTexture.set(le.TEXTURE0),pt.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const or=Ll.getMorphValuesForProxy(st.key),kr=or?1:0;or&&s.extend$1(Ve,{morphing:{srcDemTile:or.from,dstDemTile:or.to,phase:s.easeCubicInOut(or.phase)}});const Dr=s.tileCornersToBounds(st.canonical),Xt=s.getLatitudinalLod(Dr.getCenter().lat),Fn=s.getGridMatrix(st.canonical,Dr,Xt,Fe.worldSize/Fe._pixelsPerMercatorPixel),jn=s.globeNormalizeECEF(s.globeTileBounds(st.canonical)),qn=xp(Fe.projMatrix,rt,Me,jn,s.globeToMercatorTransition(Fe.zoom),Ae,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,Re,tt,Fn);if(be(kr,ut),B.setupElevationDraw(pt,ce,Ve),U.prepareDrawProgram(ue,ce,st.toUnwrapped()),ct){const[$n,Ho,Eo]=ut?ct.getWirefameBuffers(U.context,Xt):ct.getGridBuffers(Xt,tt!==0);ce.draw(ue,ft,Te,Ht,Se,s.CullFaceMode.backCCW,qn,"globe_raster",$n,Ho,Eo)}}}),ct){const ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&ut.push("CUSTOM_ANTIALIASING"),ce=U.useProgram("globeRaster",null,ut);for(const Fe of te){const{x:tt,y:ft,z:st}=Fe.canonical,pt=ft===0,Ht=ft===(1<<st)-1,[pr,Gt,or,kr]=ct.getPoleBuffers(st);if(kr&&(pt||Ht)){const Dr=$.getTile(Fe);ue.activeTexture.set(le.TEXTURE0),Dr.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);let Xt=s.globePoleMatrixForTile(st,tt,pe);const Fn=s.globeNormalizeECEF(s.globeTileBounds(Fe.canonical)),jn=(qn,$n)=>qn.draw(ue,le.TRIANGLES,Te,s.StencilMode.disabled,Se,s.CullFaceMode.disabled,xp(pe.projMatrix,Xt,Xt,Fn,0,Ae,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Re,0),"globe_pole_raster",$n,or,kr);B.setupElevationDraw(Dr,ce,Ve),U.prepareDrawProgram(ue,ce,Fe.toUnwrapped()),pt&&jn(ce,pr),Ht&&(Xt=s.scale(s.create(),Xt,[1,-1,1]),jn(ce,Gt))}}}})(E,S,M,L,N);else{const U=E.context,B=U.gl;let $,te;const se=E.options.showTerrainWireframe?2:0,ue=(pe,de)=>{if(te===pe)return;const be=[Qu[pe]];de&&be.push(Qu[se]),$=E.useProgram("terrainRaster",null,be),te=pe},le=E.colorModeForRenderPass(),ce=new s.DepthMode(B.LEQUAL,s.DepthMode.ReadWrite,E.depthRangeFor3D);Ll.update(N);const X=E.transform,oe=wp(X.zoom)*S.exaggeration();(se?[!1,!0]:[!1]).forEach(pe=>{te=-1;const de=pe?B.LINES:B.TRIANGLES,[be,Se]=pe?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const Te of L){const Me=M.getTile(Te),Ae=s.StencilMode.disabled,Be=S.prevTerrainTileForTile[Te.key],ct=S.terrainTileForTile[Te.key];qc(Be,ct)&&Ll.newMorphing(Te.key,Be,ct,N,250),U.activeTexture.set(B.TEXTURE0),Me.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const Re=Ll.getMorphValuesForProxy(Te.key),rt=Re?1:0;let Ve;Re&&(Ve={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:s.easeCubicInOut(Re.phase)}});const ut=jc(Te.projMatrix,I_(Te.canonical,X.renderWorldCopies)?oe/10:oe);ue(rt,pe),S.setupElevationDraw(Me,$,Ve),E.prepareDrawProgram(U,$,Te.toUnwrapped()),$.draw(U,de,ce,Ae,le,s.CullFaceMode.backCCW,ut,"terrain_raster",S.gridBuffer,be,Se)}})}}(p,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const p=this.painter,v=this.painter.context,E=this.proxySourceCache,S=this.proxiedCoords[E.id],M=this._drapedRenderBatches.shift(),L=[],N=p.style.order;let U=0;for(const B of S){const $=E.getTileByID(B.proxyTileKey),te=E.proxyCachedFBO[B.key]?E.proxyCachedFBO[B.key][c]:void 0,se=te!==void 0?E.renderCache[te]:this.pool[U++],ue=te!==void 0;if($.texture=se.tex,ue&&!se.dirty){L.push($.tileID);continue}let le;v.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(v.clear({color:s.Color.transparent,stencil:0}),se.dirty=!1);for(let ce=M.start;ce<=M.end;++ce){const X=p.style._layers[N[ce]];if(X.isHidden(p.transform.zoom))continue;const oe=p.style._getLayerSourceCache(X),pe=oe?this.proxyToSource[B.key][oe.id]:[B];if(!pe)continue;const de=pe;v.viewport.set([0,0,se.fb.width,se.fb.height]),le!==(oe?oe.id:null)&&(this._setupStencil(se,pe,X,oe),le=oe?oe.id:null),p.renderLayer(p,oe,X,de)}this.renderedToTile?(se.dirty=!0,L.push($.tileID)):ue||--U,U===5&&(U=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height]),M.end+1}postRender(){}renderCacheEfficiency(c){const p=c.order.length;if(p===0)return{efficiency:100};let v,E=0,S=0,M=!1;for(let L=0;L<p;++L){const N=c._layers[c.order[L]];this._style.isLayerDraped(N)?(M&&++E,++S):M||(M=!0,v=N.id)}return S===0?{efficiency:100}:{efficiency:100*(1-E/S),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{c=Math.min(c,p.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,p,v){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const M=S.tileID,L=1<<M.overscaledZ,{x:N,y:U}=M.canonical,B=N/L,$=(N+1)/L,te=U/L,se=(U+1)/L;return{minx:B,miny:te,maxx:$,maxy:se,t:S.dem.tree.raycastRoot(B,te,$,se,c,p,v),tile:S}});E.sort((S,M)=>(S.t!==null?S.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const S of E){if(S.t==null)return null;const M=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,c,p,v);if(M!=null)return M}return null}_createFBO(){const c=this.painter.context,p=c.gl,v=this.drapeBufferSize;c.activeTexture.set(p.TEXTURE0);const E=new s.Texture(c,{width:v[0],height:v[1],data:null},p.RGBA);E.bind(p.LINEAR,p.CLAMP_TO_EDGE);const S=c.createFramebuffer(v[0],v[1],!1);return S.colorAttachment.set(E.texture),S.depthAttachment=new Ie(c,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:S,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const p=this._style._layers[c],v=p.isHidden(this.painter.transform.zoom);return p.type==="custom"?!v&&p.shouldRedrape():!v&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style._getSources())if(v instanceof Tt){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const E=this._style._layers[this._style.order[v]],S=this._style._getLayerSourceCache(E);if(S&&!p[S.id]&&!E.isHidden(this.painter.transform.zoom)&&E.type==="line"&&E.widthExpression()instanceof s.ZoomDependentExpression){p[S.id]=!0;for(const M of this.proxyCoords){const L=this.proxyToSource[M.key][S.id];if(L)for(const N of L)this._clearRenderCacheForTile(S.id,N)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._sourceCaches)if(this._style._sourceCaches[v]._source instanceof dt){c=!0;break}if(!c)return;const p={};for(let v=0;v<this._style.order.length;++v){const E=this._style._layers[this._style.order[v]],S=this._style._getLayerSourceCache(E);if(!S||p[S.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const M=E.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const N=this.proxyToSource[L.key][S.id];if(N)for(const U of N){const B=Ug(S.getTile(U),S.findLoadedParent(U,0),S,this.painter.transform,M);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(S.id,U)}}}}_setupDrapedRenderBatches(){const c=this._style.order,p=c.length;if(p===0)return;const v=[];let E,S=0,M=this._style._layers[c[S]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++S<p;)M=this._style._layers[c[S]];for(;S<p;++S){const L=this._style._layers[c[S]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?E===void 0&&(E=S):E!==void 0&&(v.push({start:E,end:S-1}),E=void 0))}E!==void 0&&v.push({start:E,end:S-1}),this._drapedRenderBatches=v}_setupRenderCache(c){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const M=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let L=0;L<M.length;++L){const N=Object.values(M[L]);p.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,E=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const L=v[M];if(p.getTileByID(L.key),p.proxyCachedFBO[L.key]!==void 0){const N=c[L.key],U=this.proxyToSource[L.key];let B=0;for(const $ in U){const te=U[$],se=N[$];if(!se||se.length!==te.length||te.some((ue,le)=>ue!==se[le]||E[$]&&E[$].hasOwnProperty(ue.key))){B=-1;break}++B}for(const $ in p.proxyCachedFBO[L.key])p.renderCache[p.proxyCachedFBO[L.key][$]].dirty=B<0||B!==Object.values(N).length}}const S=[...this._drapedRenderBatches];S.sort((M,L)=>L.end-L.start-(M.end-M.start));for(const M of S)for(const L of v){if(p.proxyCachedFBO[L.key])continue;let N=p.renderCachePool.pop();N===void 0&&p.renderCache.length<50&&(N=p.renderCache.length,p.renderCache.push(this._createFBO())),N!==void 0&&(p.proxyCachedFBO[L.key]={},p.proxyCachedFBO[L.key][M.start]=N,p.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(c,p,v,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,M=S.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let L;if(v.isTileClipped())L=p.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(c,p){const v=this.painter,E=this.painter.context,S=E.gl;v._tileClippingMaskIDs={},E.setColorMode(s.ColorMode.disabled),E.setDepthMode(s.DepthMode.disabled);const M=v.useProgram("clippingMask");for(const L of c){const N=v._tileClippingMaskIDs[L.key]=--p;M.draw(E,S.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:S.ALWAYS,mask:0},N,255,S.KEEP,S.KEEP,S.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Yh(L.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const p=this.painter.transform;if(c.x<0||c.x>p.width||c.y<0||c.y>p.height)return null;const v=[c.x,c.y,1,1];s.transformMat4$1(v,v,p.pixelMatrixInverse),s.scale$1(v,v,1/v[3]),v[0]/=p.worldSize,v[1]/=p.worldSize;const E=p._camera.position,S=s.mercatorZfromAltitude(1,p.center.lat),M=[E[0],E[1],E[2]/S,0],L=s.subtract([],v.slice(0,3),M);s.normalize(L,L);const N=this.raycast(M,L,this._exaggeration);return N!==null&&N?(s.scaleAndAdd(M,M,L,N),M[3]=M[2],M[2]*=S,M):null}drawDepth(){const c=this.painter,p=c.context,v=this.proxySourceCache,E=Math.ceil(c.width),S=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=p.gl,L=p.createFramebuffer(E,S,!0);p.activeTexture.set(M.TEXTURE0);const N=new s.Texture(p,{width:E,height:S,data:null},M.RGBA);N.bind(M.NEAREST,M.CLAMP_TO_EDGE),L.colorAttachment.set(N.texture);const U=p.createRenderbuffer(p.gl.DEPTH_COMPONENT16,E,S);L.depthAttachment.set(U),this._depthFBO=L,this._depthTexture=N}p.bindFramebuffer.set(this._depthFBO.framebuffer),p.viewport.set([0,0,E,S]),function(M,L,N,U){if(M.transform.projection.name==="globe")return;const B=M.context,$=B.gl;B.clear({depth:1});const te=M.useProgram("terrainDepth"),se=new s.DepthMode($.LESS,s.DepthMode.ReadWrite,M.depthRangeFor3D);for(const ue of U){const le=N.getTile(ue),ce=jc(ue.projMatrix,0);L.setupElevationDraw(le,te),te.draw(B,$.TRIANGLES,se,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,ce,"terrain_depth",L.gridBuffer,L.gridIndexBuffer,L.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,p,v){if(c.getSource()instanceof Lr)return this._setupProxiedCoordsForImageSource(c,p,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const E=this.proxiedCoords[c.id]=[],S=this.proxyCoords;for(let L=0;L<S.length;L++){const N=S[L],U=this._findTileCoveringTileID(N,c);if(U){const B=this._createProxiedId(N,U,v[N.key]&&v[N.key][c.id]);E.push(B),this.proxyToSource[N.key][c.id]=[B]}}let M=!1;for(let L=0;L<p.length;L++){const N=c.getTile(p[L]);if(!N||!N.hasData())continue;const U=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==N.tileID.canonical.z){const B=this.proxyToSource[U.tileID.key][c.id],$=this._createProxiedId(U.tileID,N,v[U.tileID.key]&&v[U.tileID.key][c.id]);B?B.splice(B.length-1,0,$):this.proxyToSource[U.tileID.key][c.id]=[$],E.push($),M=!0}}this._sourceTilesOverlap[c.id]=M}_setupProxiedCoordsForImageSource(c,p,v){if(!c.getSource().loaded())return;const E=this.proxiedCoords[c.id]=[],S=this.proxyCoords,M=c.getSource(),L=new s.Point(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),N=M.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((B,$)=>(B.min.x=Math.min(B.min.x,$.x-L.x),B.min.y=Math.min(B.min.y,$.y-L.y),B.max.x=Math.max(B.max.x,$.x-L.x),B.max.y=Math.max(B.max.y,$.y-L.y),B),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(B,$)=>{const te=B.wrap+B.canonical.x/(1<<B.canonical.z),se=B.canonical.y/(1<<B.canonical.z),ue=s.EXTENT/(1<<B.canonical.z),le=$.wrap+$.canonical.x/(1<<$.canonical.z),ce=$.canonical.y/(1<<$.canonical.z);return te+ue<le+N.min.x||te>le+N.max.x||se+ue<ce+N.min.y||se>ce+N.max.y};for(let B=0;B<S.length;B++){const $=S[B];for(let te=0;te<p.length;te++){const se=c.getTile(p[te]);if(!se||!se.hasData()||U($,se.tileID))continue;const ue=this._createProxiedId($,se,v[$.key]&&v[$.key][c.id]),le=this.proxyToSource[$.key][c.id];le?le.push(ue):this.proxyToSource[$.key][c.id]=[ue],E.push(ue)}}}_createProxiedId(c,p,v){let E=this.orthoMatrix;if(v){const S=v.find(M=>M.key===p.tileID.key);if(S)return S}if(p.tileID.key!==c.key){const S=c.canonical.z-p.tileID.canonical.z;let M,L,N;E=s.create();const U=p.tileID.wrap-c.wrap<<c.overscaledZ;S>0?(M=s.EXTENT>>S,L=M*((p.tileID.canonical.x<<S)-c.canonical.x+U),N=M*((p.tileID.canonical.y<<S)-c.canonical.y)):(M=s.EXTENT<<-S,L=s.EXTENT*(p.tileID.canonical.x-(c.canonical.x+U<<-S)),N=s.EXTENT*(p.tileID.canonical.y-(c.canonical.y<<-S))),s.ortho(E,0,M,0,M,0,1),s.translate(E,E,[L,N,0])}return new bp(p.tileID,c.key,E)}_findTileCoveringTileID(c,p){let v=p.getTile(c);if(v&&v.hasData())return v;const E=this._findCoveringTileCache[p.id],S=E[c.key];if(v=S?p.getTileByID(S):null,v&&v.hasData()||S===null)return v;let M=v?v.tileID:c,L=M.overscaledZ;const N=p.getSource().minzoom,U=[];if(!S){const $=p.getSource().maxzoom;if(c.canonical.z>=$){const te=c.canonical.z-$;p.getSource().reparseOverscaled?(L=Math.max(c.canonical.z+2,p.transform.tileZoom),M=new s.OverscaledTileID(L,c.wrap,$,c.canonical.x>>te,c.canonical.y>>te)):te!==0&&(L=$,M=new s.OverscaledTileID(L,c.wrap,$,c.canonical.x>>te,c.canonical.y>>te))}M.key!==c.key&&(U.push(M.key),v=p.getTile(M))}const B=$=>{U.forEach(te=>{E[te]=$}),U.length=0};for(L-=1;L>=N&&(!v||!v.hasData());L--){v&&B(v.tileID.key);const $=M.calculateScaledKey(L);if(v=p.getTileByID($),v&&v.hasData())break;const te=E[$];if(te===null)break;te===void 0?U.push($):v=p.getTileByID(te)}return B(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,p){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[p.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(p){let v=0;const E=new s.StructArrayLayout2ui4,S=131;for(let M=1;M<129;M++){for(let L=1;L<129;L++)v=M*S+L,E.emplaceBack(v,v+1),E.emplaceBack(v,v+S),E.emplaceBack(v+1,v+S),M===128&&E.emplaceBack(v+S,v+S+1);E.emplaceBack(v+1,v+1+S)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Hr{static cacheKey(c,p,v,E){let S=`${p}${E?E.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(S+=`/${M}`);return S}constructor(c,p,v,E,S,M){const L=c.gl;this.program=L.createProgram();const N=function(X){const oe=[];for(let pe=0;pe<X.length;pe++){if(X[pe]===null)continue;const de=X[pe].split(" ");oe.push(de.pop())}return oe}(v.staticAttributes),U=E?E.getBinderAttributes():[],B=N.concat(U);let $=E?E.defines():[];$=$.concat(M.map(X=>`#define ${X}`));const te=c.isWebGL2?`#version 300 es
`:"",se=te+$.concat(c.extStandardDerivatives&&te.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Rg):Rg,Rg,vp,b_.fragmentSource,Gc.fragmentSource,v.fragmentSource).join(`
`),ue=te+$.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,vp,b_.vertexSource,Gc.vertexSource,_p.vertexSource,v.vertexSource).join(`
`),le=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(le,se),L.compileShader(le),L.attachShader(this.program,le);const ce=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(ce,ue),L.compileShader(ce),L.attachShader(this.program,ce),this.attributes={},this.numAttributes=B.length;for(let X=0;X<this.numAttributes;X++)B[X]&&(L.bindAttribLocation(this.program,X,B[X]),this.attributes[B[X]]=X);L.linkProgram(this.program),L.deleteShader(ce),L.deleteShader(le),this.fixedUniforms=S(c),this.binderUniforms=E?E.getUniforms(c):[],M.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new s.Uniform1i(X),u_dem_prev:new s.Uniform1i(X),u_dem_unpack:new s.Uniform4f(X),u_dem_tl:new s.Uniform2f(X),u_dem_scale:new s.Uniform1f(X),u_dem_tl_prev:new s.Uniform2f(X),u_dem_scale_prev:new s.Uniform1f(X),u_dem_size:new s.Uniform1f(X),u_dem_lerp:new s.Uniform1f(X),u_exaggeration:new s.Uniform1f(X),u_depth:new s.Uniform1i(X),u_depth_size_inv:new s.Uniform2f(X),u_meter_to_dem:new s.Uniform1f(X),u_label_plane_matrix_inv:new s.UniformMatrix4f(X)}))(c)),M.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new s.Uniform3f(X),u_tile_tr_up:new s.Uniform3f(X),u_tile_br_up:new s.Uniform3f(X),u_tile_bl_up:new s.Uniform3f(X),u_tile_up_scale:new s.Uniform1f(X)}))(c)),M.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new s.UniformMatrix4f(X),u_fog_range:new s.Uniform2f(X),u_fog_color:new s.Uniform4f(X),u_fog_horizon_blend:new s.Uniform1f(X),u_fog_temporal_offset:new s.Uniform1f(X),u_frustum_tl:new s.Uniform3f(X),u_frustum_tr:new s.Uniform3f(X),u_frustum_br:new s.Uniform3f(X),u_frustum_bl:new s.Uniform3f(X),u_globe_pos:new s.Uniform3f(X),u_globe_radius:new s.Uniform1f(X),u_globe_transition:new s.Uniform1f(X),u_is_globe:new s.Uniform1i(X),u_viewport:new s.Uniform2f(X)}))(c))}}setTerrainUniformValues(c,p){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const E in p)v[E]&&v[E].set(this.program,E,p[E])}}setGlobeUniformValues(c,p){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const E in p)v[E]&&v[E].set(this.program,E,p[E])}}setFogUniformValues(c,p){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const E in p)v[E].set(this.program,E,p[E])}}draw(c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le){const ce=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(v),c.setStencilMode(E),c.setColorMode(S),c.setCullFace(M);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,L[oe]);ue&&ue.setUniforms(this.program,c,this.binderUniforms,te,{zoom:se});const X={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[p];for(const oe of $.get()){const pe=oe.vaos||(oe.vaos={});(pe[N]||(pe[N]=new G1)).bind(c,this,U,ue?ue.getPaintVertexBuffers():[],B,oe.vertexOffset,le||[]),ce.drawElements(p,oe.primitiveLength*X,ce.UNSIGNED_SHORT,oe.primitiveOffset*X*2)}}}function Jh(y,c){const p=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,y.transform.tileZoom)/p,E=v*(c.tileID.canonical.x+c.tileID.wrap*p),S=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/bt(c,1,y.transform.tileZoom),u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const P_=s.create(),jg=(y,c,p,v,E,S,M,L,N,U,B)=>{const $=c.style.light,te=$.properties.get("position"),se=[te.x,te.y,te.z],ue=s.create$1();$.properties.get("anchor")==="viewport"&&(s.fromRotation(ue,-c.transform.angle),s.transformMat3(se,se,ue));const le=$.properties.get("color"),ce=c.transform,X={u_matrix:y,u_lightpos:se,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_vertical_gradient:+p,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:P_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:E,u_edge_radius:S};return ce.projection.name==="globe"&&(X.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],X.u_zoom_transition=N,X.u_inv_rot_matrix=B,X.u_merc_center=U,X.u_up_dir=ce.projection.upVector(new s.CanonicalTileID(0,0,0),U[0]*s.EXTENT,U[1]*s.EXTENT),X.u_height_lift=L),X},C_=(y,c,p,v,E,S,M,L,N,U,B,$)=>{const te=jg(y,c,p,v,E,S,M,N,U,B,$),se={u_height_factor:-Math.pow(2,M.overscaledZ)/L.tileSize/8};return s.extend(te,Jh(c,L),se)},ec=y=>({u_matrix:y}),qg=(y,c,p)=>s.extend(ec(y),Jh(c,p)),V1=(y,c)=>({u_matrix:y,u_world:c}),j1=(y,c,p,v)=>s.extend(qg(y,c,p),{u_world:v}),q1=s.create(),$g=(y,c,p,v,E,S)=>{const M=y.transform,L=M.projection.name==="globe";let N;if(S.paint.get("circle-pitch-alignment")==="map")if(L){const B=s.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel;N=Float32Array.from([B,0,0,B])}else N=M.calculatePixelsToTileUnitsMatrix(p);else N=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const U={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:y.translatePosMatrix(c.projMatrix,p,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:q1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){U.u_inv_rot_matrix=v,U.u_merc_center=E,U.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],U.u_zoom_transition=s.globeToMercatorTransition(M.zoom);const B=E[0]*s.EXTENT,$=E[1]*s.EXTENT;U.u_up_dir=M.projection.upVector(new s.CanonicalTileID(0,0,0),B,$)}return U},Zg=y=>{const c=[];return y.paint.get("circle-pitch-alignment")==="map"&&c.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&c.push("SCALE_WITH_MAP"),c},Xg=(y,c,p,v)=>{const E=s.EXTENT/p.tileSize;return{u_matrix:y,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/E,c.pixelsToGLUnits[1]/E]}},Tp=(y,c,p=1)=>({u_matrix:y,u_color:c,u_overlay:0,u_overlay_scale:p}),A_=s.create(),M_=(y,c,p,v,E,S,M)=>{const L=y.transform,N=L.projection.name==="globe",U=N?s.globePixelsToTileUnits(L.zoom,c.canonical)*L._pixelsPerMercatorPixel:bt(p,1,S),B={u_matrix:c.projMatrix,u_extrude_scale:U,u_intensity:M,u_inv_rot_matrix:A_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){B.u_inv_rot_matrix=v,B.u_merc_center=E,B.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],B.u_zoom_transition=s.globeToMercatorTransition(L.zoom);const $=E[0]*s.EXTENT,te=E[1]*s.EXTENT;B.u_up_dir=L.projection.upVector(new s.CanonicalTileID(0,0,0),$,te)}return B},$1=(y,c,p,v,E,S,M)=>{const L=y.transform,N=L.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:Wg(y,c,p,v),u_pixels_to_tile_units:N,u_device_pixel_ratio:S,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:E,u_texsize:ef(p)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$c(c,y.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},Qh=(y,c,p,v,E)=>{const S=y.transform;return{u_matrix:Wg(y,c,p,v),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:E,u_image:0,u_tile_units_to_pixels:$c(c,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function $c(y,c){return 1/bt(y,1,c.tileZoom)}function Wg(y,c,p,v){return y.translatePosMatrix(v||c.tileID.projMatrix,c,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}function ef(y){const c=y.paint.get("line-dasharray").value;return c.value||c.kind!=="constant"}const Hg=(y,c,p,v,E,S)=>{return{u_matrix:y,u_tl_parent:c,u_scale_parent:p,u_fade_t:v.mix,u_opacity:v.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(L=E.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(M=E.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Xa(E.paint.get("raster-hue-rotate")),u_perspective_transform:S};var M,L};function Xa(y){y*=Math.PI/180;const c=Math.sin(y),p=Math.cos(y);return[(2*p+1)/3,(-Math.sqrt(3)*c-p+1)/3,(Math.sqrt(3)*c-p+1)/3]}const Sp=s.create(),Kg=(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le)=>{const ce=E.transform,X={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+p,u_aspect_ratio:ce.width/ce.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+N,u_pitch_with_map:+v,u_texsize:U,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Sp,u_up_vector:[0,-1,0]};return le.name==="globe"&&(X.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],X.u_zoom_transition=$,X.u_inv_rot_matrix=se,X.u_merc_center=te,X.u_camera_forward=ce._camera.forward(),X.u_ecef_origin=s.globeECEFOrigin(ce.globeMatrix,B.toUnwrapped()),X.u_tile_matrix=Float32Array.from(ce.globeMatrix),X.u_up_vector=ue),X},Ip=(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le,ce)=>s.extend(Kg(y,c,p,v,E,S,M,L,N,U,$,te,se,ue,le,ce),{u_gamma_scale:v?E.transform.cameraToCenterDistance*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+B}),L_=(y,c,p,v,E,S,M,L,N,U,B,$,te,se,ue,le)=>s.extend(Ip(y,c,p,v,E,S,M,L,!0,N,!0,B,$,te,se,ue,le),{u_texsize_icon:U,u_texture_icon:1}),Yg=(y,c,p)=>({u_matrix:y,u_opacity:c,u_color:p}),Z1=(y,c,p,v,E)=>s.extend(function(S,M,L){const N=M.imageManager.getPattern(S.toString()),{width:U,height:B}=M.imageManager.getPixelSize(),$=Math.pow(2,L.tileID.overscaledZ),te=L.tileSize*Math.pow(2,M.transform.tileZoom)/$,se=te*(L.tileID.canonical.x+L.tileID.wrap*$),ue=te*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[U,B],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/bt(L,1,M.transform.tileZoom),u_pixel_coord_upper:[se>>16,ue>>16],u_pixel_coord_lower:[65535&se,65535&ue]}}(v,p,E),{u_matrix:y,u_opacity:c}),Jg={fillExtrusion:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_height_factor:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y)}),fill:y=>({u_matrix:new s.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),fillOutline:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),collisionBox:y=>({u_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new s.UniformMatrix4f(y),u_inv_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_viewport_size:new s.Uniform2f(y)}),debug:y=>({u_color:new s.UniformColor(y),u_matrix:new s.UniformMatrix4f(y),u_overlay:new s.Uniform1i(y),u_overlay_scale:new s.Uniform1f(y)}),clippingMask:y=>({u_matrix:new s.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new s.Uniform1f(y),u_intensity:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),heatmapTexture:y=>({u_image:new s.Uniform1i(y),u_color_ramp:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y)}),hillshade:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_latrange:new s.Uniform2f(y),u_light:new s.Uniform2f(y),u_shadow:new s.UniformColor(y),u_highlight:new s.UniformColor(y),u_accent:new s.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_dimension:new s.Uniform2f(y),u_zoom:new s.Uniform1f(y),u_unpack:new s.Uniform4f(y)}),line:y=>({u_matrix:new s.UniformMatrix4f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_units_to_pixels:new s.Uniform2f(y),u_dash_image:new s.Uniform1i(y),u_gradient_image:new s.Uniform1i(y),u_image_height:new s.Uniform1f(y),u_texsize:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y),u_trim_offset:new s.Uniform2f(y)}),linePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_texsize:new s.Uniform2f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_units_to_pixels:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y)}),raster:y=>({u_matrix:new s.UniformMatrix4f(y),u_tl_parent:new s.Uniform2f(y),u_scale_parent:new s.Uniform1f(y),u_fade_t:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_image0:new s.Uniform1i(y),u_image1:new s.Uniform1i(y),u_brightness_low:new s.Uniform1f(y),u_brightness_high:new s.Uniform1f(y),u_saturation_factor:new s.Uniform1f(y),u_contrast_factor:new s.Uniform1f(y),u_spin_weights:new s.Uniform3f(y),u_perspective_transform:new s.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_texture:new s.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_is_halo:new s.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texsize_icon:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_texture_icon:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_is_halo:new s.Uniform1i(y)}),background:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_color:new s.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_pattern_tl:new s.Uniform2f(y),u_pattern_br:new s.Uniform2f(y),u_texsize:new s.Uniform2f(y),u_pattern_size:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),terrainRaster:Bg,terrainDepth:Bg,skybox:y=>({u_matrix:new s.UniformMatrix4f(y),u_sun_direction:new s.Uniform3f(y),u_cubemap:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new s.UniformMatrix4f(y),u_color_ramp:new s.Uniform1i(y),u_center_direction:new s.Uniform3f(y),u_radius:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new s.UniformMatrix3f(y),u_sun_direction:new s.Uniform3f(y),u_sun_intensity:new s.Uniform1f(y),u_color_tint_r:new s.Uniform4f(y),u_color_tint_m:new s.Uniform4f(y),u_luminance:new s.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new s.UniformMatrix4f(y),u_globe_matrix:new s.UniformMatrix4f(y),u_normalize_matrix:new s.UniformMatrix4f(y),u_merc_matrix:new s.UniformMatrix4f(y),u_zoom_transition:new s.Uniform1f(y),u_merc_center:new s.Uniform2f(y),u_image0:new s.Uniform1i(y),u_grid_matrix:new s.UniformMatrix3f(y),u_skirt_height:new s.Uniform1f(y),u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_globe_pos:new s.Uniform3f(y),u_globe_radius:new s.Uniform1f(y),u_viewport:new s.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_horizon:new s.Uniform1f(y),u_transition:new s.Uniform1f(y),u_fadeout_range:new s.Uniform1f(y),u_color:new s.Uniform4f(y),u_high_color:new s.Uniform4f(y),u_space_color:new s.Uniform4f(y),u_star_intensity:new s.Uniform1f(y),u_star_density:new s.Uniform1f(y),u_star_size:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y),u_horizon_angle:new s.Uniform1f(y),u_rotation_matrix:new s.UniformMatrix4f(y)})};let Pp;function tf(y,c,p,v,E,S,M){const L=y.context,N=L.gl,U=y.transform,B=y.useProgram("collisionBox"),$=[];let te=0,se=0;for(let de=0;de<v.length;de++){const be=v[de],Se=c.getTile(be),Te=Se.getBucket(p);if(!Te)continue;const Me=Qs(be,Te,U);let Ae=Me;E[0]===0&&E[1]===0||(Ae=y.translatePosMatrix(Me,Se,E,S));const Be=M?Te.textCollisionBox:Te.iconCollisionBox,ct=Te.collisionCircleArray;if(ct.length>0){const Re=s.create(),rt=Ae;s.mul(Re,Te.placementInvProjMatrix,U.glCoordMatrix),s.mul(Re,Re,Te.placementViewportMatrix),$.push({circleArray:ct,circleOffset:se,transform:rt,invTransform:Re,projection:Te.getProjection()}),te+=ct.length/4,se=te}Be&&(y.terrain&&y.terrain.setupElevationDraw(Se,B),B.draw(L,N.LINES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,Xg(Ae,U,Se,Te.getProjection()),p.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,U.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!M||!$.length)return;const ue=y.useProgram("collisionCircle"),le=new s.StructArrayLayout2f1f2i16;le.resize(4*te),le._trim();let ce=0;for(const de of $)for(let be=0;be<de.circleArray.length/4;be++){const Se=4*be,Te=de.circleArray[Se+0],Me=de.circleArray[Se+1],Ae=de.circleArray[Se+2],Be=de.circleArray[Se+3];le.emplace(ce++,Te,Me,Ae,Be,0),le.emplace(ce++,Te,Me,Ae,Be,1),le.emplace(ce++,Te,Me,Ae,Be,2),le.emplace(ce++,Te,Me,Ae,Be,3)}(!Pp||Pp.length<2*te)&&(Pp=function(de){const be=2*de,Se=new s.StructArrayLayout3ui6;Se.resize(be),Se._trim();for(let Te=0;Te<be;Te++){const Me=6*Te;Se.uint16[Me+0]=4*Te+0,Se.uint16[Me+1]=4*Te+1,Se.uint16[Me+2]=4*Te+2,Se.uint16[Me+3]=4*Te+2,Se.uint16[Me+4]=4*Te+3,Se.uint16[Me+5]=4*Te+0}return Se}(te));const X=L.createIndexBuffer(Pp,!0),oe=L.createVertexBuffer(le,s.collisionCircleLayout.members,!0);for(const de of $){const be={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(pe=U).getCameraToCenterDistance(de.projection),u_viewport_size:[pe.width,pe.height]};ue.draw(L,N.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,be,p.id,oe,X,s.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,U.zoom)}var pe;oe.destroy(),X.destroy()}const O_=s.create();function Qg({width:y,height:c,anchor:p,textOffset:v,textScale:E},S){const{horizontalAlign:M,verticalAlign:L}=s.getAnchorAlignment(p),N=-(M-.5)*y,U=-(L-.5)*c,B=s.evaluateVariableOffset(p,v);return new s.Point((N/E+B[0])*S,(U/E+B[1])*S)}function X1(y,c,p,v,E,S,M,L,N,U,B){const $=y.text.placedSymbolArray,te=y.text.dynamicLayoutVertexArray,se=y.icon.dynamicLayoutVertexArray,ue={},le=y.getProjection(),ce=gi(L,le,S),X=S.elevation,oe=le.upVectorScale(L.canonical,S.center.lat,S.worldSize).metersToTile;te.clear();for(let pe=0;pe<$.length;pe++){const de=$.get(pe),{tileAnchorX:be,tileAnchorY:Se,numGlyphs:Te}=de,Me=de.hidden||!de.crossTileID||y.allowVerticalPlacement&&!de.placedOrientation?null:v[de.crossTileID];if(Me){let Ae=0,Be=0,ct=0;if(X){const pt=X?X.getAtTileOffset(L,be,Se):0,[Ht,pr,Gt]=le.upVector(L.canonical,be,Se);Ae=pt*Ht*oe,Be=pt*pr*oe,ct=pt*Gt*oe}let[Re,rt,Ve,ut]=xo(de.projectedAnchorX+Ae,de.projectedAnchorY+Be,de.projectedAnchorZ+ct,p?ce:M);const Fe=__(S.getCameraToCenterDistance(le),ut);let tt=E.evaluateSizeForFeature(y.textSizeData,U,de)*Fe/s.ONE_EM;p&&(tt*=y.tilePixelRatio/N);const ft=Qg(Me,tt);p?({x:Re,y:rt,z:Ve}=le.projectTilePoint(be+ft.x,Se+ft.y,L.canonical),[Re,rt,Ve]=xo(Re+Ae,rt+Be,Ve+ct,M)):(c&&ft._rotate(-S.angle),Re+=ft.x,rt+=ft.y,Ve=0);const st=y.allowVerticalPlacement&&de.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let pt=0;pt<Te;pt++)s.addDynamicAttributes(te,Re,rt,Ve,st);B&&de.associatedIconIndex>=0&&(ue[de.associatedIconIndex]={x:Re,y:rt,z:Ve,angle:st})}else Sa(Te,te)}if(B){se.clear();const pe=y.icon.placedSymbolArray;for(let de=0;de<pe.length;de++){const be=pe.get(de),{numGlyphs:Se}=be,Te=ue[de];if(be.hidden||!Te)Sa(Se,se);else{const{x:Me,y:Ae,z:Be,angle:ct}=Te;for(let Re=0;Re<Se;Re++)s.addDynamicAttributes(se,Me,Ae,Be,ct)}}y.icon.dynamicLayoutVertexBuffer.updateData(se)}y.text.dynamicLayoutVertexBuffer.updateData(te)}function em(y,c,p){return p.iconsInText&&c?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function D_(y,c,p,v,E,S,M,L,N,U,B,$){const te=y.context,se=te.gl,ue=y.transform,le=L==="map",ce=N==="map",X=le&&p.layout.get("symbol-placement")!=="point",oe=le&&!ce&&!X,pe=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let de=!1;const be=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),Se=[s.mercatorXfromLng(ue.center.lng),s.mercatorYfromLat(ue.center.lat)],Te=p.layout.get("text-variable-anchor"),Me=ue.projection.name==="globe",Ae=[],Be=[0,-1,0];let ct=Be;!Me&&!ue.mercatorFromTransition||le||(ct=function(Re){const rt=Re._camera.getWorldToCamera(Re.worldSize,1),Ve=s.multiply([],rt,Re.globeMatrix);s.invert(Ve,Ve);const ut=[0,0,0],Fe=[0,1,0,0];return s.transformMat4$1(Fe,Fe,Ve),ut[0]=Fe[0],ut[1]=Fe[1],ut[2]=Fe[2],s.normalize(ut,ut),ut}(ue));for(const Re of v){const rt=c.getTile(Re),Ve=rt.getBucket(p);if(!Ve||Ve.projection.name==="mercator"&&Me)continue;const ut=E?Ve.text:Ve.icon;if(!ut||Ve.fullyClipped||!ut.segments.get().length)continue;const Fe=ut.programConfigurations.get(p.id),tt=E||Ve.sdfIcons,ft=E?Ve.textSizeData:Ve.iconSizeData,st=ce||ue.pitch!==0,pt=s.evaluateSizeForZoom(ft,ue.zoom);let Ht,pr,Gt,or,kr=[0,0],Dr=null;if(E)pr=rt.glyphAtlasTexture,Gt=se.LINEAR,Ht=rt.glyphAtlasTexture.size,Ve.iconsInText&&(kr=rt.imageAtlasTexture.size,Dr=rt.imageAtlasTexture,or=st||y.options.rotating||y.options.zooming||ft.kind==="composite"||ft.kind==="camera"?se.LINEAR:se.NEAREST);else{const Nl=p.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;pr=rt.imageAtlasTexture,Gt=tt||y.options.rotating||y.options.zooming||Nl||st?se.LINEAR:se.NEAREST,Ht=rt.imageAtlasTexture.size}const Xt=Ve.projection.name==="globe",Fn=Xt?ct:Be,jn=Xt?s.globeToMercatorTransition(ue.zoom):0,qn=gi(Re,Ve.getProjection(),ue),$n=ue.calculatePixelsToTileUnitsMatrix(rt),Ho=Ye(qn,rt.tileID.canonical,ce,le,ue,Ve.getProjection(),$n),Eo=y.terrain&&ce&&X?s.invert(s.create(),Ho):O_,na=Xi(qn,rt.tileID.canonical,ce,le,ue,Ve.getProjection(),$n),Ha=Te&&Ve.hasTextData(),mi=p.layout.get("icon-text-fit")!=="none"&&Ha&&Ve.hasIconData();if(X){const Nl=ue.elevation,mu=Nl?Nl.getAtTileOffsetFunc(Re,ue.center.lat,ue.worldSize,Ve.getProjection()):null,oc=Il(qn,rt.tileID.canonical,ce,le,ue,Ve.getProjection(),$n);Ig(Ve,qn,y,E,oc,na,ce,U,mu,Re)}const Zn=X||E&&Te||mi,In=y.translatePosMatrix(qn,rt,S,M),Wi=Zn?O_:Ho,fs=y.translatePosMatrix(na,rt,S,M,!0),li=Ve.getProjection().createInversionMatrix(ue,Re.canonical),bs=[];y.terrainRenderModeElevated()&&ce&&bs.push("PITCH_WITH_MAP_TERRAIN"),Xt&&bs.push("PROJECTION_GLOBE_VIEW"),Zn&&bs.push("PROJECTED_POS_ON_VIEWPORT");const jp=tt&&p.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ic;ic=tt?Ve.iconsInText?L_(ft.kind,pt,oe,ce,y,In,Wi,fs,Ht,kr,Re,jn,Se,li,Fn,Ve.getProjection()):Ip(ft.kind,pt,oe,ce,y,In,Wi,fs,E,Ht,!0,Re,jn,Se,li,Fn,Ve.getProjection()):Kg(ft.kind,pt,oe,ce,y,In,Wi,fs,E,Ht,Re,jn,Se,li,Fn,Ve.getProjection());const pf={program:y.useProgram(em(tt,E,Ve),Fe,bs),buffers:ut,uniformValues:ic,atlasTexture:pr,atlasTextureIcon:Dr,atlasInterpolation:Gt,atlasInterpolationIcon:or,isSDF:tt,hasHalo:jp,tile:rt,labelPlaneMatrixInv:Eo};if(pe&&Ve.canOverlap){de=!0;const Nl=ut.segments.get();for(const mu of Nl)Ae.push({segments:new s.SegmentVector([mu]),sortKey:mu.sortKey,state:pf})}else Ae.push({segments:ut.segments,sortKey:0,state:pf})}de&&Ae.sort((Re,rt)=>Re.sortKey-rt.sortKey);for(const Re of Ae){const rt=Re.state;if(y.terrain&&y.terrain.setupElevationDraw(rt.tile,rt.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:rt.labelPlaneMatrixInv}),te.activeTexture.set(se.TEXTURE0),rt.atlasTexture.bind(rt.atlasInterpolation,se.CLAMP_TO_EDGE),rt.atlasTextureIcon&&(te.activeTexture.set(se.TEXTURE1),rt.atlasTextureIcon&&rt.atlasTextureIcon.bind(rt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),rt.isSDF){const Ve=rt.uniformValues;rt.hasHalo&&(Ve.u_is_halo=1,rf(rt.buffers,Re.segments,p,y,rt.program,be,B,$,Ve)),Ve.u_is_halo=0}rf(rt.buffers,Re.segments,p,y,rt.program,be,B,$,rt.uniformValues)}}function rf(y,c,p,v,E,S,M,L,N){const U=v.context,B=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];E.draw(U,U.gl.TRIANGLES,S,M,L,s.CullFaceMode.disabled,N,p.id,y.layoutVertexBuffer,y.indexBuffer,c,p.paint,v.transform.zoom,y.programConfigurations.get(p.id),B)}function N_(y,c,p,v,E,S,M){const L=y.context.gl,N=p.paint.get("fill-pattern"),U=N&&N.constantOr(1);let B,$,te,se,ue;M?($=U&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=L.LINES):($=U?"fillPattern":"fill",B=L.TRIANGLES);for(const le of v){const ce=c.getTile(le);if(U&&!ce.patternsLoaded())continue;const X=ce.getBucket(p);if(!X)continue;y.prepareDrawTile();const oe=X.programConfigurations.get(p.id),pe=y.useProgram($,oe);U&&(y.context.activeTexture.set(L.TEXTURE0),ce.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),oe.updatePaintBuffers());const de=N.constantOr(null);if(de&&ce.imageAtlas){const Se=ce.imageAtlas.patternPositions[de.toString()];Se&&oe.setConstantPatternPositions(Se)}const be=y.translatePosMatrix(le.projMatrix,ce,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(M){se=X.indexBuffer2,ue=X.segments2;const Se=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[L.drawingBufferWidth,L.drawingBufferHeight];te=$==="fillOutlinePattern"&&U?j1(be,y,ce,Se):V1(be,Se)}else se=X.indexBuffer,ue=X.segments,te=U?qg(be,y,ce):ec(be);y.prepareDrawProgram(y.context,pe,le.toUnwrapped()),pe.draw(y.context,B,E,y.stencilModeForClipping(le),S,s.CullFaceMode.disabled,te,p.id,X.layoutVertexBuffer,se,ue,p.paint,y.transform.zoom,oe)}}function Cp(y,c,p,v,E,S,M){const L=y.context,N=L.gl,U=y.transform,B=p.paint.get("fill-extrusion-pattern"),$=B.constantOr(1),te=p.paint.get("fill-extrusion-opacity"),se=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),p.paint.get("fill-extrusion-ambient-occlusion-radius")],ue=p.layout.get("fill-extrusion-edge-radius"),le=ue>0&&!p.paint.get("fill-extrusion-rounded-roof"),ce=le?0:ue,X=U.projection.name==="globe"?s.fillExtrusionHeightLift():0,oe=U.projection.name==="globe",pe=oe?s.globeToMercatorTransition(U.zoom):0,de=[s.mercatorXfromLng(U.center.lng),s.mercatorYfromLat(U.center.lat)],be=[];oe&&be.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&be.push("FAUX_AO"),le&&be.push("ZERO_ROOF_RADIUS");for(const Se of v){const Te=c.getTile(Se),Me=Te.getBucket(p);if(!Me||Me.projection.name!==U.projection.name)continue;const Ae=Me.programConfigurations.get(p.id),Be=y.useProgram($?"fillExtrusionPattern":"fillExtrusion",Ae,be);if(y.terrain){const tt=y.terrain;if(y.style.terrainSetForDrapingOnly())tt.setupElevationDraw(Te,Be,{useMeterToDem:!0});else{if(!Me.enableTerrain)continue;if(tt.setupElevationDraw(Te,Be,{useMeterToDem:!0}),R_(L,c,Se,Me,p,tt),!Me.centroidVertexBuffer){const ft=Be.attributes.a_centroid_pos;ft!==void 0&&N.vertexAttrib2f(ft,0,0)}}}$&&(y.context.activeTexture.set(N.TEXTURE0),Te.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ae.updatePaintBuffers());const ct=B.constantOr(null);if(ct&&Te.imageAtlas){const tt=Te.imageAtlas.patternPositions[ct.toString()];tt&&Ae.setConstantPatternPositions(tt)}const Re=y.translatePosMatrix(Se.projMatrix,Te,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),rt=U.projection.createInversionMatrix(U,Se.canonical),Ve=p.paint.get("fill-extrusion-vertical-gradient"),ut=$?C_(Re,y,Ve,te,se,ce,Se,Te,X,pe,de,rt):jg(Re,y,Ve,te,se,ce,Se,X,pe,de,rt);y.prepareDrawProgram(L,Be,Se.toUnwrapped());const Fe=[];y.terrain&&Fe.push(Me.centroidVertexBuffer),oe&&Fe.push(Me.layoutVertexExtBuffer),Be.draw(L,L.gl.TRIANGLES,E,S,M,s.CullFaceMode.backCCW,ut,p.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,p.paint,y.transform.zoom,Ae,Fe)}}function R_(y,c,p,v,E,S){const M=[X=>{let oe=X.canonical.x-1,pe=X.wrap;return oe<0&&(oe=(1<<X.canonical.z)-1,pe--),new s.OverscaledTileID(X.overscaledZ,pe,X.canonical.z,oe,X.canonical.y)},X=>{let oe=X.canonical.x+1,pe=X.wrap;return oe===1<<X.canonical.z&&(oe=0,pe++),new s.OverscaledTileID(X.overscaledZ,pe,X.canonical.z,oe,X.canonical.y)},X=>new s.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(X.canonical.y===0?1<<X.canonical.z:X.canonical.y)-1),X=>new s.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],L=X=>{const oe=c.getSource().minzoom,pe=be=>{const Se=c.getTileByID(be);if(Se&&Se.hasData())return Se.getBucket(E)},de=[0,-1,1];for(const be of de){if(X.overscaledZ+be<oe)continue;const Se=pe(X.calculateScaledKey(X.overscaledZ+be));if(Se)return Se}},N=[0,0,0],U=(X,oe)=>(N[0]=Math.min(X.min.y,oe.min.y),N[1]=Math.max(X.max.y,oe.max.y),N[2]=s.EXTENT-oe.min.x>X.max.x?oe.min.x-s.EXTENT:X.max.x,N),B=(X,oe)=>(N[0]=Math.min(X.min.x,oe.min.x),N[1]=Math.max(X.max.x,oe.max.x),N[2]=s.EXTENT-oe.min.y>X.max.y?oe.min.y-s.EXTENT:X.max.y,N),$=[(X,oe)=>U(X,oe),(X,oe)=>U(oe,X),(X,oe)=>B(X,oe),(X,oe)=>B(oe,X)],te=new s.Point(0,0);let se,ue,le;const ce=(X,oe,pe,de,be)=>{const Se=[[de?pe:X,de?X:pe,0],[de?pe:oe,de?oe:pe,0]],Te=be<0?s.EXTENT+be:be,Me=[de?Te:(X+oe)/2,de?(X+oe)/2:Te,0];return pe===0&&be<0||pe!==0&&be>0?S.getForTilePoints(le,[Me],!0,ue):Se.push(Me),S.getForTilePoints(p,Se,!0,se),Math.max(Se[0][2],Se[1][2],Me[2])/S.exaggeration()};for(let X=0;X<4;X++){const oe=(X<2?1:5)-X,pe=v.borders[X];if(pe.length===0)continue;const de=le=M[X](p),be=L(de);if(!(be&&be instanceof s.FillExtrusionBucket&&be.enableTerrain)||v.borderDoneWithNeighborZ[X]===be.canonical.z&&be.borderDoneWithNeighborZ[oe]===v.canonical.z||(ue=S.findDEMTileFor(de),!ue||!ue.dem))continue;if(!se){const Ae=S.findDEMTileFor(p);if(!Ae||!Ae.dem)return;se=Ae}const Se=be.borders[oe];let Te=0;const Me=be.borderDoneWithNeighborZ[oe]!==v.canonical.z;if(v.canonical.z===be.canonical.z){for(let Ae=0;Ae<pe.length;Ae++){const Be=v.featuresOnBorder[pe[Ae]],ct=Be.borders[X];let Re;for(;Te<Se.length&&(Re=be.featuresOnBorder[Se[Te]],!(Re.borders[oe][1]>ct[0]+3));)Me&&be.encodeCentroid(void 0,Re,!1),Te++;if(Re&&Te<Se.length){const rt=Te;let Ve=0;for(;!(Re.borders[oe][0]>ct[1]-3)&&(Ve++,++Te!==Se.length);)Re=be.featuresOnBorder[Se[Te]];if(Re=be.featuresOnBorder[Se[rt]],Be.intersectsCount()>1||Re.intersectsCount()>1||Ve!==1){Ve!==1&&(Te=rt),v.encodeCentroid(void 0,Be,!1),Me&&be.encodeCentroid(void 0,Re,!1);continue}const ut=$[X](Be,Re),Fe=X%2?s.EXTENT-1:0;te.x=ce(ut[0],Math.min(s.EXTENT-1,ut[1]),Fe,X<2,ut[2]),te.y=0,v.encodeCentroid(te,Be,!1),Me&&be.encodeCentroid(te,Re,!1)}else v.encodeCentroid(void 0,Be,!1)}v.borderDoneWithNeighborZ[X]=be.canonical.z,v.needsCentroidUpdate=!0,Me&&(be.borderDoneWithNeighborZ[oe]=v.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Ae of pe)v.encodeCentroid(void 0,v.featuresOnBorder[Ae],!1);if(Me){for(const Ae of Se)be.encodeCentroid(void 0,be.featuresOnBorder[Ae],!1);be.borderDoneWithNeighborZ[oe]=v.canonical.z,be.needsCentroidUpdate=!0}v.borderDoneWithNeighborZ[X]=be.canonical.z,v.needsCentroidUpdate=!0}}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Zc=new s.Color(1,0,0,1),W1=new s.Color(0,1,0,1),H1=new s.Color(0,0,1,1),K1=new s.Color(1,0,1,1),Y1=new s.Color(0,1,1,1);function J1(y,c,p){const v=y.context,E=y.transform,S=v.gl,M=E.projection.name==="globe",L=M?["PROJECTION_GLOBE_VIEW"]:null;let N=p.projMatrix;if(M&&s.globeToMercatorTransition(E.zoom)>0){const Be=s.transitionTileAABBinECEF(p.canonical,E),ct=s.globeDenormalizeECEF(Be);N=s.multiply(new Float32Array(16),E.globeMatrix,ct),s.multiply(N,E.projMatrix,N)}const U=y.useProgram("debug",null,L),B=c.getTileByID(p.key);y.terrain&&y.terrain.setupElevationDraw(B,U);const $=s.DepthMode.disabled,te=s.StencilMode.disabled,se=y.colorModeForRenderPass(),ue="$debug";v.activeTexture.set(S.TEXTURE0),y.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),M?B._makeGlobeTileDebugBuffers(y.context,E):B._makeDebugTileBoundsBuffers(y.context,E.projection);const le=B._tileDebugBuffer||y.debugBuffer,ce=B._tileDebugIndexBuffer||y.debugIndexBuffer,X=B._tileDebugSegments||y.debugSegments;U.draw(v,S.LINE_STRIP,$,te,se,s.CullFaceMode.disabled,Tp(N,s.Color.red),ue,le,ce,X,null,null,null,[B._globeTileDebugBorderBuffer]);const oe=B.latestRawTileData,pe=Math.floor((oe&&oe.byteLength||0)/1024),de=c.getTile(p).tileSize,be=512/Math.min(de,512)*(p.overscaledZ/E.zoom)*.5;let Se=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Se+=` => ${p.overscaledZ}`),Se+=` ${pe}kb`,function(Be,ct){Be.initDebugOverlayCanvas();const Re=Be.debugOverlayCanvas,rt=Be.context.gl,Ve=Be.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Re.width,Re.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(ct,5,5),Ve.strokeText(ct,5,5),Be.debugOverlayTexture.update(Re),Be.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}(y,Se);const Te=B._tileDebugTextBuffer||y.debugBuffer,Me=B._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,Ae=B._tileDebugTextSegments||y.debugSegments;U.draw(v,S.TRIANGLES,$,te,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Tp(N,s.Color.transparent,be),ue,Te,Me,Ae,null,null,null,[B._globeTileDebugTextBuffer])}function k_(y,c,p,v){Xc(y,0,c+p/2,y.transform.width,p,v)}function Ap(y,c,p,v){Xc(y,c-p/2,0,p,y.transform.height,v)}function Xc(y,c,p,v,E,S){const M=y.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(c*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio,v*s.exported.devicePixelRatio,E*s.exported.devicePixelRatio),M.clear({color:S}),L.disable(L.SCISSOR_TEST)}const F_=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:z_}=F_;function Ol(y,c,p,v){y.emplaceBack(c,p,v)}class Mp{constructor(c){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Ol(this.vertexArray,-1,-1,1),Ol(this.vertexArray,1,-1,1),Ol(this.vertexArray,-1,1,1),Ol(this.vertexArray,1,1,1),Ol(this.vertexArray,-1,-1,-1),Ol(this.vertexArray,1,-1,-1),Ol(this.vertexArray,-1,1,-1),Ol(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,z_),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function ta(y,c,p,v,E,S){const M=y.gl,L=c.paint.get("sky-atmosphere-color"),N=c.paint.get("sky-atmosphere-halo-color"),U=c.paint.get("sky-atmosphere-sun-intensity"),B=(($,te,se,ue,le)=>({u_matrix_3f:$,u_sun_direction:te,u_sun_intensity:se,u_color_tint_r:[ue.r,ue.g,ue.b,ue.a],u_color_tint_m:[le.r,le.g,le.b,le.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),v),E,U,L,N);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+S,c.skyboxTexture,0),p.draw(y,M.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,B,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const nf=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class B_{constructor(c){const p=new s.StructArrayLayout5f20;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const v=new s.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(p,nf.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const tc={symbol:function(y,c,p,v,E){if(y.renderPass!=="translucent")return;const S=s.StencilMode.disabled,M=y.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(L,N,U,B,$,te,se){const ue=N.transform,le=$==="map",ce=te==="map";for(const X of L){const oe=B.getTile(X),pe=oe.getBucket(U);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const de=s.evaluateSizeForZoom(pe.textSizeData,ue.zoom),be=gi(X,pe.getProjection(),ue),Se=ue.calculatePixelsToTileUnitsMatrix(oe),Te=Ye(be,oe.tileID.canonical,ce,le,ue,pe.getProjection(),Se),Me=U.layout.get("icon-text-fit")!=="none"&&pe.hasIconData();if(de){const Ae=Math.pow(2,ue.zoom-oe.tileID.overscaledZ);X1(pe,le,ce,se,s.symbolSize,ue,Te,X,Ae,de,Me)}}}(v,y,p,c,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),E),p.paint.get("icon-opacity").constantOr(1)!==0&&D_(y,c,p,v,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),S,M),p.paint.get("text-opacity").constantOr(1)!==0&&D_(y,c,p,v,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),S,M),c.map.showCollisionBoxes&&(tf(y,c,p,v,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),tf(y,c,p,v,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(y,c,p,v){if(y.renderPass!=="translucent")return;const E=p.paint.get("circle-opacity"),S=p.paint.get("circle-stroke-width"),M=p.paint.get("circle-stroke-opacity"),L=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)===0&&(S.constantOr(1)===0||M.constantOr(1)===0))return;const N=y.context,U=N.gl,B=y.transform,$=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),te=s.StencilMode.disabled,se=y.colorModeForRenderPass(),ue=B.projection.name==="globe",le=[s.mercatorXfromLng(B.center.lng),s.mercatorYfromLat(B.center.lat)],ce=[];for(let oe=0;oe<v.length;oe++){const pe=v[oe],de=c.getTile(pe),be=de.getBucket(p);if(!be||be.projection.name!==B.projection.name)continue;const Se=be.programConfigurations.get(p.id),Te=Zg(p);ue&&Te.push("PROJECTION_GLOBE_VIEW");const Me=y.useProgram("circle",Se,Te),Ae=be.layoutVertexBuffer,Be=be.globeExtVertexBuffer,ct=be.indexBuffer,Re=B.projection.createInversionMatrix(B,pe.canonical),rt={programConfiguration:Se,program:Me,layoutVertexBuffer:Ae,globeExtVertexBuffer:Be,indexBuffer:ct,uniformValues:$g(y,pe,de,Re,le,p),tile:de};if(L){const Ve=be.segments.get();for(const ut of Ve)ce.push({segments:new s.SegmentVector([ut]),sortKey:ut.sortKey,state:rt})}else ce.push({segments:be.segments,sortKey:0,state:rt})}L&&ce.sort((oe,pe)=>oe.sortKey-pe.sortKey);const X={useDepthForOcclusion:!ue};for(const oe of ce){const{programConfiguration:pe,program:de,layoutVertexBuffer:be,globeExtVertexBuffer:Se,indexBuffer:Te,uniformValues:Me,tile:Ae}=oe.state,Be=oe.segments;y.terrain&&y.terrain.setupElevationDraw(Ae,de,X),y.prepareDrawProgram(N,de,Ae.tileID.toUnwrapped()),de.draw(N,U.TRIANGLES,$,te,se,s.CullFaceMode.disabled,Me,p.id,be,Te,Be,p.paint,B.zoom,pe,[Se])}},heatmap:function(y,c,p,v){if(p.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const E=y.context,S=E.gl,M=s.StencilMode.disabled,L=new s.ColorMode([S.ONE,S.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(se,ue,le,ce){const X=se.gl,oe=ue.width*ce,pe=ue.height*ce;se.activeTexture.set(X.TEXTURE1),se.viewport.set([0,0,oe,pe]);let de=le.heatmapFbo;if(!de||de&&(de.width!==oe||de.height!==pe)){de&&de.destroy();const be=X.createTexture();X.bindTexture(X.TEXTURE_2D,be),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),de=le.heatmapFbo=se.createFramebuffer(oe,pe,!1),function(Se,Te,Me,Ae,Be,ct){const Re=Se.gl;Re.texImage2D(Re.TEXTURE_2D,0,Se.isWebGL2&&Se.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Be,ct,0,Re.RGBA,Se.extRenderToTextureHalfFloat?Se.isWebGL2?Re.HALF_FLOAT:Se.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Ae.colorAttachment.set(Me)}(se,0,be,de,oe,pe)}else X.bindTexture(X.TEXTURE_2D,de.colorAttachment.get()),se.bindFramebuffer.set(de.framebuffer)})(E,y,p,y.transform.projection.name==="globe"?.5:.25),E.clear({color:s.Color.transparent});const N=y.transform,U=N.projection.name==="globe",B=U?["PROJECTION_GLOBE_VIEW"]:null,$=U?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,te=[s.mercatorXfromLng(N.center.lng),s.mercatorYfromLat(N.center.lat)];for(let se=0;se<v.length;se++){const ue=v[se];if(c.hasRenderableParent(ue))continue;const le=c.getTile(ue),ce=le.getBucket(p);if(!ce||ce.projection.name!==N.projection.name)continue;const X=ce.programConfigurations.get(p.id),oe=y.useProgram("heatmap",X,B),{zoom:pe}=y.transform;y.terrain&&y.terrain.setupElevationDraw(le,oe),y.prepareDrawProgram(E,oe,ue.toUnwrapped());const de=N.projection.createInversionMatrix(N,ue.canonical);oe.draw(E,S.TRIANGLES,s.DepthMode.disabled,M,L,$,M_(y,ue,le,de,te,pe,p.paint.get("heatmap-intensity")),p.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,p.paint,y.transform.zoom,X,U?[ce.globeExtVertexBuffer]:null)}E.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(E,S){const M=E.context,L=M.gl,N=S.heatmapFbo;if(!N)return;M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.colorAttachment.get()),M.activeTexture.set(L.TEXTURE1);let U=S.colorRampTexture;U||(U=S.colorRampTexture=new s.Texture(M,S.colorRamp,L.RGBA)),U.bind(L.LINEAR,L.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(M,L.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,E.colorModeForRenderPass(),s.CullFaceMode.disabled,((B,$,te,se)=>({u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}))(0,S),S.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,S.paint,E.transform.zoom)}(y,p))},line:function(y,c,p,v){if(y.renderPass!=="translucent")return;const E=p.paint.get("line-opacity"),S=p.paint.get("line-width");if(E.constantOr(1)===0||S.constantOr(1)===0)return;const M=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),L=y.colorModeForRenderPass(),N=y.terrain&&y.terrain.renderingToTexture?1:s.exported.devicePixelRatio,U=p.paint.get("line-dasharray"),B=U.constantOr(1),$=p.layout.get("line-cap"),te=p.paint.get("line-pattern"),se=te.constantOr(1),ue=p.paint.get("line-gradient"),le=se?"linePattern":"line",ce=y.context,X=ce.gl,oe=(de=>{const be=[];ef(de)&&be.push("RENDER_LINE_DASH"),de.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const Se=de.paint.get("line-trim-offset");Se[0]===0&&Se[1]===0||be.push("RENDER_LINE_TRIM_OFFSET");const Te=de.paint.get("line-pattern").constantOr(1),Me=de.paint.get("line-opacity").constantOr(1)!==1;return!Te&&Me&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(p);let pe=oe.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const de of v){const be=c.getTile(de);if(se&&!be.patternsLoaded())continue;const Se=be.getBucket(p);if(!Se)continue;y.prepareDrawTile();const Te=Se.programConfigurations.get(p.id),Me=y.useProgram(le,Te,oe),Ae=te.constantOr(null);if(Ae&&be.imageAtlas){const tt=be.imageAtlas.patternPositions[Ae.toString()];tt&&Te.setConstantPatternPositions(tt)}const Be=U.constantOr(null),ct=$.constantOr(null);if(!se&&Be&&ct&&be.lineAtlas){const tt=be.lineAtlas.getDash(Be,ct);tt&&Te.setConstantPatternPositions(tt)}let[Re,rt]=p.paint.get("line-trim-offset");(ct==="round"||ct==="square")&&Re!==rt&&(Re===0&&(Re-=1),rt===1&&(rt+=1));const Ve=y.terrain?de.projMatrix:null,ut=se?Qh(y,be,p,Ve,N):$1(y,be,p,Ve,Se.lineClipsArray.length,N,[Re,rt]);if(ue){const tt=Se.gradients[p.id];let ft=tt.texture;if(p.gradientVersion!==tt.version){let st=256;if(p.stepInterpolant){const pt=c.getSource().maxzoom,Ht=de.canonical.z===pt?Math.ceil(1<<y.transform.maxZoom-de.canonical.z):1;st=s.clamp(s.nextPowerOfTwo(Se.maxLineLength/s.EXTENT*1024*Ht),256,ce.maxTextureSize)}tt.gradient=s.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:tt.gradient||void 0,clips:Se.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new s.Texture(ce,tt.gradient,X.RGBA),tt.version=p.gradientVersion,ft=tt.texture}ce.activeTexture.set(X.TEXTURE1),ft.bind(p.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}B&&(ce.activeTexture.set(X.TEXTURE0),be.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),Te.updatePaintBuffers()),se&&(ce.activeTexture.set(X.TEXTURE0),be.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Te.updatePaintBuffers()),y.prepareDrawProgram(ce,Me,de.toUnwrapped());const Fe=tt=>{Me.draw(ce,X.TRIANGLES,M,tt,L,s.CullFaceMode.disabled,ut,p.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,p.paint,y.transform.zoom,Te,[Se.layoutVertexBuffer2])};if(pe){const tt=y.stencilModeForClipping(de).ref;tt===0&&y.terrain&&ce.clear({stencil:0});const ft={func:X.EQUAL,mask:255};ut.u_alpha_discard_threshold=.8,Fe(new s.StencilMode(ft,tt,255,X.KEEP,X.KEEP,X.INVERT)),ut.u_alpha_discard_threshold=0,Fe(new s.StencilMode(ft,tt,255,X.KEEP,X.KEEP,X.KEEP))}else Fe(y.stencilModeForClipping(de))}pe&&(y.resetStencilClippingMasks(),y.terrain&&ce.clear({stencil:0}))},fill:function(y,c,p,v){const E=p.paint.get("fill-color"),S=p.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const M=y.colorModeForRenderPass(),L=p.paint.get("fill-pattern"),N=y.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(s.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===N){const U=y.depthModeForSublayer(1,y.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);N_(y,c,p,v,U,M,!1)}if(y.renderPass==="translucent"&&p.paint.get("fill-antialias")){const U=y.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);N_(y,c,p,v,U,M,!0)}},"fill-extrusion":function(y,c,p,v){const E=p.paint.get("fill-extrusion-opacity");if(E!==0&&y.renderPass==="translucent"){const S=new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);if(E!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Cp(y,c,p,v,S,s.StencilMode.disabled,s.ColorMode.disabled),Cp(y,c,p,v,S,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const M=y.colorModeForRenderPass();Cp(y,c,p,v,S,s.StencilMode.disabled,M)}}},hillshade:function(y,c,p,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const E=y.context,S=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),M=y.colorModeForRenderPass(),L=y.terrain&&y.terrain.renderingToTexture,[N,U]=y.renderPass!=="translucent"||L?[{},v]:y.stencilConfigForOverlap(v);for(const B of U){const $=c.getTile(B);if($.needsHillshadePrepare&&y.renderPass==="offscreen")S_(y,$,p,S,s.StencilMode.disabled,M);else if(y.renderPass==="translucent"){const te=L&&y.terrain?y.terrain.stencilModeForRTTOverlap(B):N[B.overscaledZ];T_(y,B,$,p,S,te,M)}}E.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,c,p,v,E,S){if(y.renderPass!=="translucent"||p.paint.get("raster-opacity")===0||!v.length)return;const M=y.context,L=M.gl,N=c.getSource(),U=y.useProgram("raster"),B=y.colorModeForRenderPass(),$=y.terrain&&y.terrain.renderingToTexture,[te,se]=N instanceof Lr||$?[{},v]:y.stencilConfigForOverlap(v),ue=se[se.length-1].overscaledZ,le=!y.options.moving;for(const ce of se){const X=$?s.DepthMode.disabled:y.depthModeForSublayer(ce.overscaledZ-ue,p.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,L.LESS),oe=ce.toUnwrapped(),pe=c.getTile(ce);if($&&(!pe||!pe.hasData()))continue;const de=$?ce.projMatrix:y.transform.calculateProjMatrix(oe,le),be=y.terrain&&$?y.terrain.stencilModeForRTTOverlap(ce):te[ce.overscaledZ],Se=S?0:p.paint.get("raster-fade-duration");pe.registerFadeDuration(Se);const Te=c.findLoadedParent(ce,0),Me=Ug(pe,Te,c,y.transform,Se);let Ae,Be;y.terrain&&y.terrain.prepareDrawTile();const ct=p.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;M.activeTexture.set(L.TEXTURE0),pe.texture.bind(ct,L.CLAMP_TO_EDGE),M.activeTexture.set(L.TEXTURE1),Te?(Te.texture.bind(ct,L.CLAMP_TO_EDGE),Ae=Math.pow(2,Te.tileID.overscaledZ-pe.tileID.overscaledZ),Be=[pe.tileID.canonical.x*Ae%1,pe.tileID.canonical.y*Ae%1]):pe.texture.bind(ct,L.CLAMP_TO_EDGE),pe.texture.useMipmap&&M.extTextureFilterAnisotropic&&y.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Re=Hg(de,Be||[0,0],Ae||1,Me,p,N instanceof Lr?N.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(M,U,oe),N instanceof Lr)N.boundsBuffer&&N.boundsSegments&&U.draw(M,L.TRIANGLES,X,s.StencilMode.disabled,B,s.CullFaceMode.disabled,Re,p.id,N.boundsBuffer,y.quadTriangleIndexBuffer,N.boundsSegments);else{const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:Ve,tileBoundsSegments:ut}=y.getTileBoundsBuffers(pe);U.draw(M,L.TRIANGLES,X,be,B,s.CullFaceMode.disabled,Re,p.id,rt,Ve,ut)}}y.resetStencilClippingMasks()},background:function(y,c,p,v){const E=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S===0)return;const M=y.context,L=M.gl,N=y.transform,U=N.tileSize,B=p.paint.get("background-pattern");if(y.isPatternMissing(B))return;const $=!B&&E.a===1&&S===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==$)return;const te=s.StencilMode.disabled,se=y.depthModeForSublayer(0,$==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),ue=y.colorModeForRenderPass(),le=y.useProgram(B?"backgroundPattern":"background");let ce,X=v;X||(ce=y.getBackgroundTiles(),X=Object.values(ce).map(oe=>oe.tileID)),B&&(M.activeTexture.set(L.TEXTURE0),y.imageManager.bind(y.context));for(const oe of X){const pe=oe.toUnwrapped(),de=v?oe.projMatrix:y.transform.calculateProjMatrix(pe);y.prepareDrawTile();const be=c?c.getTile(oe):ce?ce[oe.key]:new s.Tile(oe,U,N.zoom,y),Se=B?Z1(de,S,y,B,{tileID:oe,tileSize:U}):Yg(de,S,E);y.prepareDrawProgram(M,le,pe);const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Me,tileBoundsSegments:Ae}=y.getTileBoundsBuffers(be);le.draw(M,L.TRIANGLES,se,te,ue,s.CullFaceMode.disabled,Se,p.id,Te,Me,Ae)}},sky:function(y,c,p){const v=y.transform,E=v.projection.name==="mercator"||v.projection.name==="globe"?1:s.smoothstep(7,8,v.zoom),S=p.paint.get("sky-opacity")*E;if(S===0)return;const M=y.context,L=p.paint.get("sky-type"),N=new s.DepthMode(M.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),U=y.frameCounter/1e3%1;L==="atmosphere"?y.renderPass==="offscreen"?p.needsSkyboxCapture(y)&&(function(B,$,te,se){const ue=B.context,le=ue.gl;let ce=$.skyboxFbo;if(!ce){ce=$.skyboxFbo=ue.createFramebuffer(32,32,!1),$.skyboxGeometry=new Mp(ue),$.skyboxTexture=ue.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,$.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let de=0;de<6;++de)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}ue.bindFramebuffer.set(ce.framebuffer),ue.viewport.set([0,0,32,32]);const X=$.getCenter(B,!0),oe=B.useProgram("skyboxCapture"),pe=new Float64Array(16);s.identity(pe),s.rotateY(pe,pe,.5*-Math.PI),ta(ue,$,oe,pe,X,0),s.identity(pe),s.rotateY(pe,pe,.5*Math.PI),ta(ue,$,oe,pe,X,1),s.identity(pe),s.rotateX(pe,pe,.5*-Math.PI),ta(ue,$,oe,pe,X,2),s.identity(pe),s.rotateX(pe,pe,.5*Math.PI),ta(ue,$,oe,pe,X,3),s.identity(pe),ta(ue,$,oe,pe,X,4),s.identity(pe),s.rotateY(pe,pe,Math.PI),ta(ue,$,oe,pe,X,5),ue.viewport.set([0,0,B.width,B.height])}(y,p),p.markSkyboxValid(y)):y.renderPass==="sky"&&function(B,$,te,se,ue){const le=B.context,ce=le.gl,X=B.transform,oe=B.useProgram("skybox");le.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,$.skyboxTexture);const pe=((de,be,Se,Te,Me)=>({u_matrix:de,u_sun_direction:be,u_cubemap:0,u_opacity:Te,u_temporal_offset:Me}))(X.skyboxMatrix,$.getCenter(B,!1),0,se,ue);B.prepareDrawProgram(le,oe),oe.draw(le,ce.TRIANGLES,te,s.StencilMode.disabled,B.colorModeForRenderPass(),s.CullFaceMode.backCW,pe,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(y,p,N,S,U):L==="gradient"&&y.renderPass==="sky"&&function(B,$,te,se,ue){const le=B.context,ce=le.gl,X=B.transform,oe=B.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new Mp(le)),le.activeTexture.set(ce.TEXTURE0);let pe=$.colorRampTexture;pe||(pe=$.colorRampTexture=new s.Texture(le,$.colorRamp,ce.RGBA)),pe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const de=((be,Se,Te,Me,Ae)=>({u_matrix:be,u_color_ramp:0,u_center_direction:Se,u_radius:s.degToRad(Te),u_opacity:Me,u_temporal_offset:Ae}))(X.skyboxMatrix,$.getCenter(B,!1),$.paint.get("sky-gradient-radius"),se,ue);B.prepareDrawProgram(le,oe),oe.draw(le,ce.TRIANGLES,te,s.StencilMode.disabled,B.colorModeForRenderPass(),s.CullFaceMode.backCW,de,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(y,p,N,S,U)},debug:function(y,c,p){for(let v=0;v<p.length;v++)J1(y,c,p[v])},custom:function(y,c,p,v){const E=y.context,S=p.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&p.isLayerDraped()){if(y.renderPass==="offscreen"){const M=S.prerender;if(M){if(y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const L=y.transform.pointMerc;M.call(S,E.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(y.transform.zoom),[L.x,L.y],y.transform.pixelsPerMeterRatio)}else M.call(S,E.gl,y.transform.customLayerMatrix());E.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const L=S.renderToTile;if(L){const N=v[0].canonical,U=new s.MercatorCoordinate(N.x+v[0].wrap*(1<<N.z),N.y,N.z);E.setDepthMode(s.DepthMode.disabled),E.setStencilMode(s.StencilMode.disabled),E.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),L.call(S,E.gl,U),E.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),E.setColorMode(y.colorModeForRenderPass()),E.setStencilMode(s.StencilMode.disabled);const M=S.renderingMode==="3d"?new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(E.setDepthMode(M),y.transform.projection.name==="globe"){const L=y.transform.pointMerc;S.render(E.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(y.transform.zoom),[L.x,L.y],y.transform.pixelsPerMeterRatio)}else S.render(E.gl,y.transform.customLayerMatrix());E.setDirty(),y.setBaseState(),E.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Wc{constructor(c,p,v=!1){this.context=new vt(c,v),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,p){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vg(this,c));const E=this._terrain;this.transform.elevation=v?E:null,E.update(c,this.transform,p)}_updateFog(c){const p=c.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,E]=p.getFovAdjustedRange(this.transform._fov);if(v>E)return void(this.transform.fogCullDistSq=null);const S=v+.78*(E-v);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,p){if(this.width=c*s.exported.devicePixelRatio,this.height=p*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const c=this.context,p=new s.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(s.EXTENT,0),p.emplaceBack(0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(p,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(s.EXTENT,0),v.emplaceBack(0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=c.createVertexBuffer(v,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const E=new s.StructArrayLayout2i4;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(E,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const S=new s.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(s.EXTENT,0,s.EXTENT,0),S.emplaceBack(0,s.EXTENT,0,s.EXTENT),S.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(S,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const M=new s.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const L=new s.StructArrayLayout1ui2;for(const U of[0,1,3,2,0])L.emplaceBack(U);this.debugIndexBuffer=c.createIndexBuffer(L),this.emptyTexture=new s.Texture(c,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=s.create();const N=this.context.gl;this.stencilClearMode=new s.StencilMode({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new B_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,p=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,p.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Yh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,p,v){if(!p||this.currentStencilSource===p.id||!c.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const N of v)if(this._tileClippingMaskIDs[N.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=p.id;const E=this.context,S=E.gl;this.nextStencilID+v.length>256&&this.clearStencil(),E.setColorMode(s.ColorMode.disabled),E.setDepthMode(s.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of v){const N=p.getTile(L),U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:te}=this.getTileBoundsBuffers(N);M.draw(E,S.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:S.ALWAYS,mask:0},U,255,S.KEEP,S.KEEP,S.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Yh(L.projMatrix),"$clipping",B,$,te)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,p=this.context.gl;return new s.StencilMode({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const p=this.context.gl;return new s.StencilMode({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(c){const p=this.context.gl,v=c.sort((M,L)=>L.overscaledZ-M.overscaledZ),E=v[v.length-1].overscaledZ,S=v[0].overscaledZ-E+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const M={};for(let L=0;L<S;L++)M[L+E]=new s.StencilMode({func:p.GEQUAL,mask:255},L+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=S,[M,v]}return[{[E]:s.StencilMode.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([c.CONSTANT_COLOR,c.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(c,p,v){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new s.DepthMode(v||this.context.gl.LEQUAL,p,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,p){this.style=c,this.options=p,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const v=this.style.order,E=this.style._sourceCaches;for(const U in E){const B=E[U];B.used&&B.prepare(this.context)}const S={},M={},L={};for(const U in E){const B=E[U];S[U]=B.getVisibleCoordinates(),M[U]=S[U].slice().reverse(),L[U]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<v.length;U++)if(this.style._layers[v[U]].is3D()){this.opaquePassCutoff=U;break}if(this.terrain&&(this.terrain.updateTileBinding(L),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const U of v){const B=this.style._layers[U],$=c._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const te=$?M[$.id]:void 0;(B.type==="custom"||B.isSky()||te&&te.length)&&this.renderLayer(this,$,B,te)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const N=this.terrain;if(N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&N.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:p.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[v[this.currentLayer]],B=c._getLayerSourceCache(U);if(U.isSky())continue;const $=B?M[B.id]:void 0;this._renderTileClippingMasks(U,B,$),this.renderLayer(this,B,U,$)}if(this.style.fog&&this.transform.projection.supportsFog&&function(U,B){const $=U.context,te=$.gl,se=U.transform,ue=new s.DepthMode(te.LEQUAL,s.DepthMode.ReadOnly,[0,1]),le=U.useProgram("globeAtmosphere",null,se.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ce=s.globeToMercatorTransition(se.zoom),X=B.properties.get("color").toArray01(),oe=B.properties.get("high-color").toArray01(),pe=B.properties.get("space-color").toArray01PremultipliedAlpha(),de=s.identity$1([]);s.rotateY$1(de,de,-s.degToRad(se._center.lng)),s.rotateX$1(de,de,s.degToRad(se._center.lat)),s.rotateZ$1(de,de,se.angle),s.rotateX$1(de,de,-se._pitch);const be=s.fromQuat(new Float32Array(16),de),Se=s.mapValue(B.properties.get("star-intensity"),0,1,0,.25),Te=5e-4,Me=s.mapValue(B.properties.get("horizon-blend"),0,1,Te,.25),Ae=s.globeUseCustomAntiAliasing(U,$,se)&&Me===Te?se.worldSize/(2*Math.PI*1.025)-1:se.globeRadius,Be=U.frameCounter/1e3%1,ct=s.length(se.globeCenterInViewSpace),Re=Math.sqrt(Math.pow(ct,2)-Math.pow(Ae,2)),rt=Math.acos(Re/ct),Ve=((Fe,tt,ft,st,pt,Ht,pr,Gt,or,kr,Dr,Xt,Fn,jn)=>({u_frustum_tl:Fe,u_frustum_tr:tt,u_frustum_br:ft,u_frustum_bl:st,u_horizon:pt,u_transition:Ht,u_fadeout_range:pr,u_color:Gt,u_high_color:or,u_space_color:kr,u_star_intensity:Dr,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xt,u_horizon_angle:Fn,u_rotation_matrix:jn}))(se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.frustumCorners.horizon,ce,Me,X,oe,pe,Se,Be,rt,be);U.prepareDrawProgram($,le);const ut=U.atmosphereBuffer;ut&&le.draw($,te.TRIANGLES,ue,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ve,"skybox",ut.vertexBuffer,ut.indexBuffer,ut.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const U=this.style._layers[v[this.currentLayer]],B=c._getLayerSourceCache(U);U.isSky()&&this.renderLayer(this,B,U,B?M[B.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const U=this.style._layers[v[this.currentLayer]],B=c._getLayerSourceCache(U);if(U.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(U)){if(U.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=B?(U.type==="symbol"?L:M)[B.id]:void 0;this._renderTileClippingMasks(U,B,B?S[B.id]:void 0),this.renderLayer(this,B,U,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let U=null;s.values(this.style._layers).forEach(B=>{const $=c._getLayerSourceCache(B);$&&!B.isHidden(this.transform.zoom)&&(!U||U.getSource().maxzoom<$.getSource().maxzoom)&&(U=$)}),U&&this.options.showTileBoundaries&&tc.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const B=U.transform.padding;k_(U,U.transform.height-(B.top||0),3,Zc),k_(U,B.bottom||0,3,W1),Ap(U,B.left||0,3,H1),Ap(U,U.transform.width-(B.right||0),3,K1);const $=U.transform.centerPoint;(function(te,se,ue,le){Xc(te,se-1,ue-10,2,20,le),Xc(te,se-10,ue-1,20,2,le)})(U,$.x,U.transform.height-$.y,Y1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,p,v,E){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||E&&E.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&v.type==="custom")&&tc[v.type](c,p,v,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let v=this.gpuTimers[c.id];v||(v=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),v.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,p=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(p),c.beginQueryEXT(c.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const p={};for(const v in c){const E=c[v],S=this.context.extTimerQuery,M=S.getQueryObjectEXT(E.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(E.query),p[v]=M}return p}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery;let v=0;for(const E of c)v+=p.getQueryObjectEXT(E,p.QUERY_RESULT_EXT)/1e6,p.deleteQueryEXT(E);return v}translatePosMatrix(c,p,v,E,S){if(!v[0]&&!v[1])return c;const M=S?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(M){const U=Math.sin(M),B=Math.cos(M);v=[v[0]*B-v[1]*U,v[0]*U+v[1]*B]}const L=[S?v[0]:bt(p,v[0],this.transform.zoom),S?v[1]:bt(p,v[1],this.transform.zoom),0],N=new Float32Array(16);return s.translate(N,c,L),N}saveTileTexture(c){const p=this._tileTextures[c.size[0]];p?p.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const p=this._tileTextures[c];return p&&p.length>0?p.pop():null}isPatternMissing(c){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,p=this.terrain&&this.terrain.exaggeration()===0,v=this.style&&this.style.fog,E=[];return this.terrainRenderModeElevated()&&E.push("TERRAIN"),this.transform.projection.name==="globe"&&E.push("GLOBE"),p&&E.push("ZERO_EXAGGERATION"),v&&!c&&v.getOpacity(this.transform.pitch)!==0&&E.push("FOG"),c&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}useProgram(c,p,v){this.cache=this.cache||{};const E=v||[],S=this.currentGlobalDefines().concat(E),M=Hr.cacheKey(kg[c],c,S,p);return this.cache[M]||(this.cache[M]=new Hr(this.context,c,kg[c],p,Jg[c],S)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,p,v){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const S=E.getOpacity(this.transform.pitch),M=((L,N,U,B,$,te,se,ue,le,ce,X)=>{const oe=L.transform,pe=N.properties.get("color").toArray01();pe[3]=B;const de=L.frameCounter/1e3%1;return{u_fog_matrix:U?oe.calculateFogTileMatrix(U):L.identityMat,u_fog_range:N.getFovAdjustedRange(oe._fov),u_fog_color:pe,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_temporal_offset:de,u_frustum_tl:$,u_frustum_tr:te,u_frustum_br:se,u_frustum_bl:ue,u_globe_pos:le,u_globe_radius:ce,u_viewport:X,u_globe_transition:s.globeToMercatorTransition(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,E,v,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);p.setFogUniformValues(c,M)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,p=c.createTexture();return c.bindTexture(c.TEXTURE_2D,p),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,p=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const E of v)p[E.key]=c[E.key]||new s.Tile(E,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}}class Lp{constructor(c=0,p=0,v=0,E=0){if(isNaN(c)||c<0||isNaN(p)||p<0||isNaN(v)||v<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=v,this.right=E}interpolate(c,p,v){return p.top!=null&&c.top!=null&&(this.top=s.number(c.top,p.top,v)),p.bottom!=null&&c.bottom!=null&&(this.bottom=s.number(c.bottom,p.bottom,v)),p.left!=null&&c.left!=null&&(this.left=s.number(c.left,p.left,v)),p.right!=null&&c.right!=null&&(this.right=s.number(c.right,p.right,v)),this}getCenter(c,p){const v=s.clamp((this.left+c-this.right)/2,0,c),E=s.clamp((this.top+p-this.bottom)/2,0,p);return new s.Point(v,E)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Lp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Op(y,c){const p=s.getColumn(y,3);s.fromQuat(y,c),s.setColumn(y,3,p)}function bn(y,c){const p=s.identity$1([]);return s.rotateZ$1(p,p,-c),s.rotateX$1(p,p,-y),p}function of(y,c){const p=[y[0],y[1],0],v=[c[0],c[1],0];if(s.length(p)>=1e-15){const M=s.normalize([],p);s.scale$2(v,M,s.dot(v,M)),c[0]=v[0],c[1]=v[1]}const E=s.cross([],c,y);if(s.len(E)<1e-15)return null;const S=Math.atan2(-E[1],E[0]);return bn(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),S)}class U_{constructor(c,p){this.position=c,this.orientation=p}get position(){return this._position}set position(c){if(c){const p=c instanceof s.MercatorCoordinate?c:new s.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(p.x=s.wrap(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(c,p){if(this.orientation=null,!this.position)return;const v=this.position,E=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(c)):0,S=s.MercatorCoordinate.fromLngLat(c,E),M=[S.x-v.x,S.y-v.y,S.z-v.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=of(M,p)}setPitchBearing(c,p){this.orientation=bn(s.degToRad(c),s.degToRad(-p))}}class Dp{constructor(c,p){this._transform=s.identity([]),this.orientation=p,this.position=c}get mercatorPosition(){const c=this.position;return new s.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=s.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var p;c&&s.setColumn(this._transform,3,[(p=c)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||s.identity$1([]),c&&Op(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,p){this._orientation=bn(c,p),Op(this._transform,this._orientation)}forward(){const c=s.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=s.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=s.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,p){const v=new Float64Array(16);return s.invert(v,this.getWorldToCamera(c,p)),v}getWorldToCameraPosition(c,p,v){const E=this.position;s.scale$2(E,E,-c);const S=new Float64Array(16);return s.fromScaling(S,[v,v,v]),s.translate(S,S,E),S[10]*=p,S}getWorldToCamera(c,p){const v=new Float64Array(16),E=new Float64Array(4),S=this.position;return s.conjugate(E,this._orientation),s.scale$2(S,S,-c),s.fromQuat(v,E),s.translate(v,v,S),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=p,v[9]*=p,v[10]*=p,v[11]*=p,v}getCameraToClipPerspective(c,p,v,E){const S=new Float64Array(16);return s.perspective(S,c,p,v,E),S}getDistanceToElevation(c,p=!1){const v=c===0?0:s.mercatorZfromAltitude(c,p?s.latFromMercatorY(this.position[1]):this.position[1]),E=this.forward();return(v-this.position[2])/E[2]}clone(){return new Dp([...this.position],[...this.orientation])}}function Hc(y,c){const p=Np(y.projection,y.zoom,y.width,y.height),v=function(S,M,L,N,U){const B=new s.LngLat(L.lng-180*Dl,L.lat),$=new s.LngLat(L.lng+180*Dl,L.lat),te=S.project(B.lng,B.lat),se=S.project($.lng,$.lat),ue=-Math.atan2(se.y-te.y,se.x-te.x),le=s.MercatorCoordinate.fromLngLat(L);le.y=s.clamp(le.y,-1+Dl,1-Dl);const ce=le.toLngLat(),X=S.project(ce.lng,ce.lat),oe=s.MercatorCoordinate.fromLngLat(ce);oe.x+=Dl;const pe=oe.toLngLat(),de=S.project(pe.lng,pe.lat),be=Rp(de.x-X.x,de.y-X.y,ue),Se=s.MercatorCoordinate.fromLngLat(ce);Se.y+=Dl;const Te=Se.toLngLat(),Me=S.project(Te.lng,Te.lat),Ae=Rp(Me.x-X.x,Me.y-X.y,ue),Be=Math.abs(be.x)/Math.abs(Ae.y),ct=s.identity([]);s.rotateZ(ct,ct,-ue*(1-(U?0:N)));const Re=s.identity([]);return s.scale(Re,Re,[1,1-(1-Be)*N,1]),Re[4]=-Ae.x/Ae.y*N,s.rotateZ(Re,Re,ue),s.multiply(Re,ct,Re),Re}(y.projection,0,y.center,p,c),E=G_(y);return s.scale(v,v,[E,E,1]),v}function G_(y){const c=y.projection,p=Np(y.projection,y.zoom,y.width,y.height),v=V_(c,y.center),E=V_(c,s.LngLat.convert(c.center));return Math.pow(2,v*p+(1-p)*E)}function Np(y,c,p,v,E=1/0){const S=y.range;if(!S)return 0;const M=Math.min(E,Math.max(p,v)),L=Math.log(M/1024)/Math.LN2;return s.smoothstep(S[0]+L,S[1]+L,c)}const Dl=1/4e4;function V_(y,c){const p=s.clamp(c.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),v=new s.LngLat(c.lng-180*Dl,p),E=new s.LngLat(c.lng+180*Dl,p),S=y.project(v.lng,p),M=y.project(E.lng,p),L=s.MercatorCoordinate.fromLngLat(v),N=s.MercatorCoordinate.fromLngLat(E),U=M.x-S.x,B=M.y-S.y,$=N.x-L.x,te=N.y-L.y,se=Math.sqrt(($*$+te*te)/(U*U+B*B));return Math.log(se)/Math.LN2}function Rp(y,c,p){const v=Math.cos(p),E=Math.sin(p);return{x:y*v-c*E,y:y*E+c*v}}class Kc{constructor(c,p,v,E,S,M,L){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=v??0,this._maxPitch=E??60,this.setProjection(M),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Dp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Kc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,p=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const v=!g(p,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const p=c!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const p=-c*Math.PI/180;var v;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(v=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),function(E,S,M){var L=S[0],N=S[1],U=S[2],B=S[3],$=Math.sin(M),te=Math.cos(M);E[0]=L*te+U*$,E[1]=N*te+B*$,E[2]=L*-$+U*te,E[3]=N*-$+B*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const p=s.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=s.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let E=0,S=0;for(let M=0;M<p.length;M++){const L=new s.Point(p[M][0]*this.width,v+p[M][1]*(this.height-v)),N=c.pointCoordinate(L);if(!N)continue;const U=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);E+=N[3]*U,S+=U}return S===0?NaN:E/S}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*p,E=this._mercatorZfromZoom(c),S=this._mercatorZfromZoom(this._maxZoom),M=Math.max(E-v,S);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[p.x,p.y,p.z]:[c.x,c.y,c.z];const E=s.length(s.sub([],this._camera.position,v));return s.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let p=!1;if(c.orientation&&!s.exactEquals(c.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];s.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,p=new U_;return p.position=new s.MercatorCoordinate(c[0],c[1],c[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(c){if(!s.length$1(c))return!1;s.normalize$1(c,c);const p=s.transformQuat([],[0,0,-1],c),v=s.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const E=of(p,v);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(c){const p=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;c[2]=s.clamp(c[2],E/v,E/p),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,p,v){this._unmodified=!1,this._edgeInsets.interpolate(c,p,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(c){const p=[new s.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new s.Point(0,0)),E=this.pointCoordinate(new s.Point(this.width,0)),S=this.pointCoordinate(new s.Point(this.width,this.height)),M=this.pointCoordinate(new s.Point(0,this.height)),L=Math.floor(Math.min(v.x,E.x,S.x,M.x)),N=Math.floor(Math.max(v.x,E.x,S.x,M.x)),U=1;for(let B=L-U;B<=N+U;B++)B!==0&&p.push(new s.UnwrappedTileID(B,c))}return p}coveringTiles(c){let p=this.coveringZoomLevel(c);const v=p,E=this.elevation&&!c.isTerrainDEM,S=this.projection.name==="mercator";if(c.minzoom!==void 0&&p<c.minzoom)return[];c.maxzoom!==void 0&&p>c.maxzoom&&(p=c.maxzoom);const M=this.locationCoordinate(this.center),L=this.center.lat,N=1<<p,U=[N*M.x,N*M.y,0],B=this.projection.name==="globe",$=!B,te=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,$),se=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=N*s.mercatorZfromAltitude(1,this.center.lat),le=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),ce=[N*se.x,N*se.y,le*($?1:ue)],X=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),oe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?p:0,pe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,de=c.isTerrainDEM?-pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?G_(this):1,Se=Fe=>{const ft=new s.MercatorCoordinate(Fe.x+25e-6,Fe.y,Fe.z),st=new s.MercatorCoordinate(Fe.x,Fe.y+25e-6,Fe.z),pt=Fe.toLngLat(),Ht=ft.toLngLat(),pr=st.toLngLat(),Gt=this.locationCoordinate(pt),or=this.locationCoordinate(Ht),kr=this.locationCoordinate(pr),Dr=Math.hypot(or.x-Gt.x,or.y-Gt.y),Xt=Math.hypot(kr.x-Gt.x,kr.y-Gt.y);return Math.sqrt(Dr*Xt)*be/25e-6},Te=Fe=>{const tt=pe,ft=de;return{aabb:s.tileAABB(this,N,0,0,0,Fe,ft,tt,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:tt,wrap:Fe,fullyVisible:!1}},Me=[];let Ae=[];const Be=p,ct=c.reparseOverscaled?v:p,Re=Fe=>Fe*Fe,rt=Re((le-this._centerAltitude)*ue),Ve=Fe=>{if(!this._elevation||!Fe.tileID||!S)return;const tt=this._elevation.getMinMaxForTile(Fe.tileID),ft=Fe.aabb;tt?(ft.min[2]=tt.min,ft.max[2]=tt.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Fe.shouldSplit=ut(Fe),Fe.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},ut=Fe=>{if(Fe.zoom<oe)return!0;if(Fe.zoom===Be)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const tt=Fe.aabb.distanceX(ce),ft=Fe.aabb.distanceY(ce);let st=rt,pt=1;if(B){st=Re(Fe.aabb.distanceZ(ce));const Gt=Math.pow(2,Fe.zoom),or=s.latFromMercatorY((Fe.y+1)/Gt),kr=s.latFromMercatorY(Fe.y/Gt),Dr=Math.min(Math.max(L,or),kr),Xt=s.circumferenceAtLatitude(Dr)/s.circumferenceAtLatitude(L);if(pt=Dr===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Fe.zoom===Be-1&&Xt>=.9)return!0}else if(E&&(st=Re(Fe.aabb.distanceZ(ce)*ue)),this.projection.isReprojectedInTileSpace&&v<=5){const Gt=Math.pow(2,Fe.zoom),or=Se(new s.MercatorCoordinate((Fe.x+.5)/Gt,(Fe.y+.5)/Gt));pt=or>.85?1:or}const Ht=tt*tt+ft*ft+st,pr=Re((1<<Be-Fe.zoom)*X*pt*((Gt,or)=>{if(or*Re(.707)<Gt)return 1;const kr=Math.sqrt(or/Gt);return kr/(1.4144271570014144+(Math.pow(1.1,kr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,rt),Ht));return Ht<pr};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Me.push(Te(-Fe)),Me.push(Te(Fe));for(Me.push(Te(0));Me.length>0;){const Fe=Me.pop(),tt=Fe.x,ft=Fe.y;let st=Fe.fullyVisible;if(!st){const pt=Fe.aabb.intersects(te);if(pt===0)continue;st=pt===2}if(Fe.zoom!==Be&&ut(Fe))for(let pt=0;pt<4;pt++){const Ht=(tt<<1)+pt%2,pr=(ft<<1)+(pt>>1),Gt={aabb:S?Fe.aabb.quadrant(pt):s.tileAABB(this,N,Fe.zoom+1,Ht,pr,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:Ht,y:pr,wrap:Fe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};E&&!B&&(Gt.tileID=new s.OverscaledTileID(Fe.zoom+1===Be?ct:Fe.zoom+1,Fe.wrap,Fe.zoom+1,Ht,pr),Ve(Gt)),Me.push(Gt)}else{const pt=Fe.zoom===Be?ct:Fe.zoom;if(c.minzoom&&c.minzoom>pt)continue;const Ht=U[0]-(.5+tt+(Fe.wrap<<Fe.zoom))*(1<<p-Fe.zoom),pr=U[1]-.5-ft,Gt=Fe.tileID?Fe.tileID:new s.OverscaledTileID(pt,Fe.wrap,Fe.zoom,tt,ft);Ae.push({tileID:Gt,distanceSq:Ht*Ht+pr*pr})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,tt=this.horizonLineFromTop();Ae=Ae.filter(ft=>{const st=[0,0,0,1],pt=[s.EXTENT,s.EXTENT,0,1],Ht=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());s.transformMat4$1(st,st,Ht),s.transformMat4$1(pt,pt,Ht);const pr=s.getAABBPointSquareDist(st,pt);if(pr===0)return!0;let Gt=!1;const or=this._elevation;if(or&&pr>Fe&&tt!==0){const kr=this.calculateProjMatrix(ft.tileID.toUnwrapped());let Dr;c.isTerrainDEM||(Dr=or.getMinMaxForTile(ft.tileID)),Dr||(Dr={min:de,max:pe});const Xt=s.furthestTileCorner(this.rotation),Fn=[Xt[0]*s.EXTENT,Xt[1]*s.EXTENT,Dr.max];s.transformMat4(Fn,Fn,kr),Gt=(1-Fn[1])*this.height*.5<tt}return pr<Fe||Gt})}return Ae.sort((Fe,tt)=>Fe.distanceSq-tt.distanceSq).map(Fe=>Fe.tileID)}resize(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const p=s.clamp(c.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),v=this.projection.project(c.lng,p);return new s.Point(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,p){let v,E;const S=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;v=(p.x-S.x)/L,E=(p.y-S.y)/L}else{const L=this.pointCoordinate(p),N=this.pointCoordinate(S);v=L.x-N.x,E=L.y-N.y}const M=this.locationCoordinate(c);this.setLocation(new s.MercatorCoordinate(M.x-v,M.y-E))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,p){const v=p?s.mercatorZfromAltitude(p,c.lat):void 0,E=this.projection.project(c.lng,c.lat);return new s.MercatorCoordinate(E.x,E.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,p){const v=p??this._centerAltitude,E=[c.x,c.y,0,1],S=[c.x,c.y,1,1];s.transformMat4$1(E,E,this.pixelMatrixInverse),s.transformMat4$1(S,S,this.pixelMatrixInverse);const M=S[3];s.scale$1(E,E,1/E[3]),s.scale$1(S,S,1/M);const L=E[2],N=S[2];return{p0:E,p1:S,t:L===N?0:(v-L)/(N-L)}}screenPointToMercatorRay(c){const p=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return s.transformMat4$1(p,p,this.pixelMatrixInverse),s.transformMat4$1(v,v,this.pixelMatrixInverse),s.scale$1(p,p,1/p[3]),s.scale$1(v,v,1/v[3]),p[2]=s.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,v[2]=s.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,s.scale$1(p,p,1/this.worldSize),s.scale$1(v,v,1/this.worldSize),new s.Ray([p[0],p[1],p[2]],s.normalize([],s.sub([],v,p)))}rayIntersectionCoordinate(c){const{p0:p,p1:v,t:E}=c,S=s.mercatorZfromAltitude(p[2],this._center.lat),M=s.mercatorZfromAltitude(v[2],this._center.lat);return new s.MercatorCoordinate(s.number(p[0],v[0],E)/this.worldSize,s.number(p[1],v[1],E)/this.worldSize,s.number(S,M,E))}pointCoordinate(c,p=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,p)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let p=this.projection.pointCoordinate3D(this,c.x,c.y);if(p)return new s.MercatorCoordinate(p[0],p[1],p[2]);let v=0,E=this.horizonLineFromTop();if(c.y>E)return this.pointCoordinate(c);const S=.02*E,M=c.clone();for(let L=0;L<10&&E-v>S;L++){M.y=s.number(v,E,.66);const N=this.projection.pointCoordinate3D(this,M.x,M.y);N?(E=M.y,p=N):v=M.y}return p?new s.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const p=this.pointCoordinate(c);return p.y>=0&&p.y<=1}_coordinatePoint(c,p){const v=p&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,E=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return s.transformMat4$1(E,E,this.pixelMatrix),E[3]>0?new s.Point(E[0]/E[3],E[1]/E[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:p}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,S=this.pointLocation3D(new s.Point(p,c)),M=this.pointLocation3D(new s.Point(E,c)),L=this.pointLocation3D(new s.Point(E,v)),N=this.pointLocation3D(new s.Point(p,v));let U=Math.min(S.lng,M.lng,L.lng,N.lng),B=Math.max(S.lng,M.lng,L.lng,N.lng),$=Math.min(S.lat,M.lat,L.lat,N.lat),te=Math.max(S.lat,M.lat,L.lat,N.lat);const se=Math.pow(2,-this.zoom)/16*270,ue=this.projection.name==="globe"?1:4,le=(ce,X,oe,pe,de)=>{const be=(ce+oe)/2,Se=(X+pe)/2,Te=new s.Point(be,Se),{lng:Me,lat:Ae}=this.pointLocation3D(Te),Be=Math.max(0,U-Me,$-Ae,Me-B,Ae-te);U=Math.min(U,Me),B=Math.max(B,Me),$=Math.min($,Ae),te=Math.max(te,Ae),(de<ue||Be>se)&&(le(ce,X,be,Se,de+1),le(be,Se,oe,pe,de+1))};if(le(p,c,E,c,1),le(E,c,E,v,1),le(E,v,p,v,1),le(p,v,p,c,1),this.projection.name==="globe"){const[ce,X]=s.polesInViewport(this);ce?(te=90,B=180,U=-180):X&&($=-90,B=180,U=-180)}return new s.LngLatBounds(new s.LngLat(U,$),new s.LngLat(B,te))}_getBoundsRectangular(c,p){const{top:v,left:E}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,L=new s.Point(E,v),N=new s.Point(M,v),U=new s.Point(M,S),B=new s.Point(E,S);let $=this.pointCoordinate(L,c),te=this.pointCoordinate(N,c);const se=this.pointCoordinate(U,p),ue=this.pointCoordinate(B,p),le=(ce,X)=>(X.y-ce.y)/(X.x-ce.x);return $.y>1&&te.y>=0?$=new s.MercatorCoordinate((1-ue.y)/le(ue,$)+ue.x,1):$.y<0&&te.y<=1&&($=new s.MercatorCoordinate(-ue.y/le(ue,$)+ue.x,0)),te.y>1&&$.y>=0?te=new s.MercatorCoordinate((1-se.y)/le(se,te)+se.x,1):te.y<0&&$.y<=1&&(te=new s.MercatorCoordinate(-se.y/le(se,te)+se.x,0)),new s.LngLatBounds().extend(this.coordinateLocation($)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(ue)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=c.visibleDemTiles.reduce((v,E)=>{if(E.dem){const S=E.dem.tree;v.min=Math.min(v.min,S.minimums[0]),v.max=Math.max(v.max,S.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*c.exaggeration(),p.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-p*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,p){return this.projection.createTileMatrix(this,p,c)}calculateDistanceTileData(c){const p=c.key,v=this._distanceTileDataCache;if(v[p])return v[p];const E=c.canonical,S=1/this.height,M=this.cameraWorldSize,L=M/this.zoomScale(E.z),N=(E.x+Math.pow(2,E.z)*c.wrap)*L,U=E.y*L,B=this.point;B.x*=M/this.worldSize,B.y*=M/this.worldSize;const $=this.angle,te=Math.sin(-$),se=-Math.cos(-$);return v[p]={bearing:[te,se],center:[(B.x-N)*S,(B.y-U)*S],scale:L/s.EXTENT*S},v[p]}calculateFogTileMatrix(c){const p=c.key,v=this._fogTileMatrixCache;if(v[p])return v[p];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return s.multiply(E,this.worldToFogMatrix,E),v[p]=new Float32Array(E),v[p]}calculateProjMatrix(c,p=!1){const v=c.key,E=p?this._alignedProjMatrixCache:this._projMatrixCache;if(E[v])return E[v];const S=this.calculatePosMatrix(c,this.worldSize);return s.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.alignedProjMatrix:this.projMatrix,S),E[v]=new Float32Array(S),E[v]}calculatePixelsToTileUnitsMatrix(c){const p=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[p])return v[p];const E=function(S,M){const{scale:L}=S.tileTransform,N=L*s.EXTENT/(S.tileSize*Math.pow(2,M.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return U=new Float32Array(4),te=(B=M.inverseAdjustmentMatrix)[1],se=B[2],ue=B[3],ce=($=[N,N])[1],U[0]=B[0]*(le=$[0]),U[1]=te*le,U[2]=se*ce,U[3]=ue*ce,U;var U,B,$,te,se,ue,le,ce}(c,this);return v[p]=E,v[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,p=s.fromScaling([],[c,c,c]);return s.multiply(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const p=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),E=this._camera.forward(),S=s.mercatorZfromAltitude(1,this._center.lat);v[2]/=S,E[2]/=S,s.normalize(E,E);const M=c.raycast(v,E,c.exaggeration());if(M){const L=s.scaleAndAdd([],v,E,M),N=new s.MercatorCoordinate(L[0],L[1],s.mercatorZfromAltitude(L[2],s.latFromMercatorY(L[1]))),U=(N.z+s.length([N.x-v[0],N.y-v[1],N.z-v[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const p=this._elevation,v=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(v),S=p.getAtPointOrZero(new s.MercatorCoordinate(...E)),M=this.pixelsPerMeter/this.worldSize*S,L=this._minimumHeightOverTerrain(),N=E[2]-M;if(N<=L)if(N<0||c){const U=this.locationCoordinate(this._center,this._centerAltitude),B=[E[0],E[1],U.z-E[2]],$=s.length(B);B[2]-=(L-N)/this._pixelsPerMercatorPixel;const te=s.length(B);if(te===0)return;s.scale$2(B,B,$/te*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],U.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const te=this.center;return te.lat=s.clamp(te.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(te.lng=s.clamp(te.lng,this.minLng,this.maxLng)),this.center=te,void(this._constraining=!1)}const p=this._unmodified,{x:v,y:E}=this.point;let S=0,M=v,L=E;const N=this.width/2,U=this.height/2,B=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(E-U<B&&(L=B+U),E+U>$&&(L=$-U),$-B<this.height&&(S=Math.max(S,this.height/($-B)),L=($+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const te=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,ue=this.worldSize/2-(te+se)/2;M=(v+ue+this.worldSize)%this.worldSize-ue,M-N<te&&(M=te+N),M+N>se&&(M=se-N),se-te<this.width&&(S=Math.max(S,this.width/(se-te)),M=(se+te)/2)}M===v&&L===E||(this.center=this.unproject(new s.Point(M,L))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const v=Np(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this.projection.zAxisUnit==="meters"?p:1,S=this._camera.getWorldToCamera(this.worldSize,E),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-c.x/this.width,M[9]=2*c.y/this.height;let L=s.mul([],M,S);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Te=s.identity([]);s.translate(Te,Te,[Se.x*this.worldSize,Se.y*this.worldSize,0]),s.multiply(Te,Te,Hc(this)),s.translate(Te,Te,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),s.multiply(L,L,Te),this.inverseAdjustmentMatrix=function(Me){const Ae=Hc(Me,!0);return W([],[Ae[0],Ae[1],Ae[4],Ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],L,[this.worldSize,this.worldSize,this.worldSize/E,1]),this.projMatrix=L,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const N=s.invert([],M);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height);const U=new Float32Array(16);s.identity(U),s.scale(U,U,[1,-1,1]),s.rotateX(U,U,this._pitch),s.rotateZ(U,U,this.angle);const B=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-c.x/this.width,B[9]=2*(c.y+$)/this.height,this.skyboxMatrix=s.multiply(U,B,U);const te=this.point,se=te.x,ue=te.y,le=this.width%2/2,ce=this.height%2/2,X=Math.cos(this.angle),oe=Math.sin(this.angle),pe=se-Math.round(se)+X*le+oe*ce,de=ue-Math.round(ue)+X*ce+oe*le,be=new Float64Array(L);if(s.translate(be,be,[pe>.5?pe-1:pe,de>.5?de-1:de,0]),this.alignedProjMatrix=be,L=s.create(),s.scale(L,L,[this.width/2,-this.height/2,1]),s.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.create(),s.scale(L,L,[1,-1,1]),s.translate(L,L,[-1,-1,0]),s.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(Se,Se,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,v=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,S=[c,c,p];s.scale$2(S,S,E),s.scale$2(v,v,-1),s.multiply$2(v,v,S);const M=s.create();s.translate(M,M,v),s.scale(M,M,S),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,p,E)}_computeCameraPosition(c){const p=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),E=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-c/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-v[0]*S,E.y/this.worldSize-v[1]*S,c/this.worldSize*this._centerAltitude-v[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],E=c[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(S=Math.min((p-v)/E,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,c,S),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,p=this._camera.forward(),{pitch:v,bearing:E}=this._camera.getPitchBearing(),S=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),L=Math.max((c[2]-S)/Math.cos(v),M),N=this._zoomFromMercatorZ(L);s.scaleAndAdd(c,c,p,L),this._pitch=s.clamp(v,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(E,-Math.PI,Math.PI),this._setZoom(s.clamp(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let p=0,v=s.GLOBE_ZOOM_THRESHOLD_MAX,E=0,S=1/0;for(;v-p>1e-6&&v>p;){const M=p+.5*(v-p),L=this.tileSize*Math.pow(2,M),N=this.getCameraToCenterDistance(this.projection,M,L),U=this.scaleZoom(N/(c*this.tileSize)),B=Math.abs(M-U);B<S&&(S=B,E=M),M<U?p=M:v=M}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,p){const v=Math.min(c.x,p.x),E=Math.max(c.x,p.x),S=Math.min(c.y,p.y),M=Math.max(c.y,p.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new s.Point(v,S),new s.Point(E,M),new s.Point(v,M),new s.Point(E,S)],N=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const B of L){const $=this.pointRayIntersection(B);if($.t<0)return!0;const te=this.rayIntersectionCoordinate($);if(te.x<N||te.y<0||te.x>U||te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(c,p){const v=s.length(s.sub([],this._camera.position,c)),E=this._zoomFromMercatorZ(v)+p;return v-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([p,v,E],S){const M=[p,v,E,1];s.transformMat4$1(M,M,S);const L=M[3]=Math.max(M[3],1e-6);return M[0]/=L,M[1]/=L,M[2]/=L,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,c))}}getCameraToCenterDistance(c,p=this.zoom,v=this.worldSize){const E=Np(c,p,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,v,E);return .5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(c,c,this.globeMatrix),c}}function Yc(y,c){let p=!1,v=null;const E=()=>{v=null,p&&(y(),v=setTimeout(E,c),p=!1)};return()=>(p=!0,v||E(),v)}class tm{constructor(c){this._hashName=c&&encodeURIComponent(c),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yc(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,s.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const p=sf(c);if(this._hashName){const v=this._hashName;let E=!1;const S=s.window.location.hash.slice(1).split("&").map(M=>{const L=M.split("=")[0];return L===v?(E=!0,`${L}=${p}`):M}).filter(M=>M);return E||S.push(`${v}=${p}`),`#${S.join("&")}`}return`#${p}`}_getCurrentHash(){const c=s.window.location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(p=v)}),(p&&p[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(p[3]||0):c.getBearing();return c.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:v,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,c)}}function sf(y,c){const p=y.getCenter(),v=Math.round(100*y.getZoom())/100,E=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,E),M=Math.round(p.lng*S)/S,L=Math.round(p.lat*S)/S,N=y.getBearing(),U=y.getPitch();let B=c?`/${M}/${L}/${v}`:`${v}/${L}/${M}`;return(N||U)&&(B+="/"+Math.round(10*N)/10),U&&(B+=`/${Math.round(U)}`),B}const af={linearity:.3,easing:s.bezier(0,0,.3,1)},kp=s.extend({deceleration:2500,maxSpeed:1400},af),Fp=s.extend({deceleration:20,maxSpeed:1400},af),Rt=s.extend({deceleration:1e3,maxSpeed:360},af),Ia=s.extend({deceleration:1e3,maxSpeed:90},af);class j_{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,p=s.exported.now();for(;c.length>0&&p-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)p.zoom+=S.zoomDelta||0,p.bearing+=S.bearingDelta||0,p.pitch+=S.pitchDelta||0,S.panDelta&&p.pan._add(S.panDelta),S.around&&(p.around=S.around),S.pinchAround&&(p.pinchAround=S.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(p.pan.mag()){const S=uf(p.pan.mag(),v,s.extend({},kp,c||{}));E.offset=p.pan.mult(S.amount/p.pan.mag()),E.center=this._map.transform.center,lf(E,S)}if(p.zoom){const S=uf(p.zoom,v,Fp);E.zoom=this._map.transform.zoom+S.amount,lf(E,S)}if(p.bearing){const S=uf(p.bearing,v,Rt);E.bearing=this._map.transform.bearing+s.clamp(S.amount,-179,179),lf(E,S)}if(p.pitch){const S=uf(p.pitch,v,Ia);E.pitch=this._map.transform.pitch+S.amount,lf(E,S)}if(E.zoom||E.bearing){const S=p.pinchAround===void 0?p.around:p.pinchAround;E.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function lf(y,c){(!y.duration||y.duration<c.duration)&&(y.duration=c.duration,y.easing=c.easing)}function uf(y,c,p){const{maxSpeed:v,linearity:E,deceleration:S}=p,M=s.clamp(y*E/(c/1e3),-v,v),L=Math.abs(M)/(S*E);return{easing:p.easing,duration:1e3*L,amount:M*(L/2)}}class wo extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v,E={}){const S=Y(p.getCanvasContainer(),v),M=p.unproject(S);super(c,s.extend({point:S,lngLat:M,originalEvent:v},E)),this._defaultPrevented=!1,this.target=p}}class cf extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v){const E=c==="touchend"?v.changedTouches:v.touches,S=ie(p.getCanvasContainer(),E),M=S.map(N=>p.unproject(N)),L=S.reduce((N,U,B,$)=>N.add(U.div($.length)),new s.Point(0,0));super(c,{points:S,point:L,lngLats:M,lngLat:p.unproject(L),originalEvent:v}),this._defaultPrevented=!1}}class zp extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class rm{constructor(c,p){this._map=c,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new zp(c.type,this._map,c))}mousedown(c,p){return this._mousedownPos=p,this._firePreventable(new wo(c.type,this._map,c))}mouseup(c){this._map.fire(new wo(c.type,this._map,c))}preclick(c){const p=s.extend({},c);p.type="preclick",this._map.fire(new wo(p.type,this._map,p))}click(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(c),this._map.fire(new wo(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new wo(c.type,this._map,c))}mouseover(c){this._map.fire(new wo(c.type,this._map,c))}mouseout(c){this._map.fire(new wo(c.type,this._map,c))}touchstart(c){return this._firePreventable(new cf(c.type,this._map,c))}touchmove(c){this._map.fire(new cf(c.type,this._map,c))}touchend(c){this._map.fire(new cf(c.type,this._map,c))}touchcancel(c){this._map.fire(new cf(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bp{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new wo(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new wo(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class q_{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,p){this.isEnabled()&&c.shiftKey&&c.button===0&&(Z(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(c,p){if(!this._active)return;const v=p,E=this._startPos,S=this._lastPos;if(!E||!S||S.equals(v)||!this._box&&v.dist(E)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=I("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(E.x,v.x),L=Math.max(E.x,v.x),N=Math.min(E.y,v.y),U=Math.max(E.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${N}px)`,this._box.style.width=L-M+"px",this._box.style.height=U-N+"px")})}mouseupWindow(c,p){if(!this._active)return;const v=this._startPos,E=p;if(v&&c.button===0){if(this.reset(),j(),v.x!==E.x||v.y!==E.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(v,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),D(),delete this._startPos,delete this._lastPos}_fireEvent(c,p){return this._map.fire(new s.Event(c,{originalEvent:p}))}}function Up(y,c){const p={};for(let v=0;v<y.length;v++)p[y[v].identifier]=c[v];return p}class Jc{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,p,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(E){const S=new s.Point(0,0);for(const M of E)S._add(M);return S.div(E.length)}(p),this.touches=Up(v,p)))}touchmove(c,p,v){if(this.aborted||!this.centroid)return;const E=Up(v,p);for(const S in this.touches){const M=E[S];(!M||M.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,p,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class nm{constructor(c){this.singleTap=new Jc(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,p,v){this.singleTap.touchstart(c,p,v)}touchmove(c,p,v){this.singleTap.touchmove(c,p,v)}touchend(c,p,v){const E=this.singleTap.touchend(c,p,v);if(E){const S=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(E)<30;if(S&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class Q1{constructor(){this._zoomIn=new nm({numTouches:1,numTaps:2}),this._zoomOut=new nm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,p,v){this._zoomIn.touchstart(c,p,v),this._zoomOut.touchstart(c,p,v)}touchmove(c,p,v){this._zoomIn.touchmove(c,p,v),this._zoomOut.touchmove(c,p,v)}touchend(c,p,v){const E=this._zoomIn.touchend(c,p,v),S=this._zoomOut.touchend(c,p,v);return E?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $_={0:1,2:2};class Qc{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,p){return!1}_move(c,p){return{}}mousedown(c,p){if(this._lastPoint)return;const v=ne(c);this._correctButton(c,v)&&(this._lastPoint=p,this._eventButton=v)}mousemoveWindow(c,p){const v=this._lastPoint;if(v){if(c.preventDefault(),this._eventButton!=null&&function(E,S){const M=$_[S];return E.buttons===void 0||(E.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(v,p)}}mouseupWindow(c){this._lastPoint&&ne(c)===this._eventButton&&(this._moved&&j(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class im extends Qc{mousedown(c,p){super.mousedown(c,p),this._lastPoint&&(this._active=!0)}_correctButton(c,p){return p===0&&!c.ctrlKey}_move(c,p){return{around:p,panDelta:p.sub(c)}}}class om extends Qc{_correctButton(c,p){return p===0&&c.ctrlKey||p===2}_move(c,p){const v=.8*(p.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class sm extends Qc{_correctButton(c,p){return p===0&&c.ctrlKey||p===2}_move(c,p){const v=-.5*(p.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class Gp{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(c,p,v){return this._calculateTransform(c,p,v)}touchmove(c,p,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,p,v)}}touchend(c,p,v){this._calculateTransform(c,p,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,p,v){v.length>0&&(this._active=!0);const E=Up(v,p),S=new s.Point(0,0),M=new s.Point(0,0);let L=0;for(const U in E){const B=E[U],$=this._touches[U];$&&(S._add(B),M._add(B.sub($)),L++,E[U]=B)}if(this._touches=E,L<this._minTouches||!M.mag())return;const N=M.div(L);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(L),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=I("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class hf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,p,v){return{}}touchstart(c,p,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([p[0],p[1]]))}touchmove(c,p,v){const E=this._firstTwoTouches;if(!E)return;c.preventDefault();const[S,M]=E,L=ff(v,p,S),N=ff(v,p,M);if(!L||!N)return;const U=this._aroundCenter?null:L.add(N).div(2);return this._move([L,N],U,c)}touchend(c,p,v){if(!this._firstTwoTouches)return;const[E,S]=this._firstTwoTouches,M=ff(v,p,E),L=ff(v,p,S);M&&L||(this._active&&j(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ff(y,c,p){for(let v=0;v<y.length;v++)if(y[v].identifier===p)return c[v]}function am(y,c){return Math.log(y/c)/Math.LN2}class Z_ extends hf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,p){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(am(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:am(this._distance,v),pinchAround:p}}}function lm(y,c){return 180*y.angleWith(c)/Math.PI}class X_ extends hf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,p){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:lm(this._vector,v),pinchAround:p}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const p=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const E=lm(c,v);return Math.abs(E)<p}}function gu(y){return Math.abs(y.y)>Math.abs(y.x)}class W_ extends hf{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,gu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,p,v){const E=this._lastPoints;if(!E)return;const S=c[0].sub(E[0]),M=c[1].sub(E[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(S,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+M.y)/2*-.5})}gestureBeginsVertically(c,p,v){if(this._valid!==void 0)return this._valid;const E=c.mag()>=2,S=p.mag()>=2;if(!E&&!S)return;if(!E||!S)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==p.y>0;return gu(c)&&gu(p)&&M}}const H_={panStep:100,bearingStep:15,pitchStep:10};class ex{constructor(){const c=H_;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let p=0,v=0,E=0,S=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?E=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?E=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,E=0),{cameraAnimation:L=>{const N=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:K_,zoom:p?Math.round(N)+p*(c.shiftKey?2:1):N,bearing:L.getBearing()+v*this._bearingStep,pitch:L.getPitch()+E*this._pitchStep,offset:[-S*this._panStep,-M*this._panStep],center:L.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function K_(y){return y*(2-y)}const um=4.000244140625;class Y_{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=c.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=s.exported.now(),E=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,p!==0&&p%um==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(E*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=Y(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>um?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&U!==0&&(U=1/U);const B=p(),$=Math.pow(2,B),te=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(te*U))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:p(),E=this._startZoom,S=this._easing;let M,L=!1;if(this._type==="wheel"&&E&&S){const N=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),U=S(N);M=s.number(E,v,U),N<1?this._frameId||(this._frameId=!0):L=!0}else M=v,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:M-p(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let p=s.ease;if(this._prevEase){const v=this._prevEase,E=(s.exported.now()-v.start)/v.duration,S=v.easing(E+.01)-v.easing(E),M=.27/Math.sqrt(S*S+1e-4)*.01,L=Math.sqrt(.0729-M*M);p=s.bezier(M,L,.25,1)}return this._prevEase={start:s.exported.now(),duration:c,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=I("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class J_{constructor(c,p){this._clickZoom=c,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,p){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(p)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tx{constructor(){this._tap=new nm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,p,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=p[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,p,v))}touchmove(c,p,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const E=p[0],S=E.y-this._swipePoint.y;return this._swipePoint=E,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,p,v)}touchend(c,p,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(c,p,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Q_{constructor(c,p,v){this._el=c,this._mousePan=p,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rx{constructor(c,p,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nx{constructor(c,p,v,E){this._el=c,this._touchZoom=p,this._touchRotate=v,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ra=y=>y.zoom||y.drag||y.pitch||y.rotate;class ev extends s.Event{}class ix{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,p){const v=s.sub([],p,c);this.radius=s.length(v[2]<0?s.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){s.div(c,c,this.constants),s.normalize(c,c),s.mul$1(c,c,this.constants);const p=s.scale$2([],c,this.radius);if(p[2]>0){const v=s.scale$2([],[0,0,1],s.dot(p,[0,0,1])),E=s.scale$2([],s.normalize([],[p[0],p[1],0]),this.radius),S=s.add([],p,s.scale$2([],s.sub([],s.add([],E,v),p),2));p[0]=S[0],p[1]=S[1]}return p}}function Pa(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Wa{constructor(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new j_(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ix,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),s.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[E,S,M]of this._listeners)E.addEventListener(S,E===s.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[c,p,v]of this._listeners)c.removeEventListener(p,c===s.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(c){const p=this._map,v=p.getCanvasContainer();this._add("mapEvent",new rm(p,c));const E=p.boxZoom=new q_(p,c);this._add("boxZoom",E);const S=new Q1,M=new Wo;p.doubleClickZoom=new J_(M,S),this._add("tapZoom",S),this._add("clickZoom",M);const L=new tx;this._add("tapDragZoom",L);const N=p.touchPitch=new W_(p);this._add("touchPitch",N);const U=new om(c),B=new sm(c);p.dragRotate=new rx(c,U,B),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const $=new im(c),te=new Gp(p,c);p.dragPan=new Q_(v,$,te),this._add("mousePan",$),this._add("touchPan",te,["touchZoom","touchRotate"]);const se=new X_,ue=new Z_;p.touchZoomRotate=new nx(v,ue,se,L),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bp(p));const le=p.scrollZoom=new Y_(p,this);this._add("scrollZoom",le,["mousePan"]);const ce=p.keyboard=new ex;this._add("keyboard",ce);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[X]&&p[X].enable(c[X])}_add(c,p,v){this._handlers.push({handlerName:c,handler:p,allowed:v}),this._handlersById[c]=p}stop(c){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ra(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,p,v){for(const E in c)if(E!==v&&(!p||p.indexOf(E)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const p=[];for(const v of c)this._el.contains(v.target)&&p.push(v);return p}handleEvent(c,p){this._updatingCamera=!0;const v=c.type==="renderFrame",E=v?void 0:c,S={needsRenderFrame:!1},M={},L={},N=c.touches?this._getMapTouches(c.touches):void 0,U=N?ie(this._el,N):v?void 0:Y(this._el,c);for(const{handlerName:te,handler:se,allowed:ue}of this._handlers){if(!se.isEnabled())continue;let le;this._blockedByActive(L,ue,te)?se.reset():se[p||c.type]&&(le=se[p||c.type](c,U,N),this.mergeHandlerResult(S,M,le,te,E),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||se.isActive())&&(L[te]=se)}const B={};for(const te in this._previousActiveHandlers)L[te]||(B[te]=E);this._previousActiveHandlers=L,(Object.keys(B).length||Pa(S))&&(this._changes.push([S,M,B]),this._triggerRenderFrame()),(Object.keys(L).length||Pa(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=S;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(c,p,v,E,S){if(!v)return;s.extend(c,v);const M={handlerName:E,originalEvent:v.originalEvent||S};v.zoomDelta!==void 0&&(p.zoom=M),v.panDelta!==void 0&&(p.drag=M),v.pitchDelta!==void 0&&(p.pitch=M),v.bearingDelta!==void 0&&(p.rotate=M)}_applyChanges(){const c={},p={},v={};for(const[E,S,M]of this._changes)E.panDelta&&(c.panDelta=(c.panDelta||new s.Point(0,0))._add(E.panDelta)),E.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(c.around=E.around),E.aroundCoord!==void 0&&(c.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(c.pinchAround=E.pinchAround),E.noInertia&&(c.noInertia=E.noInertia),s.extend(p,S),s.extend(v,M);this._updateMapTransform(c,p,v),this._changes=[]}_updateMapTransform(c,p,v){const E=this._map,S=E.transform,M=oe=>[oe.x,oe.y,oe.z];if((oe=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Pa(c)){const oe=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",oe!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&E._stop(!0),!Pa(c))return void this._fireEvents(p,v,!0);let{panDelta:L,zoomDelta:N,bearingDelta:U,pitchDelta:B,around:$,aroundCoord:te,pinchAround:se}=c;S._isCameraConstrained&&(N>0&&(N=0),S._isCameraConstrained=!1),se!==void 0&&($=se),(N||(oe=>p[oe]&&!this._eventsInProgress[oe])("drag"))&&$&&(this._dragOrigin=M(S.pointCoordinate3D($)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",E._stop(!0),$=$||E.transform.centerPoint,U&&(S.bearing+=U),B&&(S.pitch+=B),S._updateCameraState();const ue=[0,0,0];if(L)if(S.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay($).dir),pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay($.sub(L)).dir);ue[0]=pe[0]-oe[0],ue[1]=pe[1]-oe[1]}else{const oe=S.pointCoordinate($);if(S.projection.name==="globe"){L=L.rotate(-S.angle);const pe=S._pixelsPerMercatorPixel/S.worldSize;ue[0]=-L.x*s.mercatorScale(s.latFromMercatorY(oe.y))*pe,ue[1]=-L.y*s.mercatorScale(S.center.lat)*pe}else{const pe=S.pointCoordinate($.sub(L));oe&&pe&&(ue[0]=pe.x-oe.x,ue[1]=pe.y-oe.y)}}const le=S.zoom,ce=[0,0,0];if(N){const oe=M(te||S.pointCoordinate3D($)),pe={dir:s.normalize([],s.sub([],oe,S._camera.position))};if(pe.dir[2]<0){const de=S.zoomDeltaToMovement(oe,N);s.scale$2(ce,pe.dir,de)}}const X=s.add(ue,ue,ce);S._translateCameraConstrained(X),N&&Math.abs(S.zoom-le)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,v,!0)}_fireEvents(c,p,v){const E=ra(this._eventsInProgress),S=ra(c),M={};for(const B in c){const{originalEvent:$}=c[B];this._eventsInProgress[B]||(M[`${B}start`]=$),this._eventsInProgress[B]=c[B]}!E&&S&&this._fireEvent("movestart",S.originalEvent);for(const B in M)this._fireEvent(B,M[B]);S&&this._fireEvent("move",S.originalEvent);for(const B in c){const{originalEvent:$}=c[B];this._fireEvent(B,$)}const L={};let N;for(const B in this._eventsInProgress){const{handlerName:$,originalEvent:te}=this._eventsInProgress[B];this._handlersById[$].isActive()||(delete this._eventsInProgress[B],N=p[$]||te,L[`${B}end`]=N)}for(const B in L)this._fireEvent(B,L[B]);const U=ra(this._eventsInProgress);if(v&&(E||S)&&!U){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;B?($(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:N})):(this._map.fire(new s.Event("moveend",{originalEvent:N})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,p){this._map.fire(new s.Event(c,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new ev("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const rc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Vp extends s.Evented{constructor(c,p){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=p.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,p){return this.jumpTo({center:c},p)}panBy(c,p,v){return c=s.Point.convert(c).mult(-1),this.panTo(this.transform.center,s.extend({offset:c},p),v)}panTo(c,p,v){return this.easeTo(s.extend({center:c},p),v)}getZoom(){return this.transform.zoom}setZoom(c,p){return this.jumpTo({zoom:c},p),this}zoomTo(c,p,v){return this.easeTo(s.extend({zoom:c},p),v)}zoomIn(c,p){return this.zoomTo(this.getZoom()+1,c,p),this}zoomOut(c,p){return this.zoomTo(this.getZoom()-1,c,p),this}getBearing(){return this.transform.bearing}setBearing(c,p){return this.jumpTo({bearing:c},p),this}getPadding(){return this.transform.padding}setPadding(c,p){return this.jumpTo({padding:c},p),this}rotateTo(c,p,v){return this.easeTo(s.extend({bearing:c},p),v)}resetNorth(c,p){return this.rotateTo(0,s.extend({duration:1e3},c),p),this}resetNorthPitch(c,p){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},c),p),this}snapToNorth(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this}getPitch(){return this.transform.pitch}setPitch(c,p){return this.jumpTo({pitch:c},p),this}cameraForBounds(c,p){c=s.LngLatBounds.convert(c);const v=p&&p.bearing||0,E=p&&p.pitch||0,S=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,S,M,v,E,p)}_extendCameraOptions(c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=s.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=s.extend(p,c.padding),c}_minimumAABBFrustumDistance(c,p){const v=p.max[0]-p.min[0],E=p.max[1]-p.min[1];return v/E>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):E/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,p,v,E,S,M){const L=c.clone(),N=this._extendCameraOptions(M);L.bearing=E,L.pitch=S;const U=s.LngLat.convert(p),B=s.LngLat.convert(v),$=.5*(U.lat+B.lat),te=.5*(U.lng+B.lng),se=s.latLngToECEF($,te),ue=s.normalize([],se),le=s.normalize([],s.cross([],ue,[0,1,0])),ce=s.cross([],le,ue),X=[le[0],le[1],le[2],0,ce[0],ce[1],ce[2],0,ue[0],ue[1],ue[2],0,0,0,0,1],oe=[se,s.latLngToECEF(U.lat,U.lng),s.latLngToECEF(B.lat,U.lng),s.latLngToECEF(B.lat,B.lng),s.latLngToECEF(U.lat,B.lng),s.latLngToECEF($,U.lng),s.latLngToECEF($,B.lng),s.latLngToECEF(U.lat,te),s.latLngToECEF(B.lat,te)];let pe=s.Aabb.fromPoints(oe.map(st=>[s.dot(le,st),s.dot(ce,st),s.dot(ue,st)]));const de=s.transformMat4([],pe.center,X);s.squaredLength(de)===0&&s.set(de,0,0,1),s.normalize(de,de),s.scale$2(de,de,s.GLOBE_RADIUS),L.center=s.ecefToLatLng(de);const be=L.getWorldToCameraMatrix(),Se=s.invert(new Float64Array(16),be);pe=s.Aabb.applyTransform(pe,s.multiply([],be,X)),s.transformMat4(de,de,be);const Te=.5*(pe.max[2]-pe.min[2]),Me=this._minimumAABBFrustumDistance(L,pe),Ae=s.scale$2([],[0,0,1],Te),Be=s.add(Ae,de,Ae),ct=Me+(L.pitch===0?0:s.distance(de,Be)),Re=L.globeCenterInViewSpace,rt=s.sub([],de,[Re[0],Re[1],Re[2]]);s.normalize(rt,rt),s.scale$2(rt,rt,ct);const Ve=s.add([],de,rt);s.transformMat4(Ve,Ve,Se);const ut=s.earthRadius/s.GLOBE_RADIUS,Fe=s.length(Ve),tt=s.mercatorZfromAltitude(Math.max(Fe*ut-s.earthRadius,Number.EPSILON),0),ft=Math.min(L.zoomFromMercatorZAdjusted(tt),N.maxZoom);return ft>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(L.setProjection({name:"mercator"}),L.zoom=ft,this._cameraForBounds(L,p,v,E,S,M)):{center:L.center,zoom:ft,bearing:E,pitch:S}}queryTerrainElevation(c,p){const v=this.transform.elevation;return v?(p=s.extend({},{exaggerated:!0},p),v.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,p.exaggerated)):null}_cameraForBounds(c,p,v,E,S,M){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,p,v,E,S,M);const L=c.clone(),N=this._extendCameraOptions(M),U=L.padding;L.bearing=E,L.pitch=S;const B=s.LngLat.convert(p),$=s.LngLat.convert(v),te=new s.LngLat(B.lng,$.lat),se=new s.LngLat($.lng,B.lat),ue=L.project(B),le=L.project($),ce=this.queryTerrainElevation(B),X=this.queryTerrainElevation($),oe=this.queryTerrainElevation(te),pe=this.queryTerrainElevation(se),de=[[ue.x,ue.y,Math.min(ce||0,X||0,oe||0,pe||0)],[le.x,le.y,Math.max(ce||0,X||0,oe||0,pe||0)]];let be=s.Aabb.fromPoints(de);const Se=L.getWorldToCameraMatrix(),Te=s.invert(new Float64Array(16),Se);be=s.Aabb.applyTransform(be,Se);const Me=s.sub([],be.max,be.min),Ae=U.left||0,Be=U.right||0,ct=U.bottom||0,Re=U.top||0,{left:rt,right:Ve,top:ut,bottom:Fe}=N.padding,tt=.5*(Ae+Be),ft=.5*(Re+ct),st=Math.min(L.scaleZoom(L.scale*Math.min((L.width-(Ae+Be+rt+Ve))/Me[0],(L.height-(ct+Re+Fe+ut))/Me[1])),N.maxZoom),pt=L.scale/L.zoomScale(st);be=new s.Aabb([be.min[0]-(rt+tt)*pt,be.min[1]-(Fe+ft)*pt,be.min[2]],[be.max[0]+(Ve+tt)*pt,be.max[1]+(ut+ft)*pt,be.max[2]]);const Ht=.5*Me[2],pr=this._minimumAABBFrustumDistance(L,be),Gt=[0,0,1,0];s.transformMat4$1(Gt,Gt,Se),s.normalize$2(Gt,Gt);const or=s.scale$2([],Gt,pr+Ht),kr=s.add([],be.center,or),Dr=(typeof N.offset.x=="number"&&typeof N.offset.y=="number"?new s.Point(N.offset.x,N.offset.y):s.Point.convert(N.offset)).rotate(-s.degToRad(E));be.center[0]-=Dr.x*pt,be.center[1]+=Dr.y*pt,s.transformMat4(be.center,be.center,Te),s.transformMat4(kr,kr,Te);const Xt=[be.center[0],be.center[1],kr[2]*L.pixelsPerMeter];s.scale$2(Xt,Xt,1/L.worldSize);const Fn=s.lngFromMercatorX(Xt[0]),jn=s.latFromMercatorY(Xt[1]),qn=Math.min(L._zoomFromMercatorZ(Xt[2]),N.maxZoom),$n=new s.LngLat(Fn,jn);return L.mercatorFromTransition&&qn<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(L.setProjection({name:"globe"}),L.zoom=qn,this._cameraForBounds(L,p,v,E,S,M)):{center:$n,zoom:qn,bearing:E,pitch:S}}fitBounds(c,p,v){const E=this.cameraForBounds(c,p);return this._fitInternal(E,p,v)}fitScreenCoordinates(c,p,v,E,S){const M=s.Point.convert(c),L=s.Point.convert(p),N=new s.Point(Math.min(M.x,L.x),Math.min(M.y,L.y)),U=new s.Point(Math.max(M.x,L.x),Math.max(M.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,L))return this;const B=this.transform.pointLocation3D(N),$=this.transform.pointLocation3D(U),te=this.transform.pointLocation3D(new s.Point(N.x,U.y)),se=this.transform.pointLocation3D(new s.Point(U.x,N.y)),ue=[Math.min(B.lng,$.lng,te.lng,se.lng),Math.min(B.lat,$.lat,te.lat,se.lat)],le=[Math.max(B.lng,$.lng,te.lng,se.lng),Math.max(B.lat,$.lat,te.lat,se.lat)],ce=E&&E.pitch?E.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,ue,le,v,ce,E);return this._fitInternal(X,E,S)}_fitInternal(c,p,v){return c?(delete(p=s.extend(c,p)).padding,p.linear?this.easeTo(p,v):this.flyTo(p,v)):this}jumpTo(c,p){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let E=!1,S=!1,M=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(E=!0,v.zoom=+c.zoom),c.center!==void 0&&(v.center=s.LngLat.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(S=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),c.padding==null||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new s.Event("movestart",p)).fire(new s.Event("move",p)),E&&this.fire(new s.Event("zoomstart",p)).fire(new s.Event("zoom",p)).fire(new s.Event("zoomend",p)),S&&this.fire(new s.Event("rotatestart",p)).fire(new s.Event("rotate",p)).fire(new s.Event("rotateend",p)),M&&this.fire(new s.Event("pitchstart",p)).fire(new s.Event("pitch",p)).fire(new s.Event("pitchend",p)),this.fire(new s.Event("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(rc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,p){const v=this.transform;if(!v.projection.supportsFreeCamera)return s.warnOnce(rc),this;this.stop();const E=v.zoom,S=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const L=E!==v.zoom,N=S!==v.pitch,U=M!==v.bearing;return this.fire(new s.Event("movestart",p)).fire(new s.Event("move",p)),L&&this.fire(new s.Event("zoomstart",p)).fire(new s.Event("zoom",p)).fire(new s.Event("zoomend",p)),U&&this.fire(new s.Event("rotatestart",p)).fire(new s.Event("rotate",p)).fire(new s.Event("rotateend",p)),N&&this.fire(new s.Event("pitchstart",p)).fire(new s.Event("pitch",p)).fire(new s.Event("pitchend",p)),this.fire(new s.Event("moveend",p)),this}easeTo(c,p){this._stop(!1,c.easeId),((c=s.extend({offset:[0,0],duration:500,easing:s.ease},c)).animate===!1||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,E=this.getZoom(),S=this.getBearing(),M=this.getPitch(),L=this.getPadding(),N="zoom"in c?+c.zoom:E,U="bearing"in c?this._normalizeBearing(c.bearing,S):S,B="pitch"in c?+c.pitch:M,$="padding"in c?c.padding:v.padding,te=s.Point.convert(c.offset);let se,ue,le;if(v.projection.name==="globe"){const Ae=s.MercatorCoordinate.fromLngLat(v.center),Be=te.rotate(-v.angle);Ae.x+=Be.x/v.worldSize,Ae.y+=Be.y/v.worldSize;const ct=Ae.toLngLat(),Re=s.LngLat.convert(c.center||ct);this._normalizeCenter(Re),se=v.centerPoint.add(Be),ue=new s.Point(Ae.x,Ae.y).mult(v.worldSize),le=new s.Point(s.mercatorXfromLng(Re.lng),s.mercatorYfromLat(Re.lat)).mult(v.worldSize).sub(ue)}else{se=v.centerPoint.add(te);const Ae=v.pointLocation(se),Be=s.LngLat.convert(c.center||Ae);this._normalizeCenter(Be),ue=v.project(Ae),le=v.project(Be).sub(ue)}const ce=v.zoomScale(N-E);let X,oe;c.around&&(X=s.LngLat.convert(c.around),oe=v.locationPoint(X));const pe=this._zooming||N!==E,de=this._rotating||S!==U,be=this._pitching||B!==M,Se=!v.isPaddingEqual($),Te=Ae=>Be=>{if(pe&&(Ae.zoom=s.number(E,N,Be)),de&&(Ae.bearing=s.number(S,U,Be)),be&&(Ae.pitch=s.number(M,B,Be)),Se&&(Ae.interpolatePadding(L,$,Be),se=Ae.centerPoint.add(te)),X)Ae.setLocationAtPoint(X,oe);else{const ct=Ae.zoomScale(Ae.zoom-E),Re=N>E?Math.min(2,ce):Math.max(.5,ce),rt=Math.pow(Re,1-Be),Ve=Ae.unproject(ue.add(le.mult(Be*rt)).mult(ct));Ae.setLocationAtPoint(Ae.renderWorldCopies?Ve.wrap():Ve,se)}return c.preloadOnly||this._fireMoveEvents(p),Ae};if(c.preloadOnly){const Ae=this._emulate(Te,c.duration,v);return this._preloadTiles(Ae),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=de,this._pitching=be,this._padding=Se,this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,Me),this._ease(Te(v),Ae=>{v.recenterOnTerrain(),this._afterEase(p,Ae)},c),this}_prepareEase(c,p,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",p||v.moving||this.fire(new s.Event("movestart",c)),this._zooming&&!v.zooming&&this.fire(new s.Event("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new s.Event("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new s.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new s.Event("move",c)),this._zooming&&this.fire(new s.Event("zoom",c)),this._rotating&&this.fire(new s.Event("rotate",c)),this._pitching&&this.fire(new s.Event("pitch",c))}_afterEase(c,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,E=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new s.Event("zoomend",c)),E&&this.fire(new s.Event("rotateend",c)),S&&this.fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c))}flyTo(c,p){if(this._prefersReducedMotion(c)){const st=s.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,p)}this.stop(),c=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},c);const v=this.transform,E=this.getZoom(),S=this.getBearing(),M=this.getPitch(),L=this.getPadding(),N="zoom"in c?s.clamp(+c.zoom,v.minZoom,v.maxZoom):E,U="bearing"in c?this._normalizeBearing(c.bearing,S):S,B="pitch"in c?+c.pitch:M,$="padding"in c?c.padding:v.padding,te=v.zoomScale(N-E),se=s.Point.convert(c.offset);let ue=v.centerPoint.add(se);const le=v.pointLocation(ue),ce=s.LngLat.convert(c.center||le);this._normalizeCenter(ce);const X=v.project(le),oe=v.project(ce).sub(X);let pe=c.curve;const de=Math.max(v.width,v.height),be=de/te,Se=oe.mag();if("minZoom"in c){const st=s.clamp(Math.min(c.minZoom,E,N),v.minZoom,v.maxZoom),pt=de/v.zoomScale(st-E);pe=Math.sqrt(pt/Se*2)}const Te=pe*pe;function Me(st){const pt=(be*be-de*de+(st?-1:1)*Te*Te*Se*Se)/(2*(st?be:de)*Te*Se);return Math.log(Math.sqrt(pt*pt+1)-pt)}function Ae(st){return(Math.exp(st)-Math.exp(-st))/2}function Be(st){return(Math.exp(st)+Math.exp(-st))/2}const ct=Me(0);let Re=function(st){return Be(ct)/Be(ct+pe*st)},rt=function(st){return de*((Be(ct)*(Ae(pt=ct+pe*st)/Be(pt))-Ae(ct))/Te)/Se;var pt},Ve=(Me(1)-ct)/pe;if(Math.abs(Se)<1e-6||!isFinite(Ve)){if(Math.abs(de-be)<1e-6)return this.easeTo(c,p);const st=be<de?-1:1;Ve=Math.abs(Math.log(be/de))/pe,rt=function(){return 0},Re=function(pt){return Math.exp(st*pe*pt)}}c.duration="duration"in c?+c.duration:1e3*Ve/("screenSpeed"in c?+c.screenSpeed/pe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const ut=S!==U,Fe=B!==M,tt=!v.isPaddingEqual($),ft=st=>pt=>{const Ht=pt*Ve,pr=1/Re(Ht);st.zoom=pt===1?N:E+st.scaleZoom(pr),ut&&(st.bearing=s.number(S,U,pt)),Fe&&(st.pitch=s.number(M,B,pt)),tt&&(st.interpolatePadding(L,$,pt),ue=st.centerPoint.add(se));const Gt=pt===1?ce:st.unproject(X.add(oe.mult(rt(Ht))).mult(pr));return st.setLocationAtPoint(st.renderWorldCopies?Gt.wrap():Gt,ue),st._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(p),st};if(c.preloadOnly){const st=this._emulate(ft,c.duration,v);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=ut,this._pitching=Fe,this._padding=tt,this._prepareEase(p,!1),this._ease(ft(v),()=>this._afterEase(p),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,p)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,p,v){v.animate===!1||v.duration===0?(c(1),p()):(this._easeStart=s.exported.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,p){c=s.wrap(c,-180,180);const v=Math.abs(c-p);return Math.abs(c-360-p)<v&&(c-=360),Math.abs(c+360-p)<v&&(c+=360),c}_normalizeCenter(c){const p=this.transform;if(!p.renderWorldCopies||p.maxBounds)return;const v=c.lng-p.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,p,v){const E=Math.ceil(15*p/1e3),S=[],M=c(v.clone());for(let L=0;L<=E;L++){const N=M(L/E);S.push(N.clone())}return S}}class Bt{constructor(c={}){this.options=c,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const p=this.options&&this.options.compact;return this._map=c,this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=I("button","mapboxgl-ctrl-attrib-button",this._container),I("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,p){const v=this._map._getUIString(`AttributionControl.${p}`);c.setAttribute("aria-label",v),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(c){const v=p.reduce((E,S,M)=>(S.value&&(E+=`${S.key}=${S.value}${M<p.length-1?"&":""}`),E),"?");c.href=`${s.config.FEEDBACK_URL}/${v}#${sf(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const p=this._map.style._sourceCaches;for(const E in p){const S=p[E];if(S.used){const M=S.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((E,S)=>E.length-S.length),c=c.filter((E,S)=>{for(let M=S+1;M<c.length;M++)if(c[M].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cm{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=I("div","mapboxgl-ctrl");const p=I("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const p in c){const v=c[p].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class hm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p}remove(c){const p=this._currentlyRunning,v=p?this._queue.concat(p):this._queue;for(const E of v)if(E.id===c)return void(E.cancelled=!0)}run(c=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const v of p)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function eh(y,c,p){if(y=new s.LngLat(y.lng,y.lat),c){const v=new s.LngLat(y.lng-360,y.lat),E=new s.LngLat(y.lng+360,y.lat),S=360*Math.ceil(Math.abs(y.lng-p.center.lng)/360),M=p.locationPoint(y).distSqr(c),L=c.x<0||c.y<0||c.x>p.width||c.y>p.height;p.locationPoint(v).distSqr(c)<M&&(L||Math.abs(v.lng-p.center.lng)<S)?y=v:p.locationPoint(E).distSqr(c)<M&&(L||Math.abs(E.lng-p.center.lng)<S)&&(y=E)}for(;Math.abs(y.lng-p.center.lng)>180;){const v=p.locationPoint(y);if(v.x>=0&&v.y>=0&&v.x<=p.width&&v.y<=p.height)break;y.lng>p.center.lng?y.lng-=360:y.lng+=360}return y}const nc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ot extends s.Evented{constructor(c,p){if(super(),(c instanceof s.window.HTMLElement||p)&&(c=s.extend({element:c},p)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=s.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=I("div");const E=41,S=27,M=A("svg",{display:"block",height:E*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${E}`},this._element),L=A("radialGradient",{id:"shadowGradient"},A("defs",{},M));A("stop",{offset:"10%","stop-opacity":.4},L),A("stop",{offset:"100%","stop-opacity":.05},L),A("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),A("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),A("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),A("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=s.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const v=this._element.classList;for(const E in nc)v.remove(`mapboxgl-marker-anchor-${E}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=s.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const p=c.code,v=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(c){const p=c.originalEvent.target,v=this._element;this._popup&&(p===v||v.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,p=this._pos;if(!c||!p)return!1;const v=c.unproject(p),E=c.getFreeCameraOptions();if(!E.position)return!1;const S=E.position.toLngLat();return S.distanceTo(v)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const p=this._pos;if(!p||p.x<0||p.x>c.transform.width||p.y<0||p.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(p);let E;c._showingGlobe()&&s.isLngLatBehindGlobe(c.transform,this._lngLat)?E=0:(E=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${nc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const c=this._pos,p=this._map,v=this.getPitchAlignment();if(!p||!c||v!=="map")return"";if(!p._showingGlobe()){const N=p.getPitch();return N?`rotateX(${N}deg)`:""}const E=s.radToDeg(s.globeTiltAtLngLat(p.transform,this._lngLat)),S=c.sub(s.globeCenterToScreenPoint(p.transform)),M=Math.abs(S.x)+Math.abs(S.y);if(M===0)return"";const L=E/M;return`rotateX(${-S.y*L}deg) rotateY(${S.x*L}deg)`}_calculateZTransform(){const c=this._pos,p=this._map;if(!p||!c)return"";let v=0;const E=this.getRotationAlignment();if(E==="map")if(p._showingGlobe()){const S=p.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=p.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);v=s.radToDeg(Math.atan2(M.y,M.x))-90}else v=-p.getBearing();else if(E==="horizon"){const S=s.smoothstep(4,6,p.getZoom()),M=s.globeCenterToScreenPoint(p.transform);M.y+=S*p.transform.height;const L=c.sub(M),N=s.radToDeg(Math.atan2(L.y,L.x));v=(N>90?N-270:N+90)*(1-S)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){s.window.cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=eh(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),c===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=s.Point.convert(c),this._update(),this}_onMove(c){const p=this._map;if(!p)return;const v=this._pointerdownPos,E=this._positionDelta;if(v&&E){if(!this._isDragging){const S=this._clickTolerance||p._clickTolerance;if(c.point.dist(v)<S)return;this._isDragging=!0}this._pos=c.point.sub(E),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(c){const p=this._map,v=this._pos;p&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const p=this._map;return p&&(c?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const fm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ox=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function tv(y=new s.Point(0,0),c="bottom"){if(typeof y=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(c){case"top":return new s.Point(0,y);case"top-left":return new s.Point(p,p);case"top-right":return new s.Point(-p,p);case"bottom":return new s.Point(0,-y);case"bottom-left":return new s.Point(p,-p);case"bottom-right":return new s.Point(-p,-p);case"left":return new s.Point(y,0);case"right":return new s.Point(-y,0)}return new s.Point(0,0)}return y instanceof s.Point||Array.isArray(y)?s.Point.convert(y):s.Point.convert(y[c]||[0,0])}class pm{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const p=s.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,p,v){this._start=this.getValue(p),this._end=c,this._startTime=p,this._endTime=p+v}}const rv={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},nv={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},sx={showCompass:!0,showZoom:!0,visualizePitch:!1};class ax{constructor(c,p,v=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new om({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new sm({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),Z()}move(c,p){const v=this.map,E=this.mouseRotate.mousemoveWindow(c,p),S=E&&E.bearingDelta;if(S&&v.setBearing(v.getBearing()+S),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,p),L=M&&M.pitchDelta;L&&v.setPitch(v.getPitch()+L)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){D(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(s.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Y(this.element,c)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Y(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=ie(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const dm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},gm={maxWidth:100,unit:"metric"},mm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},th={version:s.version,supported:m,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Vp{constructor(y){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(y=s.extend({},nv,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(y.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Kc(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new hm,this._domRenderTaskQueue=new hm,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},rv,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new pm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=s.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Wa(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new tm(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new Bt({customAttribution:y.customAttribution})),this._logoControl=new cm,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new s.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new s.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(y,c){if(c===void 0&&(c=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[c];return c.indexOf("bottom")!==-1?v.insertBefore(p,v.firstChild):v.appendChild(p),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(y);return c>-1&&this._controls.splice(c,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new s.Event("movestart",y)).fire(new s.Event("move",y)),this.fire(new s.Event("resize",y)),c&&this.fire(new s.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(s.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?s.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(c=>c==="auto"?s.window.navigator.language:c):y}setLanguage(y){const c=this._parseLanguage(y);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,c=y.projection.name;let p;c==="globe"&&y.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),p=!0):c==="mercator"&&y.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,c){return this._updateProjection(y||c||{name:"mercator"})}_updateProjection(y){let c;if(c=y.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const p in this.style._sourceCaches)this.style._sourceCaches[p].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(s.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(s.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,c,p){if(y==="mouseenter"||y==="mouseover"){let v=!1;const E=M=>{const L=c.filter(U=>this.getLayer(U)),N=L.length?this.queryRenderedFeatures(M.point,{layers:L}):[];N.length?v||(v=!0,p.call(this,new wo(y,this,M.originalEvent,{features:N}))):v=!1},S=()=>{v=!1};return{layers:new Set(c),listener:p,delegates:{mousemove:E,mouseout:S}}}if(y==="mouseleave"||y==="mouseout"){let v=!1;const E=M=>{const L=c.filter(N=>this.getLayer(N));(L.length?this.queryRenderedFeatures(M.point,{layers:L}):[]).length?v=!0:v&&(v=!1,p.call(this,new wo(y,this,M.originalEvent)))},S=M=>{v&&(v=!1,p.call(this,new wo(y,this,M.originalEvent)))};return{layers:new Set(c),listener:p,delegates:{mousemove:E,mouseout:S}}}{const v=E=>{const S=c.filter(L=>this.getLayer(L)),M=S.length?this.queryRenderedFeatures(E.point,{layers:S}):[];M.length&&(E.features=M,p.call(this,E),delete E.features)};return{layers:new Set(c),listener:p,delegates:{[y]:v}}}}on(y,c,p){if(p===void 0)return super.on(y,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(y,c,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const E in v.delegates)this.on(E,v.delegates[E]);return this}once(y,c,p){if(p===void 0)return super.once(y,c);Array.isArray(c)||(c=[c]);const v=this._createDelegatedListener(y,c,p);for(const E in v.delegates)this.once(E,v.delegates[E]);return this}off(y,c,p){if(p===void 0)return super.off(y,c);c=new Set(Array.isArray(c)?c:[c]);const v=(S,M)=>{if(S.size!==M.size)return!1;for(const L of S)if(!M.has(L))return!1;return!0},E=this._delegatedListeners?this._delegatedListeners[y]:void 0;return E&&(S=>{for(let M=0;M<S.length;M++){const L=S[M];if(L.listener===p&&v(L.layers,c)){for(const N in L.delegates)this.off(N,L.delegates[N]);return S.splice(M,1),this}}})(E),this}queryRenderedFeatures(y,c){return this.style?(c!==void 0||y===void 0||y instanceof s.Point||Array.isArray(y)||(c=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(y,c){return this.style.querySourceFeatures(y,c)}isPointOnSurface(y){const{name:c}=this.transform.projection;return c!=="globe"&&c!=="mercator"&&s.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(y))}setStyle(y,c){return(c=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(y,c))}_getUIString(y){const c=this._locale[y];if(c==null)throw new Error(`Missing UI string '${y}'`);return c}_updateStyle(y,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new Za(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Za(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,c){if(typeof y=="string"){const p=this._requestManager.normalizeStyleURL(y),v=this._requestManager.transformRequest(p,s.ResourceType.Style);s.getJSON(v,(E,S)=>{E?this.fire(new s.ErrorEvent(E)):S&&this._updateDiff(S,c)})}else typeof y=="object"&&this._updateDiff(y,c)}_updateDiff(y,c){try{this.style.setState(y)&&this._update(!0)}catch(p){s.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(y,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(y,c){return this._lazyInitEmptyStyle(),this.style.addSource(y,c),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const c in y){const p=y[c]._tiles;for(const v in p){const E=p[v];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}addSourceType(y,c,p){this._lazyInitEmptyStyle(),this.style.addSourceType(y,c,p)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,c,{pixelRatio:p=1,sdf:v=!1,stretchX:E,stretchY:S,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&c instanceof s.window.ImageBitmap){const{width:L,height:N,data:U}=s.exported.getImageData(c);this.style.addImage(y,{data:new s.RGBAImage({width:L,height:N},U),pixelRatio:p,stretchX:E,stretchY:S,content:M,sdf:v,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:N}=c,U=c;this.style.addImage(y,{data:new s.RGBAImage({width:L,height:N},new Uint8Array(U.data)),pixelRatio:p,stretchX:E,stretchY:S,content:M,sdf:v,version:0,userImage:U}),U.onAdd&&U.onAdd(this,y)}}updateImage(y,c){const p=this.style.getImage(y);if(!p)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&c instanceof s.window.ImageBitmap?s.exported.getImageData(c):c,{width:E,height:S}=v;E!==void 0&&S!==void 0?E===p.data.width&&S===p.data.height?(p.data.replace(v.data,!(c instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&c instanceof s.window.ImageBitmap)),this.style.updateImage(y,p)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${E}, ${S})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,c){s.getImage(this._requestManager.transformRequest(y,s.ResourceType.Image),(p,v)=>{c(p,v instanceof s.window.HTMLImageElement?s.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(y,c){return this._lazyInitEmptyStyle(),this.style.addLayer(y,c),this._update(!0)}moveLayer(y,c){return this.style.moveLayer(y,c),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,c,p){return this.style.setLayerZoomRange(y,c,p),this._update(!0)}setFilter(y,c,p={}){return this.style.setFilter(y,c,p),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,c,p,v={}){return this.style.setPaintProperty(y,c,p,v),this._update(!0)}getPaintProperty(y,c){return this.style.getPaintProperty(y,c)}setLayoutProperty(y,c,p,v={}){return this.style.setLayoutProperty(y,c,p,v),this._update(!0)}getLayoutProperty(y,c){return this.style.getLayoutProperty(y,c)}setLight(y,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(y),this.transform):0}setFeatureState(y,c){return this.style.setFeatureState(y,c),this._update()}removeFeatureState(y,c){return this.style.removeFeatureState(y,c),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let p,v,E,S=this._container;for(;S&&(!v||!E);){const M=s.window.getComputedStyle(S).transform;M&&M!=="none"&&(p=M.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(v=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(E=p[3])),S=S.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=E?Math.abs(c/E):c}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=I("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=I("div","mapboxgl-canvas-container",y);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=I("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=I("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=I("div",`mapboxgl-ctrl-${E}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,c){const p=s.exported.devicePixelRatio||1;this._canvas.width=p*Math.ceil(y),this._canvas.height=p*Math.ceil(c),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${c}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const c=this._markers.indexOf(y);c!==-1&&this._markers.splice(c,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const c=this._popups.indexOf(y);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const y=s.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",y),p=c||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);p?(this._useWebGL2&&!c&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(p,!0),this.painter=new Wc(p,this.transform,!!c),this.on("data",v=>{v.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(p)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let c;const p=this.painter.context.extTimerQuery,v=s.exported.now();if(this.listens("gpu-timing-frame")&&(c=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,N=this.transform.pitch,U=s.exported.now(),B=new s.EvaluationParameters(L,{now:U,fadeDuration:E,pitch:N,transition:this.style.getTransition()});this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(v),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const L=s.exported.now()-v;p.endQueryEXT(p.TIME_ELAPSED_EXT,c),setTimeout(()=>{const N=p.getQueryObjectEXT(c,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(c),this.fire(new s.Event("gpu-timing-frame",{cpuTime:L,gpuTime:N})),s.window.performance.mark("frame-gpu",{startTime:v,detail:{gpuTime:N}})},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(L);this.fire(new s.Event("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:N}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(M||this._repaint)this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(S=this._updateAverageElevation(v,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const c of this._markers)y&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!y||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(y,c=!1){const p=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);if((c||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const v=this.transform.averageElevation;let E=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=y;const M=Math.abs(v-E);if(M>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(E),p(E);this._averageElevation.easeTo(E,y,300)}else if(M>1e-4)return this._averageElevation.jumpTo(E),p(E)}return!!this._averageElevation.isEasing(y)&&p(this._averageElevation.getValue(y))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===s.AUTH_ERR_MSG||y.status===401)){const c=this.painter.context.gl;s.storeAuthState(c,!1),this._logoControl instanceof cm&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const p=this.painter.context.gl,v=p.createFramebuffer();function E(S){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,S,0);const M=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,M),M}return p.bindFramebuffer(p.FRAMEBUFFER,v),this._canvasPixelComparison(E(y),c.canvasCopies.map(E),c.timeStamps)}_canvasPixelComparison(y,c,p){let v=p[1]-p[0];const E=y.length/4;for(let S=0;S<c.length;S++){const M=c[S];let L=0;for(let N=0;N<M.length;N+=4)M[N]===y[N]&&M[N+1]===y[N+1]&&M[N+2]===y[N+2]&&M[N+3]===y[N+3]&&(L+=1);v+=(p[S+2]-p[S+1])*(1-L/E)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=s.exported.frame(c=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(c)}))}_preloadTiles(y){const c=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(c,(p,v)=>p._preloadTiles(y,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,c){s.setCacheLimits(y,c)}get version(){return s.version}},NavigationControl:class{constructor(y){this.options=s.extend({},sx,y),this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),I("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),I("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:c}):p.resetNorth({},{originalEvent:c}))}),this._compassIcon=I("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const c=y.getZoom(),p=c===y.getMaxZoom(),v=c===y.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ax(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,c){const p=I("button",y,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(y,c){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${c}`);y.setAttribute("aria-label",p),y.firstElementChild&&y.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends s.Evented{constructor(y){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},dm,y),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const c=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,y(p)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(p=>c(p.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(y){const c=this._map.getMaxBounds(),p=y.coords;return!!c&&(p.longitude<c.getWest()||p.longitude>c.getEast()||p.latitude<c.getSouth()||p.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",y)),this._finish()}}_updateCamera(y){const c=new s.LngLat(y.coords.longitude,y.coords.latitude),p=y.coords.accuracy,v=this._map.getBearing(),E=s.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(p),E,{geolocateSource:!0})}_updateMarker(y){if(y){const c=new s.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,c=s.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,p=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=I("button","mapboxgl-ctrl-geolocate",this._container),I("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I("div","mapboxgl-user-location"),this._dotElement.appendChild(I("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(I("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ot({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=I("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ot({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bt,ScaleControl:class{constructor(y){this.options=s.extend({},gm,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,c=this._map,p=c._containerHeight/2,v=c._containerWidth/2-y/2,E=c.unproject([v,p]),S=c.unproject([v+y,p]),M=E.distanceTo(S);if(this.options.unit==="imperial"){const L=3.2808*M;L>5280?this._setScale(y,L/5280,"mile"):this._setScale(y,L,"foot")}else this.options.unit==="nautical"?this._setScale(y,M/1852,"nautical-mile"):M>=1e3?this._setScale(y,M/1e3,"kilometer"):this._setScale(y,M,"meter")}_setScale(y,c,p){this._map._requestDomTask(()=>{const v=function(S){const M=Math.pow(10,`${Math.floor(S)}`.length-1);let L=S/M;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(N){const U=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*U)/U}(L),M*L}(c),E=v/c;this._container.innerHTML=this._isNumberFormatSupported&&p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(v):`${v}&nbsp;${mm[p]}`,this._container.style.width=y*E+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof s.window.HTMLElement?this._container=y.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=I("button","mapboxgl-ctrl-fullscreen",this._controlContainer);I("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(y){super(),this.options=s.extend(Object.create(fm),y),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=s.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(s.window.document.createTextNode(y))}setHTML(y){const c=s.window.document.createDocumentFragment(),p=s.window.document.createElement("body");let v;for(p.innerHTML=y;v=p.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=I("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(y),this.options.closeButton){const p=this._closeButton=I("button","mapboxgl-popup-close-button",c);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let c;return this._classList.delete(y)?c=!1:(this._classList.add(y),c=!0),this._updateClassList(),c}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const c=this._map,p=this._container,v=this._pos;if(!c||!p||!v)return"bottom";const E=p.offsetWidth,S=p.offsetHeight,M=v.x<E/2,L=v.x>c.transform.width-E/2;if(v.y+y<S)return M?"top-left":L?"top-right":"top";if(v.y>c.transform.height-S){if(M)return"bottom-left";if(L)return"bottom-right"}return M?"left":L?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),y.className=c.join(" ")}_update(y){const c=this._map,p=this._content;if(!c||!this._lngLat&&!this._trackPointer||!p)return;let v=this._container;if(v||(v=this._container=I("div","mapboxgl-popup",c.getContainer()),this._tip=I("div","mapboxgl-popup-tip",v),v.appendChild(p)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=eh(this._lngLat,this._pos,c.transform)),!this._trackPointer||y){const E=this._pos=this._trackPointer&&y?y:c.project(this._lngLat),S=tv(this.options.offset),M=this._anchor=this._getAnchor(S.y),L=tv(this.options.offset,M),N=E.add(L).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${nc[M]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&c._showingGlobe()){const E=s.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(ox);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Ot,Style:Za,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:U_,Evented:s.Evented,config:s.config,prewarm:function(){Fc().acquire(ja)},clearPrewarmedResources:function(){const y=hs;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(ja),hs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(y){s.config.ACCESS_TOKEN=y},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(y){s.config.API_URL=y},get workerCount(){return vo.workerCount},set workerCount(y){vo.workerCount=y},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){s.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){s.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return th});var h=i;return h})})(lM);var H5=lM.exports;const Sw=wa(H5);function Jo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var _h={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity,sky-type,sky-atmosphere-sun,sky-atmosphere-sun-intensity,sky-gradient-center,sky-gradient-radius,sky-gradient,sky-atmosphere-halo-color,sky-atmosphere-color,sky-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")};const Iw=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),vE=t=>t.replace(/(^|-)([a-z])/g,(e,r,n)=>`${n.toUpperCase()}`);function K5(t){return _h.paints.indexOf(t)>=0}function Y5(t){return _h.layouts.indexOf(t)>=0}function J5(t){return _h.paints.indexOf(t)>=0?"paint":_h.layouts.indexOf(t)>=0?"layout":"other"}function Q5(t){return String(t).match(/\.(geo)?json/)||t.type==="Feature"||t.type==="FeatureCollection"?{type:"geojson",data:t}:String(t).match(/^mapbox:\/\//)?{type:"vector",url:t}:t}const S0=(t,e)=>Array.isArray(t)?t:t instanceof RegExp?e.getStyle().layers.map(r=>r.id).filter(r=>r.match(t)):t instanceof Function?e.getStyle().layers.filter(r=>t(r)).map(r=>r.id):[t],la=t=>function(e,...r){return S0(e,this.map).forEach(i=>t.call(this,i,...r))},ey=t=>function(e,...r){const i=S0(e,this.map).map(a=>t.call(this,a,...r));return()=>i.forEach(a=>a())},cM=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class kf{constructor(){Jo(this,"_loaded",!1),Jo(this,"_mapgl",null),Jo(this,"map",null),Jo(this,"hoverFeatureState",ey(function(e,r,n,i,a){if(Array.isArray(r)){let w=r.map(([b,I])=>this.hoverFeatureState(e,b,I));return()=>w.forEach(b=>b())}if(r===void 0){const w=this.getLayerStyle(e);r=w.source,n=w["source-layer"]}let h;const s=w=>{h&&this.map.setFeatureState({source:r,sourceLayer:n,id:h},{hover:w})},g=w=>{const b=w.features[0];b&&b.id===h||(s(!1),b&&(h&&a&&a({...w,oldFeatureId:h}),h=b.id,s(!0),i&&i(w)))},m=w=>{s(!1),w&&w.oldFeatureId&&(w.oldFeatureId=h),h=void 0,a&&a(w)};return this.map.on("mousemove",e,g),this.map.on("mouseleave",e,m),()=>{this.map.off("mousemove",e,g),this.map.off("mouseleave",e,m),m()}})),Jo(this,"clickLayer",ey(function(e,r){const n=i=>{i.features=this.map.queryRenderedFeatures(i.point,{layers:[e]}),r(i)};return this.map.on("click",e,n),()=>this.map.off("click",e,n)})),Jo(this,"hoverLayer",ey(function(e,r){const n=i=>{i.features=this.map.queryRenderedFeatures(i.point,{layers:[e]}),r(i)};return this.map.on("click",e,n),()=>this.map.off("click",e,n)})),Jo(this,"removeLayer",la(function(e){const r=n=>{n.error.message.match(/does not exist/)||console.error(n.error)};this.map.once("error",r),this.map.removeLayer(e),this.map.off("error",r)})),Jo(this,"setProperty",la(function(e,r,n){if(typeof r=="object")Object.keys(r).forEach(i=>this.setProperty(e,i,r[i]));else{const i=Iw(r);K5(i)?this.map.setPaintProperty(e,i,n):Y5(i)&&this.map.setLayoutProperty(e,i,n)}})),Jo(this,"setLayerStyle",la(function(e,r){const n=(h={},s={})=>Object.keys(h).forEach(g=>{g in s||this.setProperty(e,g,void 0)});typeof e=="object"&&!Array.isArray(e)&&e.id&&!r&&(r=e,e=r.id);const i=this.getLayerStyle(e),a=this.properties(r);n(i.paint,a.paint),n(i.layout,a.layout),this.setProperty(e,{...a.paint,...a.layout})})),Jo(this,"show",la(function(e){this.setVisibility(e,"visible")})),Jo(this,"hide",la(function(e){this.setVisibility(e,"none")})),Jo(this,"toggle",la(function(e,r){this.setVisibility(e,r?"visible":"none")})),Jo(this,"showSource",la(function(e){this.setVisibility(this.layersBySource(e),"visible")})),Jo(this,"hideSource",la(function(e){this.setVisibility(this.layersBySource(e),"none")})),Jo(this,"toggleSource",la(function(e,r){this.setVisibility(this.layersBySource(e),r?"visible":"none")})),Jo(this,"setFilter",la(function(e,r){this.map.setFilter(e,r)})),Jo(this,"removeSource",la(function(e){const r=this.layersBySource(e);this.removeLayer(r),this.map.getSource(e)&&this.map.removeSource(e)})),Jo(this,"setLayerSource",la(function(e,r,n){const i=this.map.getStyle().layers,a=i.findIndex(g=>g.id===e),h=i[a],s=i[a+1]&&i[a+1].id;h.source=r,n?h["source-layer"]=n:n!==void 0&&delete h["source-layer"],this.map.removeLayer(e),this._mapAddLayerBefore(h,s)}))}static init(e,r){return e.U=new kf,e.U._mapgl=r,e.U.map=e,e.U}static async newMap(e,r={},n={}){function i(m,w=[]){m.layers=[...m.layers,...w.map(b=>this.layerStyle(b))]}function a(m,w={}){m.sources={...m.sources,...w}}function h(m,w=b=>b){m=w(m)}function s(m,w={}){Object.keys(w).forEach(b=>{const I=w[b].layers;delete w[b].layers,m.sources[b]=w[b],m.layers=[...m.layers,...I.map(A=>this.layerStyle({source:b,...A}))]})}if(r.style||(r.style={version:8,layers:[],sources:{}}),n.addLayers||n.addSources||n.transformStyle||n.mixStyles){let m=r.style,w;if(typeof m=="string"){const I=m.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/");w=await(await fetch(I)).json()}else w=m;const b=new kf;i.call(b,w,n.addLayers),a(w,n.addSources),h(w,n.transformStyle),s.call(b,w,n.mixStyles),r.style=w}const g=new e.Map(r);return kf.init(g,e),g}hoverPointer(e){const r=S0(e,this.map),n=h=>this.map.getCanvas().style.cursor="pointer",i=h=>{this.map.queryRenderedFeatures(h.point,{layers:r}).length===0&&(this.map.getCanvas().style.cursor=a)},a=this.map.getCanvas().style.cursor;for(const h of r)this.map.on("mouseleave",h,i),this.map.on("mouseenter",h,n);return()=>{for(const h of r)this.map.off("mouseenter",h,n),this.map.off("mouseleave",h,i);this.map.getCanvas().style.cursor=a}}hoverPopup(e,r,n={}){if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";const i=new this._mapgl.Popup({closeButton:!1,...n});return ey(function(a,h){const s=m=>{m.features[0]&&(i.setLngLat(m.lngLat),i.setHTML(h(m.features[0],i)),i.addTo(this.map))},g=m=>{i.remove()};return this.map.on("mouseenter",a,s),this.map.on("mouseout",a,g),()=>{this.map.off("mouseenter",a,s),this.map.off("mouseout",a,g),g()}}).call(this,e,r)}clickPopup(e,r,n={}){if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";const i=new this._mapgl.Popup({...n});return ey(function(a,h){const s=g=>{g.features[0]&&(i.setLngLat(g.features[0].geometry.coordinates.slice()),i.setHTML(h(g.features[0],i)),i.addTo(this.map))};return this.map.on("click",a,s),()=>this.map.off("click",a,s)}).call(this,e,r)}clickOneLayer(e,r,n){const i=S0(e,this.map),a=h=>{let s=!1;for(const g of i){const m=this.map.queryRenderedFeatures(h.point,{layers:[g]});if(m[0])try{r({event:h,layer:g,feature:m[0],features:m})}finally{s=!0;break}}!s&&n&&n(h)};return this.map.on("click",a),()=>this.map.off("click",a)}_mapAddLayerBefore(e,r){r?this.map.addLayer(e,r):this.map.addLayer(e)}addLayer(e,r,n,i,a){return this._mapAddLayerBefore(this.layerStyle(e,r,n,i),a),this._makeSource(r)}add(e,r,n,i,a){if(this._mapAddLayerBefore({...this.properties(i),id:e,type:n,source:Q5(r)},a),typeof r=="string")return this._makeSource(r)}setLayer(e,r,n,i,a){const h=this.layerStyle(e,r,n,i),s=this.map.getStyle(),g=s.layers.findIndex(m=>m.id===h.id);if(s.layers.findIndex(m=>m.id===a),g>=0){this.map.removeLayer(h.id);let m=a;!a&&s.layers[g+1]&&(m=s.layers[g+1].id),this.map.addLayer(h,m)}else this.map.addLayer(h,a||void 0);return this._makeSource(r)}addLineLayer(e,r,n){}addFillLayer(e,r,n){}addCircleLayer(e,r,n){}addSymbolLayer(e,r,n){}addVideoLayer(e,r,n){}addRasterLayer(e,r,n){}addFillExtrusionLayer(e,r,n){}addHeatmapLayer(e,r,n){}addHillshadeLayer(e,r,n){}addGeoJSONSource(e,r={type:"FeatureCollection",features:[]},n){return this.addSource(e,{type:"geojson",data:r,...n})}addGeoJSON(e,r={type:"FeatureCollection",features:[]},n){return this.addGeoJSONSource(e,r,n)}addSource(e,r){const n=this.map.getStyle();return n.sources[e]=r,this.map.setStyle(n),this._makeSource(e)}layersBySource(e){return this.map.getStyle().layers.filter(r=>r.source===e).map(r=>r.id)}addVectorSource(e,r,n={}){return typeof r=="string"?r.match(/\{z\}/)?this.addSource(e,{...n,type:"vector",tiles:[r]}):this.addSource(e,{...n,type:"vector",url:r}):this.addSource(e,{...r,type:"vector"})}addVector(e,r,n={}){return this.addVectorSource(e,r,n)}addRasterSource(e,r){return this.addSource(e,{...r,type:"raster"})}addRasterDemSource(e,r){return this.addSource(e,{...r,type:"raster-dem"})}addRasterSource(e,r){return this.addSource(e,{...r,type:"raster"})}addImageSource(e,r){return this.addSource(e,{...r,type:"image"})}addVideoSource(e,r){return this.addSource(e,{...r,type:"video"})}properties(e){if(!e)return;const r={},n={paint:{},layout:{},other:{}};return Object.keys(e).forEach(i=>{const a=Iw(i);n[J5(a)][a]=e[i]}),Object.keys(n.paint).length&&(r.paint=n.paint),Object.keys(n.layout).length&&(r.layout=n.layout),Object.assign(r,n.other),r}layerStyle(...e){const[r,n,i]=e,a=e.find(s=>typeof s=="object"&&!Array.isArray(s)),h=typeof a=="object"?this.properties(a)||{}:{};return typeof r=="string"&&(h.id=r),typeof n=="string"&&(h.source=n),typeof i=="string"&&(h.type=i),h}getLayerStyle(e){return this.map.getStyle().layers.find(r=>r.id===e)}setData(e,r={type:"FeatureCollection",features:[]}){this.map.getSource(e).setData(r)}onLoad(e){if(e)this.map.loaded()||this._loaded?e():this.map.once("load",()=>{this._loaded=!0,e()});else return new Promise(r=>this.onLoad(r))}setRootProperty(e,r){const n=this.map.getStyle();n[Iw(e)]=r,this.map.setStyle(n)}setTransition(e){this.setRootProperty("transition",e)}loadImage(e,r,n){return typeof r=="string"?new Promise((i,a)=>{this.map.loadImage(r,(h,s)=>{h?(console.error(`Error loading image ${r}`,h),a(`Error loading image ${r}`)):(this.map.addImage(e,s,n),i(e))})}):this.map.addImage(e,r,n)}lockOrientation(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()}fontsInUse(){function e(i){Array.isArray(i)&&(i[0]==="literal"?r.push(...i[1]):i.forEach(e))}let r=[];const n=this.map.getStyle().layers.map(i=>i.layout&&i.layout["text-font"]).filter(Boolean);for(const i of n)if(i.stops)try{r.push(...i.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",i)}else i.every(a=>typeof a=="string")?r.push(...i):e(i);return[...new Set(r)]}_makeSource(e){const r=new kf;return r.map=this.map,r._mapgl=this._mapgl,cM.forEach(function(n){hM(n,r,e)}),r}}const hM=(t,e,r)=>{let n;r?n=function(a,h,s){return this.setLayer(a,r,t,h,s)}:n=function(a,h,s,g){return this.setLayer(a,h,t,s,g)};const i=vE(t);e[`add${i}`]=n,e[`add${i}Layer`]=n};function ek(t){const e=(n,i)=>{const a="set"+vE(n);t[a]=la(function(h,s){return this.map[i](h,n,s)})},r=(n,i)=>{const a="get"+vE(n);t[a]=la(function(h){return this.map[i](h,n)})};t.update=t.setData,_h.paints.forEach(n=>e(n,"setPaintProperty")),_h.layouts.forEach(n=>e(n,"setLayoutProperty")),_h.paints.forEach(n=>r(n,"getPaintProperty")),_h.layouts.forEach(n=>r(n,"getLayoutProperty")),cM.forEach(n=>hM(n,t))}const tk=kf.prototype;ek(tk);var Io=63710088e-1,a1={centimeters:Io*100,centimetres:Io*100,degrees:Io/111325,feet:Io*3.28084,inches:Io*39.37,kilometers:Io/1e3,kilometres:Io/1e3,meters:Io,metres:Io,miles:Io/1609.344,millimeters:Io*1e3,millimetres:Io*1e3,nauticalmiles:Io/1852,radians:1,yards:Io*1.0936},fM={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Io,yards:1.0936133},I0={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function fo(t,e,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function pM(t,e,r){switch(t){case"Point":return Gr(e).geometry;case"LineString":return Bn(e).geometry;case"Polygon":return qr(e).geometry;case"MultiPoint":return t_(e).geometry;case"MultiLineString":return Fh(e).geometry;case"MultiPolygon":return ga(e).geometry;default:throw new Error(t+" is invalid")}}function Gr(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Lo(t[0])||!Lo(t[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:t};return fo(n,e,r)}function dM(t,e,r){return r===void 0&&(r={}),hr(t.map(function(n){return Gr(n,e)}),r)}function qr(t,e,r){r===void 0&&(r={});for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return fo(s,e,r)}function gM(t,e,r){return r===void 0&&(r={}),hr(t.map(function(n){return qr(n,e)}),r)}function Bn(t,e,r){if(r===void 0&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:t};return fo(n,e,r)}function mM(t,e,r){return r===void 0&&(r={}),hr(t.map(function(n){return Bn(n,e)}),r)}function hr(t,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function Fh(t,e,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:t};return fo(n,e,r)}function t_(t,e,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:t};return fo(n,e,r)}function ga(t,e,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:t};return fo(n,e,r)}function wb(t,e,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:t};return fo(n,e,r)}function yM(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r}function zd(t,e){e===void 0&&(e="kilometers");var r=a1[e];if(!r)throw new Error(e+" units is invalid");return t*r}function Vf(t,e){e===void 0&&(e="kilometers");var r=a1[e];if(!r)throw new Error(e+" units is invalid");return t/r}function P0(t,e){return Sh(Vf(t,e))}function jf(t){var e=t%360;return e<0&&(e+=360),e}function Sh(t){var e=t%(2*Math.PI);return e*180/Math.PI}function Ao(t){var e=t%360;return e*Math.PI/180}function qf(t,e,r){if(e===void 0&&(e="kilometers"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return zd(Vf(t,e),r)}function _M(t,e,r){if(e===void 0&&(e="meters"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var n=I0[e];if(!n)throw new Error("invalid original units");var i=I0[r];if(!i)throw new Error("invalid final units");return t/n*i}function Lo(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Vn(t){return!!t&&t.constructor===Object}function vM(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Lo(e))throw new Error("bbox must only contain numbers")})}function xM(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const wM=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:I0,bearingToAzimuth:jf,convertArea:_M,convertLength:qf,degreesToRadians:Ao,earthRadius:Io,factors:a1,feature:fo,featureCollection:hr,geometry:pM,geometryCollection:wb,isNumber:Lo,isObject:Vn,lengthToDegrees:P0,lengthToRadians:Vf,lineString:Bn,lineStrings:mM,multiLineString:Fh,multiPoint:t_,multiPolygon:ga,point:Gr,points:dM,polygon:qr,polygons:gM,radiansToDegrees:Sh,radiansToLength:zd,round:yM,unitsFactors:fM,validateBBox:vM,validateId:xM},Symbol.toStringTag,{value:"Module"}));function ji(t,e,r){if(t!==null)for(var n,i,a,h,s,g,m,w=0,b=0,I,A=t.type,z=A==="FeatureCollection",V=A==="Feature",H=z?t.features.length:1,Z=0;Z<H;Z++){m=z?t.features[Z].geometry:V?t.geometry:t,I=m?m.type==="GeometryCollection":!1,s=I?m.geometries.length:1;for(var D=0;D<s;D++){var k=0,j=0;if(h=I?m.geometries[D]:m,h!==null){g=h.coordinates;var Y=h.type;switch(w=r&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(e(g,b,Z,k,j)===!1)return!1;b++,k++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(e(g[n],b,Z,k,j)===!1)return!1;b++,Y==="MultiPoint"&&k++}Y==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(i=0;i<g[n].length-w;i++){if(e(g[n][i],b,Z,k,j)===!1)return!1;b++}Y==="MultiLineString"&&k++,Y==="Polygon"&&j++}Y==="Polygon"&&k++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(j=0,i=0;i<g[n].length;i++){for(a=0;a<g[n][i].length-w;a++){if(e(g[n][i][a],b,Z,k,j)===!1)return!1;b++}j++}k++}break;case"GeometryCollection":for(n=0;n<h.geometries.length;n++)if(ji(h.geometries[n],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Eb(t,e,r,n){var i=r;return ji(t,function(a,h,s,g,m){h===0&&r===void 0?i=a:i=e(i,a,h,s,g,m)},n),i}function bb(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&e(t.features[r].properties,r)!==!1;r++);break;case"Feature":e(t.properties,0);break}}function EM(t,e,r){var n=r;return bb(t,function(i,a){a===0&&r===void 0?n=i:n=e(n,i,a)}),n}function kn(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var r=0;r<t.features.length&&e(t.features[r],r)!==!1;r++);}function Tb(t,e,r){var n=r;return kn(t,function(i,a){a===0&&r===void 0?n=i:n=e(n,i,a)}),n}function Bd(t){var e=[];return ji(t,function(r){e.push(r)}),e}function ma(t,e){var r,n,i,a,h,s,g,m,w,b,I=0,A=t.type==="FeatureCollection",z=t.type==="Feature",V=A?t.features.length:1;for(r=0;r<V;r++){for(s=A?t.features[r].geometry:z?t.geometry:t,m=A?t.features[r].properties:z?t.properties:{},w=A?t.features[r].bbox:z?t.bbox:void 0,b=A?t.features[r].id:z?t.id:void 0,g=s?s.type==="GeometryCollection":!1,h=g?s.geometries.length:1,i=0;i<h;i++){if(a=g?s.geometries[i]:s,a===null){if(e(null,I,m,w,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,I,m,w,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(e(a.geometries[n],I,m,w,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function Sb(t,e,r){var n=r;return ma(t,function(i,a,h,s,g){a===0&&r===void 0?n=i:n=e(n,i,a,h,s,g)}),n}function jo(t,e){ma(t,function(r,n,i,a,h){var s=r===null?null:r.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(fo(r,i,{bbox:a,id:h}),n,0)===!1?!1:void 0}var g;switch(s){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var m=0;m<r.coordinates.length;m++){var w=r.coordinates[m],b={type:g,coordinates:w};if(e(fo(b,i),n,m)===!1)return!1}})}function bM(t,e,r){var n=r;return jo(t,function(i,a,h){a===0&&h===0&&r===void 0?n=i:n=e(n,i,a,h)}),n}function gc(t,e){jo(t,function(r,n,i){var a=0;if(r.geometry){var h=r.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var s,g=0,m=0,w=0;if(ji(r,function(b,I,A,z,V){if(s===void 0||n>g||z>m||V>w){s=b,g=n,m=z,w=V,a=0;return}var H=Bn([s,b],r.properties);if(e(H,n,i,V,a)===!1)return!1;a++,s=b})===!1)return!1}}})}function Ib(t,e,r){var n=r,i=!1;return gc(t,function(a,h,s,g,m){i===!1&&r===void 0?n=a:n=e(n,a,h,s,g,m),i=!0}),n}function Pb(t,e){if(!t)throw new Error("geojson is required");jo(t,function(r,n,i){if(r.geometry!==null){var a=r.geometry.type,h=r.geometry.coordinates;switch(a){case"LineString":if(e(r,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<h.length;s++)if(e(Bn(h[s],r.properties),n,i,s)===!1)return!1;break}}})}function Cb(t,e,r){var n=r;return Pb(t,function(i,a,h,s){a===0&&r===void 0?n=i:n=e(n,i,a,h,s)}),n}function TM(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,h=e.properties,s;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),h=h||t.features[r].properties,s=t.features[r].geometry;break;case"Feature":h=h||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var g=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=g.length+a-1),Bn([g[a],g[a+1]],h,e);case"Polygon":return i<0&&(i=g.length+i),a<0&&(a=g[i].length+a-1),Bn([g[i][a],g[i][a+1]],h,e);case"MultiLineString":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a-1),Bn([g[n][a],g[n][a+1]],h,e);case"MultiPolygon":return n<0&&(n=g.length+n),i<0&&(i=g[n].length+i),a<0&&(a=g[n][i].length-a-1),Bn([g[n][i][a],g[n][i][a+1]],h,e)}throw new Error("geojson is invalid")}function SM(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,h=e.properties,s;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),h=h||t.features[r].properties,s=t.features[r].geometry;break;case"Feature":h=h||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var g=s.coordinates;switch(s.type){case"Point":return Gr(g,h,e);case"MultiPoint":return n<0&&(n=g.length+n),Gr(g[n],h,e);case"LineString":return a<0&&(a=g.length+a),Gr(g[a],h,e);case"Polygon":return i<0&&(i=g.length+i),a<0&&(a=g[i].length+a),Gr(g[i][a],h,e);case"MultiLineString":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),Gr(g[n][a],h,e);case"MultiPolygon":return n<0&&(n=g.length+n),i<0&&(i=g[n].length+i),a<0&&(a=g[n][i].length-a),Gr(g[n][i][a],h,e)}throw new Error("geojson is invalid")}const IM=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Bd,coordEach:ji,coordReduce:Eb,featureEach:kn,featureReduce:Tb,findPoint:SM,findSegment:TM,flattenEach:jo,flattenReduce:bM,geomEach:ma,geomReduce:Sb,lineEach:Pb,lineReduce:Cb,propEach:bb,propReduce:EM,segmentEach:gc,segmentReduce:Ib},Symbol.toStringTag,{value:"Module"}));function Fi(t){var e=[1/0,1/0,-1/0,-1/0];return ji(t,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}Fi.default=Fi;const rk=Object.freeze(Object.defineProperty({__proto__:null,default:Fi},Symbol.toStringTag,{value:"Module"}));function oi(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function mr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ab(t){if(t.length>1&&Lo(t[0])&&Lo(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ab(t[0]);throw new Error("coordinates must only contain numbers")}function PM(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}function Cy(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}function Nc(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,i=t.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+a.geometry.type)}}function hi(t){return t.type==="Feature"?t.geometry:t}function Zs(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}const nk=Object.freeze(Object.defineProperty({__proto__:null,collectionOf:Nc,containsNumber:Ab,featureOf:Cy,geojsonType:PM,getCoord:oi,getCoords:mr,getGeom:hi,getType:Zs},Symbol.toStringTag,{value:"Module"}));/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Y2=Object.getOwnPropertySymbols,ik=Object.prototype.hasOwnProperty,ok=Object.prototype.propertyIsEnumerable;function sk(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function ak(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(e).map(function(a){return e[a]});if(n.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(a){i[a]=a}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var lk=ak()?Object.assign:function(t,e){for(var r,n=sk(t),i,a=1;a<arguments.length;a++){r=Object(arguments[a]);for(var h in r)ik.call(r,h)&&(n[h]=r[h]);if(Y2){i=Y2(r);for(var s=0;s<i.length;s++)ok.call(r,i[s])&&(n[i[s]]=r[i[s]])}}return n};const Mb=wa(lk);/**
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 *
 * MarchingSquaresJS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * MarchingSquaresJS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * As additional permission under GNU Affero General Public License version 3
 * section 7, third-party projects (personal or commercial) may distribute,
 * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
 * requirement that said third-party project for that reason alone becomes
 * subject to any requirement of the GNU Affero General Public License version 3.
 * Any modifications to MarchingSquaresJS, however, must be shared with the public
 * and made available.
 *
 * In summary this:
 * - allows you to use MarchingSquaresJS at no cost
 * - allows you to use MarchingSquaresJS for both personal and commercial purposes
 * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
 *   license as long as this license notice is included
 * - enables you to keep the source code of your program that uses MarchingSquaresJS
 *   undisclosed
 * - forces you to share any modifications you have made to MarchingSquaresJS,
 *   e.g. bug-fixes
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
 */var J2={successCallback:null,verbose:!1},Wv={};function uk(t,e,r){r=r||{};for(var n=Object.keys(J2),i=0;i<n.length;i++){var a=n[i],h=r[a];h=typeof h<"u"&&h!==null?h:J2[a],Wv[a]=h}Wv.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var s=fk(ck(t,e));return typeof Wv.successCallback=="function"&&Wv.successCallback(s),s}function Yn(t,e,r){return(t-e)/(r-e)}function ck(t,e){for(var r=t.length-1,n=t[0].length-1,i={rows:r,cols:n,cells:[]},a=0;a<r;++a){i.cells[a]=[];for(var h=0;h<n;++h){var s=0,g=t[a+1][h],m=t[a+1][h+1],w=t[a][h+1],b=t[a][h];if(!(isNaN(g)||isNaN(m)||isNaN(w)||isNaN(b))){s|=g>=e?8:0,s|=m>=e?4:0,s|=w>=e?2:0,s|=b>=e?1:0;var I=!1;if(s===5||s===10){var A=(g+m+w+b)/4;s===5&&A<e?(s=10,I=!0):s===10&&A<e&&(s=5,I=!0)}if(s!==0&&s!==15){var z,V,H,Z;z=V=H=Z=.5,s===1?(H=1-Yn(e,g,b),V=1-Yn(e,w,b)):s===2?(V=Yn(e,b,w),Z=1-Yn(e,m,w)):s===3?(H=1-Yn(e,g,b),Z=1-Yn(e,m,w)):s===4?(z=Yn(e,g,m),Z=Yn(e,w,m)):s===5?(z=Yn(e,g,m),Z=Yn(e,w,m),V=1-Yn(e,w,b),H=1-Yn(e,g,b)):s===6?(V=Yn(e,b,w),z=Yn(e,g,m)):s===7?(H=1-Yn(e,g,b),z=Yn(e,g,m)):s===8?(H=Yn(e,b,g),z=1-Yn(e,m,g)):s===9?(V=1-Yn(e,w,b),z=1-Yn(e,m,g)):s===10?(z=1-Yn(e,m,g),Z=1-Yn(e,m,w),V=Yn(e,b,w),H=Yn(e,b,g)):s===11?(z=1-Yn(e,m,g),Z=1-Yn(e,m,w)):s===12?(H=Yn(e,b,g),Z=Yn(e,w,m)):s===13?(V=1-Yn(e,w,b),Z=Yn(e,w,m)):s===14?(H=Yn(e,b,g),V=Yn(e,b,w)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),i.cells[a][h]={cval:s,flipped:I,top:z,right:Z,bottom:V,left:H}}}}}return i}function hk(t){return t.cval===5||t.cval===10}function CM(t){return t.cval===0||t.cval===15}function Q2(t){!CM(t)&&t.cval!==5&&t.cval!==10&&(t.cval=15)}function Pw(t,e){if(e==="top")return[t.top,1];if(e==="bottom")return[t.bottom,0];if(e==="right")return[1,t.right];if(e==="left")return[0,t.left]}function fk(t){var e=[],r=0,n=1e-7;return t.cells.forEach(function(i,a){i.forEach(function(h,s){if(typeof h<"u"&&!hk(h)&&!CM(h)){var g=pk(t.cells,a,s),m=!1;if(g.info==="mergeable"){for(var w=g.path[g.path.length-1][0],b=g.path[g.path.length-1][1],I=r-1;I>=0;I--)if(Math.abs(e[I][0][0]-w)<=n&&Math.abs(e[I][0][1]-b)<=n){for(var A=g.path.length-2;A>=0;--A)e[I].unshift(g.path[A]);m=!0;break}}m||(e[r++]=g.path)}})}),e}function pk(t,e,r){var n=t.length,i=[],a=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],h=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],s,g,m=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],w=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],A,b=t[e][r],I=b.cval,A=m[I],z=Pw(b,A);i.push([r+z[0],e+z[1]]),A=w[I],z=Pw(b,A),i.push([r+z[0],e+z[1]]),Q2(b);for(var V=r+a[I],H=e+h[I],Z=I;V>=0&&H>=0&&H<n&&(V!=r||H!=e)&&(b=t[H][V],!(typeof b>"u"));){if(I=b.cval,I===0||I===15)return{path:i,info:"mergeable"};A=w[I],s=a[I],g=h[I],(I===5||I===10)&&(I===5?b.flipped?h[Z]===-1?(A="left",s=-1,g=0):(A="right",s=1,g=0):a[Z]===-1&&(A="bottom",s=0,g=-1):I===10&&(b.flipped?a[Z]===-1?(A="top",s=0,g=1):(A="bottom",s=0,g=-1):h[Z]===1&&(A="left",s=-1,g=0))),z=Pw(b,A),i.push([V+z[0],H+z[1]]),Q2(b),V+=s,H+=g,Z=I}return{path:i,info:"closed"}}function dk(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.zProperty||"elevation",n=e.flip,i=e.flags;Nc(t,"Point","input must contain Points");for(var a=gk(t,n),h=[],s=0;s<a.length;s++){for(var g=a[s],m=[],w=0;w<g.length;w++){var b=g[w];b.properties[r]?m.push(b.properties[r]):m.push(0),i===!0&&(b.properties.matrixPosition=[s,w])}h.push(m)}return h}function gk(t,e){var r={};kn(t,function(a){var h=mr(a)[1];r[h]||(r[h]=[]),r[h].push(a)});var n=Object.keys(r).map(function(a){var h=r[a],s=h.sort(function(g,m){return mr(g)[0]-mr(m)[0]});return s}),i=n.sort(function(a,h){return e?mr(a[0])[1]-mr(h[0])[1]:mr(h[0])[1]-mr(a[0])[1]});return i}function mk(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},a=r.breaksProperties||[];if(Nc(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!Vn(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(a))throw new Error("breaksProperties must be an Array");var h=dk(t,{zProperty:n,flip:!0}),s=yk(h,e,n,i,a),g=_k(s,h,t);return hr(g)}function yk(t,e,r,n,i){for(var a=[],h=1;h<e.length;h++){var s=+e[h],g=Mb({},n,i[h]);g[r]=s;var m=Fh(uk(t,s),g);a.push(m)}return a}function _k(t,e,r){var n=Fi(r),i=n[2]-n[0],a=n[3]-n[1],h=n[0],s=n[1],g=e[0].length-1,m=e.length-1,w=i/g,b=a/m,I=function(A){A[0]=A[0]*w+h,A[1]=A[1]*b+s};return t.forEach(function(A){ji(A,I)}),t}var Lb={exports:{}},AM={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(e_,function(){function r(D,k,j,Y,ie){(function ne(ae,W,$e,Oe,ze){for(;Oe>$e;){if(Oe-$e>600){var We=Oe-$e+1,Ze=W-$e+1,Pt=Math.log(We),at=.5*Math.exp(2*Pt/3),St=.5*Math.sqrt(Pt*at*(We-at)/We)*(Ze-We/2<0?-1:1),et=Math.max($e,Math.floor(W-Ze*at/We+St)),zt=Math.min(Oe,Math.floor(W+(We-Ze)*at/We+St));ne(ae,W,et,zt,ze)}var mt=ae[W],bt=$e,It=Oe;for(n(ae,$e,W),ze(ae[Oe],mt)>0&&n(ae,$e,Oe);bt<It;){for(n(ae,bt,It),bt++,It--;ze(ae[bt],mt)<0;)bt++;for(;ze(ae[It],mt)>0;)It--}ze(ae[$e],mt)===0?n(ae,$e,It):n(ae,++It,Oe),It<=W&&($e=It+1),W<=It&&(Oe=It-1)}})(D,k,j||0,Y||D.length-1,ie||i)}function n(D,k,j){var Y=D[k];D[k]=D[j],D[j]=Y}function i(D,k){return D<k?-1:D>k?1:0}var a=function(D){D===void 0&&(D=9),this._maxEntries=Math.max(4,D),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function h(D,k,j){if(!j)return k.indexOf(D);for(var Y=0;Y<k.length;Y++)if(j(D,k[Y]))return Y;return-1}function s(D,k){g(D,0,D.children.length,k,D)}function g(D,k,j,Y,ie){ie||(ie=H(null)),ie.minX=1/0,ie.minY=1/0,ie.maxX=-1/0,ie.maxY=-1/0;for(var ne=k;ne<j;ne++){var ae=D.children[ne];m(ie,D.leaf?Y(ae):ae)}return ie}function m(D,k){return D.minX=Math.min(D.minX,k.minX),D.minY=Math.min(D.minY,k.minY),D.maxX=Math.max(D.maxX,k.maxX),D.maxY=Math.max(D.maxY,k.maxY),D}function w(D,k){return D.minX-k.minX}function b(D,k){return D.minY-k.minY}function I(D){return(D.maxX-D.minX)*(D.maxY-D.minY)}function A(D){return D.maxX-D.minX+(D.maxY-D.minY)}function z(D,k){return D.minX<=k.minX&&D.minY<=k.minY&&k.maxX<=D.maxX&&k.maxY<=D.maxY}function V(D,k){return k.minX<=D.maxX&&k.minY<=D.maxY&&k.maxX>=D.minX&&k.maxY>=D.minY}function H(D){return{children:D,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Z(D,k,j,Y,ie){for(var ne=[k,j];ne.length;)if(!((j=ne.pop())-(k=ne.pop())<=Y)){var ae=k+Math.ceil((j-k)/Y/2)*Y;r(D,ae,k,j,ie),ne.push(k,ae,ae,j)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(D){var k=this.data,j=[];if(!V(D,k))return j;for(var Y=this.toBBox,ie=[];k;){for(var ne=0;ne<k.children.length;ne++){var ae=k.children[ne],W=k.leaf?Y(ae):ae;V(D,W)&&(k.leaf?j.push(ae):z(D,W)?this._all(ae,j):ie.push(ae))}k=ie.pop()}return j},a.prototype.collides=function(D){var k=this.data;if(!V(D,k))return!1;for(var j=[];k;){for(var Y=0;Y<k.children.length;Y++){var ie=k.children[Y],ne=k.leaf?this.toBBox(ie):ie;if(V(D,ne)){if(k.leaf||z(D,ne))return!0;j.push(ie)}}k=j.pop()}return!1},a.prototype.load=function(D){if(!D||!D.length)return this;if(D.length<this._minEntries){for(var k=0;k<D.length;k++)this.insert(D[k]);return this}var j=this._build(D.slice(),0,D.length-1,0);if(this.data.children.length)if(this.data.height===j.height)this._splitRoot(this.data,j);else{if(this.data.height<j.height){var Y=this.data;this.data=j,j=Y}this._insert(j,this.data.height-j.height-1,!0)}else this.data=j;return this},a.prototype.insert=function(D){return D&&this._insert(D,this.data.height-1),this},a.prototype.clear=function(){return this.data=H([]),this},a.prototype.remove=function(D,k){if(!D)return this;for(var j,Y,ie,ne=this.data,ae=this.toBBox(D),W=[],$e=[];ne||W.length;){if(ne||(ne=W.pop(),Y=W[W.length-1],j=$e.pop(),ie=!0),ne.leaf){var Oe=h(D,ne.children,k);if(Oe!==-1)return ne.children.splice(Oe,1),W.push(ne),this._condense(W),this}ie||ne.leaf||!z(ne,ae)?Y?(j++,ne=Y.children[j],ie=!1):ne=null:(W.push(ne),$e.push(j),j=0,Y=ne,ne=ne.children[0])}return this},a.prototype.toBBox=function(D){return D},a.prototype.compareMinX=function(D,k){return D.minX-k.minX},a.prototype.compareMinY=function(D,k){return D.minY-k.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(D){return this.data=D,this},a.prototype._all=function(D,k){for(var j=[];D;)D.leaf?k.push.apply(k,D.children):j.push.apply(j,D.children),D=j.pop();return k},a.prototype._build=function(D,k,j,Y){var ie,ne=j-k+1,ae=this._maxEntries;if(ne<=ae)return s(ie=H(D.slice(k,j+1)),this.toBBox),ie;Y||(Y=Math.ceil(Math.log(ne)/Math.log(ae)),ae=Math.ceil(ne/Math.pow(ae,Y-1))),(ie=H([])).leaf=!1,ie.height=Y;var W=Math.ceil(ne/ae),$e=W*Math.ceil(Math.sqrt(ae));Z(D,k,j,$e,this.compareMinX);for(var Oe=k;Oe<=j;Oe+=$e){var ze=Math.min(Oe+$e-1,j);Z(D,Oe,ze,W,this.compareMinY);for(var We=Oe;We<=ze;We+=W){var Ze=Math.min(We+W-1,ze);ie.children.push(this._build(D,We,Ze,Y-1))}}return s(ie,this.toBBox),ie},a.prototype._chooseSubtree=function(D,k,j,Y){for(;Y.push(k),!k.leaf&&Y.length-1!==j;){for(var ie=1/0,ne=1/0,ae=void 0,W=0;W<k.children.length;W++){var $e=k.children[W],Oe=I($e),ze=(We=D,Ze=$e,(Math.max(Ze.maxX,We.maxX)-Math.min(Ze.minX,We.minX))*(Math.max(Ze.maxY,We.maxY)-Math.min(Ze.minY,We.minY))-Oe);ze<ne?(ne=ze,ie=Oe<ie?Oe:ie,ae=$e):ze===ne&&Oe<ie&&(ie=Oe,ae=$e)}k=ae||k.children[0]}var We,Ze;return k},a.prototype._insert=function(D,k,j){var Y=j?D:this.toBBox(D),ie=[],ne=this._chooseSubtree(Y,this.data,k,ie);for(ne.children.push(D),m(ne,Y);k>=0&&ie[k].children.length>this._maxEntries;)this._split(ie,k),k--;this._adjustParentBBoxes(Y,ie,k)},a.prototype._split=function(D,k){var j=D[k],Y=j.children.length,ie=this._minEntries;this._chooseSplitAxis(j,ie,Y);var ne=this._chooseSplitIndex(j,ie,Y),ae=H(j.children.splice(ne,j.children.length-ne));ae.height=j.height,ae.leaf=j.leaf,s(j,this.toBBox),s(ae,this.toBBox),k?D[k-1].children.push(ae):this._splitRoot(j,ae)},a.prototype._splitRoot=function(D,k){this.data=H([D,k]),this.data.height=D.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(D,k,j){for(var Y,ie,ne,ae,W,$e,Oe,ze=1/0,We=1/0,Ze=k;Ze<=j-k;Ze++){var Pt=g(D,0,Ze,this.toBBox),at=g(D,Ze,j,this.toBBox),St=(ie=Pt,ne=at,ae=void 0,W=void 0,$e=void 0,Oe=void 0,ae=Math.max(ie.minX,ne.minX),W=Math.max(ie.minY,ne.minY),$e=Math.min(ie.maxX,ne.maxX),Oe=Math.min(ie.maxY,ne.maxY),Math.max(0,$e-ae)*Math.max(0,Oe-W)),et=I(Pt)+I(at);St<ze?(ze=St,Y=Ze,We=et<We?et:We):St===ze&&et<We&&(We=et,Y=Ze)}return Y||j-k},a.prototype._chooseSplitAxis=function(D,k,j){var Y=D.leaf?this.compareMinX:w,ie=D.leaf?this.compareMinY:b;this._allDistMargin(D,k,j,Y)<this._allDistMargin(D,k,j,ie)&&D.children.sort(Y)},a.prototype._allDistMargin=function(D,k,j,Y){D.children.sort(Y);for(var ie=this.toBBox,ne=g(D,0,k,ie),ae=g(D,j-k,j,ie),W=A(ne)+A(ae),$e=k;$e<j-k;$e++){var Oe=D.children[$e];m(ne,D.leaf?ie(Oe):Oe),W+=A(ne)}for(var ze=j-k-1;ze>=k;ze--){var We=D.children[ze];m(ae,D.leaf?ie(We):We),W+=A(ae)}return W},a.prototype._adjustParentBBoxes=function(D,k,j){for(var Y=j;Y>=0;Y--)m(k[Y],D)},a.prototype._condense=function(D){for(var k=D.length-1,j=void 0;k>=0;k--)D[k].children.length===0?k>0?(j=D[k-1].children).splice(j.indexOf(D[k]),1):this.clear():s(D[k],this.toBBox)},a})})(AM);var vk=AM.exports;class xk{constructor(e=[],r=wk){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,i=r[e];for(;e>0;){const a=e-1>>1,h=r[a];if(n(i,h)>=0)break;r[e]=h,e=a}r[e]=i}_down(e){const{data:r,compare:n}=this,i=this.length>>1,a=r[e];for(;e<i;){let h=(e<<1)+1,s=r[h];const g=h+1;if(g<this.length&&n(r[g],s)<0&&(h=g,s=r[g]),n(s,a)>=0)break;r[e]=s,e=h}r[e]=a}}function wk(t,e){return t<e?-1:t>e?1:0}const Ek=Object.freeze(Object.defineProperty({__proto__:null,default:xk},Symbol.toStringTag,{value:"Module"})),bk=s1(Ek);var l1={exports:{}},Tk=function(e,r,n,i){var a=e[0],h=e[1],s=!1;n===void 0&&(n=0),i===void 0&&(i=r.length);for(var g=(i-n)/2,m=0,w=g-1;m<g;w=m++){var b=r[n+m*2+0],I=r[n+m*2+1],A=r[n+w*2+0],z=r[n+w*2+1],V=I>h!=z>h&&a<(A-b)*(h-I)/(z-I)+b;V&&(s=!s)}return s},Sk=function(e,r,n,i){var a=e[0],h=e[1],s=!1;n===void 0&&(n=0),i===void 0&&(i=r.length);for(var g=i-n,m=0,w=g-1;m<g;w=m++){var b=r[m+n][0],I=r[m+n][1],A=r[w+n][0],z=r[w+n][1],V=I>h!=z>h&&a<(A-b)*(h-I)/(z-I)+b;V&&(s=!s)}return s},MM=Tk,LM=Sk;l1.exports=function(e,r,n,i){return r.length>0&&Array.isArray(r[0])?LM(e,r,n,i):MM(e,r,n,i)};l1.exports.nested=LM;l1.exports.flat=MM;var Ik=l1.exports,xE={exports:{}};(function(t,e){(function(r,n){n(e)})(e_,function(r){const i=33306690738754706e-32;function a(V,H,Z,D,k){let j,Y,ie,ne,ae=H[0],W=D[0],$e=0,Oe=0;W>ae==W>-ae?(j=ae,ae=H[++$e]):(j=W,W=D[++Oe]);let ze=0;if($e<V&&Oe<Z)for(W>ae==W>-ae?(ie=j-((Y=ae+j)-ae),ae=H[++$e]):(ie=j-((Y=W+j)-W),W=D[++Oe]),j=Y,ie!==0&&(k[ze++]=ie);$e<V&&Oe<Z;)W>ae==W>-ae?(ie=j-((Y=j+ae)-(ne=Y-j))+(ae-ne),ae=H[++$e]):(ie=j-((Y=j+W)-(ne=Y-j))+(W-ne),W=D[++Oe]),j=Y,ie!==0&&(k[ze++]=ie);for(;$e<V;)ie=j-((Y=j+ae)-(ne=Y-j))+(ae-ne),ae=H[++$e],j=Y,ie!==0&&(k[ze++]=ie);for(;Oe<Z;)ie=j-((Y=j+W)-(ne=Y-j))+(W-ne),W=D[++Oe],j=Y,ie!==0&&(k[ze++]=ie);return j===0&&ze!==0||(k[ze++]=j),ze}function h(V){return new Float64Array(V)}const s=33306690738754716e-32,g=22204460492503146e-32,m=11093356479670487e-47,w=h(4),b=h(8),I=h(12),A=h(16),z=h(4);r.orient2d=function(V,H,Z,D,k,j){const Y=(H-j)*(Z-k),ie=(V-k)*(D-j),ne=Y-ie;if(Y===0||ie===0||Y>0!=ie>0)return ne;const ae=Math.abs(Y+ie);return Math.abs(ne)>=s*ae?ne:-function(W,$e,Oe,ze,We,Ze,Pt){let at,St,et,zt,mt,bt,It,jt,Jt,yr,rr,Ar,Ii,Xr,si,nr,Ee,Ce;const Ke=W-We,Qe=Oe-We,ot=$e-Ze,wt=ze-Ze;mt=(si=(jt=Ke-(It=(bt=134217729*Ke)-(bt-Ke)))*(yr=wt-(Jt=(bt=134217729*wt)-(bt-wt)))-((Xr=Ke*wt)-It*Jt-jt*Jt-It*yr))-(rr=si-(Ee=(jt=ot-(It=(bt=134217729*ot)-(bt-ot)))*(yr=Qe-(Jt=(bt=134217729*Qe)-(bt-Qe)))-((nr=ot*Qe)-It*Jt-jt*Jt-It*yr))),w[0]=si-(rr+mt)+(mt-Ee),mt=(Ii=Xr-((Ar=Xr+rr)-(mt=Ar-Xr))+(rr-mt))-(rr=Ii-nr),w[1]=Ii-(rr+mt)+(mt-nr),mt=(Ce=Ar+rr)-Ar,w[2]=Ar-(Ce-mt)+(rr-mt),w[3]=Ce;let Mt=function($t,Qt){let fr=Qt[0];for(let Mr=1;Mr<$t;Mr++)fr+=Qt[Mr];return fr}(4,w),_t=g*Pt;if(Mt>=_t||-Mt>=_t||(at=W-(Ke+(mt=W-Ke))+(mt-We),et=Oe-(Qe+(mt=Oe-Qe))+(mt-We),St=$e-(ot+(mt=$e-ot))+(mt-Ze),zt=ze-(wt+(mt=ze-wt))+(mt-Ze),at===0&&St===0&&et===0&&zt===0)||(_t=m*Pt+i*Math.abs(Mt),(Mt+=Ke*zt+wt*at-(ot*et+Qe*St))>=_t||-Mt>=_t))return Mt;mt=(si=(jt=at-(It=(bt=134217729*at)-(bt-at)))*(yr=wt-(Jt=(bt=134217729*wt)-(bt-wt)))-((Xr=at*wt)-It*Jt-jt*Jt-It*yr))-(rr=si-(Ee=(jt=St-(It=(bt=134217729*St)-(bt-St)))*(yr=Qe-(Jt=(bt=134217729*Qe)-(bt-Qe)))-((nr=St*Qe)-It*Jt-jt*Jt-It*yr))),z[0]=si-(rr+mt)+(mt-Ee),mt=(Ii=Xr-((Ar=Xr+rr)-(mt=Ar-Xr))+(rr-mt))-(rr=Ii-nr),z[1]=Ii-(rr+mt)+(mt-nr),mt=(Ce=Ar+rr)-Ar,z[2]=Ar-(Ce-mt)+(rr-mt),z[3]=Ce;const Nt=a(4,w,4,z,b);mt=(si=(jt=Ke-(It=(bt=134217729*Ke)-(bt-Ke)))*(yr=zt-(Jt=(bt=134217729*zt)-(bt-zt)))-((Xr=Ke*zt)-It*Jt-jt*Jt-It*yr))-(rr=si-(Ee=(jt=ot-(It=(bt=134217729*ot)-(bt-ot)))*(yr=et-(Jt=(bt=134217729*et)-(bt-et)))-((nr=ot*et)-It*Jt-jt*Jt-It*yr))),z[0]=si-(rr+mt)+(mt-Ee),mt=(Ii=Xr-((Ar=Xr+rr)-(mt=Ar-Xr))+(rr-mt))-(rr=Ii-nr),z[1]=Ii-(rr+mt)+(mt-nr),mt=(Ce=Ar+rr)-Ar,z[2]=Ar-(Ce-mt)+(rr-mt),z[3]=Ce;const xt=a(Nt,b,4,z,I);mt=(si=(jt=at-(It=(bt=134217729*at)-(bt-at)))*(yr=zt-(Jt=(bt=134217729*zt)-(bt-zt)))-((Xr=at*zt)-It*Jt-jt*Jt-It*yr))-(rr=si-(Ee=(jt=St-(It=(bt=134217729*St)-(bt-St)))*(yr=et-(Jt=(bt=134217729*et)-(bt-et)))-((nr=St*et)-It*Jt-jt*Jt-It*yr))),z[0]=si-(rr+mt)+(mt-Ee),mt=(Ii=Xr-((Ar=Xr+rr)-(mt=Ar-Xr))+(rr-mt))-(rr=Ii-nr),z[1]=Ii-(rr+mt)+(mt-nr),mt=(Ce=Ar+rr)-Ar,z[2]=Ar-(Ce-mt)+(rr-mt),z[3]=Ce;const ir=a(xt,I,4,z,A);return A[ir-1]}(V,H,Z,D,k,j,ae)},r.orient2dfast=function(V,H,Z,D,k,j){return(H-j)*(Z-k)-(V-k)*(D-j)},Object.defineProperty(r,"__esModule",{value:!0})})})(xE,xE.exports);var Pk=xE.exports,eP=vk,p0=bk,Ck=Ik,Ak=Pk.orient2d;p0.default&&(p0=p0.default);Lb.exports=OM;Lb.exports.default=OM;function OM(t,e,r){e=Math.max(0,e===void 0?2:e),r=r||0;var n=Nk(t),i=new eP(16);i.toBBox=function(D){return{minX:D[0],minY:D[1],maxX:D[0],maxY:D[1]}},i.compareMinX=function(D,k){return D[0]-k[0]},i.compareMinY=function(D,k){return D[1]-k[1]},i.load(t);for(var a=[],h=0,s;h<n.length;h++){var g=n[h];i.remove(g),s=nP(g,s),a.push(s)}var m=new eP(16);for(h=0;h<a.length;h++)m.insert(Cw(a[h]));for(var w=e*e,b=r*r;a.length;){var I=a.shift(),A=I.p,z=I.next.p,V=Aw(A,z);if(!(V<b)){var H=V/w;g=Mk(i,I.prev.p,A,z,I.next.next.p,H,m),g&&Math.min(Aw(g,A),Aw(g,z))<=H&&(a.push(I),a.push(nP(g,I)),i.remove(g),m.remove(I),m.insert(Cw(I)),m.insert(Cw(I.next)))}}I=s;var Z=[];do Z.push(I.p),I=I.next;while(I!==s);return Z.push(I.p),Z}function Mk(t,e,r,n,i,a,h){for(var s=new p0([],Lk),g=t.data;g;){for(var m=0;m<g.children.length;m++){var w=g.children[m],b=g.leaf?Mw(w,r,n):Ok(r,n,w);b>a||s.push({node:w,dist:b})}for(;s.length&&!s.peek().node.children;){var I=s.pop(),A=I.node,z=Mw(A,e,r),V=Mw(A,n,i);if(I.dist<z&&I.dist<V&&rP(r,A,h)&&rP(n,A,h))return A}g=s.pop(),g&&(g=g.node)}return null}function Lk(t,e){return t.dist-e.dist}function Ok(t,e,r){if(tP(t,r)||tP(e,r))return 0;var n=Hv(t[0],t[1],e[0],e[1],r.minX,r.minY,r.maxX,r.minY);if(n===0)return 0;var i=Hv(t[0],t[1],e[0],e[1],r.minX,r.minY,r.minX,r.maxY);if(i===0)return 0;var a=Hv(t[0],t[1],e[0],e[1],r.maxX,r.minY,r.maxX,r.maxY);if(a===0)return 0;var h=Hv(t[0],t[1],e[0],e[1],r.minX,r.maxY,r.maxX,r.maxY);return h===0?0:Math.min(n,i,a,h)}function tP(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function rP(t,e,r){for(var n=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),a=Math.max(t[0],e[0]),h=Math.max(t[1],e[1]),s=r.search({minX:n,minY:i,maxX:a,maxY:h}),g=0;g<s.length;g++)if(Dk(s[g].p,s[g].next.p,t,e))return!1;return!0}function wd(t,e,r){return Ak(t[0],t[1],e[0],e[1],r[0],r[1])}function Dk(t,e,r,n){return t!==n&&e!==r&&wd(t,e,r)>0!=wd(t,e,n)>0&&wd(r,n,t)>0!=wd(r,n,e)>0}function Cw(t){var e=t.p,r=t.next.p;return t.minX=Math.min(e[0],r[0]),t.minY=Math.min(e[1],r[1]),t.maxX=Math.max(e[0],r[0]),t.maxY=Math.max(e[1],r[1]),t}function Nk(t){for(var e=t[0],r=t[0],n=t[0],i=t[0],a=0;a<t.length;a++){var h=t[a];h[0]<e[0]&&(e=h),h[0]>n[0]&&(n=h),h[1]<r[1]&&(r=h),h[1]>i[1]&&(i=h)}var s=[e,r,n,i],g=s.slice();for(a=0;a<t.length;a++)Ck(t[a],s)||g.push(t[a]);return kk(g)}function nP(t,e){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function Aw(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Mw(t,e,r){var n=e[0],i=e[1],a=r[0]-n,h=r[1]-i;if(a!==0||h!==0){var s=((t[0]-n)*a+(t[1]-i)*h)/(a*a+h*h);s>1?(n=r[0],i=r[1]):s>0&&(n+=a*s,i+=h*s)}return a=t[0]-n,h=t[1]-i,a*a+h*h}function Hv(t,e,r,n,i,a,h,s){var g=r-t,m=n-e,w=h-i,b=s-a,I=t-i,A=e-a,z=g*g+m*m,V=g*w+m*b,H=w*w+b*b,Z=g*I+m*A,D=w*I+b*A,k=z*H-V*V,j,Y,ie,ne,ae=k,W=k;k===0?(Y=0,ae=1,ne=D,W=H):(Y=V*D-H*Z,ne=z*D-V*Z,Y<0?(Y=0,ne=D,W=H):Y>ae&&(Y=ae,ne=D+V,W=H)),ne<0?(ne=0,-Z<0?Y=0:-Z>z?Y=ae:(Y=-Z,ae=z)):ne>W&&(ne=W,-Z+V<0?Y=0:-Z+V>z?Y=ae:(Y=-Z+V,ae=z)),j=Y===0?0:Y/ae,ie=ne===0?0:ne/W;var $e=(1-j)*t+j*r,Oe=(1-j)*e+j*n,ze=(1-ie)*i+ie*h,We=(1-ie)*a+ie*s,Ze=ze-$e,Pt=We-Oe;return Ze*Ze+Pt*Pt}function Rk(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function kk(t){t.sort(Rk);for(var e=[],r=0;r<t.length;r++){for(;e.length>=2&&wd(e[e.length-2],e[e.length-1],t[r])<=0;)e.pop();e.push(t[r])}for(var n=[],i=t.length-1;i>=0;i--){for(;n.length>=2&&wd(n[n.length-2],n[n.length-1],t[i])<=0;)n.pop();n.push(t[i])}return n.pop(),e.pop(),e.concat(n)}var Fk=Lb.exports;const zk=wa(Fk);function DM(t,e){e===void 0&&(e={}),e.concavity=e.concavity||1/0;var r=[];if(ji(t,function(i){r.push([i[0],i[1]])}),!r.length)return null;var n=zk(r,e.concavity);return n.length>3?qr([n]):null}function ci(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=oi(t),i=hi(e),a=i.type,h=e.bbox,s=i.coordinates;if(h&&Bk(n,h)===!1)return!1;a==="Polygon"&&(s=[s]);for(var g=!1,m=0;m<s.length&&!g;m++)if(iP(n,s[m][0],r.ignoreBoundary)){for(var w=!1,b=1;b<s[m].length&&!w;)iP(n,s[m][b],!r.ignoreBoundary)&&(w=!0),b++;w||(g=!0)}return g}function iP(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,a=e.length-1;i<e.length;a=i++){var h=e[i][0],s=e[i][1],g=e[a][0],m=e[a][1],w=t[1]*(h-g)+s*(g-t[0])+m*(t[0]-h)===0&&(h-t[0])*(g-t[0])<=0&&(s-t[1])*(m-t[1])<=0;if(w)return!r;var b=s>t[1]!=m>t[1]&&t[0]<(g-h)*(t[1]-s)/(m-s)+h;b&&(n=!n)}return n}function Bk(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function wE(t,e){var r=[];return kn(t,function(n){var i=!1;if(n.geometry.type==="Point")ma(e,function(h){ci(n,h)&&(i=!0)}),i&&r.push(n);else if(n.geometry.type==="MultiPoint"){var a=[];ma(e,function(h){ji(n,function(s){ci(s,h)&&(i=!0,a.push(s))})}),i&&r.push(t_(a))}else throw new Error("Input geometry must be a Point or MultiPoint")}),hr(r)}function Rn(t,e,r){r===void 0&&(r={});var n=oi(t),i=oi(e),a=Ao(i[1]-n[1]),h=Ao(i[0]-n[0]),s=Ao(n[1]),g=Ao(i[1]),m=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(s)*Math.cos(g);return zd(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r.units)}function NM(t,e){var r=!1;return hr(Vk(t.features.map(function(n){var i={x:n.geometry.coordinates[0],y:n.geometry.coordinates[1]};return e?i.z=n.properties[e]:n.geometry.coordinates.length===3&&(r=!0,i.z=n.geometry.coordinates[2]),i})).map(function(n){var i=[n.a.x,n.a.y],a=[n.b.x,n.b.y],h=[n.c.x,n.c.y],s={};return r?(i.push(n.a.z),a.push(n.b.z),h.push(n.c.z)):s={a:n.a.z,b:n.b.z,c:n.c.z},qr([[i,a,h,i]],s)}))}var oP=function(){function t(e,r,n){this.a=e,this.b=r,this.c=n;var i=r.x-e.x,a=r.y-e.y,h=n.x-e.x,s=n.y-e.y,g=i*(e.x+r.x)+a*(e.y+r.y),m=h*(e.x+n.x)+s*(e.y+n.y),w=2*(i*(n.y-r.y)-a*(n.x-r.x)),b,I;this.x=(s*g-a*m)/w,this.y=(i*m-h*g)/w,b=this.x-e.x,I=this.y-e.y,this.r=b*b+I*I}return t}();function Uk(t,e){return e.x-t.x}function Gk(t){var e=t.length,r,n,i,a,h;e:for(;e;)for(n=t[--e],r=t[--e],i=e;i;)if(h=t[--i],a=t[--i],r===a&&n===h||r===h&&n===a){t.splice(e,2),t.splice(i,2),e-=2;continue e}}function Vk(t){if(t.length<3)return[];t.sort(Uk);for(var e=t.length-1,r=t[e].x,n=t[0].x,i=t[e].y,a=i,h=1e-12,s,g,m,w,b,I;e--;)t[e].y<i&&(i=t[e].y),t[e].y>a&&(a=t[e].y);var A=n-r,z=a-i,V=A>z?A:z,H=(n+r)*.5,Z=(a+i)*.5,D=[new oP({__sentinel:!0,x:H-20*V,y:Z-V},{__sentinel:!0,x:H,y:Z+20*V},{__sentinel:!0,x:H+20*V,y:Z-V})],k=[],j=[],Y;for(e=t.length;e--;){for(j.length=0,Y=D.length;Y--;){if(A=t[e].x-D[Y].x,A>0&&A*A>D[Y].r){k.push(D[Y]),D.splice(Y,1);continue}z=t[e].y-D[Y].y,!(A*A+z*z>D[Y].r)&&(j.push(D[Y].a,D[Y].b,D[Y].b,D[Y].c,D[Y].c,D[Y].a),D.splice(Y,1))}for(Gk(j),Y=j.length;Y;)g=j[--Y],s=j[--Y],m=t[e],w=g.x-s.x,b=g.y-s.y,I=2*(w*(m.y-g.y)-b*(m.x-g.x)),Math.abs(I)>h&&D.push(new oP(s,g,m))}for(Array.prototype.push.apply(k,D),e=k.length;e--;)(k[e].a.__sentinel||k[e].b.__sentinel||k[e].c.__sentinel)&&k.splice(e,1);return k}function ss(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return RM(t);case"FeatureCollection":return jk(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ob(t);default:throw new Error("unknown GeoJSON type")}}function RM(t){var e={type:"Feature"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}}),e.properties=kM(t.properties),e.geometry=Ob(t.geometry),e}function kM(t){var e={};return t&&Object.keys(t).forEach(function(r){var n=t[r];typeof n=="object"?n===null?e[r]=null:Array.isArray(n)?e[r]=n.map(function(i){return i}):e[r]=kM(n):e[r]=n}),e}function jk(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}}),e.features=t.features.map(function(r){return RM(r)}),e}function Ob(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(r){return Ob(r)}),e):(e.coordinates=FM(t.coordinates),e)}function FM(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(r){return FM(r)})}function qk(t,e){if(e===void 0&&(e={}),e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.mutate;if(Zs(t)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");(r===!1||r===void 0)&&(t=ss(t));var n=[],i=Cb(t,function(a,h){var s=$k(a,h);return s||(n.push(a),h)});return i&&n.push(i),n.length?n.length===1?n[0]:Fh(n.map(function(a){return a.coordinates})):null}function Kv(t){return t[0].toString()+","+t[1].toString()}function $k(t,e){var r=t.geometry.coordinates,n=e.geometry.coordinates,i=Kv(r[0]),a=Kv(r[r.length-1]),h=Kv(n[0]),s=Kv(n[n.length-1]),g;if(i===s)g=n.concat(r.slice(1));else if(h===a)g=r.concat(n.slice(1));else if(i===h)g=r.slice(1).reverse().concat(n);else if(a===s)g=r.concat(n.reverse().slice(1));else return null;return Bn(g)}function Zk(t){return t}function Xk(t){if(t==null)return Zk;var e,r,n=t.scale[0],i=t.scale[1],a=t.translate[0],h=t.translate[1];return function(s,g){g||(e=r=0);var m=2,w=s.length,b=new Array(w);for(b[0]=(e+=s[0])*n+a,b[1]=(r+=s[1])*i+h;m<w;)b[m]=s[m],++m;return b}}function Wk(t,e){for(var r,n=t.length,i=n-e;i<--n;)r=t[i],t[i++]=t[n],t[n]=r}function zM(t,e){var r=Xk(t.transform),n=t.arcs;function i(w,b){b.length&&b.pop();for(var I=n[w<0?~w:w],A=0,z=I.length;A<z;++A)b.push(r(I[A],A));w<0&&Wk(b,z)}function a(w){return r(w)}function h(w){for(var b=[],I=0,A=w.length;I<A;++I)i(w[I],b);return b.length<2&&b.push(b[0]),b}function s(w){for(var b=h(w);b.length<4;)b.push(b[0]);return b}function g(w){return w.map(s)}function m(w){var b=w.type,I;switch(b){case"GeometryCollection":return{type:b,geometries:w.geometries.map(m)};case"Point":I=a(w.coordinates);break;case"MultiPoint":I=w.coordinates.map(a);break;case"LineString":I=h(w.arcs);break;case"MultiLineString":I=w.arcs.map(h);break;case"Polygon":I=g(w.arcs);break;case"MultiPolygon":I=w.arcs.map(g);break;default:return null}return{type:b,coordinates:I}}return m(e)}function Hk(t,e){var r={},n={},i={},a=[],h=-1;e.forEach(function(m,w){var b=t.arcs[m<0?~m:m],I;b.length<3&&!b[1][0]&&!b[1][1]&&(I=e[++h],e[h]=m,e[w]=I)}),e.forEach(function(m){var w=s(m),b=w[0],I=w[1],A,z;if(A=i[b])if(delete i[A.end],A.push(m),A.end=I,z=n[I]){delete n[z.start];var V=z===A?A:A.concat(z);n[V.start=A.start]=i[V.end=z.end]=V}else n[A.start]=i[A.end]=A;else if(A=n[I])if(delete n[A.start],A.unshift(m),A.start=b,z=i[b]){delete i[z.end];var H=z===A?A:z.concat(A);n[H.start=z.start]=i[H.end=A.end]=H}else n[A.start]=i[A.end]=A;else A=[m],n[A.start=b]=i[A.end=I]=A});function s(m){var w=t.arcs[m<0?~m:m],b=w[0],I;return t.transform?(I=[0,0],w.forEach(function(A){I[0]+=A[0],I[1]+=A[1]})):I=w[w.length-1],m<0?[I,b]:[b,I]}function g(m,w){for(var b in m){var I=m[b];delete w[I.start],delete I.start,delete I.end,I.forEach(function(A){r[A<0?~A:A]=1}),a.push(I)}}return g(i,n),g(n,i),e.forEach(function(m){r[m<0?~m:m]||a.push([m])}),a}function Kk(t){for(var e=-1,r=t.length,n,i=t[r-1],a=0;++e<r;)n=i,i=t[e],a+=n[0]*i[1]-n[1]*i[0];return Math.abs(a)}function Yk(t){return zM(t,Jk.apply(this,arguments))}function Jk(t,e){var r={},n=[],i=[];e.forEach(a);function a(g){switch(g.type){case"GeometryCollection":g.geometries.forEach(a);break;case"Polygon":h(g.arcs);break;case"MultiPolygon":g.arcs.forEach(h);break}}function h(g){g.forEach(function(m){m.forEach(function(w){(r[w=w<0?~w:w]||(r[w]=[])).push(g)})}),n.push(g)}function s(g){return Kk(zM(t,{type:"Polygon",arcs:[g]}).coordinates[0])}return n.forEach(function(g){if(!g._){var m=[],w=[g];for(g._=1,i.push(m);g=w.pop();)m.push(g),g.forEach(function(b){b.forEach(function(I){r[I<0?~I:I].forEach(function(A){A._||(A._=1,w.push(A))})})})}}),n.forEach(function(g){delete g._}),{type:"MultiPolygon",arcs:i.map(function(g){var m=[],w;if(g.forEach(function(V){V.forEach(function(H){H.forEach(function(Z){r[Z<0?~Z:Z].length<2&&m.push(Z)})})}),m=Hk(t,m),(w=m.length)>1)for(var b=1,I=s(m[0]),A,z;b<w;++b)(A=s(m[b]))>I&&(z=m[0],m[0]=m[b],m[b]=z,I=A);return m}).filter(function(g){return g.length>0})}}var u1=Object.prototype.hasOwnProperty;function Qk(t){var e=1/0,r=1/0,n=-1/0,i=-1/0;function a(b){b!=null&&u1.call(h,b.type)&&h[b.type](b)}var h={GeometryCollection:function(b){b.geometries.forEach(a)},Point:function(b){s(b.coordinates)},MultiPoint:function(b){b.coordinates.forEach(s)},LineString:function(b){g(b.arcs)},MultiLineString:function(b){b.arcs.forEach(g)},Polygon:function(b){b.arcs.forEach(g)},MultiPolygon:function(b){b.arcs.forEach(m)}};function s(b){var I=b[0],A=b[1];I<e&&(e=I),I>n&&(n=I),A<r&&(r=A),A>i&&(i=A)}function g(b){b.forEach(s)}function m(b){b.forEach(g)}for(var w in t)a(t[w]);return n>=e&&i>=r?[e,r,n,i]:void 0}function eF(t,e,r,n,i){arguments.length===3&&(n=Array,i=null);for(var a=new n(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),h=t-1,s=0;s<t;++s)a[s]=i;function g(b){for(var I=e(b)&h,A=a[I],z=0;A!=i;){if(r(A,b))return!0;if(++z>=t)throw new Error("full hashset");A=a[I=I+1&h]}return a[I]=b,!0}function m(b){for(var I=e(b)&h,A=a[I],z=0;A!=i;){if(r(A,b))return!0;if(++z>=t)break;A=a[I=I+1&h]}return!1}function w(){for(var b=[],I=0,A=a.length;I<A;++I){var z=a[I];z!=i&&b.push(z)}return b}return{add:g,has:m,values:w}}function Db(t,e,r,n,i,a){arguments.length===3&&(n=a=Array,i=null);for(var h=new n(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=new a(t),g=t-1,m=0;m<t;++m)h[m]=i;function w(z,V){for(var H=e(z)&g,Z=h[H],D=0;Z!=i;){if(r(Z,z))return s[H]=V;if(++D>=t)throw new Error("full hashmap");Z=h[H=H+1&g]}return h[H]=z,s[H]=V,V}function b(z,V){for(var H=e(z)&g,Z=h[H],D=0;Z!=i;){if(r(Z,z))return s[H];if(++D>=t)throw new Error("full hashmap");Z=h[H=H+1&g]}return h[H]=z,s[H]=V,V}function I(z,V){for(var H=e(z)&g,Z=h[H],D=0;Z!=i;){if(r(Z,z))return s[H];if(++D>=t)break;Z=h[H=H+1&g]}return V}function A(){for(var z=[],V=0,H=h.length;V<H;++V){var Z=h[V];Z!=i&&z.push(Z)}return z}return{set:w,maybeSet:b,get:I,keys:A}}function Df(t,e){return t[0]===e[0]&&t[1]===e[1]}var BM=new ArrayBuffer(16),sP=new Float64Array(BM),Yv=new Uint32Array(BM);function EE(t){sP[0]=t[0],sP[1]=t[1];var e=Yv[0]^Yv[1];return e=e<<5^e>>7^Yv[2]^Yv[3],e&2147483647}function tF(t){var e=t.coordinates,r=t.lines,n=t.rings,i=ie(),a=new Int32Array(e.length),h=new Int32Array(e.length),s=new Int32Array(e.length),g=new Int8Array(e.length),m=0,w,b,I,A,z;for(w=0,b=e.length;w<b;++w)a[w]=h[w]=s[w]=-1;for(w=0,b=r.length;w<b;++w){var V=r[w],H=V[0],Z=V[1];for(A=i[H],z=i[++H],++m,g[A]=1;++H<=Z;)Y(w,I=A,A=z,z=i[H]);++m,g[z]=1}for(w=0,b=e.length;w<b;++w)a[w]=-1;for(w=0,b=n.length;w<b;++w){var D=n[w],k=D[0]+1,j=D[1];for(I=i[j-1],A=i[k-1],z=i[k],Y(w,I,A,z);++k<=j;)Y(w,I=A,A=z,z=i[k])}function Y(Oe,ze,We,Ze){if(a[We]!==Oe){a[We]=Oe;var Pt=h[We];if(Pt>=0){var at=s[We];(Pt!==ze||at!==Ze)&&(Pt!==Ze||at!==ze)&&(++m,g[We]=1)}else h[We]=ze,s[We]=Ze}}function ie(){for(var Oe=Db(e.length*1.4,ne,ae,Int32Array,-1,Int32Array),ze=new Int32Array(e.length),We=0,Ze=e.length;We<Ze;++We)ze[We]=Oe.maybeSet(We,We);return ze}function ne(Oe){return EE(e[Oe])}function ae(Oe,ze){return Df(e[Oe],e[ze])}a=h=s=null;var W=eF(m*1.4,EE,Df),$e;for(w=0,b=e.length;w<b;++w)g[$e=i[w]]&&W.add(e[$e]);return W}function rF(t){var e=tF(t),r=t.coordinates,n=t.lines,i=t.rings,a,h,s;for(h=0,s=n.length;h<s;++h)for(var g=n[h],m=g[0],w=g[1];++m<w;)e.has(r[m])&&(a={0:m,1:g[1]},g[1]=m,g=g.next=a);for(h=0,s=i.length;h<s;++h)for(var b=i[h],I=b[0],A=I,z=b[1],V=e.has(r[I]);++A<z;)e.has(r[A])&&(V?(a={0:A,1:b[1]},b[1]=A,b=b.next=a):(nF(r,I,z,z-A),r[z]=r[I],V=!0,A=I));return t}function nF(t,e,r,n){Lw(t,e,r),Lw(t,e,e+n),Lw(t,e+n,r)}function Lw(t,e,r){for(var n=e+(r---e>>1),i;e<n;++e,--r)i=t[e],t[e]=t[r],t[r]=i}function iF(t){var e=t.coordinates,r=t.lines,n,i=t.rings,a,h=r.length+i.length,s,g;for(delete t.lines,delete t.rings,s=0,g=r.length;s<g;++s)for(n=r[s];n=n.next;)++h;for(s=0,g=i.length;s<g;++s)for(a=i[s];a=a.next;)++h;var m=Db(h*2*1.4,EE,Df),w=t.arcs=[];for(s=0,g=r.length;s<g;++s){n=r[s];do b(n);while(n=n.next)}for(s=0,g=i.length;s<g;++s)if(a=i[s],a.next)do b(a);while(a=a.next);else I(a);function b(D){var k,j,Y,ie,ne,ae,W,$e;if(Y=m.get(k=e[D[0]])){for(W=0,$e=Y.length;W<$e;++W)if(ie=Y[W],A(ie,D)){D[0]=ie[0],D[1]=ie[1];return}}if(ne=m.get(j=e[D[1]])){for(W=0,$e=ne.length;W<$e;++W)if(ae=ne[W],z(ae,D)){D[1]=ae[0],D[0]=ae[1];return}}Y?Y.push(D):m.set(k,[D]),ne?ne.push(D):m.set(j,[D]),w.push(D)}function I(D){var k,j,Y,ie,ne;if(j=m.get(k=e[D[0]]))for(ie=0,ne=j.length;ie<ne;++ie){if(Y=j[ie],V(Y,D)){D[0]=Y[0],D[1]=Y[1];return}if(H(Y,D)){D[0]=Y[1],D[1]=Y[0];return}}if(j=m.get(k=e[D[0]+Z(D)]))for(ie=0,ne=j.length;ie<ne;++ie){if(Y=j[ie],V(Y,D)){D[0]=Y[0],D[1]=Y[1];return}if(H(Y,D)){D[0]=Y[1],D[1]=Y[0];return}}j?j.push(D):m.set(k,[D]),w.push(D)}function A(D,k){var j=D[0],Y=k[0],ie=D[1],ne=k[1];if(j-ie!==Y-ne)return!1;for(;j<=ie;++j,++Y)if(!Df(e[j],e[Y]))return!1;return!0}function z(D,k){var j=D[0],Y=k[0],ie=D[1],ne=k[1];if(j-ie!==Y-ne)return!1;for(;j<=ie;++j,--ne)if(!Df(e[j],e[ne]))return!1;return!0}function V(D,k){var j=D[0],Y=k[0],ie=D[1],ne=k[1],ae=ie-j;if(ae!==ne-Y)return!1;for(var W=Z(D),$e=Z(k),Oe=0;Oe<ae;++Oe)if(!Df(e[j+(Oe+W)%ae],e[Y+(Oe+$e)%ae]))return!1;return!0}function H(D,k){var j=D[0],Y=k[0],ie=D[1],ne=k[1],ae=ie-j;if(ae!==ne-Y)return!1;for(var W=Z(D),$e=ae-Z(k),Oe=0;Oe<ae;++Oe)if(!Df(e[j+(Oe+W)%ae],e[ne-(Oe+$e)%ae]))return!1;return!0}function Z(D){for(var k=D[0],j=D[1],Y=k,ie=Y,ne=e[Y];++Y<j;){var ae=e[Y];(ae[0]<ne[0]||ae[0]===ne[0]&&ae[1]<ne[1])&&(ie=Y,ne=ae)}return ie-k}return t}function oF(t){for(var e=-1,r=t.length;++e<r;){for(var n=t[e],i=0,a=1,h=n.length,s=n[0],g=s[0],m=s[1],w,b;++i<h;)s=n[i],w=s[0],b=s[1],(w!==g||b!==m)&&(n[a++]=[w-g,b-m],g=w,m=b);a===1&&(n[a++]=[0,0]),n.length=a}return t}function sF(t){var e=-1,r=[],n=[],i=[];function a(b){b&&u1.call(h,b.type)&&h[b.type](b)}var h={GeometryCollection:function(b){b.geometries.forEach(a)},LineString:function(b){b.arcs=s(b.arcs)},MultiLineString:function(b){b.arcs=b.arcs.map(s)},Polygon:function(b){b.arcs=b.arcs.map(g)},MultiPolygon:function(b){b.arcs=b.arcs.map(m)}};function s(b){for(var I=0,A=b.length;I<A;++I)i[++e]=b[I];var z={0:e-A+1,1:e};return r.push(z),z}function g(b){for(var I=0,A=b.length;I<A;++I)i[++e]=b[I];var z={0:e-A+1,1:e};return n.push(z),z}function m(b){return b.map(g)}for(var w in t)a(t[w]);return{type:"Topology",coordinates:i,lines:r,rings:n,objects:t}}function aF(t){var e={},r;for(r in t)e[r]=lF(t[r]);return e}function lF(t){return t==null?{type:null}:(t.type==="FeatureCollection"?uF:t.type==="Feature"?UM:Nb)(t)}function uF(t){var e={type:"GeometryCollection",geometries:t.features.map(UM)};return t.bbox!=null&&(e.bbox=t.bbox),e}function UM(t){var e=Nb(t.geometry),r;t.id!=null&&(e.id=t.id),t.bbox!=null&&(e.bbox=t.bbox);for(r in t.properties){e.properties=t.properties;break}return e}function Nb(t){if(t==null)return{type:null};var e=t.type==="GeometryCollection"?{type:"GeometryCollection",geometries:t.geometries.map(Nb)}:t.type==="Point"||t.type==="MultiPoint"?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return t.bbox!=null&&(e.bbox=t.bbox),e}function cF(t,e,r){var n=e[0],i=e[1],a=e[2],h=e[3],s=a-n?(r-1)/(a-n):1,g=h-i?(r-1)/(h-i):1;function m(Z){return[Math.round((Z[0]-n)*s),Math.round((Z[1]-i)*g)]}function w(Z,D){for(var k=-1,j=0,Y=Z.length,ie=new Array(Y),ne,ae,W,$e,Oe;++k<Y;)ne=Z[k],$e=Math.round((ne[0]-n)*s),Oe=Math.round((ne[1]-i)*g),($e!==ae||Oe!==W)&&(ie[j++]=[ae=$e,W=Oe]);for(ie.length=j;j<D;)j=ie.push([ie[0][0],ie[0][1]]);return ie}function b(Z){return w(Z,2)}function I(Z){return w(Z,4)}function A(Z){return Z.map(I)}function z(Z){Z!=null&&u1.call(V,Z.type)&&V[Z.type](Z)}var V={GeometryCollection:function(Z){Z.geometries.forEach(z)},Point:function(Z){Z.coordinates=m(Z.coordinates)},MultiPoint:function(Z){Z.coordinates=Z.coordinates.map(m)},LineString:function(Z){Z.arcs=b(Z.arcs)},MultiLineString:function(Z){Z.arcs=Z.arcs.map(b)},Polygon:function(Z){Z.arcs=A(Z.arcs)},MultiPolygon:function(Z){Z.arcs=Z.arcs.map(A)}};for(var H in t)z(t[H]);return{scale:[1/s,1/g],translate:[n,i]}}function hF(t,e){var r=Qk(t=aF(t)),n=e>0&&r&&cF(t,r,e),i=iF(rF(sF(t))),a=i.coordinates,h=Db(i.arcs.length*1.4,fF,pF);t=i.objects,i.bbox=r,i.arcs=i.arcs.map(function(I,A){return h.set(I,A),a.slice(I[0],I[1]+1)}),delete i.coordinates,a=null;function s(I){I&&u1.call(g,I.type)&&g[I.type](I)}var g={GeometryCollection:function(I){I.geometries.forEach(s)},LineString:function(I){I.arcs=m(I.arcs)},MultiLineString:function(I){I.arcs=I.arcs.map(m)},Polygon:function(I){I.arcs=I.arcs.map(m)},MultiPolygon:function(I){I.arcs=I.arcs.map(w)}};function m(I){var A=[];do{var z=h.get(I);A.push(I[0]<I[1]?z:~z)}while(I=I.next);return A}function w(I){return I.map(m)}for(var b in t)s(t[b]);return n&&(i.transform=n,i.arcs=oF(i.arcs)),i}function fF(t){var e=t[0],r=t[1],n;return r<e&&(n=e,e=r,r=n),e+31*r}function pF(t,e){var r=t[0],n=t[1],i=e[0],a=e[1],h;return n<r&&(h=r,r=n,n=h),a<i&&(h=i,i=a,a=h),r===i&&n===a}function dF(t,e){if(e===void 0&&(e={}),Zs(t)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");(e.mutate===!1||e.mutate===void 0)&&(t=ss(t));var r=[];jo(t,function(a){r.push(a.geometry)});var n=hF({geoms:wb(r).geometry}),i=Yk(n,n.objects.geoms.geometries);return i}function gF(t,e){if(e===void 0&&(e={}),e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.mutate;if(Zs(t)!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");(r===!1||r===void 0)&&(t=ss(t));var n=mF(t);if(!n)throw new Error("geojson must be homogenous");var i=t;switch(n){case"LineString":return qk(i,e);case"Polygon":return dF(i,e);default:throw new Error(n+" is not supported")}}function mF(t){var e={};jo(t,function(n){e[n.geometry.type]=!0});var r=Object.keys(e);return r.length===1?r[0]:null}function yF(t,e){e===void 0&&(e={});var r=e.maxEdge||1/0,n=_F(t),i=NM(n);if(i.features=i.features.filter(function(h){var s=h.geometry.coordinates[0][0],g=h.geometry.coordinates[0][1],m=h.geometry.coordinates[0][2],w=Rn(s,g,e),b=Rn(g,m,e),I=Rn(s,m,e);return w<=r&&b<=r&&I<=r}),i.features.length<1)return null;var a=gF(i);return a.coordinates.length===1&&(a.coordinates=a.coordinates[0],a.type="Polygon"),fo(a)}function _F(t){var e=[],r={};return kn(t,function(n){if(n.geometry){var i=n.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(r,i)||(e.push(n),r[i]=!0)}}),hr(e)}var Rb={exports:{}},GM={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(e_,function(){function r(h,s,g,m,w){n(h,s,g||0,m||h.length-1,w||a)}function n(h,s,g,m,w){for(;m>g;){if(m-g>600){var b=m-g+1,I=s-g+1,A=Math.log(b),z=.5*Math.exp(2*A/3),V=.5*Math.sqrt(A*z*(b-z)/b)*(I-b/2<0?-1:1),H=Math.max(g,Math.floor(s-I*z/b+V)),Z=Math.min(m,Math.floor(s+(b-I)*z/b+V));n(h,s,H,Z,w)}var D=h[s],k=g,j=m;for(i(h,g,s),w(h[m],D)>0&&i(h,g,m);k<j;){for(i(h,k,j),k++,j--;w(h[k],D)<0;)k++;for(;w(h[j],D)>0;)j--}w(h[g],D)===0?i(h,g,j):(j++,i(h,j,m)),j<=s&&(g=j+1),s<=j&&(m=j-1)}}function i(h,s,g){var m=h[s];h[s]=h[g],h[g]=m}function a(h,s){return h<s?-1:h>s?1:0}return r})})(GM);var vF=GM.exports;Rb.exports=Ay;Rb.exports.default=Ay;var xF=vF;function Ay(t,e){if(!(this instanceof Ay))return new Ay(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}Ay.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!Qv(t,e))return r;for(var i=[],a,h,s,g;e;){for(a=0,h=e.children.length;a<h;a++)s=e.children[a],g=e.leaf?n(s):s,Qv(t,g)&&(e.leaf?r.push(s):Dw(t,g)?this._all(s,r):i.push(s));e=i.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!Qv(t,e))return!1;for(var n=[],i,a,h,s;e;){for(i=0,a=e.children.length;i<a;i++)if(h=e.children[i],s=e.leaf?r(h):h,Qv(t,s)){if(e.leaf||Dw(t,s))return!0;n.push(h)}e=n.pop()}return!1},load:function(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=vd([]),this},remove:function(t,e){if(!t)return this;for(var r=this.data,n=this.toBBox(t),i=[],a=[],h,s,g,m;r||i.length;){if(r||(r=i.pop(),s=i[i.length-1],h=a.pop(),m=!0),r.leaf&&(g=wF(t,r.children,e),g!==-1))return r.children.splice(g,1),i.push(r),this._condense(i),this;!m&&!r.leaf&&Dw(r,n)?(i.push(r),a.push(h),h=0,s=r,r=r.children[0]):s?(h++,r=s.children[h],m=!1):r=null}return this},toBBox:function(t){return t},compareMinX:aP,compareMinY:lP,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i=r-e+1,a=this._maxEntries,h;if(i<=a)return h=vd(t.slice(e,r+1)),pd(h,this.toBBox),h;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),h=vd([]),h.leaf=!1,h.height=n;var s=Math.ceil(i/a),g=s*Math.ceil(Math.sqrt(a)),m,w,b,I;for(uP(t,e,r,g,this.compareMinX),m=e;m<=r;m+=g)for(b=Math.min(m+g-1,r),uP(t,m,b,s,this.compareMinY),w=m;w<=b;w+=s)I=Math.min(w+s-1,b),h.children.push(this._build(t,w,I,n-1));return pd(h,this.toBBox),h},_chooseSubtree:function(t,e,r,n){for(var i,a,h,s,g,m,w,b;n.push(e),!(e.leaf||n.length-1===r);){for(w=b=1/0,i=0,a=e.children.length;i<a;i++)h=e.children[i],g=Ow(h),m=EF(t,h)-g,m<b?(b=m,w=g<w?g:w,s=h):m===b&&g<w&&(w=g,s=h);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),a=[],h=this._chooseSubtree(i,this.data,e,a);for(h.children.push(t),hy(h,i);e>=0&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(i,a,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n),h=vd(r.children.splice(a,r.children.length-a));h.height=r.height,h.leaf=r.leaf,pd(r,this.toBBox),pd(h,this.toBBox),e?t[e-1].children.push(h):this._splitRoot(r,h)},_splitRoot:function(t,e){this.data=vd([t,e]),this.data.height=t.height+1,this.data.leaf=!1,pd(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,a,h,s,g,m,w;for(g=m=1/0,n=e;n<=r-e;n++)i=cy(t,0,n,this.toBBox),a=cy(t,n,r,this.toBBox),h=bF(i,a),s=Ow(i)+Ow(a),h<g?(g=h,w=n,m=s<m?s:m):h===g&&s<m&&(m=s,w=n);return w},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:aP,i=t.leaf?this.compareMinY:lP,a=this._allDistMargin(t,e,r,n),h=this._allDistMargin(t,e,r,i);a<h&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i=this.toBBox,a=cy(t,0,e,i),h=cy(t,r-e,r,i),s=Jv(a)+Jv(h),g,m;for(g=e;g<r-e;g++)m=t.children[g],hy(a,t.leaf?i(m):m),s+=Jv(a);for(g=r-e-1;g>=e;g--)m=t.children[g],hy(h,t.leaf?i(m):m),s+=Jv(h);return s},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)hy(e[n],t)},_condense:function(t){for(var e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():pd(t[e],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function wF(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function pd(t,e){cy(t,0,t.children.length,e,t)}function cy(t,e,r,n,i){i||(i=vd(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=e,h;a<r;a++)h=t.children[a],hy(i,t.leaf?n(h):h);return i}function hy(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function aP(t,e){return t.minX-e.minX}function lP(t,e){return t.minY-e.minY}function Ow(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Jv(t){return t.maxX-t.minX+(t.maxY-t.minY)}function EF(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function bF(t,e){var r=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),a=Math.min(t.maxY,e.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function Dw(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Qv(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function vd(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function uP(t,e,r,n,i){for(var a=[e,r],h;a.length;)r=a.pop(),e=a.pop(),!(r-e<=n)&&(h=e+Math.ceil((r-e)/n/2)*n,xF(t,h,e,r,i),a.push(e,h,h,r))}var TF=Rb.exports;const kb=wa(TF);function SF(t,e,r,n){var i=kb(6),a=e.features.map(function(h){var s;return{minX:h.geometry.coordinates[0],minY:h.geometry.coordinates[1],maxX:h.geometry.coordinates[0],maxY:h.geometry.coordinates[1],property:(s=h.properties)===null||s===void 0?void 0:s[r]}});return i.load(a),t.features.forEach(function(h){h.properties||(h.properties={});var s=Fi(h),g=i.search({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]}),m=[];g.forEach(function(w){ci([w.minX,w.minY],h)&&m.push(w.property)}),h.properties[n]=m}),t}function IF(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.mutate;if(!t)throw new Error("geojson is required");return(r===!1||r===void 0)&&(t=ss(t)),ji(t,function(n){var i=n[0],a=n[1];n[0]=a,n[1]=i}),t}function $f(t,e){e===void 0&&(e={});var r=typeof e=="object"?e.mutate:e;if(!t)throw new Error("geojson is required");var n=Zs(t),i=[];switch(n){case"LineString":i=Nw(t);break;case"MultiLineString":case"Polygon":mr(t).forEach(function(h){i.push(Nw(h))});break;case"MultiPolygon":mr(t).forEach(function(h){var s=[];h.forEach(function(g){s.push(Nw(g))}),i.push(s)});break;case"Point":return t;case"MultiPoint":var a={};mr(t).forEach(function(h){var s=h.join("-");Object.prototype.hasOwnProperty.call(a,s)||(i.push(h),a[s]=!0)});break;default:throw new Error(n+" geometry not supported")}return t.coordinates?r===!0?(t.coordinates=i,t):{type:n,coordinates:i}:r===!0?(t.geometry.coordinates=i,t):fo({type:n,coordinates:i},t.properties,{bbox:t.bbox,id:t.id})}function Nw(t){var e=mr(t);if(e.length===2&&!cP(e[0],e[1]))return e;var r=[],n=e.length-1,i=r.length;r.push(e[0]);for(var a=1;a<n;a++){var h=r[r.length-1];e[a][0]===h[0]&&e[a][1]===h[1]||(r.push(e[a]),i=r.length,i>2&&hP(r[i-3],r[i-1],r[i-2])&&r.splice(r.length-2,1))}if(r.push(e[e.length-1]),i=r.length,cP(e[0],e[e.length-1])&&i<4)throw new Error("invalid polygon");return hP(r[i-3],r[i-1],r[i-2])&&r.splice(r.length-2,1),r}function cP(t,e){return t[0]===e[0]&&t[1]===e[1]}function hP(t,e,r){var n=r[0],i=r[1],a=t[0],h=t[1],s=e[0],g=e[1],m=n-a,w=i-h,b=s-a,I=g-h,A=m*I-w*b;return A!==0?!1:Math.abs(b)>=Math.abs(I)?b>0?a<=n&&n<=s:s<=n&&n<=a:I>0?h<=i&&i<=g:g<=i&&i<=h}function PF(t,e){var r=t.x-e.x,n=t.y-e.y;return r*r+n*n}function CF(t,e,r){var n=e.x,i=e.y,a=r.x-n,h=r.y-i;if(a!==0||h!==0){var s=((t.x-n)*a+(t.y-i)*h)/(a*a+h*h);s>1?(n=r.x,i=r.y):s>0&&(n+=a*s,i+=h*s)}return a=t.x-n,h=t.y-i,a*a+h*h}function AF(t,e){for(var r=t[0],n=[r],i,a=1,h=t.length;a<h;a++)i=t[a],PF(i,r)>e&&(n.push(i),r=i);return r!==i&&n.push(i),n}function bE(t,e,r,n,i){for(var a=n,h,s=e+1;s<r;s++){var g=CF(t[s],t[e],t[r]);g>a&&(h=s,a=g)}a>n&&(h-e>1&&bE(t,e,h,n,i),i.push(t[h]),r-h>1&&bE(t,h,r,n,i))}function MF(t,e){var r=t.length-1,n=[t[0]];return bE(t,0,r,e,n),n.push(t[r]),n}function TE(t,e,r){if(t.length<=2)return t;var n=e!==void 0?e*e:1;return t=r?t:AF(t,n),t=MF(t,n),t}function LF(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.tolerance!==void 0?e.tolerance:1,n=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(r&&r<0)throw new Error("invalid tolerance");return i!==!0&&(t=ss(t)),ma(t,function(a){OF(a,r,n)}),t}function OF(t,e,r){var n=t.type;if(n==="Point"||n==="MultiPoint")return t;$f(t,!0);var i=t.coordinates;switch(n){case"LineString":t.coordinates=fP(i,e,r);break;case"MultiLineString":t.coordinates=i.map(function(a){return fP(a,e,r)});break;case"Polygon":t.coordinates=pP(i,e,r);break;case"MultiPolygon":t.coordinates=i.map(function(a){return pP(a,e,r)})}return t}function fP(t,e,r){return TE(t.map(function(n){return{x:n[0],y:n[1],z:n[2]}}),e,r).map(function(n){return n.z?[n.x,n.y,n.z]:[n.x,n.y]})}function pP(t,e,r){return t.map(function(n){var i=n.map(function(h){return{x:h[0],y:h[1]}});if(i.length<4)throw new Error("invalid polygon");for(var a=TE(i,e,r).map(function(h){return[h.x,h.y]});!DF(a);)e-=e*.01,a=TE(i,e,r).map(function(h){return[h.x,h.y]});return(a[a.length-1][0]!==a[0][0]||a[a.length-1][1]!==a[0][1])&&a.push(a[0]),a})}function DF(t){return t.length<3?!1:!(t.length===3&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}var NF=function(){function t(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(var r=0;r<this.length;r++)this.points[r].z=this.points[r].z||0;for(var r=0;r<this.length-1;r++){var n=this.points[r],i=this.points[r+1];this.centers.push({x:(n.x+i.x)/2,y:(n.y+i.y)/2,z:(n.z+i.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(var r=0;r<this.centers.length-1;r++){var a=this.points[r+1].x-(this.centers[r].x+this.centers[r+1].x)/2,h=this.points[r+1].y-(this.centers[r].y+this.centers[r+1].y)/2,s=this.points[r+1].z-(this.centers[r].y+this.centers[r+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[r+1].x+this.sharpness*(this.centers[r].x+a),y:(1-this.sharpness)*this.points[r+1].y+this.sharpness*(this.centers[r].y+h),z:(1-this.sharpness)*this.points[r+1].z+this.sharpness*(this.centers[r].z+s)},{x:(1-this.sharpness)*this.points[r+1].x+this.sharpness*(this.centers[r+1].x+a),y:(1-this.sharpness)*this.points[r+1].y+this.sharpness*(this.centers[r+1].y+h),z:(1-this.sharpness)*this.points[r+1].z+this.sharpness*(this.centers[r+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return t.prototype.cacheSteps=function(e){var r=[],n=this.pos(0);r.push(0);for(var i=0;i<this.duration;i+=10){var a=this.pos(i),h=Math.sqrt((a.x-n.x)*(a.x-n.x)+(a.y-n.y)*(a.y-n.y)+(a.z-n.z)*(a.z-n.z));h>e&&(r.push(i),n=a)}return r},t.prototype.vector=function(e){var r=this.pos(e+10),n=this.pos(e-10);return{angle:180*Math.atan2(r.y-n.y,r.x-n.x)/3.14,speed:Math.sqrt((n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y)+(n.z-r.z)*(n.z-r.z))}},t.prototype.pos=function(e){var r=e-this.delay;r<0&&(r=0),r>this.duration&&(r=this.duration-1);var n=r/this.duration;if(n>=1)return this.points[this.length-1];var i=Math.floor((this.points.length-1)*n),a=(this.length-1)*n-i;return RF(a,this.points[i],this.controls[i][1],this.controls[i+1][0],this.points[i+1])},t}();function RF(t,e,r,n,i){var a=kF(t),h={x:i.x*a[0]+n.x*a[1]+r.x*a[2]+e.x*a[3],y:i.y*a[0]+n.y*a[1]+r.y*a[2]+e.y*a[3],z:i.z*a[0]+n.z*a[1]+r.z*a[2]+e.z*a[3]};return h}function kF(t){var e=t*t,r=e*t;return[r,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}function dP(t,e){e===void 0&&(e={});for(var r=e.resolution||1e4,n=e.sharpness||.85,i=[],a=hi(t).coordinates.map(function(m){return{x:m[0],y:m[1]}}),h=new NF({duration:r,points:a,sharpness:n}),s=function(m){var w=h.pos(m);Math.floor(m/100)%2===0&&i.push([w.x,w.y])},g=0;g<h.duration;g+=10)s(g);return s(h.duration),Bn(i,e.properties)}function FF(t,e,r,n){return t=ss(t),e=ss(e),kn(t,function(i){i.properties||(i.properties={}),kn(e,function(a){i.properties[n]===void 0&&ci(i,a)&&(i.properties[n]=a.properties[r])})}),t}function zF(t,e){if(!t)throw new Error("featurecollection is required");if(e==null)throw new Error("num is required");if(typeof e!="number")throw new Error("num must be a number");var r=hr(BF(t.features,e));return r}function BF(t,e){for(var r=t.slice(0),n=t.length,i=n-e,a,h;n-- >i;)h=Math.floor((n+1)*Math.random()),a=r[h],r[h]=r[n],r[n]=a;return r.slice(i)}function Fb(t,e){e===void 0&&(e={});var r=Number(t[0]),n=Number(t[1]),i=Number(t[2]),a=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var h=[r,n],s=[r,a],g=[i,a],m=[i,n];return qr([[h,m,g,s,h]],e.properties,{bbox:t,id:e.id})}function VM(t){return Fb(Fi(t))}function jM(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=Rn(t.slice(0,2),[n,r]),h=Rn(t.slice(0,2),[e,i]);if(a>=h){var s=(r+i)/2;return[e,s-(n-e)/2,n,s+(n-e)/2]}else{var g=(e+n)/2;return[g-(i-r)/2,r,g+(i-r)/2,i]}}function zu(t,e,r,n){n===void 0&&(n={});var i=oi(t),a=Ao(i[0]),h=Ao(i[1]),s=Ao(r),g=Vf(e,n.units),m=Math.asin(Math.sin(h)*Math.cos(g)+Math.cos(h)*Math.sin(g)*Math.cos(s)),w=a+Math.atan2(Math.sin(s)*Math.sin(g)*Math.cos(h),Math.cos(g)-Math.sin(h)*Math.sin(m)),b=Sh(w),I=Sh(m);return Gr([b,I],n.properties)}function zb(t,e,r){r===void 0&&(r={});for(var n=r.steps||64,i=r.properties?r.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},a=[],h=0;h<n;h++)a.push(zu(t,e,h*-360/n,r).geometry.coordinates);return a.push(a[0]),qr([a],i)}function bc(t,e,r){if(r===void 0&&(r={}),r.final===!0)return UF(t,e);var n=oi(t),i=oi(e),a=Ao(n[0]),h=Ao(i[0]),s=Ao(n[1]),g=Ao(i[1]),m=Math.sin(h-a)*Math.cos(g),w=Math.cos(s)*Math.sin(g)-Math.sin(s)*Math.cos(g)*Math.cos(h-a);return Sh(Math.atan2(m,w))}function UF(t,e){var r=bc(e,t);return r=(r+180)%360,r}function GF(t,e){var r=Rn(t,e),n=bc(t,e),i=zu(t,r/2,n);return i}function c1(t,e){e===void 0&&(e={});var r=Fi(t),n=(r[0]+r[2])/2,i=(r[1]+r[3])/2;return Gr([n,i],e.properties,e)}function Ih(t,e){e===void 0&&(e={});var r=0,n=0,i=0;return ji(t,function(a){r+=a[0],n+=a[1],i++},!0),Gr([r/i,n/i],e.properties)}function qM(t,e){switch(e===void 0&&(e={}),Zs(t)){case"Point":return Gr(oi(t),e.properties);case"Polygon":var r=[];ji(t,function(j){r.push(j)});var n=Ih(t,{properties:e.properties}),i=n.geometry.coordinates,a=0,h=0,s=0,g,m,w,b,I,A,z,V,H=r.map(function(j){return[j[0]-i[0],j[1]-i[1]]});for(g=0;g<r.length-1;g++)m=H[g],b=m[0],A=m[1],w=H[g+1],I=w[0],z=w[1],V=b*z-I*A,s+=V,a+=(b+I)*V,h+=(A+z)*V;if(s===0)return n;var Z=s*.5,D=1/(6*Z);return Gr([i[0]+D*a,i[1]+D*h],e.properties);default:var k=DM(t);return k?qM(k,{properties:e.properties}):Ih(t,{properties:e.properties})}}function VF(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return kn(t,function(r){var n,i,a,h;switch((h=r.geometry)===null||h===void 0?void 0:h.type){case"Point":e.MultiPoint.coordinates.push(r.geometry.coordinates),e.MultiPoint.properties.push(r.properties);break;case"MultiPoint":(n=e.MultiPoint.coordinates).push.apply(n,r.geometry.coordinates),e.MultiPoint.properties.push(r.properties);break;case"LineString":e.MultiLineString.coordinates.push(r.geometry.coordinates),e.MultiLineString.properties.push(r.properties);break;case"MultiLineString":(i=e.MultiLineString.coordinates).push.apply(i,r.geometry.coordinates),e.MultiLineString.properties.push(r.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(r.geometry.coordinates),e.MultiPolygon.properties.push(r.properties);break;case"MultiPolygon":(a=e.MultiPolygon.coordinates).push.apply(a,r.geometry.coordinates),e.MultiPolygon.properties.push(r.properties);break}}),hr(Object.keys(e).filter(function(r){return e[r].coordinates.length}).sort().map(function(r){var n={type:r,coordinates:e[r].coordinates},i={collectedProperties:e[r].properties};return fo(n,i)}))}function h1(t){var e=[];return t.type==="FeatureCollection"?kn(t,function(r){ji(r,function(n){e.push(Gr(n,r.properties))})}):ji(t,function(r){e.push(Gr(r,t.properties))}),hr(e)}var Bb={exports:{}};Bb.exports=f1;Bb.exports.default=f1;function f1(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length,a=$M(t,0,i,r,!0),h=[];if(!a||a.next===a.prev)return h;var s,g,m,w,b,I,A;if(n&&(a=XF(t,e,a,r)),t.length>80*r){s=m=t[0],g=w=t[1];for(var z=r;z<i;z+=r)b=t[z],I=t[z+1],b<s&&(s=b),I<g&&(g=I),b>m&&(m=b),I>w&&(w=I);A=Math.max(m-s,w-g),A=A!==0?32767/A:0}return My(a,h,r,s,g,A,0),h}function $M(t,e,r,n,i){var a,h;if(i===PE(t,e,r,n)>0)for(a=e;a<r;a+=n)h=gP(a,t[a],t[a+1],h);else for(a=r-n;a>=e;a-=n)h=gP(a,t[a],t[a+1],h);return h&&p1(h,h.next)&&(Oy(h),h=h.next),h}function Zf(t,e){if(!t)return t;e||(e=t);var r=t,n;do if(n=!1,!r.steiner&&(p1(r,r.next)||io(r.prev,r,r.next)===0)){if(Oy(r),r=e=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==e);return e}function My(t,e,r,n,i,a,h){if(t){!h&&a&&JF(t,n,i,a);for(var s=t,g,m;t.prev!==t.next;){if(g=t.prev,m=t.next,a?qF(t,n,i,a):jF(t)){e.push(g.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),Oy(t),t=m.next,s=m.next;continue}if(t=m,t===s){h?h===1?(t=$F(Zf(t),e,r),My(t,e,r,n,i,a,2)):h===2&&ZF(t,e,r,n,i,a):My(Zf(t),e,r,n,i,a,1);break}}}}function jF(t){var e=t.prev,r=t,n=t.next;if(io(e,r,n)>=0)return!1;for(var i=e.x,a=r.x,h=n.x,s=e.y,g=r.y,m=n.y,w=i<a?i<h?i:h:a<h?a:h,b=s<g?s<m?s:m:g<m?g:m,I=i>a?i>h?i:h:a>h?a:h,A=s>g?s>m?s:m:g>m?g:m,z=n.next;z!==e;){if(z.x>=w&&z.x<=I&&z.y>=b&&z.y<=A&&Ed(i,s,a,g,h,m,z.x,z.y)&&io(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function qF(t,e,r,n){var i=t.prev,a=t,h=t.next;if(io(i,a,h)>=0)return!1;for(var s=i.x,g=a.x,m=h.x,w=i.y,b=a.y,I=h.y,A=s<g?s<m?s:m:g<m?g:m,z=w<b?w<I?w:I:b<I?b:I,V=s>g?s>m?s:m:g>m?g:m,H=w>b?w>I?w:I:b>I?b:I,Z=SE(A,z,e,r,n),D=SE(V,H,e,r,n),k=t.prevZ,j=t.nextZ;k&&k.z>=Z&&j&&j.z<=D;){if(k.x>=A&&k.x<=V&&k.y>=z&&k.y<=H&&k!==i&&k!==h&&Ed(s,w,g,b,m,I,k.x,k.y)&&io(k.prev,k,k.next)>=0||(k=k.prevZ,j.x>=A&&j.x<=V&&j.y>=z&&j.y<=H&&j!==i&&j!==h&&Ed(s,w,g,b,m,I,j.x,j.y)&&io(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;k&&k.z>=Z;){if(k.x>=A&&k.x<=V&&k.y>=z&&k.y<=H&&k!==i&&k!==h&&Ed(s,w,g,b,m,I,k.x,k.y)&&io(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;j&&j.z<=D;){if(j.x>=A&&j.x<=V&&j.y>=z&&j.y<=H&&j!==i&&j!==h&&Ed(s,w,g,b,m,I,j.x,j.y)&&io(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function $F(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!p1(i,a)&&ZM(i,n,n.next,a)&&Ly(i,a)&&Ly(a,i)&&(e.push(i.i/r|0),e.push(n.i/r|0),e.push(a.i/r|0),Oy(n),Oy(n.next),n=t=a),n=n.next}while(n!==t);return Zf(n)}function ZF(t,e,r,n,i,a){var h=t;do{for(var s=h.next.next;s!==h.prev;){if(h.i!==s.i&&tz(h,s)){var g=XM(h,s);h=Zf(h,h.next),g=Zf(g,g.next),My(h,e,r,n,i,a,0),My(g,e,r,n,i,a,0);return}s=s.next}h=h.next}while(h!==t)}function XF(t,e,r,n){var i=[],a,h,s,g,m;for(a=0,h=e.length;a<h;a++)s=e[a]*n,g=a<h-1?e[a+1]*n:t.length,m=$M(t,s,g,n,!1),m===m.next&&(m.steiner=!0),i.push(ez(m));for(i.sort(WF),a=0;a<i.length;a++)r=HF(i[a],r);return r}function WF(t,e){return t.x-e.x}function HF(t,e){var r=KF(t,e);if(!r)return e;var n=XM(r,t);return Zf(n,n.next),Zf(r,r.next)}function KF(t,e){var r=e,n=t.x,i=t.y,a=-1/0,h;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a&&(a=s,h=r.x<r.next.x?r:r.next,s===n))return h}r=r.next}while(r!==e);if(!h)return null;var g=h,m=h.x,w=h.y,b=1/0,I;r=h;do n>=r.x&&r.x>=m&&n!==r.x&&Ed(i<w?n:a,i,m,w,i<w?a:n,i,r.x,r.y)&&(I=Math.abs(i-r.y)/(n-r.x),Ly(r,t)&&(I<b||I===b&&(r.x>h.x||r.x===h.x&&YF(h,r)))&&(h=r,b=I)),r=r.next;while(r!==g);return h}function YF(t,e){return io(t.prev,t,e.prev)<0&&io(e.next,t,t.next)<0}function JF(t,e,r,n){var i=t;do i.z===0&&(i.z=SE(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,QF(i)}function QF(t){var e,r,n,i,a,h,s,g,m=1;do{for(r=t,t=null,a=null,h=0;r;){for(h++,n=r,s=0,e=0;e<m&&(s++,n=n.nextZ,!!n);e++);for(g=m;s>0||g>0&&n;)s!==0&&(g===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,g--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,m*=2}while(h>1);return t}function SE(t,e,r,n,i){return t=(t-r)*i|0,e=(e-n)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function ez(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Ed(t,e,r,n,i,a,h,s){return(i-h)*(e-s)>=(t-h)*(a-s)&&(t-h)*(n-s)>=(r-h)*(e-s)&&(r-h)*(a-s)>=(i-h)*(n-s)}function tz(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!rz(t,e)&&(Ly(t,e)&&Ly(e,t)&&nz(t,e)&&(io(t.prev,t,e.prev)||io(t,e.prev,e))||p1(t,e)&&io(t.prev,t,t.next)>0&&io(e.prev,e,e.next)>0)}function io(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function p1(t,e){return t.x===e.x&&t.y===e.y}function ZM(t,e,r,n){var i=t0(io(t,e,r)),a=t0(io(t,e,n)),h=t0(io(r,n,t)),s=t0(io(r,n,e));return!!(i!==a&&h!==s||i===0&&e0(t,r,e)||a===0&&e0(t,n,e)||h===0&&e0(r,t,n)||s===0&&e0(r,e,n))}function e0(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function t0(t){return t>0?1:t<0?-1:0}function rz(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ZM(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ly(t,e){return io(t.prev,t,t.next)<0?io(t,e,t.next)>=0&&io(t,t.prev,e)>=0:io(t,e,t.prev)<0||io(t,t.next,e)<0}function nz(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function XM(t,e){var r=new IE(t.i,t.x,t.y),n=new IE(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function gP(t,e,r,n){var i=new IE(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Oy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function IE(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}f1.deviation=function(t,e,r,n){var i=e&&e.length,a=i?e[0]*r:t.length,h=Math.abs(PE(t,0,a,r));if(i)for(var s=0,g=e.length;s<g;s++){var m=e[s]*r,w=s<g-1?e[s+1]*r:t.length;h-=Math.abs(PE(t,m,w,r))}var b=0;for(s=0;s<n.length;s+=3){var I=n[s]*r,A=n[s+1]*r,z=n[s+2]*r;b+=Math.abs((t[I]-t[z])*(t[A+1]-t[I+1])-(t[I]-t[A])*(t[z+1]-t[I+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)};function PE(t,e,r,n){for(var i=0,a=e,h=r-n;a<r;a+=n)i+=(t[h]-t[a])*(t[a+1]+t[h+1]),h=a;return i}f1.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var h=0;h<e;h++)r.vertices.push(t[i][a][h]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var iz=Bb.exports;const oz=wa(iz);function sz(t){if(!t.geometry||t.geometry.type!=="Polygon"&&t.geometry.type!=="MultiPolygon")throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return t.geometry.type==="Polygon"?e.features=mP(t.geometry.coordinates):t.geometry.coordinates.forEach(function(r){e.features=e.features.concat(mP(r))}),e}function mP(t){var e=az(t),r=2,n=oz(e.vertices,e.holes,r),i=[],a=[];n.forEach(function(g,m){var w=n[m];a.push([e.vertices[w*r],e.vertices[w*r+1]])});for(var h=0;h<a.length;h+=3){var s=a.slice(h,h+3);s.push(a[h]),i.push(qr([s]))}return i}function az(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var h=0;h<e;h++)r.vertices.push(t[i][a][h]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}function C0(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var r,n=1/0,i=0;return kn(e,function(a,h){var s=Rn(t,a);s<n&&(i=h,n=s)}),r=ss(e.features[i]),r.properties.featureIndex=i,r.properties.distanceToPoint=n,r}function Xf(t){if(!t)throw new Error("geojson is required");var e=[];return jo(t,function(r){lz(r,e)}),hr(e)}function lz(t,e){var r=[],n=t.geometry;if(n!==null){switch(n.type){case"Polygon":r=mr(n);break;case"LineString":r=[mr(n)]}r.forEach(function(i){var a=uz(i,t.properties);a.forEach(function(h){h.id=e.length,e.push(h)})})}}function uz(t,e){var r=[];return t.reduce(function(n,i){var a=Bn([n,i],e);return a.bbox=cz(n,i),r.push(a),i}),r}function cz(t,e){var r=t[0],n=t[1],i=e[0],a=e[1],h=r<i?r:i,s=n<a?n:a,g=r>i?r:i,m=n>a?n:a;return[h,s,g,m]}var Ub={exports:{}},WM={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(e_,function(){function r(D,k,j,Y,ie){(function ne(ae,W,$e,Oe,ze){for(;Oe>$e;){if(Oe-$e>600){var We=Oe-$e+1,Ze=W-$e+1,Pt=Math.log(We),at=.5*Math.exp(2*Pt/3),St=.5*Math.sqrt(Pt*at*(We-at)/We)*(Ze-We/2<0?-1:1),et=Math.max($e,Math.floor(W-Ze*at/We+St)),zt=Math.min(Oe,Math.floor(W+(We-Ze)*at/We+St));ne(ae,W,et,zt,ze)}var mt=ae[W],bt=$e,It=Oe;for(n(ae,$e,W),ze(ae[Oe],mt)>0&&n(ae,$e,Oe);bt<It;){for(n(ae,bt,It),bt++,It--;ze(ae[bt],mt)<0;)bt++;for(;ze(ae[It],mt)>0;)It--}ze(ae[$e],mt)===0?n(ae,$e,It):n(ae,++It,Oe),It<=W&&($e=It+1),W<=It&&(Oe=It-1)}})(D,k,j||0,Y||D.length-1,ie||i)}function n(D,k,j){var Y=D[k];D[k]=D[j],D[j]=Y}function i(D,k){return D<k?-1:D>k?1:0}var a=function(D){D===void 0&&(D=9),this._maxEntries=Math.max(4,D),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function h(D,k,j){if(!j)return k.indexOf(D);for(var Y=0;Y<k.length;Y++)if(j(D,k[Y]))return Y;return-1}function s(D,k){g(D,0,D.children.length,k,D)}function g(D,k,j,Y,ie){ie||(ie=H(null)),ie.minX=1/0,ie.minY=1/0,ie.maxX=-1/0,ie.maxY=-1/0;for(var ne=k;ne<j;ne++){var ae=D.children[ne];m(ie,D.leaf?Y(ae):ae)}return ie}function m(D,k){return D.minX=Math.min(D.minX,k.minX),D.minY=Math.min(D.minY,k.minY),D.maxX=Math.max(D.maxX,k.maxX),D.maxY=Math.max(D.maxY,k.maxY),D}function w(D,k){return D.minX-k.minX}function b(D,k){return D.minY-k.minY}function I(D){return(D.maxX-D.minX)*(D.maxY-D.minY)}function A(D){return D.maxX-D.minX+(D.maxY-D.minY)}function z(D,k){return D.minX<=k.minX&&D.minY<=k.minY&&k.maxX<=D.maxX&&k.maxY<=D.maxY}function V(D,k){return k.minX<=D.maxX&&k.minY<=D.maxY&&k.maxX>=D.minX&&k.maxY>=D.minY}function H(D){return{children:D,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Z(D,k,j,Y,ie){for(var ne=[k,j];ne.length;)if(!((j=ne.pop())-(k=ne.pop())<=Y)){var ae=k+Math.ceil((j-k)/Y/2)*Y;r(D,ae,k,j,ie),ne.push(k,ae,ae,j)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(D){var k=this.data,j=[];if(!V(D,k))return j;for(var Y=this.toBBox,ie=[];k;){for(var ne=0;ne<k.children.length;ne++){var ae=k.children[ne],W=k.leaf?Y(ae):ae;V(D,W)&&(k.leaf?j.push(ae):z(D,W)?this._all(ae,j):ie.push(ae))}k=ie.pop()}return j},a.prototype.collides=function(D){var k=this.data;if(!V(D,k))return!1;for(var j=[];k;){for(var Y=0;Y<k.children.length;Y++){var ie=k.children[Y],ne=k.leaf?this.toBBox(ie):ie;if(V(D,ne)){if(k.leaf||z(D,ne))return!0;j.push(ie)}}k=j.pop()}return!1},a.prototype.load=function(D){if(!D||!D.length)return this;if(D.length<this._minEntries){for(var k=0;k<D.length;k++)this.insert(D[k]);return this}var j=this._build(D.slice(),0,D.length-1,0);if(this.data.children.length)if(this.data.height===j.height)this._splitRoot(this.data,j);else{if(this.data.height<j.height){var Y=this.data;this.data=j,j=Y}this._insert(j,this.data.height-j.height-1,!0)}else this.data=j;return this},a.prototype.insert=function(D){return D&&this._insert(D,this.data.height-1),this},a.prototype.clear=function(){return this.data=H([]),this},a.prototype.remove=function(D,k){if(!D)return this;for(var j,Y,ie,ne=this.data,ae=this.toBBox(D),W=[],$e=[];ne||W.length;){if(ne||(ne=W.pop(),Y=W[W.length-1],j=$e.pop(),ie=!0),ne.leaf){var Oe=h(D,ne.children,k);if(Oe!==-1)return ne.children.splice(Oe,1),W.push(ne),this._condense(W),this}ie||ne.leaf||!z(ne,ae)?Y?(j++,ne=Y.children[j],ie=!1):ne=null:(W.push(ne),$e.push(j),j=0,Y=ne,ne=ne.children[0])}return this},a.prototype.toBBox=function(D){return D},a.prototype.compareMinX=function(D,k){return D.minX-k.minX},a.prototype.compareMinY=function(D,k){return D.minY-k.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(D){return this.data=D,this},a.prototype._all=function(D,k){for(var j=[];D;)D.leaf?k.push.apply(k,D.children):j.push.apply(j,D.children),D=j.pop();return k},a.prototype._build=function(D,k,j,Y){var ie,ne=j-k+1,ae=this._maxEntries;if(ne<=ae)return s(ie=H(D.slice(k,j+1)),this.toBBox),ie;Y||(Y=Math.ceil(Math.log(ne)/Math.log(ae)),ae=Math.ceil(ne/Math.pow(ae,Y-1))),(ie=H([])).leaf=!1,ie.height=Y;var W=Math.ceil(ne/ae),$e=W*Math.ceil(Math.sqrt(ae));Z(D,k,j,$e,this.compareMinX);for(var Oe=k;Oe<=j;Oe+=$e){var ze=Math.min(Oe+$e-1,j);Z(D,Oe,ze,W,this.compareMinY);for(var We=Oe;We<=ze;We+=W){var Ze=Math.min(We+W-1,ze);ie.children.push(this._build(D,We,Ze,Y-1))}}return s(ie,this.toBBox),ie},a.prototype._chooseSubtree=function(D,k,j,Y){for(;Y.push(k),!k.leaf&&Y.length-1!==j;){for(var ie=1/0,ne=1/0,ae=void 0,W=0;W<k.children.length;W++){var $e=k.children[W],Oe=I($e),ze=(We=D,Ze=$e,(Math.max(Ze.maxX,We.maxX)-Math.min(Ze.minX,We.minX))*(Math.max(Ze.maxY,We.maxY)-Math.min(Ze.minY,We.minY))-Oe);ze<ne?(ne=ze,ie=Oe<ie?Oe:ie,ae=$e):ze===ne&&Oe<ie&&(ie=Oe,ae=$e)}k=ae||k.children[0]}var We,Ze;return k},a.prototype._insert=function(D,k,j){var Y=j?D:this.toBBox(D),ie=[],ne=this._chooseSubtree(Y,this.data,k,ie);for(ne.children.push(D),m(ne,Y);k>=0&&ie[k].children.length>this._maxEntries;)this._split(ie,k),k--;this._adjustParentBBoxes(Y,ie,k)},a.prototype._split=function(D,k){var j=D[k],Y=j.children.length,ie=this._minEntries;this._chooseSplitAxis(j,ie,Y);var ne=this._chooseSplitIndex(j,ie,Y),ae=H(j.children.splice(ne,j.children.length-ne));ae.height=j.height,ae.leaf=j.leaf,s(j,this.toBBox),s(ae,this.toBBox),k?D[k-1].children.push(ae):this._splitRoot(j,ae)},a.prototype._splitRoot=function(D,k){this.data=H([D,k]),this.data.height=D.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(D,k,j){for(var Y,ie,ne,ae,W,$e,Oe,ze=1/0,We=1/0,Ze=k;Ze<=j-k;Ze++){var Pt=g(D,0,Ze,this.toBBox),at=g(D,Ze,j,this.toBBox),St=(ie=Pt,ne=at,ae=void 0,W=void 0,$e=void 0,Oe=void 0,ae=Math.max(ie.minX,ne.minX),W=Math.max(ie.minY,ne.minY),$e=Math.min(ie.maxX,ne.maxX),Oe=Math.min(ie.maxY,ne.maxY),Math.max(0,$e-ae)*Math.max(0,Oe-W)),et=I(Pt)+I(at);St<ze?(ze=St,Y=Ze,We=et<We?et:We):St===ze&&et<We&&(We=et,Y=Ze)}return Y||j-k},a.prototype._chooseSplitAxis=function(D,k,j){var Y=D.leaf?this.compareMinX:w,ie=D.leaf?this.compareMinY:b;this._allDistMargin(D,k,j,Y)<this._allDistMargin(D,k,j,ie)&&D.children.sort(Y)},a.prototype._allDistMargin=function(D,k,j,Y){D.children.sort(Y);for(var ie=this.toBBox,ne=g(D,0,k,ie),ae=g(D,j-k,j,ie),W=A(ne)+A(ae),$e=k;$e<j-k;$e++){var Oe=D.children[$e];m(ne,D.leaf?ie(Oe):Oe),W+=A(ne)}for(var ze=j-k-1;ze>=k;ze--){var We=D.children[ze];m(ae,D.leaf?ie(We):We),W+=A(ae)}return W},a.prototype._adjustParentBBoxes=function(D,k,j){for(var Y=j;Y>=0;Y--)m(k[Y],D)},a.prototype._condense=function(D){for(var k=D.length-1,j=void 0;k>=0;k--)D[k].children.length===0?k>0?(j=D[k-1].children).splice(j.indexOf(D[k]),1):this.clear():s(D[k],this.toBBox)},a})})(WM);var hz=WM.exports;const fz=s1(wM),pz=s1(IM),dz=s1(rk);var Iu=hz,HM=fz,KM=pz,dd=dz.default,gz=KM.featureEach;KM.coordEach;HM.polygon;var yP=HM.featureCollection;function YM(t){var e=new Iu(t);return e.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:dd(r),Iu.prototype.insert.call(this,r)},e.load=function(r){var n=[];return Array.isArray(r)?r.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dd(i),n.push(i)}):gz(r,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dd(i),n.push(i)}),Iu.prototype.load.call(this,n)},e.remove=function(r,n){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:dd(r),Iu.prototype.remove.call(this,r,n)},e.clear=function(){return Iu.prototype.clear.call(this)},e.search=function(r){var n=Iu.prototype.search.call(this,this.toBBox(r));return yP(n)},e.collides=function(r){return Iu.prototype.collides.call(this,this.toBBox(r))},e.all=function(){var r=Iu.prototype.all.call(this);return yP(r)},e.toJSON=function(){return Iu.prototype.toJSON.call(this)},e.fromJSON=function(r){return Iu.prototype.fromJSON.call(this,r)},e.toBBox=function(r){var n;if(r.bbox)n=r.bbox;else if(Array.isArray(r)&&r.length===4)n=r;else if(Array.isArray(r)&&r.length===6)n=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")n=dd(r);else if(r.type==="FeatureCollection")n=dd(r);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ub.exports=YM;Ub.exports.default=YM;var mz=Ub.exports;const d1=wa(mz);function Rc(t,e){var r={},n=[];if(t.type==="LineString"&&(t=fo(t)),e.type==="LineString"&&(e=fo(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=_P(t,e);return i&&n.push(i),hr(n)}var a=d1();return a.load(Xf(e)),kn(Xf(t),function(h){kn(a.search(h),function(s){var g=_P(h,s);if(g){var m=mr(g).join(",");r[m]||(r[m]=!0,n.push(g))}})}),hr(n)}function _P(t,e){var r=mr(t),n=mr(e);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],a=r[0][1],h=r[1][0],s=r[1][1],g=n[0][0],m=n[0][1],w=n[1][0],b=n[1][1],I=(b-m)*(h-i)-(w-g)*(s-a),A=(w-g)*(a-m)-(b-m)*(i-g),z=(h-i)*(a-m)-(s-a)*(i-g);if(I===0)return null;var V=A/I,H=z/I;if(V>=0&&V<=1&&H>=0&&H<=1){var Z=i+V*(h-i),D=a+V*(s-a);return Gr([Z,D])}return null}function mc(t,e,r){r===void 0&&(r={});var n=Gr([1/0,1/0],{dist:1/0}),i=0;return jo(t,function(a){for(var h=mr(a),s=0;s<h.length-1;s++){var g=Gr(h[s]);g.properties.dist=Rn(e,g,r);var m=Gr(h[s+1]);m.properties.dist=Rn(e,m,r);var w=Rn(g,m,r),b=Math.max(g.properties.dist,m.properties.dist),I=bc(g,m),A=zu(e,b,I+90,r),z=zu(e,b,I-90,r),V=Rc(Bn([A.geometry.coordinates,z.geometry.coordinates]),Bn([g.geometry.coordinates,m.geometry.coordinates])),H=null;V.features.length>0&&(H=V.features[0],H.properties.dist=Rn(e,H,r),H.properties.location=i+Rn(g,H,r)),g.properties.dist<n.properties.dist&&(n=g,n.properties.index=s,n.properties.location=i),m.properties.dist<n.properties.dist&&(n=m,n.properties.index=s+1,n.properties.location=i+w),H&&H.properties.dist<n.properties.dist&&(n=H,n.properties.index=s),i+=w}}),n}function g1(t,e,r){r===void 0&&(r={});var n=oi(t),i=oi(e);i[0]+=i[0]-n[0]>180?-360:n[0]-i[0]>180?360:0;var a=yz(n,i),h=qf(a,"meters",r.units);return h}function yz(t,e,r){r=r===void 0?Io:Number(r);var n=r,i=t[1]*Math.PI/180,a=e[1]*Math.PI/180,h=a-i,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var g=Math.log(Math.tan(a/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),m=Math.abs(g)>1e-11?h/g:Math.cos(i),w=Math.sqrt(h*h+m*m*s*s),b=w*n;return b}function JM(t,e,r){if(r===void 0&&(r={}),r.method||(r.method="geodesic"),r.units||(r.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=Gr(t):t.type==="Point"?t=fo(t):Cy(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=Bn(e):e.type==="LineString"?e=fo(e):Cy(e,"LineString","line");var n=1/0,i=t.geometry.coordinates;return gc(e,function(a){var h=a.geometry.coordinates[0],s=a.geometry.coordinates[1],g=_z(i,h,s,r);g<n&&(n=g)}),qf(n,"degrees",r.units)}function _z(t,e,r,n){var i=[r[0]-e[0],r[1]-e[1]],a=[t[0]-e[0],t[1]-e[1]],h=vP(a,i);if(h<=0)return Rw(t,e,{method:n.method,units:"degrees"});var s=vP(i,i);if(s<=h)return Rw(t,r,{method:n.method,units:"degrees"});var g=h/s,m=[e[0]+g*i[0],e[1]+g*i[1]];return Rw(t,m,{method:n.method,units:"degrees"})}function vP(t,e){return t[0]*e[0]+t[1]*e[1]}function Rw(t,e,r){return r.method==="planar"?g1(t,e,r):Rn(t,e,r)}function vz(t,e,r){r===void 0&&(r={});var n=r.units,i=r.properties||{},a=xz(t);if(!a.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if(Zs(e)!=="LineString")throw new Error("line must be a LineString");var h=1/0,s=null;return kn(a,function(g){var m=JM(g,e,{units:n});m<h&&(h=m,s=g)}),s&&(s.properties=Mb({dist:h},s.properties,i)),s}function xz(t){var e=[],r=t.geometry?t.geometry.type:t.type;switch(r){case"GeometryCollection":return ma(t,function(n){n.type==="Point"&&e.push({type:"Feature",properties:{},geometry:n})}),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter(function(n){return n.geometry.type==="Point"}),t;default:throw new Error("points must be a Point Collection")}}function wz(t,e){var r=oi(t),n=hi(e),i=n.coordinates,a=i[0];if(a.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var h=e.properties||{},s=h.a,g=h.b,m=h.c,w=r[0],b=r[1],I=a[0][0],A=a[0][1],z=s!==void 0?s:a[0][2],V=a[1][0],H=a[1][1],Z=g!==void 0?g:a[1][2],D=a[2][0],k=a[2][1],j=m!==void 0?m:a[2][2],Y=(j*(w-I)*(b-H)+z*(w-V)*(b-k)+Z*(w-D)*(b-A)-Z*(w-I)*(b-k)-j*(w-V)*(b-A)-z*(w-D)*(b-H))/((w-I)*(b-H)+(w-V)*(b-k)+(w-D)*(b-A)-(w-I)*(b-k)-(w-V)*(b-A)-(w-D)*(b-H));return Y}function Ez(t){var e,r,n={type:"FeatureCollection",features:[]};if(t.type==="Feature"?r=t.geometry:r=t,r.type==="LineString")e=[r.coordinates];else if(r.type==="MultiLineString")e=r.coordinates;else if(r.type==="MultiPolygon")e=[].concat.apply([],r.coordinates);else if(r.type==="Polygon")e=r.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return e.forEach(function(i){e.forEach(function(a){for(var h=0;h<i.length-1;h++)for(var s=h;s<a.length-1;s++)if(!(i===a&&(Math.abs(h-s)===1||h===0&&s===i.length-2&&i[h][0]===i[i.length-1][0]&&i[h][1]===i[i.length-1][1]))){var g=bz(i[h][0],i[h][1],i[h+1][0],i[h+1][1],a[s][0],a[s][1],a[s+1][0],a[s+1][1]);g&&n.features.push(Gr([g[0],g[1]]))}})}),n}function bz(t,e,r,n,i,a,h,s){var g,m,w,b,I,A={x:null,y:null,onLine1:!1,onLine2:!1};return g=(s-a)*(r-t)-(h-i)*(n-e),g===0?A.x!==null&&A.y!==null?A:!1:(m=e-a,w=t-i,b=(h-i)*m-(s-a)*w,I=(r-t)*m-(n-e)*w,m=b/g,w=I/g,A.x=t+m*(r-t),A.y=e+m*(n-e),m>=0&&m<=1&&(A.onLine1=!0),w>=0&&w<=1&&(A.onLine2=!0),A.onLine1&&A.onLine2?[A.x,A.y]:!1)}function xP(t){for(var e=Tz(t),r=c1(e),n=!1,i=0;!n&&i<e.features.length;){var a=e.features[i].geometry,h,s,g,m,w,b,I,A=!1;if(a.type==="Point")r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(n=!0);else if(a.type==="MultiPoint"){var z=!1;for(I=0;!z&&I<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[I][0]&&r.geometry.coordinates[1]===a.coordinates[I][1]&&(n=!0,z=!0),I++}else if(a.type==="LineString")for(I=0;!A&&I<a.coordinates.length-1;)h=r.geometry.coordinates[0],s=r.geometry.coordinates[1],g=a.coordinates[I][0],m=a.coordinates[I][1],w=a.coordinates[I+1][0],b=a.coordinates[I+1][1],wP(h,s,g,m,w,b)&&(A=!0,n=!0),I++;else if(a.type==="MultiLineString")for(var V=0;V<a.coordinates.length;){A=!1,I=0;for(var H=a.coordinates[V];!A&&I<H.length-1;)h=r.geometry.coordinates[0],s=r.geometry.coordinates[1],g=H[I][0],m=H[I][1],w=H[I+1][0],b=H[I+1][1],wP(h,s,g,m,w,b)&&(A=!0,n=!0),I++;V++}else(a.type==="Polygon"||a.type==="MultiPolygon")&&ci(r,a)&&(n=!0);i++}if(n)return r;var Z=hr([]);for(i=0;i<e.features.length;i++)Z.features=Z.features.concat(h1(e.features[i]).features);return Gr(C0(r,Z).geometry.coordinates)}function Tz(t){return t.type!=="FeatureCollection"?t.type!=="Feature"?hr([fo(t)]):hr([t]):t}function wP(t,e,r,n,i,a){var h=Math.sqrt((i-r)*(i-r)+(a-n)*(a-n)),s=Math.sqrt((t-r)*(t-r)+(e-n)*(e-n)),g=Math.sqrt((i-t)*(i-t)+(a-e)*(a-e));return h===s+g}var EP=6378137;function Gb(t){return Sb(t,function(e,r){return e+Sz(r)},0)}function Sz(t){var e=0,r;switch(t.type){case"Polygon":return bP(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)e+=bP(t.coordinates[r]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function bP(t){var e=0;if(t&&t.length>0){e+=Math.abs(TP(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(TP(t[r]))}return e}function TP(t){var e,r,n,i,a,h,s,g=0,m=t.length;if(m>2){for(s=0;s<m;s++)s===m-2?(i=m-2,a=m-1,h=0):s===m-1?(i=m-1,a=0,h=1):(i=s,a=s+1,h=s+2),e=t[i],r=t[a],n=t[h],g+=(kw(n[0])-kw(e[0]))*Math.sin(kw(r[1]));g=g*EP*EP/2}return g}function kw(t){return t*Math.PI/180}function Iz(t,e,r){r===void 0&&(r={});for(var n=hi(t),i=n.coordinates,a=0,h=0;h<i.length&&!(e>=a&&h===i.length-1);h++)if(a>=e){var s=e-a;if(s){var g=bc(i[h],i[h-1])-180,m=zu(i[h],s,g,r);return m}else return Gr(i[h])}else a+=Rn(i[h],i[h+1],r);return Gr(i[i.length-1])}function CE(t,e){return e===void 0&&(e={}),Ib(t,function(r,n){var i=n.geometry.coordinates;return r+Rn(i[0],i[1],e)},0)}function Pz(t,e,r){var n=mr(r);if(Zs(r)!=="LineString")throw new Error("line must be a LineString");var i=mc(r,t),a=mc(r,e),h;i.properties.index<=a.properties.index?h=[i,a]:h=[a,i];for(var s=[h[0].geometry.coordinates],g=h[0].properties.index+1;g<h[1].properties.index+1;g++)s.push(n[g]);return s.push(h[1].geometry.coordinates),Bn(s,r.properties)}function QM(t,e,r,n){if(n=n||{},!Vn(n))throw new Error("options is invalid");var i,a=[];if(t.type==="Feature")i=t.geometry.coordinates;else if(t.type==="LineString")i=t.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var h=i.length,s=0,g,m,w,b=0;b<i.length&&!(e>=s&&b===i.length-1);b++){if(s>e&&a.length===0){if(g=e-s,!g)return a.push(i[b]),Bn(a);m=bc(i[b],i[b-1])-180,w=zu(i[b],g,m,n),a.push(w.geometry.coordinates)}if(s>=r)return g=r-s,g?(m=bc(i[b],i[b-1])-180,w=zu(i[b],g,m,n),a.push(w.geometry.coordinates),Bn(a)):(a.push(i[b]),Bn(a));if(s>=e&&a.push(i[b]),b===i.length-1)return Bn(a);s+=Rn(i[b],i[b+1],n)}if(s<e&&i.length===h)throw new Error("Start position is beyond line");var I=i[i.length-1];return Bn([I,I])}function ca(t,e,r){r===void 0&&(r={});for(var n=oi(t),i=mr(e),a=0;a<i.length-1;a++){var h=!1;if(r.ignoreEndVertices&&(a===0&&(h="start"),a===i.length-2&&(h="end"),a===0&&a+1===i.length-1&&(h="both")),Cz(i[a],i[a+1],n,h,typeof r.epsilon>"u"?null:r.epsilon))return!0}return!1}function Cz(t,e,r,n,i){var a=r[0],h=r[1],s=t[0],g=t[1],m=e[0],w=e[1],b=r[0]-s,I=r[1]-g,A=m-s,z=w-g,V=b*z-I*A;if(i!==null){if(Math.abs(V)>i)return!1}else if(V!==0)return!1;if(n){if(n==="start")return Math.abs(A)>=Math.abs(z)?A>0?s<a&&a<=m:m<=a&&a<s:z>0?g<h&&h<=w:w<=h&&h<g;if(n==="end")return Math.abs(A)>=Math.abs(z)?A>0?s<=a&&a<m:m<a&&a<=s:z>0?g<=h&&h<w:w<h&&h<=g;if(n==="both")return Math.abs(A)>=Math.abs(z)?A>0?s<a&&a<m:m<a&&a<s:z>0?g<h&&h<w:w<h&&h<g}else return Math.abs(A)>=Math.abs(z)?A>0?s<=a&&a<=m:m<=a&&a<=s:z>0?g<=h&&h<=w:w<=h&&h<=g;return!1}function eL(t,e){var r=hi(t),n=hi(e),i=r.type,a=n.type;switch(i){case"Point":switch(a){case"MultiPoint":return Az(r,n);case"LineString":return ca(r,n,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return ci(r,n,{ignoreBoundary:!0});default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"MultiPoint":return Mz(r,n);case"LineString":return Lz(r,n);case"Polygon":case"MultiPolygon":return Oz(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"LineString":return Dz(r,n);case"Polygon":case"MultiPolygon":return Nz(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Polygon":case"MultiPolygon":return Rz(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function Az(t,e){var r,n=!1;for(r=0;r<e.coordinates.length;r++)if(rL(e.coordinates[r],t.coordinates)){n=!0;break}return n}function Mz(t,e){for(var r=0;r<t.coordinates.length;r++){for(var n=!1,i=0;i<e.coordinates.length;i++)rL(t.coordinates[r],e.coordinates[i])&&(n=!0);if(!n)return!1}return!0}function Lz(t,e){for(var r=!1,n=0;n<t.coordinates.length;n++){if(!ca(t.coordinates[n],e))return!1;r||(r=ca(t.coordinates[n],e,{ignoreEndVertices:!0}))}return r}function Oz(t,e){for(var r=!0,n=!1,i=0;i<t.coordinates.length;i++){if(n=ci(t.coordinates[1],e),!n){r=!1;break}n=ci(t.coordinates[1],e,{ignoreBoundary:!0})}return r&&n}function Dz(t,e){for(var r=0;r<t.coordinates.length;r++)if(!ca(t.coordinates[r],e))return!1;return!0}function Nz(t,e){var r=Fi(e),n=Fi(t);if(!tL(r,n))return!1;for(var i=!1,a=0;a<t.coordinates.length-1;a++){if(!ci(t.coordinates[a],e))return!1;if(i||(i=ci(t.coordinates[a],e,{ignoreBoundary:!0})),!i){var h=kz(t.coordinates[a],t.coordinates[a+1]);i=ci(h,e,{ignoreBoundary:!0})}}return i}function Rz(t,e){var r=Fi(t),n=Fi(e);if(!tL(n,r))return!1;for(var i=0;i<t.coordinates[0].length;i++)if(!ci(t.coordinates[0][i],e))return!1;return!0}function tL(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function rL(t,e){return t[0]===e[0]&&t[1]===e[1]}function kz(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function nL(t,e,r){r===void 0&&(r={}),r.mask&&!r.units&&(r.units="kilometers");for(var n=[],i=t[0],a=t[1],h=t[2],s=t[3],g=e/Rn([i,a],[h,a],r),m=g*(h-i),w=e/Rn([i,a],[i,s],r),b=w*(s-a),I=h-i,A=s-a,z=Math.floor(I/m),V=Math.floor(A/b),H=(I-z*m)/2,Z=(A-V*b)/2,D=i+H;D<=h;){for(var k=a+Z;k<=s;){var j=Gr([D,k],r.properties);r.mask?eL(j,r.mask)&&n.push(j):n.push(j),k+=b}D+=m}return hr(n)}function iL(t,e){e===void 0&&(e={});var r=e.precision,n=e.coordinates,i=e.mutate;if(r=r==null||isNaN(r)?6:r,n=n==null||isNaN(n)?3:n,!t)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(t=JSON.parse(JSON.stringify(t)));var a=Math.pow(10,r);return ji(t,function(h){Fz(h,a,n)}),t}function Fz(t,e,r){t.length>r&&t.splice(r,t.length);for(var n=0;n<t.length;n++)t[n]=Math.round(t[n]*e)/e;return t}function AE(t){if(!t)throw new Error("geojson is required");var e=[];return jo(t,function(r){e.push(r)}),hr(e)}function zz(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.units,i=r.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var a=[];return jo(t,function(h){i&&(h.geometry.coordinates=h.geometry.coordinates.reverse()),Bz(h,e,n,function(s){a.push(s)})}),hr(a)}function Bz(t,e,r,n){var i=CE(t,{units:r});if(i<=e)return n(t);var a=i/e;Number.isInteger(a)||(a=Math.floor(a)+1);for(var h=0;h<a;h++){var s=QM(t,e*h,e*(h+1),{units:r});n(s,h)}}function Uz(t,e,r){if(t.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");r===void 0&&(r=1);var n=t.geometry.coordinates,i=[],a={};if(r){for(var h=[],s=0;s<n.length;s++)for(var g=0;g<n[s].length-1;g++)h.push(H(s,g));var m=kb();m.load(h)}for(var w=0;w<n.length;w++)for(var b=0;b<n[w].length-1;b++)if(r){var I=m.search(H(w,b));I.forEach(function(Z){var D=Z.ring,k=Z.edge;V(w,b,D,k)})}else for(var A=0;A<n.length;A++)for(var z=0;z<n[A].length-1;z++)V(w,b,A,z);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function V(Z,D,k,j){var Y=n[Z][D],ie=n[Z][D+1],ne=n[k][j],ae=n[k][j+1],W=Gz(Y,ie,ne,ae);if(W!==null){var $e,Oe;if(ie[0]!==Y[0]?$e=(W[0]-Y[0])/(ie[0]-Y[0]):$e=(W[1]-Y[1])/(ie[1]-Y[1]),ae[0]!==ne[0]?Oe=(W[0]-ne[0])/(ae[0]-ne[0]):Oe=(W[1]-ne[1])/(ae[1]-ne[1]),!($e>=1||$e<=0||Oe>=1||Oe<=0)){var ze=W,We=!a[ze];We&&(a[ze]=!0),e?i.push(e(W,Z,D,Y,ie,$e,k,j,ne,ae,Oe,We)):i.push(W)}}}function H(Z,D){var k=n[Z][D],j=n[Z][D+1],Y,ie,ne,ae;return k[0]<j[0]?(Y=k[0],ie=j[0]):(Y=j[0],ie=k[0]),k[1]<j[1]?(ne=k[1],ae=j[1]):(ne=j[1],ae=k[1]),{minX:Y,minY:ne,maxX:ie,maxY:ae,ring:Z,edge:D}}}function Gz(t,e,r,n){if(fy(t,r)||fy(t,n)||fy(e,r)||fy(n,r))return null;var i=t[0],a=t[1],h=e[0],s=e[1],g=r[0],m=r[1],w=n[0],b=n[1],I=(i-h)*(m-b)-(a-s)*(g-w);if(I===0)return null;var A=((i*s-a*h)*(g-w)-(i-h)*(g*b-m*w))/I,z=((i*s-a*h)*(m-b)-(a-s)*(g*b-m*w))/I;return[A,z]}function fy(t,e){if(!t||!e||t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!fy(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return!0}function Vz(t){if(t.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(t.geometry===void 0||t.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(t.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,r=[],D=0;D<e;D++){var n=t.geometry.coordinates[D];py(n[0],n[n.length-1])||n.push(n[0]),r.push.apply(r,n.slice(0,n.length-1))}if(!qz(r))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var i=r.length,a=Uz(t,function(Jt,yr,rr,Ar,Ii,Xr,si,nr,Ee,Ce,Ke,Qe){return[Jt,yr,rr,Ar,Ii,Xr,si,nr,Ee,Ce,Ke,Qe]}),h=a.length;if(h==0){for(var ne=[],D=0;D<e;D++)ne.push(qr([t.geometry.coordinates[D]],{parent:-1,winding:jz(t.geometry.coordinates[D])}));var zt=hr(ne);return mt(),bt(),zt}for(var s=[],g=[],D=0;D<e;D++){s.push([]);for(var m=0;m<t.geometry.coordinates[D].length-1;m++)s[D].push([new SP(t.geometry.coordinates[D][bd(m+1,t.geometry.coordinates[D].length-1)],1,[D,m],[D,bd(m+1,t.geometry.coordinates[D].length-1)],void 0)]),g.push(new IP(t.geometry.coordinates[D][m],[D,bd(m-1,t.geometry.coordinates[D].length-1)],[D,m],void 0,void 0,!1,!0))}for(var D=0;D<h;D++)s[a[D][1]][a[D][2]].push(new SP(a[D][0],a[D][5],[a[D][1],a[D][2]],[a[D][6],a[D][7]],void 0)),a[D][11]&&g.push(new IP(a[D][0],[a[D][1],a[D][2]],[a[D][6],a[D][7]],void 0,void 0,!0,!0));for(var w=g.length,D=0;D<s.length;D++)for(var m=0;m<s[D].length;m++)s[D][m].sort(function(yr,rr){return yr.param<rr.param?-1:1});for(var b=[],D=0;D<w;D++)b.push({minX:g[D].coord[0],minY:g[D].coord[1],maxX:g[D].coord[0],maxY:g[D].coord[1],index:D});var I=kb();I.load(b);for(var D=0;D<s.length;D++)for(var m=0;m<s[D].length;m++)for(var A=0;A<s[D][m].length;A++){var z;A==s[D][m].length-1?z=s[D][bd(m+1,t.geometry.coordinates[D].length-1)][0].coord:z=s[D][m][A+1].coord;var V=I.search({minX:z[0],minY:z[1],maxX:z[0],maxY:z[1]})[0];s[D][m][A].nxtIsectAlongEdgeIn=V.index}for(var D=0;D<s.length;D++)for(var m=0;m<s[D].length;m++)for(var A=0;A<s[D][m].length;A++){var z=s[D][m][A].coord,V=I.search({minX:z[0],minY:z[1],maxX:z[0],maxY:z[1]})[0],H=V.index;H<i?g[H].nxtIsectAlongRingAndEdge2=s[D][m][A].nxtIsectAlongEdgeIn:py(g[H].ringAndEdge1,s[D][m][A].ringAndEdgeIn)?g[H].nxtIsectAlongRingAndEdge1=s[D][m][A].nxtIsectAlongEdgeIn:g[H].nxtIsectAlongRingAndEdge2=s[D][m][A].nxtIsectAlongEdgeIn}for(var Z=[],D=0,m=0;m<e;m++){for(var k=D,A=0;A<t.geometry.coordinates[m].length-1;A++)g[D].coord[0]<g[k].coord[0]&&(k=D),D++;for(var j=g[k].nxtIsectAlongRingAndEdge2,A=0;A<g.length;A++)if(g[A].nxtIsectAlongRingAndEdge1==k||g[A].nxtIsectAlongRingAndEdge2==k){var Y=A;break}var ie=d0([g[Y].coord,g[k].coord,g[j].coord],!0)?1:-1;Z.push({isect:k,parent:-1,winding:ie})}Z.sort(function(jt,Jt){return g[jt.isect].coord>g[Jt.isect].coord?-1:1});for(var ne=[];Z.length>0;){var ae=Z.pop(),W=ae.isect,$e=ae.parent,Oe=ae.winding,ze=ne.length,We=[g[W].coord],Ze=W;if(g[W].ringAndEdge1Walkable)var Pt=g[W].ringAndEdge1,at=g[W].nxtIsectAlongRingAndEdge1;else var Pt=g[W].ringAndEdge2,at=g[W].nxtIsectAlongRingAndEdge2;for(;!py(g[W].coord,g[at].coord);){We.push(g[at].coord);for(var St=void 0,D=0;D<Z.length;D++)if(Z[D].isect==at){St=D;break}if(St!=null&&Z.splice(St,1),py(Pt,g[at].ringAndEdge1)){if(Pt=g[at].ringAndEdge2,g[at].ringAndEdge2Walkable=!1,g[at].ringAndEdge1Walkable){var et={isect:at};d0([g[Ze].coord,g[at].coord,g[g[at].nxtIsectAlongRingAndEdge2].coord],Oe==1)?(et.parent=$e,et.winding=-Oe):(et.parent=ze,et.winding=Oe),Z.push(et)}Ze=at,at=g[at].nxtIsectAlongRingAndEdge2}else{if(Pt=g[at].ringAndEdge1,g[at].ringAndEdge1Walkable=!1,g[at].ringAndEdge2Walkable){var et={isect:at};d0([g[Ze].coord,g[at].coord,g[g[at].nxtIsectAlongRingAndEdge1].coord],Oe==1)?(et.parent=$e,et.winding=-Oe):(et.parent=ze,et.winding=Oe),Z.push(et)}Ze=at,at=g[at].nxtIsectAlongRingAndEdge1}}We.push(g[at].coord),ne.push(qr([We],{index:ze,parent:$e,winding:Oe,netWinding:void 0}))}var zt=hr(ne);mt(),bt();function mt(){for(var jt=[],Jt=0;Jt<zt.features.length;Jt++)zt.features[Jt].properties.parent==-1&&jt.push(Jt);if(jt.length>1)for(var Jt=0;Jt<jt.length;Jt++){for(var yr=-1,rr=1/0,Ar=0;Ar<zt.features.length;Ar++)jt[Jt]!=Ar&&ci(zt.features[jt[Jt]].geometry.coordinates[0][0],zt.features[Ar],{ignoreBoundary:!0})&&Gb(zt.features[Ar])<rr&&(yr=Ar);zt.features[jt[Jt]].properties.parent=yr}}function bt(){for(var jt=0;jt<zt.features.length;jt++)if(zt.features[jt].properties.parent==-1){var Jt=zt.features[jt].properties.winding;zt.features[jt].properties.netWinding=Jt,It(jt,Jt)}}function It(jt,Jt){for(var yr=0;yr<zt.features.length;yr++)if(zt.features[yr].properties.parent==jt){var rr=Jt+zt.features[yr].properties.winding;zt.features[yr].properties.netWinding=rr,It(yr,rr)}}return zt}var SP=function(t,e,r,n,i){this.coord=t,this.param=e,this.ringAndEdgeIn=r,this.ringAndEdgeOut=n,this.nxtIsectAlongEdgeIn=i},IP=function(t,e,r,n,i,a,h){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=n,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=a,this.ringAndEdge2Walkable=h};function d0(t,e){if(typeof e>"u"&&(e=!0),t.length!=3)throw new Error("This function requires an array of three points [x,y]");var r=(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0]);return r>=0==e}function jz(t){for(var e=0,r=0;r<t.length-1;r++)t[r][0]<t[e][0]&&(e=r);if(d0([t[bd(e-1,t.length-1)],t[e],t[bd(e+1,t.length-1)]],!0))var n=1;else var n=-1;return n}function py(t,e){if(!t||!e||t.length!=e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!py(t[r],e[r]))return!1}else if(t[r]!=e[r])return!1;return!0}function bd(t,e){return(t%e+e)%e}function qz(t){for(var e={},r=1,n=0,i=t.length;n<i;++n){if(Object.prototype.hasOwnProperty.call(e,t[n])){r=0;break}e[t[n]]=1}return r}function $z(t){var e=[];return jo(t,function(r){r.geometry.type==="Polygon"&&kn(Vz(r),function(n){e.push(qr(n.geometry.coordinates,r.properties))})}),hr(e)}var PP=Math.PI/180,CP=180/Math.PI,Dy=function(t,e){this.lon=t,this.lat=e,this.x=PP*t,this.y=PP*e};Dy.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)};Dy.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:(180-this.lon)*-1;return new Dy(e,t)};var oL=function(){this.coords=[],this.length=0};oL.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Vb=function(t){this.properties=t||{},this.geometries=[]};Vb.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(this.geometries.length===1)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}};Vb.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(a){e+=a[0]+" "+a[1]+","},n=0;n<this.geometries.length;n++){if(this.geometries[n].coords.length===0)return"LINESTRING(empty)";var i=this.geometries[n].coords;i.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};var jb=function(t,e,r){if(!t||t.x===void 0||t.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||e.x===void 0||e.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Dy(t.x,t.y),this.end=new Dy(e.x,e.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,a=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(a)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};jb.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),a=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),h=CP*Math.atan2(a,Math.sqrt(Math.pow(n,2)+Math.pow(i,2))),s=CP*Math.atan2(i,n);return[s,h]};jb.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var n=1/(t-1),i=0;i<t;++i){var a=n*i,h=this.interpolate(a);r.push(h)}for(var s=!1,g=0,m=e&&e.offset?e.offset:10,w=180-m,b=-180+m,I=360-m,A=1;A<r.length;++A){var z=r[A-1][0],V=r[A][0],H=Math.abs(V-z);H>I&&(V>w&&z<b||z>w&&V<b)?s=!0:H>g&&(g=H)}var Z=[];if(s&&g<m){var D=[];Z.push(D);for(var k=0;k<r.length;++k){var j=parseFloat(r[k][0]);if(k>0&&Math.abs(j-r[k-1][0])>I){var Y=parseFloat(r[k-1][0]),ie=parseFloat(r[k-1][1]),ne=parseFloat(r[k][0]),ae=parseFloat(r[k][1]);if(Y>-180&&Y<b&&ne===180&&k+1<r.length&&r[k-1][0]>-180&&r[k-1][0]<b){D.push([-180,r[k][1]]),k++,D.push([r[k][0],r[k][1]]);continue}else if(Y>w&&Y<180&&ne===-180&&k+1<r.length&&r[k-1][0]>w&&r[k-1][0]<180){D.push([180,r[k][1]]),k++,D.push([r[k][0],r[k][1]]);continue}if(Y<b&&ne>w){var W=Y;Y=ne,ne=W;var $e=ie;ie=ae,ae=$e}if(Y>w&&ne<b&&(ne+=360),Y<=180&&ne>=180&&Y<ne){var Oe=(180-Y)/(ne-Y),ze=Oe*ae+(1-Oe)*ie;D.push([r[k-1][0]>w?180:-180,ze]),D=[],D.push([r[k-1][0]>w?-180:180,ze]),Z.push(D)}else D=[],Z.push(D);D.push([j,r[k][1]])}else D.push([r[k][0],r[k][1]])}}else{var We=[];Z.push(We);for(var Ze=0;Ze<r.length;++Ze)We.push([r[Ze][0],r[Ze][1]])}for(var Pt=new Vb(this.properties),at=0;at<Z.length;++at){var St=new oL;Pt.geometries.push(St);for(var et=Z[at],zt=0;zt<et.length;++zt)St.move_to(et[zt])}return Pt};function Zz(t,e,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.properties,i=r.npoints,a=r.offset;t=oi(t),e=oi(e),n=n||{},i=i||100,a=a||10;var h=new jb({x:t[0],y:t[1]},{x:e[0],y:e[1]},n),s=h.Arc(i,{offset:a});return s.json()}function Xz(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=Zs(t),n=Zs(e);if(r!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=iL(e,{precision:7});switch(n){case"Point":return ME(t,i);case"MultiPoint":return AP(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return AP(t,Rc(t,i))}}function AP(t,e){var r=[],n=d1();return jo(e,function(i){if(r.forEach(function(s,g){s.id=g}),!r.length)r=ME(t,i).features,r.forEach(function(s){s.bbox||(s.bbox=jM(Fi(s)))}),n.load(hr(r));else{var a=n.search(i);if(a.features.length){var h=sL(i,a);r=r.filter(function(s){return s.id!==h.id}),n.remove(h),kn(ME(h,i),function(s){r.push(s),n.insert(s)})}}}),hr(r)}function ME(t,e){var r=[],n=mr(t)[0],i=mr(t)[t.geometry.coordinates.length-1];if(Fw(n,oi(e))||Fw(i,oi(e)))return hr([t]);var a=d1(),h=Xf(t);a.load(h);var s=a.search(e);if(!s.features.length)return hr([t]);var g=sL(e,s),m=[n],w=Tb(h,function(b,I,A){var z=mr(I)[1],V=oi(e);return A===g.id?(b.push(V),r.push(Bn(b)),Fw(V,z)?[V]:[V,z]):(b.push(z),b)},m);return w.length>1&&r.push(Bn(w)),hr(r)}function sL(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var r,n=1/0;return kn(e,function(i){var a=mc(i,t),h=a.properties.dist;h<n&&(r=i,n=h)}),r}function Fw(t,e){return t[0]===e[0]&&t[1]===e[1]}function aL(t,e,r,n,i){i===void 0&&(i={});var a=i.steps||64,h=MP(r),s=MP(n),g=!Array.isArray(t)&&t.type==="Feature"?t.properties:{};if(h===s)return Bn(zb(t,e,i).geometry.coordinates[0],g);for(var m=h,w=h<s?s:s+360,b=m,I=[],A=0;b<w;)I.push(zu(t,e,b,i).geometry.coordinates),A++,b=m+A*360/a;return b>w&&I.push(zu(t,e,w,i).geometry.coordinates),Bn(I,g)}function MP(t){var e=t%360;return e<0&&(e+=360),e}function Ny(t,e){e===void 0&&(e={});var r=hi(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),r.type){case"Polygon":return lL(r,e);case"MultiPolygon":return Wz(r,e);default:throw new Error("invalid poly")}}function lL(t,e){e===void 0&&(e={});var r=hi(t),n=r.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{};return uL(n,i)}function Wz(t,e){e===void 0&&(e={});var r=hi(t),n=r.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{},a=[];return n.forEach(function(h){a.push(uL(h,i))}),hr(a)}function uL(t,e){return t.length>1?Fh(t,e):Bn(t[0],e)}function LP(t,e){e===void 0&&(e={});var r,n,i,a=e.properties,h=(r=e.autoComplete)!==null&&r!==void 0?r:!0,s=(n=e.orderCoords)!==null&&n!==void 0?n:!0,g=(i=e.mutate)!==null&&i!==void 0?i:!1;switch(g||(t=ss(t)),t.type){case"FeatureCollection":var m=[];return t.features.forEach(function(w){m.push(mr(OP(w,{},h,s)))}),ga(m,a);default:return OP(t,a,h,s)}}function OP(t,e,r,n){e=e||(t.type==="Feature"?t.properties:{});var i=hi(t),a=i.coordinates,h=i.type;if(!a.length)throw new Error("line must contain coordinates");switch(h){case"LineString":return r&&(a=DP(a)),qr([a],e);case"MultiLineString":var s=[],g=0;return a.forEach(function(m){if(r&&(m=DP(m)),n){var w=Hz(Fi(Bn(m)));w>g?(s.unshift(m),g=w):s.push(m)}else s.push(m)}),qr(s,e);default:throw new Error("geometry type "+h+" is not supported")}}function DP(t){var e=t[0],r=e[0],n=e[1],i=t[t.length-1],a=i[0],h=i[1];return(r!==a||n!==h)&&t.push(e),t}function Hz(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.abs(e-n)*Math.abs(r-i)}function Kz(t,e,r){var n=t.length,i=Td(t[0],e),a=[],h,s,g,m,w;for(r||(r=[]),h=1;h<n;h++){for(m=t[h-1],w=t[h],s=g=Td(w,e);;)if(i|s){if(i&s)break;i?(m=LE(m,w,i,e),i=Td(m,e)):(w=LE(m,w,s,e),s=Td(w,e))}else{a.push(m),s!==g?(a.push(w),h<n-1&&(r.push(a),a=[])):h===n-1&&a.push(w);break}i=g}return a.length&&r.push(a),r}function Yz(t,e){var r,n,i,a,h,s,g;for(n=1;n<=8;n*=2){for(r=[],i=t[t.length-1],a=!(Td(i,e)&n),h=0;h<t.length;h++)s=t[h],g=!(Td(s,e)&n),g!==a&&r.push(LE(i,s,n,e)),g&&r.push(s),i=s,a=g;if(t=r,!t.length)break}return r}function LE(t,e,r,n){return r&8?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:r&4?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:r&2?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:r&1?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function Td(t,e){var r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Jz(t,e){var r=hi(t),n=r.type,i=t.type==="Feature"?t.properties:{},a=r.coordinates;switch(n){case"LineString":case"MultiLineString":{var h=[];return n==="LineString"&&(a=[a]),a.forEach(function(s){Kz(s,e,h)}),h.length===1?Bn(h[0],i):Fh(h,i)}case"Polygon":return qr(NP(a,e),i);case"MultiPolygon":return ga(a.map(function(s){return NP(s,e)}),i);default:throw new Error("geometry "+n+" not supported")}}function NP(t,e){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],h=Yz(a,e);h.length>0&&((h[0][0]!==h[h.length-1][0]||h[0][1]!==h[h.length-1][1])&&h.push(h[0]),h.length>=4&&r.push(h))}return r}var RP=Object.prototype.toString,cL=function(e){var r=RP.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&RP.call(e.callee)==="[object Function]"),n},zw,kP;function Qz(){if(kP)return zw;kP=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=cL,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),h=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],g=function(I){var A=I.constructor;return A&&A.prototype===I},m={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},w=function(){if(typeof window>"u")return!1;for(var I in window)try{if(!m["$"+I]&&e.call(window,I)&&window[I]!==null&&typeof window[I]=="object")try{g(window[I])}catch{return!0}}catch{return!0}return!1}(),b=function(I){if(typeof window>"u"||!w)return g(I);try{return g(I)}catch{return!1}};t=function(A){var z=A!==null&&typeof A=="object",V=r.call(A)==="[object Function]",H=n(A),Z=z&&r.call(A)==="[object String]",D=[];if(!z&&!V&&!H)throw new TypeError("Object.keys called on a non-object");var k=h&&V;if(Z&&A.length>0&&!e.call(A,0))for(var j=0;j<A.length;++j)D.push(String(j));if(H&&A.length>0)for(var Y=0;Y<A.length;++Y)D.push(String(Y));else for(var ie in A)!(k&&ie==="prototype")&&e.call(A,ie)&&D.push(String(ie));if(a)for(var ne=b(A),ae=0;ae<s.length;++ae)!(ne&&s[ae]==="constructor")&&e.call(A,s[ae])&&D.push(s[ae]);return D}}return zw=t,zw}var eB=Array.prototype.slice,tB=cL,FP=Object.keys,g0=FP?function(e){return FP(e)}:Qz(),zP=Object.keys;g0.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return tB(n)?zP(eB.call(n)):zP(n)})}else Object.keys=g0;return Object.keys||g0};var hL=g0,fL=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[r]=i;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(e,r);if(h.value!==i||h.enumerable!==!0)return!1}return!0},rB=fL,qb=function(){return rB()&&!!Symbol.toStringTag},BP=typeof Symbol<"u"&&Symbol,nB=fL,iB=function(){return typeof BP!="function"||typeof Symbol!="function"||typeof BP("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:nB()},UP={foo:{}},oB=Object,sB=function(){return{__proto__:UP}.foo===UP.foo&&!({__proto__:null}instanceof oB)},aB="Function.prototype.bind called on incompatible ",Bw=Array.prototype.slice,lB=Object.prototype.toString,uB="[object Function]",cB=function(e){var r=this;if(typeof r!="function"||lB.call(r)!==uB)throw new TypeError(aB+r);for(var n=Bw.call(arguments,1),i,a=function(){if(this instanceof i){var w=r.apply(this,n.concat(Bw.call(arguments)));return Object(w)===w?w:this}else return r.apply(e,n.concat(Bw.call(arguments)))},h=Math.max(0,r.length-n.length),s=[],g=0;g<h;g++)s.push("$"+g);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(a),r.prototype){var m=function(){};m.prototype=r.prototype,i.prototype=new m,m.prototype=null}return i},hB=cB,$b=Function.prototype.bind||hB,fB=$b,pB=fB.call(Function.call,Object.prototype.hasOwnProperty),Nn,Ud=SyntaxError,pL=Function,Ld=TypeError,Uw=function(t){try{return pL('"use strict"; return ('+t+").constructor;")()}catch{}},Bf=Object.getOwnPropertyDescriptor;if(Bf)try{Bf({},"")}catch{Bf=null}var Gw=function(){throw new Ld},dB=Bf?function(){try{return arguments.callee,Gw}catch{try{return Bf(arguments,"callee").get}catch{return Gw}}}():Gw,gd=iB(),gB=sB(),Qo=Object.getPrototypeOf||(gB?function(t){return t.__proto__}:null),xd={},mB=typeof Uint8Array>"u"||!Qo?Nn:Qo(Uint8Array),Uf={"%AggregateError%":typeof AggregateError>"u"?Nn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Nn:ArrayBuffer,"%ArrayIteratorPrototype%":gd&&Qo?Qo([][Symbol.iterator]()):Nn,"%AsyncFromSyncIteratorPrototype%":Nn,"%AsyncFunction%":xd,"%AsyncGenerator%":xd,"%AsyncGeneratorFunction%":xd,"%AsyncIteratorPrototype%":xd,"%Atomics%":typeof Atomics>"u"?Nn:Atomics,"%BigInt%":typeof BigInt>"u"?Nn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Nn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Nn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Nn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Nn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Nn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Nn:FinalizationRegistry,"%Function%":pL,"%GeneratorFunction%":xd,"%Int8Array%":typeof Int8Array>"u"?Nn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Nn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Nn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":gd&&Qo?Qo(Qo([][Symbol.iterator]())):Nn,"%JSON%":typeof JSON=="object"?JSON:Nn,"%Map%":typeof Map>"u"?Nn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!gd||!Qo?Nn:Qo(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Nn:Promise,"%Proxy%":typeof Proxy>"u"?Nn:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Nn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Nn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!gd||!Qo?Nn:Qo(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Nn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":gd&&Qo?Qo(""[Symbol.iterator]()):Nn,"%Symbol%":gd?Symbol:Nn,"%SyntaxError%":Ud,"%ThrowTypeError%":dB,"%TypedArray%":mB,"%TypeError%":Ld,"%Uint8Array%":typeof Uint8Array>"u"?Nn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Nn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Nn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Nn:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Nn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Nn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Nn:WeakSet};if(Qo)try{null.error}catch(t){var yB=Qo(Qo(t));Uf["%Error.prototype%"]=yB}var _B=function t(e){var r;if(e==="%AsyncFunction%")r=Uw("async function () {}");else if(e==="%GeneratorFunction%")r=Uw("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=Uw("async function* () {}");else if(e==="%AsyncGenerator%"){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&Qo&&(r=Qo(i.prototype))}return Uf[e]=r,r},GP={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},r_=$b,A0=pB,vB=r_.call(Function.call,Array.prototype.concat),xB=r_.call(Function.apply,Array.prototype.splice),VP=r_.call(Function.call,String.prototype.replace),M0=r_.call(Function.call,String.prototype.slice),wB=r_.call(Function.call,RegExp.prototype.exec),EB=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,bB=/\\(\\)?/g,TB=function(e){var r=M0(e,0,1),n=M0(e,-1);if(r==="%"&&n!=="%")throw new Ud("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Ud("invalid intrinsic syntax, expected opening `%`");var i=[];return VP(e,EB,function(a,h,s,g){i[i.length]=s?VP(g,bB,"$1"):h||a}),i},SB=function(e,r){var n=e,i;if(A0(GP,n)&&(i=GP[n],n="%"+i[0]+"%"),A0(Uf,n)){var a=Uf[n];if(a===xd&&(a=_B(n)),typeof a>"u"&&!r)throw new Ld("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:a}}throw new Ud("intrinsic "+e+" does not exist!")},n_=function(e,r){if(typeof e!="string"||e.length===0)throw new Ld("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Ld('"allowMissing" argument must be a boolean');if(wB(/^%?[^%]*%?$/,e)===null)throw new Ud("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=TB(e),i=n.length>0?n[0]:"",a=SB("%"+i+"%",r),h=a.name,s=a.value,g=!1,m=a.alias;m&&(i=m[0],xB(n,vB([0,1],m)));for(var w=1,b=!0;w<n.length;w+=1){var I=n[w],A=M0(I,0,1),z=M0(I,-1);if((A==='"'||A==="'"||A==="`"||z==='"'||z==="'"||z==="`")&&A!==z)throw new Ud("property names with quotes must have matching quotes");if((I==="constructor"||!b)&&(g=!0),i+="."+I,h="%"+i+"%",A0(Uf,h))s=Uf[h];else if(s!=null){if(!(I in s)){if(!r)throw new Ld("base intrinsic for "+e+" exists, but the property is not available.");return}if(Bf&&w+1>=n.length){var V=Bf(s,I);b=!!V,b&&"get"in V&&!("originalValue"in V.get)?s=V.get:s=s[I]}else b=A0(s,I),s=s[I];b&&!g&&(Uf[h]=s)}}return s},dL={exports:{}};(function(t){var e=$b,r=n_,n=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||e.call(i,n),h=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),g=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch{s=null}t.exports=function(b){var I=a(e,i,arguments);if(h&&s){var A=h(I,"length");A.configurable&&s(I,"length",{value:1+g(0,b.length-(arguments.length-1))})}return I};var m=function(){return a(e,n,arguments)};s?s(t.exports,"apply",{value:m}):t.exports.apply=m})(dL);var Zb=dL.exports,gL=n_,mL=Zb,IB=mL(gL("String.prototype.indexOf")),yL=function(e,r){var n=gL(e,!!r);return typeof n=="function"&&IB(e,".prototype.")>-1?mL(n):n},PB=qb(),CB=yL,OE=CB("Object.prototype.toString"),m1=function(e){return PB&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:OE(e)==="[object Arguments]"},_L=function(e){return m1(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&OE(e)!=="[object Array]"&&OE(e.callee)==="[object Function]"},AB=function(){return m1(arguments)}();m1.isLegacyArguments=_L;var MB=AB?m1:_L,LB=n_,DE=LB("%Object.defineProperty%",!0),NE=function(){if(DE)try{return DE({},"a",{value:1}),!0}catch{return!1}return!1};NE.hasArrayLengthDefineBug=function(){if(!NE())return null;try{return DE([],"length",{value:1}).length!==1}catch{return!0}};var Xb=NE,Vw,jP;function OB(){if(jP)return Vw;jP=1;var t=n_,e=t("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch{e=null}return Vw=e,Vw}var DB=Xb(),Wb=n_,qP=DB&&Wb("%Object.defineProperty%",!0),NB=Wb("%SyntaxError%"),md=Wb("%TypeError%"),$P=OB(),vL=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new md("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new md("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new md("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new md("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new md("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new md("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,g=!!$P&&$P(e,r);if(qP)qP(e,r,{configurable:h===null&&g?g.configurable:!h,enumerable:i===null&&g?g.enumerable:!i,value:n,writable:a===null&&g?g.writable:!a});else if(s||!i&&!a&&!h)e[r]=n;else throw new NB("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},RB=hL,kB=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",FB=Object.prototype.toString,zB=Array.prototype.concat,ZP=vL,BB=function(t){return typeof t=="function"&&FB.call(t)==="[object Function]"},xL=Xb(),UB=function(t,e,r,n){if(e in t){if(n===!0){if(t[e]===r)return}else if(!BB(n)||!n())return}xL?ZP(t,e,r,!0):ZP(t,e,r)},wL=function(t,e){var r=arguments.length>2?arguments[2]:{},n=RB(e);kB&&(n=zB.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)UB(t,n[i],e[n[i]],r[n[i]])};wL.supportsDescriptors=!!xL;var i_=wL,XP=function(t){return t!==t},EL=function(e,r){return e===0&&r===0?1/e===1/r:!!(e===r||XP(e)&&XP(r))},GB=EL,bL=function(){return typeof Object.is=="function"?Object.is:GB},VB=bL,jB=i_,qB=function(){var e=VB();return jB(Object,{is:e},{is:function(){return Object.is!==e}}),e},$B=i_,ZB=Zb,XB=EL,TL=bL,WB=qB,SL=ZB(TL(),Object);$B(SL,{getPolyfill:TL,implementation:XB,shim:WB});var HB=SL,RE=yL,IL=qb(),PL,CL,kE,FE;if(IL){PL=RE("Object.prototype.hasOwnProperty"),CL=RE("RegExp.prototype.exec"),kE={};var jw=function(){throw kE};FE={toString:jw,valueOf:jw},typeof Symbol.toPrimitive=="symbol"&&(FE[Symbol.toPrimitive]=jw)}var KB=RE("Object.prototype.toString"),YB=Object.getOwnPropertyDescriptor,JB="[object RegExp]",QB=IL?function(e){if(!e||typeof e!="object")return!1;var r=YB(e,"lastIndex"),n=r&&PL(r,"value");if(!n)return!1;try{CL(e,FE)}catch(i){return i===kE}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:KB(e)===JB},Ry=function(){return typeof(function(){}).name=="string"},xy=Object.getOwnPropertyDescriptor;if(xy)try{xy([],"length")}catch{xy=null}Ry.functionsHaveConfigurableNames=function(){if(!Ry()||!xy)return!1;var e=xy(function(){},"name");return!!e&&!!e.configurable};var eU=Function.prototype.bind;Ry.boundFunctionsHaveNames=function(){return Ry()&&typeof eU=="function"&&(function(){}).bind().name!==""};var tU=Ry,WP=vL,rU=Xb(),nU=tU.functionsHaveConfigurableNames(),iU=TypeError,oU=function(e,r){if(typeof e!="function")throw new iU("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||nU)&&(rU?WP(e,"name",r,!0,!0):WP(e,"name",r)),e},sU=oU,aU=Object,lU=TypeError,AL=sU(function(){if(this!=null&&this!==aU(this))throw new lU("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),uU=AL,cU=i_.supportsDescriptors,hU=Object.getOwnPropertyDescriptor,ML=function(){if(cU&&/a/mig.flags==="gim"){var e=hU(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var r="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){r+="d"}}),Object.defineProperty(n,"sticky",{get:function(){r+="y"}}),r==="dy")return e.get}}return uU},fU=i_.supportsDescriptors,pU=ML,dU=Object.getOwnPropertyDescriptor,gU=Object.defineProperty,mU=TypeError,HP=Object.getPrototypeOf,yU=/a/,_U=function(){if(!fU||!HP)throw new mU("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=pU(),r=HP(yU),n=dU(r,"flags");return(!n||n.get!==e)&&gU(r,"flags",{configurable:!0,enumerable:!1,get:e}),e},vU=i_,xU=Zb,wU=AL,LL=ML,EU=_U,OL=xU(LL());vU(OL,{getPolyfill:LL,implementation:wU,shim:EU});var bU=OL,TU=Date.prototype.getDay,SU=function(e){try{return TU.call(e),!0}catch{return!1}},IU=Object.prototype.toString,PU="[object Date]",CU=qb(),AU=function(e){return typeof e!="object"||e===null?!1:CU?SU(e):IU.call(e)===PU},KP=hL,YP=MB,JP=HB,QP=QB,eC=bU,tC=AU,rC=Date.prototype.getTime;function DL(t,e,r){var n=r||{};return(n.strict?JP(t,e):t===e)?!0:!t||!e||typeof t!="object"&&typeof e!="object"?n.strict?JP(t,e):t==e:MU(t,e,n)}function nC(t){return t==null}function iC(t){return!(!t||typeof t!="object"||typeof t.length!="number"||typeof t.copy!="function"||typeof t.slice!="function"||t.length>0&&typeof t[0]!="number")}function MU(t,e,r){var n,i;if(typeof t!=typeof e||nC(t)||nC(e)||t.prototype!==e.prototype||YP(t)!==YP(e))return!1;var a=QP(t),h=QP(e);if(a!==h)return!1;if(a||h)return t.source===e.source&&eC(t)===eC(e);if(tC(t)&&tC(e))return rC.call(t)===rC.call(e);var s=iC(t),g=iC(e);if(s!==g)return!1;if(s||g){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}if(typeof t!=typeof e)return!1;try{var m=KP(t),w=KP(e)}catch{return!1}if(m.length!==w.length)return!1;for(m.sort(),w.sort(),n=m.length-1;n>=0;n--)if(m[n]!=w[n])return!1;for(n=m.length-1;n>=0;n--)if(i=m[n],!DL(t[i],e[i],r))return!1;return!0}var NL=DL;const dy=wa(NL);function RL(t,e,r){if(r===void 0&&(r={}),r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.tolerance||0,i=[],a=d1(),h=Xf(t);a.load(h);var s;return gc(e,function(g){var m=!1;g&&(kn(a.search(g),function(w){if(m===!1){var b=mr(g).sort(),I=mr(w).sort();dy(b,I)||(n===0?ca(b[0],w)&&ca(b[1],w):mc(w,b[0]).properties.dist<=n&&mc(w,b[1]).properties.dist<=n)?(m=!0,s?s=qw(s,g):s=g):(n===0?ca(I[0],g)&&ca(I[1],g):mc(g,I[0]).properties.dist<=n&&mc(g,I[1]).properties.dist<=n)&&(s?s=qw(s,w):s=w)}}),m===!1&&s&&(i.push(s),s=void 0))}),s&&i.push(s),hr(i)}function qw(t,e){var r=mr(e),n=mr(t),i=n[0],a=n[n.length-1],h=t.geometry.coordinates;return dy(r[0],i)?h.unshift(r[1]):dy(r[0],a)?h.push(r[1]):dy(r[1],i)?h.unshift(r[0]):dy(r[1],a)&&h.push(r[0]),t}function LU(t,e,r,n,i){if(i=i||{},!Vn(i))throw new Error("options is invalid");var a=i.properties;if(!t)throw new Error("center is required");if(r==null)throw new Error("bearing1 is required");if(n==null)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if(typeof i!="object")throw new Error("options must be an object");if(oC(r)===oC(n))return zb(t,e,i);var h=mr(t),s=aL(t,e,r,n,i),g=[[h]];return ji(s,function(m){g[0].push(m)}),g[0].push(h),qr(g,a)}function oC(t){var e=t%360;return e<0&&(e+=360),e}function Wf(t,e,r){r===void 0&&(r={});var n;r.final?n=sC(oi(e),oi(t)):n=sC(oi(t),oi(e));var i=n>180?-(360-n):n;return i}function sC(t,e){var r=Ao(t[1]),n=Ao(e[1]),i=Ao(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var a=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),h=Math.atan2(i,a);return(Sh(h)+360)%360}function Gd(t,e,r,n){n===void 0&&(n={});var i=e<0,a=qf(Math.abs(e),n.units,"meters");i&&(a=-Math.abs(a));var h=oi(t),s=OU(h,a,r);return s[0]+=s[0]-h[0]>180?-360:h[0]-s[0]>180?360:0,Gr(s,n.properties)}function OU(t,e,r,n){n=n===void 0?Io:Number(n);var i=e/n,a=t[0]*Math.PI/180,h=Ao(t[1]),s=Ao(r),g=i*Math.cos(s),m=h+g;Math.abs(m)>Math.PI/2&&(m=m>0?Math.PI-m:-Math.PI-m);var w=Math.log(Math.tan(m/2+Math.PI/4)/Math.tan(h/2+Math.PI/4)),b=Math.abs(w)>1e-11?g/w:Math.cos(h),I=i*Math.sin(s)/b,A=a+I;return[(A*180/Math.PI+540)%360-180,m*180/Math.PI]}function DU(t,e){var r=mr(t),n=mr(e),i,a,h,s,g=Fi(e),m=0,w=null;r[0]>g[0]&&r[0]<g[2]&&r[1]>g[1]&&r[1]<g[3]&&(w=C0(t,h1(e)),m=w.properties.featureIndex);var b=Zs(e);switch(b){case"Polygon":i=n[0][m],a=n[0][0],w!==null&&w.geometry.coordinates[1]<r[1]&&(a=n[0][m]),s=ky(n[0][0],n[0][n[0].length-1],r);var I=aC(n[0],r,s,h,i,a);i=I[0],a=I[1];break;case"MultiPolygon":for(var A=0,z=0,V=0,H=0;H<n[0].length;H++){A=H;for(var Z=!1,D=0;D<n[0][H].length;D++){if(z=D,V===m){Z=!0;break}V++}if(Z)break}i=n[0][A][z],a=n[0][A][z],s=ky(n[0][0][0],n[0][0][n[0][0].length-1],r),n.forEach(function(k){var j=aC(k[0],r,s,h,i,a);i=j[0],a=j[1]});break}return hr([Gr(i),Gr(a)])}function aC(t,e,r,n,i,a){for(var h=0;h<t.length;h++){var s=t[h],g=t[h+1];h===t.length-1&&(g=t[0]),n=ky(s,g,e),r<=0&&n>0?RU(e,s,i)||(i=s):r>0&&n<=0&&(NU(e,s,a)||(a=s)),r=n}return[i,a]}function NU(t,e,r){return ky(t,e,r)>0}function RU(t,e,r){return ky(t,e,r)<0}function ky(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])}function L0(t){for(var e=mr(t),r=0,n=1,i,a;n<e.length;)i=a||e[0],a=e[n],r+=(a[0]-i[0])*(a[1]+i[1]),n++;return r>0}function kU(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.reverse||!1,n=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if(typeof r!="boolean")throw new Error("<reverse> must be a boolean");if(typeof n!="boolean")throw new Error("<mutate> must be a boolean");n===!1&&(t=ss(t));var i=[];switch(t.type){case"GeometryCollection":return ma(t,function(a){m0(a,r)}),t;case"FeatureCollection":return kn(t,function(a){kn(m0(a,r),function(h){i.push(h)})}),hr(i)}return m0(t,r)}function m0(t,e){var r=t.type==="Feature"?t.geometry.type:t.type;switch(r){case"GeometryCollection":return ma(t,function(n){m0(n,e)}),t;case"LineString":return lC(mr(t),e),t;case"Polygon":return uC(mr(t),e),t;case"MultiLineString":return mr(t).forEach(function(n){lC(n,e)}),t;case"MultiPolygon":return mr(t).forEach(function(n){uC(n,e)}),t;case"Point":case"MultiPoint":return t}}function lC(t,e){L0(t)===e&&t.reverse()}function uC(t,e){L0(t[0])!==e&&t[0].reverse();for(var r=1;r<t.length;r++)L0(t[r])===e&&t[r].reverse()}function FU(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.zProperty||"elevation",n=e.flip,i=e.flags;Nc(t,"Point","input must contain Points");for(var a=zU(t,n),h=[],s=0;s<a.length;s++){for(var g=a[s],m=[],w=0;w<g.length;w++){var b=g[w];b.properties[r]?m.push(b.properties[r]):m.push(0),i===!0&&(b.properties.matrixPosition=[s,w])}h.push(m)}return h}function zU(t,e){var r={};kn(t,function(a){var h=mr(a)[1];r[h]||(r[h]=[]),r[h].push(a)});var n=Object.keys(r).map(function(a){var h=r[a],s=h.sort(function(g,m){return mr(g)[0]-mr(m)[0]});return s}),i=n.sort(function(a,h){return e?mr(a[0])[1]-mr(h[0])[1]:mr(h[0])[1]-mr(a[0])[1]});return i}/*!
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 *
 * MarchingSquaresJS is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * MarchingSquaresJS is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * As additional permission under GNU Affero General Public License version 3
 * section 7, third-party projects (personal or commercial) may distribute,
 * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
 * requirement that said third-party project for that reason alone becomes
 * subject to any requirement of the GNU Affero General Public License version 3.
 * Any modifications to MarchingSquaresJS, however, must be shared with the public
 * and made available.
 *
 * In summary this:
 * - allows you to use MarchingSquaresJS at no cost
 * - allows you to use MarchingSquaresJS for both personal and commercial purposes
 * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
 *   license as long as this license notice is included
 * - enables you to keep the source code of your program that uses MarchingSquaresJS
 *   undisclosed
 * - forces you to share any modifications you have made to MarchingSquaresJS,
 *   e.g. bug-fixes
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
 */var cC={successCallback:null,verbose:!1,polygons:!1},Mf={};function BU(t,e,r,n){n=n||{};for(var i=Object.keys(cC),a=0;a<i.length;a++){var h=i[a],s=n[h];s=typeof s<"u"&&s!==null?s:cC[h],Mf[h]=s}Mf.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+r)+"]");var g=_6(t,e,r),m;return Mf.polygons?(Mf.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),m=T6(g)):(Mf.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),m=v6(g)),typeof Mf.successCallback=="function"&&Mf.successCallback(m),m}var ds=64,ol=16,Bo=4,es=1,Yr=[],Jr=[],Qr=[],en=[],tn=[],rn=[],nn=[],on=[],sn=[],an=[],ln=[],un=[],cn=[],hn=[],fn=[],pn=[],dn=[],gn=[],mn=[],yn=[],_n=[],vn=[],xn=[],wn=[];nn[85]=an[85]=-1;on[85]=ln[85]=0;sn[85]=un[85]=1;mn[85]=vn[85]=1;yn[85]=xn[85]=0;_n[85]=wn[85]=1;Yr[85]=en[85]=0;Jr[85]=tn[85]=-1;Qr[85]=fn[85]=0;pn[85]=cn[85]=0;dn[85]=hn[85]=1;rn[85]=gn[85]=1;vn[1]=vn[169]=0;xn[1]=xn[169]=-1;wn[1]=wn[169]=0;cn[1]=cn[169]=-1;hn[1]=hn[169]=0;fn[1]=fn[169]=0;an[4]=an[166]=0;ln[4]=ln[166]=-1;un[4]=un[166]=1;pn[4]=pn[166]=1;dn[4]=dn[166]=0;gn[4]=gn[166]=0;nn[16]=nn[154]=0;on[16]=on[154]=1;sn[16]=sn[154]=1;en[16]=en[154]=1;tn[16]=tn[154]=0;rn[16]=rn[154]=1;mn[64]=mn[106]=0;yn[64]=yn[106]=1;_n[64]=_n[106]=0;Yr[64]=Yr[106]=-1;Jr[64]=Jr[106]=0;Qr[64]=Qr[106]=1;mn[2]=mn[168]=0;yn[2]=yn[168]=-1;_n[2]=_n[168]=1;vn[2]=vn[168]=0;xn[2]=xn[168]=-1;wn[2]=wn[168]=0;cn[2]=cn[168]=-1;hn[2]=hn[168]=0;fn[2]=fn[168]=0;pn[2]=pn[168]=-1;dn[2]=dn[168]=0;gn[2]=gn[168]=1;nn[8]=nn[162]=0;on[8]=on[162]=-1;sn[8]=sn[162]=0;an[8]=an[162]=0;ln[8]=ln[162]=-1;un[8]=un[162]=1;cn[8]=cn[162]=1;hn[8]=hn[162]=0;fn[8]=fn[162]=1;pn[8]=pn[162]=1;dn[8]=dn[162]=0;gn[8]=gn[162]=0;nn[32]=nn[138]=0;on[32]=on[138]=1;sn[32]=sn[138]=1;an[32]=an[138]=0;ln[32]=ln[138]=1;un[32]=un[138]=0;Yr[32]=Yr[138]=1;Jr[32]=Jr[138]=0;Qr[32]=Qr[138]=0;en[32]=en[138]=1;tn[32]=tn[138]=0;rn[32]=rn[138]=1;vn[128]=vn[42]=0;xn[128]=xn[42]=1;wn[128]=wn[42]=1;mn[128]=mn[42]=0;yn[128]=yn[42]=1;_n[128]=_n[42]=0;Yr[128]=Yr[42]=-1;Jr[128]=Jr[42]=0;Qr[128]=Qr[42]=1;en[128]=en[42]=-1;tn[128]=tn[42]=0;rn[128]=rn[42]=0;an[5]=an[165]=-1;ln[5]=ln[165]=0;un[5]=un[165]=0;vn[5]=vn[165]=1;xn[5]=xn[165]=0;wn[5]=wn[165]=0;pn[20]=pn[150]=0;dn[20]=dn[150]=1;gn[20]=gn[150]=1;en[20]=en[150]=0;tn[20]=tn[150]=-1;rn[20]=rn[150]=1;nn[80]=nn[90]=-1;on[80]=on[90]=0;sn[80]=sn[90]=1;mn[80]=mn[90]=1;yn[80]=yn[90]=0;_n[80]=_n[90]=1;cn[65]=cn[105]=0;hn[65]=hn[105]=1;fn[65]=fn[105]=0;Yr[65]=Yr[105]=0;Jr[65]=Jr[105]=-1;Qr[65]=Qr[105]=0;nn[160]=nn[10]=-1;on[160]=on[10]=0;sn[160]=sn[10]=1;an[160]=an[10]=-1;ln[160]=ln[10]=0;un[160]=un[10]=0;vn[160]=vn[10]=1;xn[160]=xn[10]=0;wn[160]=wn[10]=0;mn[160]=mn[10]=1;yn[160]=yn[10]=0;_n[160]=_n[10]=1;pn[130]=pn[40]=0;dn[130]=dn[40]=1;gn[130]=gn[40]=1;cn[130]=cn[40]=0;hn[130]=hn[40]=1;fn[130]=fn[40]=0;Yr[130]=Yr[40]=0;Jr[130]=Jr[40]=-1;Qr[130]=Qr[40]=0;en[130]=en[40]=0;tn[130]=tn[40]=-1;rn[130]=rn[40]=1;an[37]=an[133]=0;ln[37]=ln[133]=1;un[37]=un[133]=1;vn[37]=vn[133]=0;xn[37]=xn[133]=1;wn[37]=wn[133]=0;Yr[37]=Yr[133]=-1;Jr[37]=Jr[133]=0;Qr[37]=Qr[133]=0;en[37]=en[133]=1;tn[37]=tn[133]=0;rn[37]=rn[133]=0;pn[148]=pn[22]=-1;dn[148]=dn[22]=0;gn[148]=gn[22]=0;vn[148]=vn[22]=0;xn[148]=xn[22]=-1;wn[148]=wn[22]=1;mn[148]=mn[22]=0;yn[148]=yn[22]=1;_n[148]=_n[22]=1;en[148]=en[22]=-1;tn[148]=tn[22]=0;rn[148]=rn[22]=1;nn[82]=nn[88]=0;on[82]=on[88]=-1;sn[82]=sn[88]=1;pn[82]=pn[88]=1;dn[82]=dn[88]=0;gn[82]=gn[88]=1;cn[82]=cn[88]=-1;hn[82]=hn[88]=0;fn[82]=fn[88]=1;mn[82]=mn[88]=0;yn[82]=yn[88]=-1;_n[82]=_n[88]=0;nn[73]=nn[97]=0;on[73]=on[97]=1;sn[73]=sn[97]=0;an[73]=an[97]=0;ln[73]=ln[97]=-1;un[73]=un[97]=0;cn[73]=cn[97]=1;hn[73]=hn[97]=0;fn[73]=fn[97]=0;Yr[73]=Yr[97]=1;Jr[73]=Jr[97]=0;Qr[73]=Qr[97]=1;nn[145]=nn[25]=0;on[145]=on[25]=-1;sn[145]=sn[25]=0;cn[145]=cn[25]=1;hn[145]=hn[25]=0;fn[145]=fn[25]=1;vn[145]=vn[25]=0;xn[145]=xn[25]=1;wn[145]=wn[25]=1;en[145]=en[25]=-1;tn[145]=tn[25]=0;rn[145]=rn[25]=0;an[70]=an[100]=0;ln[70]=ln[100]=1;un[70]=un[100]=0;pn[70]=pn[100]=-1;dn[70]=dn[100]=0;gn[70]=gn[100]=1;mn[70]=mn[100]=0;yn[70]=yn[100]=-1;_n[70]=_n[100]=1;Yr[70]=Yr[100]=1;Jr[70]=Jr[100]=0;Qr[70]=Qr[100]=0;an[101]=an[69]=0;ln[101]=ln[69]=1;un[101]=un[69]=0;Yr[101]=Yr[69]=1;Jr[101]=Jr[69]=0;Qr[101]=Qr[69]=0;vn[149]=vn[21]=0;xn[149]=xn[21]=1;wn[149]=wn[21]=1;en[149]=en[21]=-1;tn[149]=tn[21]=0;rn[149]=rn[21]=0;pn[86]=pn[84]=-1;dn[86]=dn[84]=0;gn[86]=gn[84]=1;mn[86]=mn[84]=0;yn[86]=yn[84]=-1;_n[86]=_n[84]=1;nn[89]=nn[81]=0;on[89]=on[81]=-1;sn[89]=sn[81]=0;cn[89]=cn[81]=1;hn[89]=hn[81]=0;fn[89]=fn[81]=1;nn[96]=nn[74]=0;on[96]=on[74]=1;sn[96]=sn[74]=0;an[96]=an[74]=-1;ln[96]=ln[74]=0;un[96]=un[74]=1;mn[96]=mn[74]=1;yn[96]=yn[74]=0;_n[96]=_n[74]=0;Yr[96]=Yr[74]=1;Jr[96]=Jr[74]=0;Qr[96]=Qr[74]=1;nn[24]=nn[146]=0;on[24]=on[146]=-1;sn[24]=sn[146]=1;pn[24]=pn[146]=1;dn[24]=dn[146]=0;gn[24]=gn[146]=1;cn[24]=cn[146]=0;hn[24]=hn[146]=1;fn[24]=fn[146]=1;en[24]=en[146]=0;tn[24]=tn[146]=-1;rn[24]=rn[146]=0;an[6]=an[164]=-1;ln[6]=ln[164]=0;un[6]=un[164]=1;pn[6]=pn[164]=-1;dn[6]=dn[164]=0;gn[6]=gn[164]=0;vn[6]=vn[164]=0;xn[6]=xn[164]=-1;wn[6]=wn[164]=1;mn[6]=mn[164]=1;yn[6]=yn[164]=0;_n[6]=_n[164]=0;cn[129]=cn[41]=0;hn[129]=hn[41]=1;fn[129]=fn[41]=1;vn[129]=vn[41]=0;xn[129]=xn[41]=1;wn[129]=wn[41]=0;Yr[129]=Yr[41]=-1;Jr[129]=Jr[41]=0;Qr[129]=Qr[41]=0;en[129]=en[41]=0;tn[129]=tn[41]=-1;rn[129]=rn[41]=0;pn[66]=pn[104]=0;dn[66]=dn[104]=1;gn[66]=gn[104]=0;cn[66]=cn[104]=-1;hn[66]=hn[104]=0;fn[66]=fn[104]=1;mn[66]=mn[104]=0;yn[66]=yn[104]=-1;_n[66]=_n[104]=0;Yr[66]=Yr[104]=0;Jr[66]=Jr[104]=-1;Qr[66]=Qr[104]=1;nn[144]=nn[26]=-1;on[144]=on[26]=0;sn[144]=sn[26]=0;vn[144]=vn[26]=1;xn[144]=xn[26]=0;wn[144]=wn[26]=1;mn[144]=mn[26]=0;yn[144]=yn[26]=1;_n[144]=_n[26]=1;en[144]=en[26]=-1;tn[144]=tn[26]=0;rn[144]=rn[26]=1;an[36]=an[134]=0;ln[36]=ln[134]=1;un[36]=un[134]=1;pn[36]=pn[134]=0;dn[36]=dn[134]=1;gn[36]=gn[134]=0;Yr[36]=Yr[134]=0;Jr[36]=Jr[134]=-1;Qr[36]=Qr[134]=1;en[36]=en[134]=1;tn[36]=tn[134]=0;rn[36]=rn[134]=0;nn[9]=nn[161]=-1;on[9]=on[161]=0;sn[9]=sn[161]=0;an[9]=an[161]=0;ln[9]=ln[161]=-1;un[9]=un[161]=0;cn[9]=cn[161]=1;hn[9]=hn[161]=0;fn[9]=fn[161]=0;vn[9]=vn[161]=1;xn[9]=xn[161]=0;wn[9]=wn[161]=1;nn[136]=0;on[136]=1;sn[136]=1;an[136]=0;ln[136]=1;un[136]=0;pn[136]=-1;dn[136]=0;gn[136]=1;cn[136]=-1;hn[136]=0;fn[136]=0;vn[136]=0;xn[136]=-1;wn[136]=0;mn[136]=0;yn[136]=-1;_n[136]=1;Yr[136]=1;Jr[136]=0;Qr[136]=0;en[136]=1;tn[136]=0;rn[136]=1;nn[34]=0;on[34]=-1;sn[34]=0;an[34]=0;ln[34]=-1;un[34]=1;pn[34]=1;dn[34]=0;gn[34]=0;cn[34]=1;hn[34]=0;fn[34]=1;vn[34]=0;xn[34]=1;wn[34]=1;mn[34]=0;yn[34]=1;_n[34]=0;Yr[34]=-1;Jr[34]=0;Qr[34]=1;en[34]=-1;tn[34]=0;rn[34]=0;nn[35]=0;on[35]=1;sn[35]=1;an[35]=0;ln[35]=-1;un[35]=1;pn[35]=1;dn[35]=0;gn[35]=0;cn[35]=-1;hn[35]=0;fn[35]=0;vn[35]=0;xn[35]=-1;wn[35]=0;mn[35]=0;yn[35]=1;_n[35]=0;Yr[35]=-1;Jr[35]=0;Qr[35]=1;en[35]=1;tn[35]=0;rn[35]=1;nn[153]=0;on[153]=1;sn[153]=1;cn[153]=-1;hn[153]=0;fn[153]=0;vn[153]=0;xn[153]=-1;wn[153]=0;en[153]=1;tn[153]=0;rn[153]=1;an[102]=0;ln[102]=-1;un[102]=1;pn[102]=1;dn[102]=0;gn[102]=0;mn[102]=0;yn[102]=1;_n[102]=0;Yr[102]=-1;Jr[102]=0;Qr[102]=1;nn[155]=0;on[155]=-1;sn[155]=0;cn[155]=1;hn[155]=0;fn[155]=1;vn[155]=0;xn[155]=1;wn[155]=1;en[155]=-1;tn[155]=0;rn[155]=0;an[103]=0;ln[103]=1;un[103]=0;pn[103]=-1;dn[103]=0;gn[103]=1;mn[103]=0;yn[103]=-1;_n[103]=1;Yr[103]=1;Jr[103]=0;Qr[103]=0;nn[152]=0;on[152]=1;sn[152]=1;pn[152]=-1;dn[152]=0;gn[152]=1;cn[152]=-1;hn[152]=0;fn[152]=0;vn[152]=0;xn[152]=-1;wn[152]=0;mn[152]=0;yn[152]=-1;_n[152]=1;en[152]=1;tn[152]=0;rn[152]=1;nn[156]=0;on[156]=-1;sn[156]=1;pn[156]=1;dn[156]=0;gn[156]=1;cn[156]=-1;hn[156]=0;fn[156]=0;vn[156]=0;xn[156]=-1;wn[156]=0;mn[156]=0;yn[156]=1;_n[156]=1;en[156]=-1;tn[156]=0;rn[156]=1;nn[137]=0;on[137]=1;sn[137]=1;an[137]=0;ln[137]=1;un[137]=0;cn[137]=-1;hn[137]=0;fn[137]=0;vn[137]=0;xn[137]=-1;wn[137]=0;Yr[137]=1;Jr[137]=0;Qr[137]=0;en[137]=1;tn[137]=0;rn[137]=1;nn[139]=0;on[139]=1;sn[139]=1;an[139]=0;ln[139]=-1;un[139]=0;cn[139]=1;hn[139]=0;fn[139]=0;vn[139]=0;xn[139]=1;wn[139]=0;Yr[139]=-1;Jr[139]=0;Qr[139]=0;en[139]=1;tn[139]=0;rn[139]=1;nn[98]=0;on[98]=-1;sn[98]=0;an[98]=0;ln[98]=-1;un[98]=1;pn[98]=1;dn[98]=0;gn[98]=0;cn[98]=1;hn[98]=0;fn[98]=1;mn[98]=0;yn[98]=1;_n[98]=0;Yr[98]=-1;Jr[98]=0;Qr[98]=1;nn[99]=0;on[99]=1;sn[99]=0;an[99]=0;ln[99]=-1;un[99]=1;pn[99]=1;dn[99]=0;gn[99]=0;cn[99]=-1;hn[99]=0;fn[99]=1;mn[99]=0;yn[99]=-1;_n[99]=0;Yr[99]=1;Jr[99]=0;Qr[99]=1;an[38]=0;ln[38]=-1;un[38]=1;pn[38]=1;dn[38]=0;gn[38]=0;vn[38]=0;xn[38]=1;wn[38]=1;mn[38]=0;yn[38]=1;_n[38]=0;Yr[38]=-1;Jr[38]=0;Qr[38]=1;en[38]=-1;tn[38]=0;rn[38]=0;an[39]=0;ln[39]=1;un[39]=1;pn[39]=-1;dn[39]=0;gn[39]=0;vn[39]=0;xn[39]=-1;wn[39]=1;mn[39]=0;yn[39]=1;_n[39]=0;Yr[39]=-1;Jr[39]=0;Qr[39]=1;en[39]=1;tn[39]=0;rn[39]=0;var Hb=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Kb=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Yb=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Jb=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Qb=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},eT=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},tT=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},rT=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},UU=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},GU=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},VU=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},jU=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},qU=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},$U=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},ZU=function(){return[[0,0],[0,1],[1,1],[1,0]]},XU=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},WU=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},HU=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},KU=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},YU=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},JU=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},QU=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},e6=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},t6=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},r6=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},n6=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},i6=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},o6=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},s6=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},a6=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},l6=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},u6=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},c6=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},h6=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},f6=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},p6=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},d6=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},g6=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},m6=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},y6=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Zt=[],qt=[],lr=[],sr=[],gr=[],dr=[],En=[],Sn=[];sr[1]=gr[1]=18;sr[169]=gr[169]=18;lr[4]=qt[4]=12;lr[166]=qt[166]=12;Zt[16]=Sn[16]=4;Zt[154]=Sn[154]=4;dr[64]=En[64]=22;dr[106]=En[106]=22;lr[2]=dr[2]=17;sr[2]=gr[2]=18;lr[168]=dr[168]=17;sr[168]=gr[168]=18;Zt[8]=sr[8]=9;qt[8]=lr[8]=12;Zt[162]=sr[162]=9;qt[162]=lr[162]=12;Zt[32]=Sn[32]=4;qt[32]=En[32]=1;Zt[138]=Sn[138]=4;qt[138]=En[138]=1;gr[128]=Sn[128]=21;dr[128]=En[128]=22;gr[42]=Sn[42]=21;dr[42]=En[42]=22;qt[5]=gr[5]=14;qt[165]=gr[165]=14;lr[20]=Sn[20]=6;lr[150]=Sn[150]=6;Zt[80]=dr[80]=11;Zt[90]=dr[90]=11;sr[65]=En[65]=3;sr[105]=En[105]=3;Zt[160]=dr[160]=11;qt[160]=gr[160]=14;Zt[10]=dr[10]=11;qt[10]=gr[10]=14;lr[130]=Sn[130]=6;sr[130]=En[130]=3;lr[40]=Sn[40]=6;sr[40]=En[40]=3;qt[101]=En[101]=1;qt[69]=En[69]=1;gr[149]=Sn[149]=21;gr[21]=Sn[21]=21;lr[86]=dr[86]=17;lr[84]=dr[84]=17;Zt[89]=sr[89]=9;Zt[81]=sr[81]=9;Zt[96]=En[96]=0;qt[96]=dr[96]=15;Zt[74]=En[74]=0;qt[74]=dr[74]=15;Zt[24]=lr[24]=8;sr[24]=Sn[24]=7;Zt[146]=lr[146]=8;sr[146]=Sn[146]=7;qt[6]=dr[6]=15;lr[6]=gr[6]=16;qt[164]=dr[164]=15;lr[164]=gr[164]=16;sr[129]=Sn[129]=7;gr[129]=En[129]=20;sr[41]=Sn[41]=7;gr[41]=En[41]=20;lr[66]=En[66]=2;sr[66]=dr[66]=19;lr[104]=En[104]=2;sr[104]=dr[104]=19;Zt[144]=gr[144]=10;dr[144]=Sn[144]=23;Zt[26]=gr[26]=10;dr[26]=Sn[26]=23;qt[36]=Sn[36]=5;lr[36]=En[36]=2;qt[134]=Sn[134]=5;lr[134]=En[134]=2;Zt[9]=gr[9]=10;qt[9]=sr[9]=13;Zt[161]=gr[161]=10;qt[161]=sr[161]=13;qt[37]=Sn[37]=5;gr[37]=En[37]=20;qt[133]=Sn[133]=5;gr[133]=En[133]=20;lr[148]=gr[148]=16;dr[148]=Sn[148]=23;lr[22]=gr[22]=16;dr[22]=Sn[22]=23;Zt[82]=lr[82]=8;sr[82]=dr[82]=19;Zt[88]=lr[88]=8;sr[88]=dr[88]=19;Zt[73]=En[73]=0;qt[73]=sr[73]=13;Zt[97]=En[97]=0;qt[97]=sr[97]=13;Zt[145]=sr[145]=9;gr[145]=Sn[145]=21;Zt[25]=sr[25]=9;gr[25]=Sn[25]=21;qt[70]=En[70]=1;lr[70]=dr[70]=17;qt[100]=En[100]=1;lr[100]=dr[100]=17;Zt[34]=sr[34]=9;qt[34]=lr[34]=12;gr[34]=Sn[34]=21;dr[34]=En[34]=22;Zt[136]=Sn[136]=4;qt[136]=En[136]=1;lr[136]=dr[136]=17;sr[136]=gr[136]=18;Zt[35]=Sn[35]=4;qt[35]=lr[35]=12;sr[35]=gr[35]=18;dr[35]=En[35]=22;Zt[153]=Sn[153]=4;sr[153]=gr[153]=18;qt[102]=lr[102]=12;dr[102]=En[102]=22;Zt[155]=sr[155]=9;gr[155]=Sn[155]=23;qt[103]=En[103]=1;lr[103]=dr[103]=17;Zt[152]=Sn[152]=4;lr[152]=dr[152]=17;sr[152]=gr[152]=18;Zt[156]=lr[156]=8;sr[156]=gr[156]=18;dr[156]=Sn[156]=23;Zt[137]=Sn[137]=4;qt[137]=En[137]=1;sr[137]=gr[137]=18;Zt[139]=Sn[139]=4;qt[139]=sr[139]=13;gr[139]=En[139]=20;Zt[98]=sr[98]=9;qt[98]=lr[98]=12;dr[98]=En[98]=22;Zt[99]=En[99]=0;qt[99]=lr[99]=12;sr[99]=dr[99]=19;qt[38]=lr[38]=12;gr[38]=Sn[38]=21;dr[38]=En[38]=22;qt[39]=Sn[39]=5;lr[39]=gr[39]=16;dr[39]=En[39]=22;var Ut=[];Ut[1]=Ut[169]=Hb;Ut[4]=Ut[166]=Kb;Ut[16]=Ut[154]=Yb;Ut[64]=Ut[106]=Jb;Ut[168]=Ut[2]=Qb;Ut[162]=Ut[8]=eT;Ut[138]=Ut[32]=tT;Ut[42]=Ut[128]=rT;Ut[5]=Ut[165]=UU;Ut[20]=Ut[150]=GU;Ut[80]=Ut[90]=VU;Ut[65]=Ut[105]=jU;Ut[160]=Ut[10]=qU;Ut[130]=Ut[40]=$U;Ut[85]=ZU;Ut[101]=Ut[69]=XU;Ut[149]=Ut[21]=WU;Ut[86]=Ut[84]=HU;Ut[89]=Ut[81]=KU;Ut[96]=Ut[74]=YU;Ut[24]=Ut[146]=JU;Ut[6]=Ut[164]=QU;Ut[129]=Ut[41]=e6;Ut[66]=Ut[104]=t6;Ut[144]=Ut[26]=r6;Ut[36]=Ut[134]=n6;Ut[9]=Ut[161]=i6;Ut[37]=Ut[133]=o6;Ut[148]=Ut[22]=s6;Ut[82]=Ut[88]=a6;Ut[73]=Ut[97]=l6;Ut[145]=Ut[25]=u6;Ut[70]=Ut[100]=c6;Ut[34]=function(t){return[rT(t),eT(t)]};Ut[35]=h6;Ut[136]=function(t){return[tT(t),Qb(t)]};Ut[153]=function(t){return[Yb(t),Hb(t)]};Ut[102]=function(t){return[Kb(t),Jb(t)]};Ut[155]=f6;Ut[103]=p6;Ut[152]=function(t){return[Yb(t),Qb(t)]};Ut[156]=d6;Ut[137]=function(t){return[tT(t),Hb(t)]};Ut[139]=g6;Ut[98]=function(t){return[eT(t),Jb(t)]};Ut[99]=m6;Ut[38]=function(t){return[Kb(t),rT(t)]};Ut[39]=y6;function ee(t,e,r){return(t-e)/(r-e)}function $w(t){return t.constructor.toString().indexOf("Array")>-1}function _6(t,e,r){for(var n=t.length-1,i=t[0].length-1,a={rows:n,cols:i,cells:[]},h=e+Math.abs(r),s=0;s<n;++s){a.cells[s]=[];for(var g=0;g<i;++g){var m=0,w=t[s+1][g],b=t[s+1][g+1],I=t[s][g+1],A=t[s][g];if(!(isNaN(w)||isNaN(b)||isNaN(I)||isNaN(A))){m|=w<e?0:w>h?128:64,m|=b<e?0:b>h?32:16,m|=I<e?0:I>h?8:4,m|=A<e?0:A>h?2:1;var z=+m,V=0;if(m===17||m===18||m===33||m===34||m===38||m===68||m===72||m===98||m===102||m===132||m===136||m===137||m===152||m===153){var H=(w+b+I+A)/4;V=H>h?2:H<e?0:1,m===34?V===1?m=35:V===0&&(m=136):m===136?V===1?(m=35,V=4):V===0&&(m=34):m===17?V===1?(m=155,V=4):V===0&&(m=153):m===68?V===1?(m=103,V=4):V===0&&(m=102):m===153?V===1&&(m=155):m===102?V===1&&(m=103):m===152?V<2&&(m=156,V=1):m===137?V<2&&(m=139,V=1):m===98?V<2&&(m=99,V=1):m===38?V<2&&(m=39,V=1):m===18?V>0?(m=156,V=4):m=152:m===33?V>0?(m=139,V=4):m=137:m===72?V>0?(m=99,V=4):m=98:m===132&&(V>0?(m=39,V=4):m=38)}if(m!=0&&m!=170){var Z,D,k,j,Y,ie,ne,ae;Z=D=k=j=Y=ie=ne=ae=.5;var W=[];m===1?(k=1-ee(e,I,A),ae=1-ee(e,w,A),W.push(sr[m])):m===169?(k=ee(h,A,I),ae=ee(h,A,w),W.push(sr[m])):m===4?(ie=1-ee(e,b,I),j=ee(e,A,I),W.push(qt[m])):m===166?(ie=ee(h,I,b),j=1-ee(h,I,A),W.push(qt[m])):m===16?(Y=ee(e,I,b),D=ee(e,w,b),W.push(Zt[m])):m===154?(Y=1-ee(h,b,I),D=1-ee(h,b,w),W.push(Zt[m])):m===64?(ne=ee(e,A,w),Z=1-ee(e,b,w),W.push(dr[m])):m===106?(ne=1-ee(h,w,A),Z=ee(h,w,b),W.push(dr[m])):m===168?(j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),W.push(lr[m]),W.push(sr[m])):m===2?(j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),W.push(lr[m]),W.push(sr[m])):m===162?(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),W.push(lr[m]),W.push(sr[m])):m===8?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),W.push(Zt[m]),W.push(qt[m])):m===138?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(Zt[m]),W.push(qt[m])):m===32?(Y=ee(h,I,b),ie=ee(e,I,b),Z=ee(e,w,b),D=ee(h,w,b),W.push(Zt[m]),W.push(qt[m])):m===42?(ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b),W.push(gr[m]),W.push(dr[m])):m===128&&(ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(gr[m]),W.push(dr[m])),m===5?(ie=1-ee(e,b,I),ae=1-ee(e,w,A),W.push(qt[m])):m===165?(ie=ee(h,I,b),ae=ee(h,A,w),W.push(qt[m])):m===20?(j=ee(e,A,I),D=ee(e,w,b),W.push(lr[m])):m===150?(j=1-ee(h,I,A),D=1-ee(h,b,w),W.push(lr[m])):m===80?(Y=ee(e,I,b),ne=ee(e,A,w),W.push(Zt[m])):m===90?(Y=1-ee(h,b,I),ne=1-ee(h,w,A),W.push(Zt[m])):m===65?(k=1-ee(e,I,A),Z=1-ee(e,b,w),W.push(sr[m])):m===105?(k=ee(h,A,I),Z=ee(h,w,b),W.push(sr[m])):m===160?(Y=ee(h,I,b),ie=ee(e,I,b),ae=ee(e,A,w),ne=ee(h,A,w),W.push(Zt[m]),W.push(qt[m])):m===10?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),ae=1-ee(h,w,A),ne=1-ee(e,w,A),W.push(Zt[m]),W.push(qt[m])):m===130?(j=1-ee(e,I,A),k=1-ee(h,I,A),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(lr[m]),W.push(sr[m])):m===40?(j=ee(h,A,I),k=ee(e,A,I),Z=ee(e,w,b),D=ee(h,w,b),W.push(lr[m]),W.push(sr[m])):m===101?(ie=ee(h,I,b),Z=ee(h,w,b),W.push(qt[m])):m===69?(ie=1-ee(e,b,I),Z=1-ee(e,b,w),W.push(qt[m])):m===149?(ae=ee(h,A,w),D=1-ee(h,b,w),W.push(gr[m])):m===21?(ae=1-ee(e,w,A),D=ee(e,w,b),W.push(gr[m])):m===86?(j=1-ee(h,I,A),ne=1-ee(h,w,A),W.push(lr[m])):m===84?(j=ee(e,A,I),ne=ee(e,A,w),W.push(lr[m])):m===89?(Y=1-ee(h,b,I),k=ee(h,A,I),W.push(sr[m])):m===81?(Y=ee(e,I,b),k=1-ee(e,I,A),W.push(sr[m])):m===96?(Y=ee(h,I,b),ie=ee(e,I,b),ne=ee(e,A,w),Z=ee(h,w,b),W.push(Zt[m]),W.push(qt[m])):m===74?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),ne=1-ee(h,w,A),Z=1-ee(e,b,w),W.push(Zt[m]),W.push(qt[m])):m===24?(Y=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),D=ee(e,w,b),W.push(Zt[m]),W.push(sr[m])):m===146?(Y=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),D=1-ee(h,b,w),W.push(Zt[m]),W.push(sr[m])):m===6?(ie=1-ee(e,b,I),j=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),W.push(qt[m]),W.push(lr[m])):m===164?(ie=ee(h,I,b),j=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),W.push(qt[m]),W.push(lr[m])):m===129?(k=1-ee(e,I,A),ae=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(sr[m]),W.push(gr[m])):m===41?(k=ee(h,A,I),ae=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b),W.push(sr[m]),W.push(gr[m])):m===66?(j=1-ee(e,I,A),k=1-ee(h,I,A),ne=1-ee(h,w,A),Z=1-ee(e,b,w),W.push(lr[m]),W.push(sr[m])):m===104?(j=ee(h,A,I),k=ee(e,A,I),ne=ee(e,A,w),Z=ee(h,w,b),W.push(sr[m]),W.push(En[m])):m===144?(Y=ee(e,I,b),ae=ee(e,A,w),ne=ee(h,A,w),D=1-ee(h,b,w),W.push(Zt[m]),W.push(dr[m])):m===26?(Y=1-ee(h,b,I),ae=1-ee(h,w,A),ne=1-ee(e,w,A),D=ee(e,w,b),W.push(Zt[m]),W.push(dr[m])):m===36?(ie=ee(h,I,b),j=ee(e,A,I),Z=ee(e,w,b),D=ee(h,w,b),W.push(qt[m]),W.push(lr[m])):m===134?(ie=1-ee(e,b,I),j=1-ee(h,I,A),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(qt[m]),W.push(lr[m])):m===9?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),k=ee(h,A,I),ae=1-ee(e,w,A),W.push(Zt[m]),W.push(qt[m])):m===161?(Y=ee(h,I,b),ie=ee(e,I,b),k=1-ee(e,I,A),ae=ee(h,A,w),W.push(Zt[m]),W.push(qt[m])):m===37?(ie=ee(h,I,b),ae=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b),W.push(qt[m]),W.push(gr[m])):m===133?(ie=1-ee(e,b,I),ae=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w),W.push(qt[m]),W.push(gr[m])):m===148?(j=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),D=1-ee(h,b,w),W.push(lr[m]),W.push(dr[m])):m===22?(j=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),D=ee(e,w,b),W.push(lr[m]),W.push(dr[m])):m===82?(Y=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ne=1-ee(h,w,A),W.push(Zt[m]),W.push(sr[m])):m===88?(Y=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ne=ee(e,A,w),W.push(Zt[m]),W.push(sr[m])):m===73?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),k=ee(h,A,I),Z=1-ee(e,b,w),W.push(Zt[m]),W.push(qt[m])):m===97?(Y=ee(h,I,b),ie=ee(e,I,b),k=1-ee(e,I,A),Z=ee(h,w,b),W.push(Zt[m]),W.push(qt[m])):m===145?(Y=ee(e,I,b),k=1-ee(e,I,A),ae=ee(h,A,w),D=1-ee(h,b,w),W.push(Zt[m]),W.push(gr[m])):m===25?(Y=1-ee(h,b,I),k=ee(h,A,I),ae=1-ee(e,w,A),D=ee(e,w,b),W.push(Zt[m]),W.push(gr[m])):m===70?(ie=1-ee(e,b,I),j=1-ee(h,I,A),ne=1-ee(h,w,A),Z=1-ee(e,b,w),W.push(qt[m]),W.push(lr[m])):m===100?(ie=ee(h,I,b),j=ee(e,A,I),ne=ee(e,A,w),Z=ee(h,w,b),W.push(qt[m]),W.push(lr[m])):m===34?(V===0?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)):(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)),W.push(Zt[m]),W.push(qt[m]),W.push(gr[m]),W.push(dr[m])):m===35?(V===4?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)):(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)),W.push(Zt[m]),W.push(qt[m]),W.push(sr[m]),W.push(dr[m])):m===136?(V===0?(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)):(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)),W.push(Zt[m]),W.push(qt[m]),W.push(gr[m]),W.push(dr[m])):m===153?(V===0?(Y=ee(e,I,b),k=1-ee(e,I,A),ae=1-ee(e,w,A),D=ee(e,w,b)):(Y=1-ee(h,b,I),k=ee(h,A,I),ae=ee(h,A,w),D=1-ee(h,b,w)),W.push(Zt[m]),W.push(sr[m])):m===102?(V===0?(ie=1-ee(e,b,I),j=ee(e,A,I),ne=ee(e,A,w),Z=1-ee(e,b,w)):(ie=ee(h,I,b),j=1-ee(h,I,A),ne=1-ee(h,w,A),Z=ee(h,w,b)),W.push(qt[m]),W.push(dr[m])):m===155?(V===4?(Y=ee(e,I,b),k=1-ee(e,I,A),ae=1-ee(e,w,A),D=ee(e,w,b)):(Y=1-ee(h,b,I),k=ee(h,A,I),ae=ee(h,A,w),D=1-ee(h,b,w)),W.push(Zt[m]),W.push(gr[m])):m===103?(V===4?(ie=1-ee(e,b,I),j=ee(e,A,I),ne=ee(e,A,w),Z=1-ee(e,b,w)):(ie=ee(h,I,b),j=1-ee(h,I,A),ne=1-ee(h,w,A),Z=ee(h,w,b)),W.push(qt[m]),W.push(lr[m])):m===152?(V===0?(Y=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),D=ee(e,w,b)):(Y=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),D=1-ee(h,b,w)),W.push(Zt[m]),W.push(lr[m]),W.push(sr[m])):m===156?(V===4?(Y=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),D=ee(e,w,b)):(Y=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),D=1-ee(h,b,w)),W.push(Zt[m]),W.push(sr[m]),W.push(dr[m])):m===137?(V===0?(Y=ee(h,I,b),ie=ee(e,I,b),k=1-ee(e,I,A),ae=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)):(Y=1-ee(e,b,I),ie=1-ee(h,b,I),k=ee(h,A,I),ae=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)),W.push(Zt[m]),W.push(qt[m]),W.push(sr[m])):m===139?(V===4?(Y=ee(h,I,b),ie=ee(e,I,b),k=1-ee(e,I,A),ae=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)):(Y=1-ee(e,b,I),ie=1-ee(h,b,I),k=ee(h,A,I),ae=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)),W.push(Zt[m]),W.push(qt[m]),W.push(gr[m])):m===98?(V===0?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ne=ee(e,A,w),Z=1-ee(e,b,w)):(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ne=1-ee(h,w,A),Z=ee(h,w,b)),W.push(Zt[m]),W.push(qt[m]),W.push(dr[m])):m===99?(V===4?(Y=1-ee(e,b,I),ie=1-ee(h,b,I),j=ee(h,A,I),k=ee(e,A,I),ne=ee(e,A,w),Z=1-ee(e,b,w)):(Y=ee(h,I,b),ie=ee(e,I,b),j=1-ee(e,I,A),k=1-ee(h,I,A),ne=1-ee(h,w,A),Z=ee(h,w,b)),W.push(Zt[m]),W.push(qt[m]),W.push(sr[m])):m===38?(V===0?(ie=1-ee(e,b,I),j=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)):(ie=ee(h,I,b),j=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)),W.push(qt[m]),W.push(gr[m]),W.push(dr[m])):m===39?(V===4?(ie=1-ee(e,b,I),j=ee(e,A,I),ae=ee(e,A,w),ne=ee(h,A,w),Z=1-ee(h,b,w),D=1-ee(e,b,w)):(ie=ee(h,I,b),j=1-ee(h,I,A),ae=1-ee(h,w,A),ne=1-ee(e,w,A),Z=ee(e,w,b),D=ee(h,w,b)),W.push(qt[m]),W.push(lr[m]),W.push(dr[m])):m===85&&(Y=1,ie=0,j=1,k=0,ae=0,ne=1,Z=0,D=1),(Z<0||Z>1||D<0||D>1||Y<0||Y>1||j<0||j>1||ae<0||ae>1||ne<0||ne>1)&&console.log("MarchingSquaresJS-isoBands: "+m+" "+z+" "+w+","+b+","+I+","+A+" "+V+" "+Z+" "+D+" "+Y+" "+ie+" "+j+" "+k+" "+ae+" "+ne),a.cells[s][g]={cval:m,cval_real:z,flipped:V,topleft:Z,topright:D,righttop:Y,rightbottom:ie,bottomright:j,bottomleft:k,leftbottom:ae,lefttop:ne,edges:W}}}}}return a}function v6(t){for(var e=[],r=t.rows,n=t.cols,i=[],a=0;a<r;a++)for(var h=0;h<n;h++)if(typeof t.cells[a][h]<"u"&&t.cells[a][h].edges.length>0){var s=t.cells[a][h],g=E6(s),m=null,w=h,b=a;g!==null&&i.push([g.p[0]+w,g.p[1]+b]);do{if(m=b6(t.cells[b][w],g.x,g.y,g.o),m!==null)i.push([m.p[0]+w,m.p[1]+b]),w+=m.x,b+=m.y,g=m;else break;if(b<0||b>=r||w<0||w>=n||typeof t.cells[b][w]>"u"){w-=m.x,b-=m.y;var I=x6(t,w,b,m.x,m.y,m.o);if(I!==null)I.path.forEach(function(A){i.push(A)}),w=I.i,b=I.j,g=I;else break}}while(typeof t.cells[b][w]<"u"&&t.cells[b][w].edges.length>0);e.push(i),i=[],t.cells[a][h].edges.length>0&&h--}return e}function x6(t,e,r,n,i,a){for(var h=t.cells[r][e],s=h.cval_real,g=e+n,m=r+i,w=[],b=!1;!b;){if(typeof t.cells[m]>"u"||typeof t.cells[m][g]>"u")if(m-=i,g-=n,h=t.cells[m][g],s=h.cval_real,i===-1)if(a===0)if(s&es)w.push([g,m]),n=-1,i=0,a=0;else if(s&Bo)w.push([g+1,m]),n=1,i=0,a=0;else{w.push([g+h.bottomright,m]),n=0,i=1,a=1,b=!0;break}else if(s&es)w.push([g,m]),n=-1,i=0,a=0;else if(s&Bo){w.push([g+h.bottomright,m]),n=0,i=1,a=1,b=!0;break}else{w.push([g+h.bottomleft,m]),n=0,i=1,a=0,b=!0;break}else if(i===1)if(a===0)if(s&ol)w.push([g+1,m+1]),n=1,i=0,a=1;else if(s&ds){w.push([g+h.topleft,m+1]),n=0,i=-1,a=0,b=!0;break}else{w.push([g+h.topright,m+1]),n=0,i=-1,a=1,b=!0;break}else s&ol?(w.push([g+1,m+1]),n=1,i=0,a=1):(w.push([g+1,m+1]),n=1,i=0,a=1);else if(n===-1)if(a===0)if(s&ds)w.push([g,m+1]),n=0,i=1,a=0;else if(s&es){w.push([g,m+h.leftbottom]),n=1,i=0,a=0,b=!0;break}else{w.push([g,m+h.lefttop]),n=1,i=0,a=1,b=!0;break}else if(s&ds)w.push([g,m+1]),n=0,i=1,a=0;else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(n===1)if(a===0)if(s&Bo)w.push([g+1,m]),n=0,i=-1,a=1;else{w.push([g+1,m+h.rightbottom]),n=-1,i=0,a=0,b=!0;break}else if(s&Bo)w.push([g+1,m]),n=0,i=-1,a=1;else if(s&ol){w.push([g+1,m+h.righttop]),n=-1,i=0,a=1;break}else{w.push([g+1,m+h.rightbottom]),n=-1,i=0,a=0,b=!0;break}else{console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}else if(h=t.cells[m][g],s=h.cval_real,n===-1)if(a===0)if(typeof t.cells[m-1]<"u"&&typeof t.cells[m-1][g]<"u")n=0,i=-1,a=1;else if(s&es)w.push([g,m]);else{w.push([g+h.bottomright,m]),n=0,i=1,a=1,b=!0;break}else if(s&ds)console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!");else{console.log("MarchingSquaresJS-isoBands: found entry from top at "+g+","+m);break}else if(n===1)if(a===0){console.log("MarchingSquaresJS-isoBands: wtf");break}else if(typeof t.cells[m+1]<"u"&&typeof t.cells[m+1][g]<"u")n=0,i=1,a=0;else if(s&ol)w.push([g+1,m+1]),n=1,i=0,a=1;else{w.push([g+h.topleft,m+1]),n=0,i=-1,a=0,b=!0;break}else if(i===-1)if(a===1)if(typeof t.cells[m][g+1]<"u")n=1,i=0,a=1;else if(s&Bo)w.push([g+1,m]),n=0,i=-1,a=1;else{w.push([g+1,m+h.righttop]),n=-1,i=0,a=1,b=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else if(i===1)if(a===0)if(typeof t.cells[m][g-1]<"u")n=-1,i=0,a=0;else if(s&ds)w.push([g,m+1]),n=0,i=1,a=0;else{w.push([g,m+h.leftbottom]),n=1,i=0,a=0,b=!0;break}else{console.log("MarchingSquaresJS-isoBands: wtf");break}else{console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(g+=n,m+=i,g===e&&m===r)break}return{path:w,i:g,j:m,x:n,y:i,o:a}}function w6(t,e){delete t.edges[e];for(var r=e+1;r<t.edges.length;r++)t.edges[r-1]=t.edges[r];t.edges.pop()}function E6(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],r=t.cval_real;switch(e){case 0:return r&ol?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return r&Bo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return r&Bo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return r&es?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return r&ol?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return r&Bo?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return r&Bo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return r&es?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return r&Bo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return r&es?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return r&es?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return r&ds?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return r&Bo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return r&es?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return r&es?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return r&ds?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return r&Bo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return r&ds?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return r&es?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return r&ds?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return r&ds?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return r&ol?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return r&ds?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return r&ol?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t);break}}return null}function b6(t,e,r,n){var i,a,h,s,g=t.cval,m;switch(e){case-1:switch(n){case 0:i=qt[g],h=an[g],s=ln[g],m=un[g];break;default:i=Zt[g],h=nn[g],s=on[g],m=sn[g];break}break;case 1:switch(n){case 0:i=gr[g],h=vn[g],s=xn[g],m=wn[g];break;default:i=dr[g],h=mn[g],s=yn[g],m=_n[g];break}break;default:switch(r){case-1:switch(n){case 0:i=En[g],h=Yr[g],s=Jr[g],m=Qr[g];break;default:i=Sn[g],h=en[g],s=tn[g],m=rn[g];break}break;case 1:switch(n){case 0:i=sr[g],h=cn[g],s=hn[g],m=fn[g];break;default:i=lr[g],h=pn[g],s=dn[g],m=gn[g];break}break}break}if(a=t.edges.indexOf(i),typeof t.edges[a]<"u")w6(t,a);else return null;switch(g=t.cval_real,i){case 0:g&ol?(e=t.topleft,r=1):(e=1,r=t.righttop);break;case 1:g&Bo?(e=1,r=t.rightbottom):(e=t.topleft,r=1);break;case 2:g&Bo?(e=t.topleft,r=1):(e=t.bottomright,r=0);break;case 3:g&es?(e=t.bottomleft,r=0):(e=t.topleft,r=1);break;case 4:g&ol?(e=t.topright,r=1):(e=1,r=t.righttop);break;case 5:g&Bo?(e=1,r=t.rightbottom):(e=t.topright,r=1);break;case 6:g&Bo?(e=t.topright,r=1):(e=t.bottomright,r=0);break;case 7:g&es?(e=t.bottomleft,r=0):(e=t.topright,r=1);break;case 8:g&Bo?(e=1,r=t.righttop):(e=t.bottomright,r=0);break;case 9:g&es?(e=t.bottomleft,r=0):(e=1,r=t.righttop);break;case 10:g&es?(e=1,r=t.righttop):(e=0,r=t.leftbottom);break;case 11:g&ds?(e=0,r=t.lefttop):(e=1,r=t.righttop);break;case 12:g&Bo?(e=1,r=t.rightbottom):(e=t.bottomright,r=0);break;case 13:g&es?(e=t.bottomleft,r=0):(e=1,r=t.rightbottom);break;case 14:g&es?(e=1,r=t.rightbottom):(e=0,r=t.leftbottom);break;case 15:g&ds?(e=0,r=t.lefttop):(e=1,r=t.rightbottom);break;case 16:g&Bo?(e=0,r=t.leftbottom):(e=t.bottomright,r=0);break;case 17:g&ds?(e=0,r=t.lefttop):(e=t.bottomright,r=0);break;case 18:g&es?(e=t.bottomleft,r=0):(e=0,r=t.leftbottom);break;case 19:g&ds?(e=0,r=t.lefttop):(e=t.bottomleft,r=0);break;case 20:g&ds?(e=0,r=t.leftbottom):(e=t.topleft,r=1);break;case 21:g&ol?(e=t.topright,r=1):(e=0,r=t.leftbottom);break;case 22:g&ds?(e=0,r=t.lefttop):(e=t.topleft,r=1);break;case 23:g&ol?(e=t.topright,r=1):(e=0,r=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return(typeof e>"u"||typeof r>"u"||typeof h>"u"||typeof s>"u"||typeof m>"u")&&(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+r+" "+h+" "+s+" "+m)),{p:[e,r],x:h,y:s,o:m}}function T6(t){var e=[],r=0;return t.cells.forEach(function(n,i){n.forEach(function(a,h){if(typeof a<"u"){var s=Ut[a.cval](a);typeof s=="object"&&$w(s)?typeof s[0]=="object"&&$w(s[0])?typeof s[0][0]=="object"&&$w(s[0][0])?s.forEach(function(g){g.forEach(function(m){m[0]+=h,m[1]+=i}),e[r++]=g}):(s.forEach(function(g){g[0]+=h,g[1]+=i}),e[r++]=s):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),e}function S6(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},a=r.breaksProperties||[];if(Nc(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!Vn(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(a))throw new Error("breaksProperties is not an Array");var h=FU(t,{zProperty:n,flip:!0}),s=I6(h,e,n);s=P6(s,h,t);var g=s.map(function(m,w){if(a[w]&&!Vn(a[w]))throw new Error("Each mappedProperty is required to be an Object");var b=Mb({},i,a[w]);b[n]=m[n];var I=ga(m.groupedRings,b);return I});return hr(g)}function I6(t,e,r){for(var n=[],i=1;i<e.length;i++){var a=+e[i-1],h=+e[i],s=BU(t,a,h-a),g=C6(s),m=A6(g),w={};w.groupedRings=m,w[r]=a+"-"+h,n.push(w)}return n}function P6(t,e,r){var n=Fi(r),i=n[2]-n[0],a=n[3]-n[1],h=n[0],s=n[1],g=e[0].length-1,m=e.length-1,w=i/g,b=a/m,I=function(A){A[0]=A[0]*w+h,A[1]=A[1]*b+s};return t.forEach(function(A){A.groupedRings.forEach(function(z){z.forEach(function(V){V.forEach(I)})})}),t}function C6(t){var e=[],r=[];t.forEach(function(i){var a=Gb(qr([i]));r.push(a),e.push({ring:i,area:a})}),r.sort(function(i,a){return a-i});var n=[];return r.forEach(function(i){for(var a=0;a<e.length;a++)if(e[a].area===i){n.push(e[a].ring),e.splice(a,1);break}}),n}function A6(t){for(var e=t.map(function(g){return{lrCoordinates:g,grouped:!1}}),r=[];!L6(e);)for(var n=0;n<e.length;n++)if(!e[n].grouped){var i=[];i.push(e[n].lrCoordinates),e[n].grouped=!0;for(var a=qr([e[n].lrCoordinates]),h=n+1;h<e.length;h++)if(!e[h].grouped){var s=qr([e[h].lrCoordinates]);M6(s,a)&&(i.push(e[h].lrCoordinates),e[h].grouped=!0)}r.push(i)}return r}function M6(t,e){for(var r=h1(t),n=0;n<r.features.length;n++)if(!ci(r.features[n],e))return!1;return!0}function L6(t){for(var e=0;e<t.length;e++)if(t[e].grouped===!1)return!1;return!0}function kL(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.pivot,i=r.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");return e===0||(n||(n=Ih(t)),(i===!1||i===void 0)&&(t=ss(t)),ji(t,function(a){var h=Wf(n,a),s=h+e,g=g1(n,a),m=mr(Gd(n,g,s));a[0]=m[0],a[1]=m[1]})),t}function FL(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.origin,i=r.mutate;if(!t)throw new Error("geojson required");if(typeof e!="number"||e===0)throw new Error("invalid factor");var a=Array.isArray(n)||typeof n=="object";return i!==!0&&(t=ss(t)),t.type==="FeatureCollection"&&!a?(kn(t,function(h,s){t.features[s]=hC(h,e,n)}),t):hC(t,e,n)}function hC(t,e,r){var n=Zs(t)==="Point";return r=O6(t,r),e===1||n||ji(t,function(i){var a=g1(r,i),h=Wf(r,i),s=a*e,g=mr(Gd(r,s,h));i[0]=g[0],i[1]=g[1],i.length===3&&(i[2]*=e)}),t}function O6(t,e){if(e==null&&(e="centroid"),Array.isArray(e)||typeof e=="object")return oi(e);var r=t.bbox?t.bbox:Fi(t),n=r[0],i=r[1],a=r[2],h=r[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return Gr([n,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return Gr([a,i]);case"nw":case"northwest":case"westnorth":case"topleft":return Gr([n,h]);case"ne":case"northeast":case"eastnorth":case"topright":return Gr([a,h]);case"center":return c1(t);case void 0:case null:case"centroid":return Ih(t);default:throw new Error("invalid origin")}}function D6(t,e,r,n){if(n=n||{},!Vn(n))throw new Error("options is invalid");var i=n.units,a=n.zTranslation,h=n.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(a&&typeof a!="number"&&isNaN(a))throw new Error("zTranslation is not a number");if(a=a!==void 0?a:0,e===0&&a===0)return t;if(r==null||isNaN(r))throw new Error("direction is required");return e<0&&(e=-e,r=r+180),(h===!1||h===void 0)&&(t=ss(t)),ji(t,function(s){var g=mr(Gd(s,e,r,{units:i}));s[0]=g[0],s[1]=g[1],a&&s.length===3&&(s[2]+=a)}),t}function O0(t){var e=t[0],r=t[1];return[r[0]-e[0],r[1]-e[1]]}function zE(t,e){return t[0]*e[1]-e[0]*t[1]}function N6(t,e){return[t[0]+e[0],t[1]+e[1]]}function R6(t,e){return[t[0]-e[0],t[1]-e[1]]}function k6(t,e){return[t*e[0],t*e[1]]}function F6(t,e){var r=t[0],n=O0(t),i=e[0],a=O0(e),h=zE(n,a),s=R6(i,r),g=zE(s,a),m=g/h,w=N6(r,k6(m,n));return w}function z6(t,e){var r=O0(t),n=O0(e);return zE(r,n)===0}function B6(t,e){return z6(t,e)?!1:F6(t,e)}function U6(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var i=Zs(t),a=t.properties;switch(i){case"LineString":return fC(t,e,n);case"MultiLineString":var h=[];return jo(t,function(s){h.push(fC(s,e,n).geometry.coordinates)}),Fh(h,a);default:throw new Error("geometry "+i+" is not supported")}}function fC(t,e,r){var n=[],i=P0(e,r),a=mr(t),h=[];return a.forEach(function(s,g){if(g!==a.length-1){var m=G6(s,a[g+1],i);if(n.push(m),g>0){var w=n[g-1],b=B6(m,w);b!==!1&&(w[1]=b,m[0]=b),h.push(w[0]),g===a.length-2&&(h.push(m[0]),h.push(m[1]))}a.length===2&&(h.push(m[0]),h.push(m[1]))}}),Bn(h,t.properties)}function G6(t,e,r){var n=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),i=t[0]+r*(e[1]-t[1])/n,a=e[0]+r*(e[1]-t[1])/n,h=t[1]+r*(t[0]-e[0])/n,s=e[1]+r*(t[0]-e[0])/n;return[[i,h],[a,s]]}function V6(t){return(t>0)-(t<0)||+t}function nT(t,e,r){var n=e[0]-t[0],i=e[1]-t[1],a=r[0]-e[0],h=r[1]-e[1];return V6(n*h-a*i)}function j6(t,e){var r=t.geometry.coordinates[0].map(function(h){return h[0]}),n=t.geometry.coordinates[0].map(function(h){return h[1]}),i=e.geometry.coordinates[0].map(function(h){return h[0]}),a=e.geometry.coordinates[0].map(function(h){return h[1]});return Math.max.apply(null,r)===Math.max.apply(null,i)&&Math.max.apply(null,n)===Math.max.apply(null,a)&&Math.min.apply(null,r)===Math.min.apply(null,i)&&Math.min.apply(null,n)===Math.min.apply(null,a)}function pC(t,e){return e.geometry.coordinates[0].every(function(r){return ci(Gr(r),t)})}function q6(t,e){return t[0]===e[0]&&t[1]===e[1]}var dC=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(e){return e.join(",")},t.prototype.removeInnerEdge=function(e){this.innerEdges=this.innerEdges.filter(function(r){return r.from.id!==e.from.id})},t.prototype.removeOuterEdge=function(e){this.outerEdges=this.outerEdges.filter(function(r){return r.to.id!==e.to.id})},t.prototype.addOuterEdge=function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var e=this;this.outerEdgesSorted||(this.outerEdges.sort(function(r,n){var i=r.to,a=n.to;if(i.coordinates[0]-e.coordinates[0]>=0&&a.coordinates[0]-e.coordinates[0]<0)return 1;if(i.coordinates[0]-e.coordinates[0]<0&&a.coordinates[0]-e.coordinates[0]>=0)return-1;if(i.coordinates[0]-e.coordinates[0]===0&&a.coordinates[0]-e.coordinates[0]===0)return i.coordinates[1]-e.coordinates[1]>=0||a.coordinates[1]-e.coordinates[1]>=0?i.coordinates[1]-a.coordinates[1]:a.coordinates[1]-i.coordinates[1];var h=nT(e.coordinates,i.coordinates,a.coordinates);if(h<0)return 1;if(h>0)return-1;var s=Math.pow(i.coordinates[0]-e.coordinates[0],2)+Math.pow(i.coordinates[1]-e.coordinates[1],2),g=Math.pow(a.coordinates[0]-e.coordinates[0],2)+Math.pow(a.coordinates[1]-e.coordinates[1],2);return s-g}),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(e){return this.sortOuterEdges(),this.outerEdges[e]},t.prototype.addInnerEdge=function(e){this.innerEdges.push(e)},t}(),$6=function(){function t(e,r){this.from=e,this.to=r,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(e){return this.from.id===e.from.id&&this.to.id===e.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return Bn([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(e){return nT(e.from.coordinates,e.to.coordinates,this.to.coordinates)},t}(),Z6=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(e){this.edges.push(e),this.polygon=this.envelope=void 0},t.prototype.get=function(e){return this.edges[e]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(e){this.edges.forEach(e)},t.prototype.map=function(e){return this.edges.map(e)},t.prototype.some=function(e){return this.edges.some(e)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var e=this,r=this.edges.reduce(function(h,s,g){return s.from.coordinates[1]>e.edges[h].from.coordinates[1]&&(h=g),h},0),n=(r===0?this.length:r)-1,i=(r+1)%this.length,a=nT(this.edges[n].from.coordinates,this.edges[r].from.coordinates,this.edges[i].from.coordinates);return a===0?this.edges[n].from.coordinates[0]>this.edges[i].from.coordinates[0]:a>0},t.prototype.toMultiPoint=function(){return t_(this.edges.map(function(e){return e.from.coordinates}))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var e=this.edges.map(function(r){return r.from.coordinates});return e.push(this.edges[0].from.coordinates),this.polygon=qr([e])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=VM(this.toPolygon())},t.findEdgeRingContaining=function(e,r){var n=e.getEnvelope(),i,a;return r.forEach(function(h){var s=h.getEnvelope();if(a&&(i=a.getEnvelope()),!j6(s,n)&&pC(s,n)){for(var g=e.map(function(z){return z.from.coordinates}),m=void 0,w=function(z){h.some(function(V){return q6(z,V.from.coordinates)})||(m=z)},b=0,I=g;b<I.length;b++){var A=I[b];w(A)}m&&h.inside(Gr(m))&&(!a||pC(i,s))&&(a=h)}}),a},t.prototype.inside=function(e){return ci(e,this.toPolygon())},t}();const zL=Z6;function X6(t){if(!t)throw new Error("No geojson passed");if(t.type!=="FeatureCollection"&&t.type!=="GeometryCollection"&&t.type!=="MultiLineString"&&t.type!=="LineString"&&t.type!=="Feature")throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}var W6=function(){function t(){this.edges=[],this.nodes={}}return t.fromGeoJson=function(e){X6(e);var r=new t;return jo(e,function(n){Cy(n,"LineString","Graph::fromGeoJson"),Eb(n,function(i,a){if(i){var h=r.getNode(i),s=r.getNode(a);r.addEdge(h,s)}return a})}),r},t.prototype.getNode=function(e){var r=dC.buildId(e),n=this.nodes[r];return n||(n=this.nodes[r]=new dC(e)),n},t.prototype.addEdge=function(e,r){var n=new $6(e,r),i=n.getSymetric();this.edges.push(n),this.edges.push(i)},t.prototype.deleteDangles=function(){var e=this;Object.keys(this.nodes).map(function(r){return e.nodes[r]}).forEach(function(r){return e._removeIfDangle(r)})},t.prototype._removeIfDangle=function(e){var r=this;if(e.innerEdges.length<=1){var n=e.getOuterEdges().map(function(i){return i.to});this.removeNode(e),n.forEach(function(i){return r._removeIfDangle(i)})}},t.prototype.deleteCutEdges=function(){var e=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(r){r.label===r.symetric.label&&(e.removeEdge(r.symetric),e.removeEdge(r))})},t.prototype._computeNextCWEdges=function(e){var r=this;typeof e>"u"?Object.keys(this.nodes).forEach(function(n){return r._computeNextCWEdges(r.nodes[n])}):e.getOuterEdges().forEach(function(n,i){e.getOuterEdge((i===0?e.getOuterEdges().length:i)-1).symetric.next=n})},t.prototype._computeNextCCWEdges=function(e,r){for(var n=e.getOuterEdges(),i,a,h=n.length-1;h>=0;--h){var s=n[h],g=s.symetric,m=void 0,w=void 0;s.label===r&&(m=s),g.label===r&&(w=g),!(!m||!w)&&(w&&(a=w),m&&(a&&(a.next=m,a=void 0),i||(i=m)))}a&&(a.next=i)},t.prototype._findLabeledEdgeRings=function(){var e=[],r=0;return this.edges.forEach(function(n){if(!(n.label>=0)){e.push(n);var i=n;do i.label=r,i=i.next;while(!n.isEqual(i));r++}}),e},t.prototype.getEdgeRings=function(){var e=this;this._computeNextCWEdges(),this.edges.forEach(function(n){n.label=void 0}),this._findLabeledEdgeRings().forEach(function(n){e._findIntersectionNodes(n).forEach(function(i){e._computeNextCCWEdges(i,n.label)})});var r=[];return this.edges.forEach(function(n){n.ring||r.push(e._findEdgeRing(n))}),r},t.prototype._findIntersectionNodes=function(e){var r=[],n=e,i=function(){var a=0;n.from.getOuterEdges().forEach(function(h){h.label===e.label&&++a}),a>1&&r.push(n.from),n=n.next};do i();while(!e.isEqual(n));return r},t.prototype._findEdgeRing=function(e){var r=e,n=new zL;do n.push(r),r.ring=n,r=r.next;while(!e.isEqual(r));return n},t.prototype.removeNode=function(e){var r=this;e.getOuterEdges().forEach(function(n){return r.removeEdge(n)}),e.innerEdges.forEach(function(n){return r.removeEdge(n)}),delete this.nodes[e.id]},t.prototype.removeEdge=function(e){this.edges=this.edges.filter(function(r){return!r.isEqual(e)}),e.deleteEdge()},t}();const H6=W6;function K6(t){var e=H6.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var r=[],n=[];return e.getEdgeRings().filter(function(i){return i.isValid()}).forEach(function(i){i.isHole()?r.push(i):n.push(i)}),r.forEach(function(i){zL.findEdgeRingContaining(i,n)&&n.push(i)}),hr(n.map(function(i){return i.toPolygon()}))}function BL(t,e){var r=!0;return jo(t,function(n){jo(e,function(i){if(r===!1)return!1;r=Y6(n.geometry,i.geometry)})}),r}function Y6(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!t8(t.coordinates,e.coordinates);case"LineString":return!gC(e,t);case"Polygon":return!ci(t,e)}break;case"LineString":switch(e.type){case"Point":return!gC(t,e);case"LineString":return!J6(t,e);case"Polygon":return!mC(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ci(e,t);case"LineString":return!mC(t,e);case"Polygon":return!Q6(e,t)}}return!1}function gC(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(e8(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function J6(t,e){var r=Rc(t,e);return r.features.length>0}function mC(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){var i=n[r];if(ci(i,t))return!0}var a=Rc(e,Ny(t));return a.features.length>0}function Q6(t,e){for(var r=0,n=t.coordinates[0];r<n.length;r++){var i=n[r];if(ci(i,e))return!0}for(var a=0,h=e.coordinates[0];a<h.length;a++){var s=h[a];if(ci(s,t))return!0}var g=Rc(Ny(t),Ny(e));return g.features.length>0}function e8(t,e,r){var n=r[0]-t[0],i=r[1]-t[1],a=e[0]-t[0],h=e[1]-t[1],s=n*h-i*a;return s!==0?!1:Math.abs(a)>=Math.abs(h)?a>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:h>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]}function t8(t,e){return t[0]===e[0]&&t[1]===e[1]}function r8(t,e){var r=hi(t),n=hi(e),i=r.type,a=n.type,h=r.coordinates,s=n.coordinates;switch(i){case"Point":switch(a){case"Point":return iT(h,s);default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"Point":return n8(r,n);case"MultiPoint":return i8(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return ca(n,r,{ignoreEndVertices:!0});case"LineString":return a8(r,n);case"MultiPoint":return o8(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return ci(n,r,{ignoreBoundary:!0});case"LineString":return l8(r,n);case"Polygon":return u8(r,n);case"MultiPoint":return s8(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function n8(t,e){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(iT(t.coordinates[r],e.coordinates)){n=!0;break}return n}function i8(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){for(var i=n[r],a=!1,h=0,s=t.coordinates;h<s.length;h++){var g=s[h];if(iT(i,g)){a=!0;break}}if(!a)return!1}return!0}function o8(t,e){for(var r=!1,n=0,i=e.coordinates;n<i.length;n++){var a=i[n];if(ca(a,t,{ignoreEndVertices:!0})&&(r=!0),!ca(a,t))return!1}return!!r}function s8(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){var i=n[r];if(!ci(i,t,{ignoreBoundary:!0}))return!1}return!0}function a8(t,e){for(var r=!1,n=0,i=e.coordinates;n<i.length;n++){var a=i[n];if(ca({type:"Point",coordinates:a},t,{ignoreEndVertices:!0})&&(r=!0),!ca({type:"Point",coordinates:a},t,{ignoreEndVertices:!1}))return!1}return r}function l8(t,e){var r=!1,n=0,i=Fi(t),a=Fi(e);if(!UL(i,a))return!1;for(n;n<e.coordinates.length-1;n++){var h=c8(e.coordinates[n],e.coordinates[n+1]);if(ci({type:"Point",coordinates:h},t,{ignoreBoundary:!0})){r=!0;break}}return r}function u8(t,e){if(t.type==="Feature"&&t.geometry===null||e.type==="Feature"&&e.geometry===null)return!1;var r=Fi(t),n=Fi(e);if(!UL(r,n))return!1;for(var i=hi(e).coordinates,a=0,h=i;a<h.length;a++)for(var s=h[a],g=0,m=s;g<m.length;g++){var w=m[g];if(!ci(w,t))return!1}return!0}function UL(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function iT(t,e){return t[0]===e[0]&&t[1]===e[1]}function c8(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function h8(t,e){var r=hi(t),n=hi(e),i=r.type,a=n.type;switch(i){case"MultiPoint":switch(a){case"LineString":return yC(r,n);case"Polygon":return vC(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"MultiPoint":return yC(n,r);case"LineString":return f8(r,n);case"Polygon":return _C(r,n);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"MultiPoint":return vC(n,r);case"LineString":return _C(n,r);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function yC(t,e){for(var r=!1,n=!1,i=t.coordinates.length,a=0;a<i&&!r&&!n;){for(var h=0;h<e.coordinates.length-1;h++){var s=!0;(h===0||h===e.coordinates.length-2)&&(s=!1),GL(e.coordinates[h],e.coordinates[h+1],t.coordinates[a],s)?r=!0:n=!0}a++}return r&&n}function f8(t,e){var r=Rc(t,e);if(r.features.length>0)for(var n=0;n<t.coordinates.length-1;n++)for(var i=0;i<e.coordinates.length-1;i++){var a=!0;if((i===0||i===e.coordinates.length-2)&&(a=!1),GL(t.coordinates[n],t.coordinates[n+1],e.coordinates[i],a))return!0}return!1}function _C(t,e){var r=lL(e),n=Rc(t,r);return n.features.length>0}function vC(t,e){for(var r=!1,n=!1,i=t.coordinates.length,a=0;a<i&&(!r||!n);a++)ci(Gr(t.coordinates[a]),e)?r=!0:n=!0;return n&&r}function GL(t,e,r,n){var i=r[0]-t[0],a=r[1]-t[1],h=e[0]-t[0],s=e[1]-t[1],g=i*s-a*h;return g!==0?!1:n?Math.abs(h)>=Math.abs(s)?h>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:s>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]:Math.abs(h)>=Math.abs(s)?h>0?t[0]<r[0]&&r[0]<e[0]:e[0]<r[0]&&r[0]<t[0]:s>0?t[1]<r[1]&&r[1]<e[1]:e[1]<r[1]&&r[1]<t[1]}var p8=NL,Zu=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=t&&t.direction?t.direction:!1,this.pseudoNode=t&&t.pseudoNode?t.pseudoNode:!1,this.objectComparator=t&&t.objectComparator?t.objectComparator:d8};Zu.prototype.compare=function(t,e){if(t.type!==e.type||!VL(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(t.type.indexOf("Multi")===0){var r=this,n=xC(t),i=xC(e);return n.every(function(a){return this.some(function(h){return r.compare(a,h)})},i)}}return!1};function xC(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function VL(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}Zu.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r].toFixed(this.precision)!==e[r].toFixed(this.precision))return!1;return!0};Zu.prototype.compareLine=function(t,e,r,n){if(!VL(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),a=this.pseudoNode?e:this.removePseudo(e);if(!(n&&!this.compareCoord(i[0],a[0])&&(a=this.fixStartIndex(a,i),!a))){var h=this.compareCoord(i[r],a[r]);return this.direction||h?this.comparePath(i,a):this.compareCoord(i[r],a[a.length-(1+r)])?this.comparePath(i.slice().reverse(),a):!1}};Zu.prototype.fixStartIndex=function(t,e){for(var r,n=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){n=i;break}return n>=0&&(r=[].concat(t.slice(n,t.length),t.slice(1,n+1))),r};Zu.prototype.comparePath=function(t,e){var r=this;return t.every(function(n,i){return r.compareCoord(n,this[i])},e)};Zu.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var r=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),i=this;return r.every(function(a){return this.some(function(h){return i.compareLine(a,h,1,!0)})},n)}else return!1};Zu.prototype.compareFeature=function(t,e){return t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e)?!1:this.compare(t.geometry,e.geometry)};Zu.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))};Zu.prototype.removePseudo=function(t){return t};function d8(t,e){return p8(t,e,{strict:!0})}var g8=Zu;const jL=wa(g8);function m8(t,e){var r=hi(t),n=hi(e),i=r.type,a=n.type;if(i==="MultiPoint"&&a!=="MultiPoint"||(i==="LineString"||i==="MultiLineString")&&a!=="LineString"&&a!=="MultiLineString"||(i==="Polygon"||i==="MultiPolygon")&&a!=="Polygon"&&a!=="MultiPolygon")throw new Error("features must be of the same type");if(i==="Point")throw new Error("Point geometry not supported");var h=new jL({precision:6});if(h.compare(t,e))return!1;var s=0;switch(i){case"MultiPoint":for(var g=0;g<r.coordinates.length;g++)for(var m=0;m<n.coordinates.length;m++){var w=r.coordinates[g],b=n.coordinates[m];if(w[0]===b[0]&&w[1]===b[1])return!0}return!1;case"LineString":case"MultiLineString":gc(t,function(I){gc(e,function(A){RL(I,A).features.length&&s++})});break;case"Polygon":case"MultiPolygon":gc(t,function(I){gc(e,function(A){Rc(I,A).features.length&&s++})});break}return s>0}function y8(t,e){var r=hi(t).type,n=hi(e).type;if(r!==n)return!1;var i=new jL({precision:6});return i.compare($f(t),$f(e))}function qL(t,e){var r=!1;return jo(t,function(n){jo(e,function(i){if(r===!0)return!0;r=!BL(n.geometry,i.geometry)})}),r}var $L={exports:{}},Zw={exports:{}},wC;function _8(){return wC||(wC=1,function(t){function e(r,n,i,a){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(r,n,i,a)}e.prototype.run=function(r,n,i,a){this._init(r,n,i,a);for(var h=0;h<this._datasetLength;h++)if(this._visited[h]!==1){this._visited[h]=1;var s=this._regionQuery(h);if(s.length<this.minPts)this.noise.push(h);else{var g=this.clusters.length;this.clusters.push([]),this._addToCluster(h,g),this._expandCluster(g,s)}}return this.clusters},e.prototype._init=function(r,n,i,a){if(r){if(!(r instanceof Array))throw Error("Dataset must be of type array, "+typeof r+" given");this.dataset=r,this.clusters=[],this.noise=[],this._datasetLength=r.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}n&&(this.epsilon=n),i&&(this.minPts=i),a&&(this.distance=a)},e.prototype._expandCluster=function(r,n){for(var i=0;i<n.length;i++){var a=n[i];if(this._visited[a]!==1){this._visited[a]=1;var h=this._regionQuery(a);h.length>=this.minPts&&(n=this._mergeArrays(n,h))}this._assigned[a]!==1&&this._addToCluster(a,r)}},e.prototype._addToCluster=function(r,n){this.clusters[n].push(r),this._assigned[r]=1},e.prototype._regionQuery=function(r){for(var n=[],i=0;i<this._datasetLength;i++){var a=this.distance(this.dataset[r],this.dataset[i]);a<this.epsilon&&n.push(i)}return n},e.prototype._mergeArrays=function(r,n){for(var i=n.length,a=0;a<i;a++){var h=n[a];r.indexOf(h)<0&&r.push(h)}return r},e.prototype._euclideanDistance=function(r,n){for(var i=0,a=Math.min(r.length,n.length);a--;)i+=(r[a]-n[a])*(r[a]-n[a]);return Math.sqrt(i)},t.exports&&(t.exports=e)}(Zw)),Zw.exports}var Xw={exports:{}},EC;function v8(){return EC||(EC=1,function(t){function e(r,n,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(r,n,i)}e.prototype.init=function(r,n,i){this.assignments=[],this.centroids=[],typeof r<"u"&&(this.dataset=r),typeof n<"u"&&(this.k=n),typeof i<"u"&&(this.distance=i)},e.prototype.run=function(r,n){this.init(r,n);for(var i=this.dataset.length,a=0;a<this.k;a++)this.centroids[a]=this.randomCentroid();for(var h=!0;h;){h=this.assign();for(var s=0;s<this.k;s++){for(var g=new Array(I),m=0,w=0;w<I;w++)g[w]=0;for(var b=0;b<i;b++){var I=this.dataset[b].length;if(s===this.assignments[b]){for(var w=0;w<I;w++)g[w]+=this.dataset[b][w];m++}}if(m>0){for(var w=0;w<I;w++)g[w]/=m;this.centroids[s]=g}else this.centroids[s]=this.randomCentroid(),h=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var r=this.dataset.length-1,n,i;do i=Math.round(Math.random()*r),n=this.dataset[i];while(this.centroids.indexOf(n)>=0);return n},e.prototype.assign=function(){for(var r=!1,n=this.dataset.length,i,a=0;a<n;a++)i=this.argmin(this.dataset[a],this.centroids,this.distance),i!=this.assignments[a]&&(this.assignments[a]=i,r=!0);return r},e.prototype.getClusters=function(){for(var r=new Array(this.k),n,i=0;i<this.assignments.length;i++)n=this.assignments[i],typeof r[n]>"u"&&(r[n]=[]),r[n].push(i);return r},e.prototype.argmin=function(r,n,i){for(var a=Number.MAX_VALUE,h=0,s=n.length,g,m=0;m<s;m++)g=i(r,n[m]),g<a&&(a=g,h=m);return h},e.prototype.distance=function(r,n){for(var i=0,a=Math.min(r.length,n.length);a--;){var h=r[a]-n[a];i+=h*h}return Math.sqrt(i)},t.exports&&(t.exports=e)}(Xw)),Xw.exports}var Ww={exports:{}},Hw={exports:{}},bC;function ZL(){return bC||(bC=1,function(t){function e(r,n,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(r,n,i)}e.prototype.insert=function(r,n){for(var i=this._queue.length,a=i;a--;){var h=this._priorities[a];this._sorting==="desc"?n>h&&(i=a):n<h&&(i=a)}this._insertAt(r,n,i)},e.prototype.remove=function(r){for(var n=this._queue.length;n--;){var i=this._queue[n];if(r===i){this._queue.splice(n,1),this._priorities.splice(n,1);break}}},e.prototype.forEach=function(r){this._queue.forEach(r)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(r){return this._priorities[r]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var r=[],n=0,i=this._queue.length;n<i;n++)r.push([this._queue[n],this._priorities[n]]);return r},e.prototype._init=function(r,n,i){if(r&&n){if(this._queue=[],this._priorities=[],r.length!==n.length)throw new Error("Arrays must have the same length");for(var a=0;a<r.length;a++)this.insert(r[a],n[a])}i&&(this._sorting=i)},e.prototype._insertAt=function(r,n,i){this._queue.length===i?(this._queue.push(r),this._priorities.push(n)):(this._queue.splice(i,0,r),this._priorities.splice(i,0,n))},t.exports&&(t.exports=e)}(Hw)),Hw.exports}var TC;function x8(){return TC||(TC=1,function(t){if(t.exports)var e=ZL();function r(n,i,a,h){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(n,i,a,h)}r.prototype.run=function(n,i,a,h){this._init(n,i,a,h);for(var s=0,g=this.dataset.length;s<g;s++)if(this._processed[s]!==1){this._processed[s]=1,this.clusters.push([s]);var m=this.clusters.length-1;this._orderedList.push(s);var w=new e(null,null,"asc"),b=this._regionQuery(s);this._distanceToCore(s)!==void 0&&(this._updateQueue(s,b,w),this._expandCluster(m,w))}return this.clusters},r.prototype.getReachabilityPlot=function(){for(var n=[],i=0,a=this._orderedList.length;i<a;i++){var h=this._orderedList[i],s=this._reachability[h];n.push([h,s])}return n},r.prototype._init=function(n,i,a,h){if(n){if(!(n instanceof Array))throw Error("Dataset must be of type array, "+typeof n+" given");this.dataset=n,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}i&&(this.epsilon=i),a&&(this.minPts=a),h&&(this.distance=h)},r.prototype._updateQueue=function(n,i,a){var h=this;this._coreDistance=this._distanceToCore(n),i.forEach(function(s){if(h._processed[s]===void 0){var g=h.distance(h.dataset[n],h.dataset[s]),m=Math.max(h._coreDistance,g);h._reachability[s]===void 0?(h._reachability[s]=m,a.insert(s,m)):m<h._reachability[s]&&(h._reachability[s]=m,a.remove(s),a.insert(s,m))}})},r.prototype._expandCluster=function(n,i){for(var a=i.getElements(),h=0,s=a.length;h<s;h++){var g=a[h];if(this._processed[g]===void 0){var m=this._regionQuery(g);this._processed[g]=1,this.clusters[n].push(g),this._orderedList.push(g),this._distanceToCore(g)!==void 0&&(this._updateQueue(g,m,i),this._expandCluster(n,i))}}},r.prototype._distanceToCore=function(n){for(var i=this.epsilon,a=0;a<i;a++){var h=this._regionQuery(n,a);if(h.length>=this.minPts)return a}},r.prototype._regionQuery=function(n,i){i=i||this.epsilon;for(var a=[],h=0,s=this.dataset.length;h<s;h++)this.distance(this.dataset[n],this.dataset[h])<i&&a.push(h);return a},r.prototype._euclideanDistance=function(n,i){for(var a=0,h=Math.min(n.length,i.length);h--;)a+=(n[h]-i[h])*(n[h]-i[h]);return Math.sqrt(a)},t.exports&&(t.exports=r)}(Ww)),Ww.exports}(function(t){t.exports&&(t.exports={DBSCAN:_8(),KMEANS:v8(),OPTICS:x8(),PriorityQueue:ZL()})})($L);var w8=$L.exports;const E8=wa(w8);function b8(t,e,r){r===void 0&&(r={}),r.mutate!==!0&&(t=ss(t)),r.minPoints=r.minPoints||3;var n=new E8.DBSCAN,i=n.run(Bd(t),qf(e,r.units),r.minPoints,Rn),a=-1;return i.forEach(function(h){a++,h.forEach(function(s){var g=t.features[s];g.properties||(g.properties={}),g.properties.cluster=a,g.properties.dbscan="core"})}),n.noise.forEach(function(h){var s=t.features[h];s.properties||(s.properties={}),s.properties.cluster?s.properties.dbscan="edge":s.properties.dbscan="noise"}),t}var XL={eudist:function(e,r,n){for(var i=e.length,a=0,h=0;h<i;h++){var s=(e[h]||0)-(r[h]||0);a+=s*s}return n?Math.sqrt(a):a},mandist:function(e,r,n){for(var i=e.length,a=0,h=0;h<i;h++)a+=Math.abs((e[h]||0)-(r[h]||0));return n?Math.sqrt(a):a},dist:function(e,r,n){var i=Math.abs(e-r);return n?i:i*i}},WL=XL,T8=WL.eudist,S8=WL.dist,I8={kmrand:function(e,r){for(var n={},i=[],a=r<<2,h=e.length,s=e[0].length>0;i.length<r&&a-- >0;){var g=e[Math.floor(Math.random()*h)],m=s?g.join("_"):""+g;n[m]||(n[m]=!0,i.push(g))}if(i.length<r)throw new Error("Error initializating clusters");return i},kmpp:function(e,r){var n=e[0].length?T8:S8,i=[],a=e.length,h=e[0].length>0,s=e[Math.floor(Math.random()*a)];for(h?s.join("_"):""+s,i.push(s);i.length<r;){for(var g=[],m=i.length,w=0,b=[],I=0;I<a;I++){for(var A=1/0,z=0;z<m;z++){var V=n(e[I],i[z]);V<=A&&(A=V)}g[I]=A}for(var H=0;H<a;H++)w+=g[H];for(var Z=0;Z<a;Z++)b[Z]={i:Z,v:e[Z],pr:g[Z]/w,cs:0};b.sort(function(Y,ie){return Y.pr-ie.pr}),b[0].cs=b[0].pr;for(var D=1;D<a;D++)b[D].cs=b[D-1].cs+b[D].pr;for(var k=Math.random(),j=0;j<a-1&&b[j++].cs<k;);i.push(b[j-1].v)}return i}},oT=XL,HL=I8,P8=oT.eudist;oT.mandist;oT.dist;var C8=HL.kmrand,A8=HL.kmpp,SC=1e4;function IC(t,e,r){r=r||[];for(var n=0;n<t;n++)r[n]=e;return r}function M8(t,e,r,n){var i=[],a=[],h=[],s=[],g=!1,m=n||SC,w=t.length,b=t[0].length,I=b>0,A=[];if(r)r=="kmrand"?i=C8(t,e):r=="kmpp"?i=A8(t,e):i=r;else for(var z={};i.length<e;){var V=Math.floor(Math.random()*w);z[V]||(z[V]=!0,i.push(t[V]))}do{IC(e,0,A);for(var H=0;H<w;H++){for(var Z=1/0,D=0,k=0;k<e;k++){var s=I?P8(t[H],i[k]):Math.abs(t[H]-i[k]);s<=Z&&(Z=s,D=k)}h[H]=D,A[D]++}for(var j=[],a=[],Y=0;Y<e;Y++)j[Y]=I?IC(b,0,j[Y]):0,a[Y]=i[Y];if(I){for(var ie=0;ie<e;ie++)i[ie]=[];for(var ne=0;ne<w;ne++)for(var ae=h[ne],W=j[ae],$e=t[ne],Oe=0;Oe<b;Oe++)W[Oe]+=$e[Oe];g=!0;for(var ze=0;ze<e;ze++){for(var We=i[ze],Ze=j[ze],Pt=a[ze],at=A[ze],St=0;St<b;St++)We[St]=Ze[St]/at||0;if(g){for(var et=0;et<b;et++)if(Pt[et]!=We[et]){g=!1;break}}}}else{for(var zt=0;zt<w;zt++){var mt=h[zt];j[mt]+=t[zt]}for(var bt=0;bt<e;bt++)i[bt]=j[bt]/A[bt]||0;g=!0;for(var It=0;It<e;It++)if(a[It]!=i[It]){g=!1;break}}g=g||--m<=0}while(!g);return{it:SC-m,k:e,idxs:h,centroids:i}}var L8=M8;const O8=wa(L8);function D8(t,e){e===void 0&&(e={});var r=t.features.length;e.numberOfClusters=e.numberOfClusters||Math.round(Math.sqrt(r/2)),e.numberOfClusters>r&&(e.numberOfClusters=r),e.mutate!==!0&&(t=ss(t));var n=Bd(t),i=n.slice(0,e.numberOfClusters),a=O8(n,e.numberOfClusters,i),h={};return a.centroids.forEach(function(s,g){h[g]=s}),kn(t,function(s,g){var m=a.idxs[g];s.properties.cluster=m,s.properties.centroid=h[m]}),t}function N8(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");var r=PC(t,"line1");if(r!=="LineString")throw new Error("line1 must be a LineString");var n=PC(e,"line2");if(n!=="LineString")throw new Error("line2 must be a LineString");for(var i=Xf($f(t)).features,a=Xf($f(e)).features,h=0;h<i.length;h++){var s=i[h].geometry.coordinates;if(!a[h])break;var g=a[h].geometry.coordinates;if(!R8(s,g))return!1}return!0}function R8(t,e){var r=jf(Wf(t[0],t[1])),n=jf(Wf(e[0],e[1]));return r===n}function PC(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function CC(t){for(var e=t,r=[];e.parent;)r.unshift(e),e=e.parent;return r}function k8(){return new KL(function(t){return t.f})}var y1={search:function(t,e,r,n){t.cleanDirty(),n=n||{};var i=n.heuristic||y1.heuristics.manhattan,a=n.closest||!1,h=k8(),s=e;for(e.h=i(e,r),h.push(e);h.size()>0;){var g=h.pop();if(g===r)return CC(g);g.closed=!0;for(var m=t.neighbors(g),w=0,b=m.length;w<b;++w){var I=m[w];if(!(I.closed||I.isWall())){var A=g.g+I.getCost(g),z=I.visited;(!z||A<I.g)&&(I.visited=!0,I.parent=g,I.h=I.h||i(I,r),I.g=A,I.f=I.g+I.h,t.markDirty(I),a&&(I.h<s.h||I.h===s.h&&I.g<s.g)&&(s=I),z?h.rescoreElement(I):h.push(I))}}}return a?CC(s):[]},heuristics:{manhattan:function(t,e){var r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return r+n},diagonal:function(t,e){var r=1,n=Math.sqrt(2),i=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);return r*(i+a)+(n-2*r)*Math.min(i,a)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function pg(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var n=0,i=t[r];n<i.length;n++){var a=new _1(r,n,i[n]);this.grid[r][n]=a,this.nodes.push(a)}}this.init()}pg.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)y1.cleanNode(this.nodes[t])};pg.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)y1.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]};pg.prototype.markDirty=function(t){this.dirtyNodes.push(t)};pg.prototype.neighbors=function(t){var e=[],r=t.x,n=t.y,i=this.grid;return i[r-1]&&i[r-1][n]&&e.push(i[r-1][n]),i[r+1]&&i[r+1][n]&&e.push(i[r+1][n]),i[r]&&i[r][n-1]&&e.push(i[r][n-1]),i[r]&&i[r][n+1]&&e.push(i[r][n+1]),this.diagonal&&(i[r-1]&&i[r-1][n-1]&&e.push(i[r-1][n-1]),i[r+1]&&i[r+1][n-1]&&e.push(i[r+1][n-1]),i[r-1]&&i[r-1][n+1]&&e.push(i[r-1][n+1]),i[r+1]&&i[r+1][n+1]&&e.push(i[r+1][n+1])),e};pg.prototype.toString=function(){for(var t=[],e=this.grid,r,n,i,a,h=0,s=e.length;h<s;h++){for(r=[],n=e[h],i=0,a=n.length;i<a;i++)r.push(n[i].weight);t.push(r.join(" "))}return t.join(`
`)};function _1(t,e,r){this.x=t,this.y=e,this.weight=r}_1.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};_1.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?this.weight*1.41421:this.weight};_1.prototype.isWall=function(){return this.weight===0};function KL(t){this.content=[],this.scoreFunction=t}KL.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),r=this.content.pop();e!==this.content.length-1&&(this.content[e]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var r=(t+1>>1)-1,n=this.content[r];if(this.scoreFunction(e)<this.scoreFunction(n))this.content[r]=e,this.content[t]=n,t=r;else break}},bubbleUp:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i=t+1<<1,a=i-1,h=null,s;if(a<e){var g=this.content[a];s=this.scoreFunction(g),s<n&&(h=a)}if(i<e){var m=this.content[i],w=this.scoreFunction(m);w<(h===null?n:s)&&(h=i)}if(h!==null)this.content[t]=this.content[h],this.content[h]=r,t=h;else break}}};function F8(t,e,r){if(r=r||{},!Vn(r))throw new Error("options is invalid");var n=r.resolution,i=r.minDistance,a=r.obstacles||hr([]);if(!t)throw new Error("start is required");if(!e)throw new Error("end is required");if(n&&!Lo(n)||n<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var h=oi(t),s=oi(e);switch(t=Gr(h),e=Gr(s),Zs(a)){case"FeatureCollection":if(a.features.length===0)return Bn([h,s]);break;case"Polygon":a=hr([fo(hi(a))]);break;default:throw new Error("invalid obstacles")}var g=a;g.features.push(t),g.features.push(e);var m=Fi(FL(Fb(Fi(g)),1.15));if(!n){var w=Rn([m[0],m[1]],[m[2],m[1]],r);n=w/100}g.features.pop(),g.features.pop();for(var b=m[0],I=m[1],A=m[2],z=m[3],V=n/Rn([b,I],[A,I],r),H=V*(A-b),Z=n/Rn([b,I],[b,z],r),D=Z*(z-I),k=A-b,j=z-I,Y=Math.floor(k/H),ie=Math.floor(j/D),ne=(k-Y*H)/2,ae=(j-ie*D)/2,W=[],$e=[],Oe=[],ze=[],We=1/0,Ze=1/0,Pt=z-ae,at=0;Pt>=I;){for(var St=[],et=[],zt=b+ne,mt=0;zt<=A;){var bt=Gr([zt,Pt]),It=z8(bt,a);St.push(It?0:1),et.push(zt+"|"+Pt);var jt=Rn(bt,t);!It&&jt<We&&(We=jt,Oe={x:mt,y:at});var Jt=Rn(bt,e);!It&&Jt<Ze&&(Ze=Jt,ze={x:mt,y:at}),zt+=H,mt++}$e.push(St),W.push(et),Pt-=D,at++}var yr=new pg($e,{diagonal:!0}),rr=yr.grid[Oe.y][Oe.x],Ar=yr.grid[ze.y][ze.x],Ii=y1.search(yr,rr,Ar),Xr=[h];return Ii.forEach(function(si){var nr=W[si.x][si.y].split("|");Xr.push([+nr[0],+nr[1]])}),Xr.push(s),$f(Bn(Xr))}function z8(t,e){for(var r=0;r<e.features.length;r++)if(ci(t,e.features[r]))return!0;return!1}function AC(t){return function(){return t}}function B8(t){return t[0]}function U8(t){return t[1]}function D0(){this._=null}function v1(t){t.U=t.C=t.L=t.R=t.P=t.N=null}D0.prototype={constructor:D0,insert:function(t,e){var r,n,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;r=t}else this._?(t=MC(this._),e.P=null,e.N=t,t.P=t.L=e,r=t):(e.P=e.N=null,this._=e,r=null);for(e.L=e.R=null,e.U=r,e.C=!0,t=e;r&&r.C;)n=r.U,r===n.L?(i=n.R,i&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.R&&(ty(this,r),t=r,r=t.U),r.C=!1,n.C=!0,ry(this,n))):(i=n.L,i&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.L&&(ry(this,r),t=r,r=t.U),r.C=!1,n.C=!0,ty(this,n))),r=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,r,n=t.L,i=t.R,a,h;if(n?i?a=MC(i):a=n:a=i,e?e.L===t?e.L=a:e.R=a:this._=a,n&&i?(h=a.C,a.C=t.C,a.L=n,n.U=a,a!==i?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=i,i.U=a):(a.U=e,e=a,t=a.R)):(h=t.C,t=a),t&&(t.U=e),!h){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(r=e.R,r.C&&(r.C=!1,e.C=!0,ty(this,e),r=e.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,ry(this,r),r=e.R),r.C=e.C,e.C=r.R.C=!1,ty(this,e),t=this._;break}}else if(r=e.L,r.C&&(r.C=!1,e.C=!0,ry(this,e),r=e.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,ty(this,r),r=e.L),r.C=e.C,e.C=r.L.C=!1,ry(this,e),t=this._;break}r.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function ty(t,e){var r=e,n=e.R,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function ry(t,e){var r=e,n=e.L,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function MC(t){for(;t.L;)t=t.L;return t}function gy(t,e,r,n){var i=[null,null],a=As.push(i)-1;return i.left=t,i.right=e,r&&N0(i,t,e,r),n&&N0(i,e,t,n),La[t.index].halfedges.push(a),La[e.index].halfedges.push(a),i}function ny(t,e,r){var n=[e,r];return n.left=t,n}function N0(t,e,r,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=r):t.left===r?t[1]=n:t[0]=n}function G8(t,e,r,n,i){var a=t[0],h=t[1],s=a[0],g=a[1],m=h[0],w=h[1],b=0,I=1,A=m-s,z=w-g,V;if(V=e-s,!(!A&&V>0)){if(V/=A,A<0){if(V<b)return;V<I&&(I=V)}else if(A>0){if(V>I)return;V>b&&(b=V)}if(V=n-s,!(!A&&V<0)){if(V/=A,A<0){if(V>I)return;V>b&&(b=V)}else if(A>0){if(V<b)return;V<I&&(I=V)}if(V=r-g,!(!z&&V>0)){if(V/=z,z<0){if(V<b)return;V<I&&(I=V)}else if(z>0){if(V>I)return;V>b&&(b=V)}if(V=i-g,!(!z&&V<0)){if(V/=z,z<0){if(V>I)return;V>b&&(b=V)}else if(z>0){if(V<b)return;V<I&&(I=V)}return!(b>0)&&!(I<1)||(b>0&&(t[0]=[s+b*A,g+b*z]),I<1&&(t[1]=[s+I*A,g+I*z])),!0}}}}}function V8(t,e,r,n,i){var a=t[1];if(a)return!0;var h=t[0],s=t.left,g=t.right,m=s[0],w=s[1],b=g[0],I=g[1],A=(m+b)/2,z=(w+I)/2,V,H;if(I===w){if(A<e||A>=n)return;if(m>b){if(!h)h=[A,r];else if(h[1]>=i)return;a=[A,i]}else{if(!h)h=[A,i];else if(h[1]<r)return;a=[A,r]}}else if(V=(m-b)/(I-w),H=z-V*A,V<-1||V>1)if(m>b){if(!h)h=[(r-H)/V,r];else if(h[1]>=i)return;a=[(i-H)/V,i]}else{if(!h)h=[(i-H)/V,i];else if(h[1]<r)return;a=[(r-H)/V,r]}else if(w<I){if(!h)h=[e,V*e+H];else if(h[0]>=n)return;a=[n,V*n+H]}else{if(!h)h=[n,V*n+H];else if(h[0]<e)return;a=[e,V*e+H]}return t[0]=h,t[1]=a,!0}function j8(t,e,r,n){for(var i=As.length,a;i--;)(!V8(a=As[i],t,e,r,n)||!G8(a,t,e,r,n)||!(Math.abs(a[0][0]-a[1][0])>_i||Math.abs(a[0][1]-a[1][1])>_i))&&delete As[i]}function q8(t){return La[t.index]={site:t,halfedges:[]}}function $8(t,e){var r=t.site,n=e.left,i=e.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=e[1],i=e[0]):(n=e[0],i=e[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function YL(t,e){return e[+(e.left!==t.site)]}function Z8(t,e){return e[+(e.left===t.site)]}function X8(){for(var t=0,e=La.length,r,n,i,a;t<e;++t)if((r=La[t])&&(a=(n=r.halfedges).length)){var h=new Array(a),s=new Array(a);for(i=0;i<a;++i)h[i]=i,s[i]=$8(r,As[n[i]]);for(h.sort(function(g,m){return s[m]-s[g]}),i=0;i<a;++i)s[i]=n[h[i]];for(i=0;i<a;++i)n[i]=s[i]}}function W8(t,e,r,n){var i=La.length,a,h,s,g,m,w,b,I,A,z,V,H,Z=!0;for(a=0;a<i;++a)if(h=La[a]){for(s=h.site,m=h.halfedges,g=m.length;g--;)As[m[g]]||m.splice(g,1);for(g=0,w=m.length;g<w;)z=Z8(h,As[m[g]]),V=z[0],H=z[1],b=YL(h,As[m[++g%w]]),I=b[0],A=b[1],(Math.abs(V-I)>_i||Math.abs(H-A)>_i)&&(m.splice(g,0,As.push(ny(s,z,Math.abs(V-t)<_i&&n-H>_i?[t,Math.abs(I-t)<_i?A:n]:Math.abs(H-n)<_i&&r-V>_i?[Math.abs(A-n)<_i?I:r,n]:Math.abs(V-r)<_i&&H-e>_i?[r,Math.abs(I-r)<_i?A:e]:Math.abs(H-e)<_i&&V-t>_i?[Math.abs(A-e)<_i?I:t,e]:null))-1),++w);w&&(Z=!1)}if(Z){var D,k,j,Y=1/0;for(a=0,Z=null;a<i;++a)(h=La[a])&&(s=h.site,D=s[0]-t,k=s[1]-e,j=D*D+k*k,j<Y&&(Y=j,Z=h));if(Z){var ie=[t,e],ne=[t,n],ae=[r,n],W=[r,e];Z.halfedges.push(As.push(ny(s=Z.site,ie,ne))-1,As.push(ny(s,ne,ae))-1,As.push(ny(s,ae,W))-1,As.push(ny(s,W,ie))-1)}}for(a=0;a<i;++a)(h=La[a])&&(h.halfedges.length||delete La[a])}var JL=[],sT;function H8(){v1(this),this.x=this.y=this.arc=this.site=this.cy=null}function Sd(t){var e=t.P,r=t.N;if(!(!e||!r)){var n=e.site,i=t.site,a=r.site;if(n!==a){var h=i[0],s=i[1],g=n[0]-h,m=n[1]-s,w=a[0]-h,b=a[1]-s,I=2*(g*b-m*w);if(!(I>=-e9)){var A=g*g+m*m,z=w*w+b*b,V=(b*A-m*z)/I,H=(g*z-w*A)/I,Z=JL.pop()||new H8;Z.arc=t,Z.site=i,Z.x=V+h,Z.y=(Z.cy=H+s)+Math.sqrt(V*V+H*H),t.circle=Z;for(var D=null,k=Fy._;k;)if(Z.y<k.y||Z.y===k.y&&Z.x<=k.x)if(k.L)k=k.L;else{D=k.P;break}else if(k.R)k=k.R;else{D=k;break}Fy.insert(D,Z),D||(sT=Z)}}}}function Od(t){var e=t.circle;e&&(e.P||(sT=e.N),Fy.remove(e),JL.push(e),v1(e),t.circle=null)}var QL=[];function K8(){v1(this),this.edge=this.site=this.circle=null}function LC(t){var e=QL.pop()||new K8;return e.site=t,e}function Kw(t){Od(t),Dd.remove(t),QL.push(t),v1(t)}function Y8(t){var e=t.circle,r=e.x,n=e.cy,i=[r,n],a=t.P,h=t.N,s=[t];Kw(t);for(var g=a;g.circle&&Math.abs(r-g.circle.x)<_i&&Math.abs(n-g.circle.cy)<_i;)a=g.P,s.unshift(g),Kw(g),g=a;s.unshift(g),Od(g);for(var m=h;m.circle&&Math.abs(r-m.circle.x)<_i&&Math.abs(n-m.circle.cy)<_i;)h=m.N,s.push(m),Kw(m),m=h;s.push(m),Od(m);var w=s.length,b;for(b=1;b<w;++b)m=s[b],g=s[b-1],N0(m.edge,g.site,m.site,i);g=s[0],m=s[w-1],m.edge=gy(g.site,m.site,null,i),Sd(g),Sd(m)}function J8(t){for(var e=t[0],r=t[1],n,i,a,h,s=Dd._;s;)if(a=eO(s,r)-e,a>_i)s=s.L;else if(h=e-Q8(s,r),h>_i){if(!s.R){n=s;break}s=s.R}else{a>-_i?(n=s.P,i=s):h>-_i?(n=s,i=s.N):n=i=s;break}q8(t);var g=LC(t);if(Dd.insert(n,g),!(!n&&!i)){if(n===i){Od(n),i=LC(n.site),Dd.insert(g,i),g.edge=i.edge=gy(n.site,g.site),Sd(n),Sd(i);return}if(!i){g.edge=gy(n.site,g.site);return}Od(n),Od(i);var m=n.site,w=m[0],b=m[1],I=t[0]-w,A=t[1]-b,z=i.site,V=z[0]-w,H=z[1]-b,Z=2*(I*H-A*V),D=I*I+A*A,k=V*V+H*H,j=[(H*D-A*k)/Z+w,(I*k-V*D)/Z+b];N0(i.edge,m,z,j),g.edge=gy(m,t,null,j),i.edge=gy(t,z,null,j),Sd(n),Sd(i)}}function eO(t,e){var r=t.site,n=r[0],i=r[1],a=i-e;if(!a)return n;var h=t.P;if(!h)return-1/0;r=h.site;var s=r[0],g=r[1],m=g-e;if(!m)return s;var w=s-n,b=1/a-1/m,I=w/m;return b?(-I+Math.sqrt(I*I-2*b*(w*w/(-2*m)-g+m/2+i-a/2)))/b+n:(n+s)/2}function Q8(t,e){var r=t.N;if(r)return eO(r,e);var n=t.site;return n[1]===e?n[0]:1/0}var _i=1e-6,e9=1e-12,Dd,La,Fy,As;function t9(t,e,r){return(t[0]-r[0])*(e[1]-t[1])-(t[0]-e[0])*(r[1]-t[1])}function r9(t,e){return e[1]-t[1]||e[0]-t[0]}function BE(t,e){var r=t.sort(r9).pop(),n,i,a;for(As=[],La=new Array(t.length),Dd=new D0,Fy=new D0;;)if(a=sT,r&&(!a||r[1]<a.y||r[1]===a.y&&r[0]<a.x))(r[0]!==n||r[1]!==i)&&(J8(r),n=r[0],i=r[1]),r=t.pop();else if(a)Y8(a.arc);else break;if(X8(),e){var h=+e[0][0],s=+e[0][1],g=+e[1][0],m=+e[1][1];j8(h,s,g,m),W8(h,s,g,m)}this.edges=As,this.cells=La,Dd=Fy=As=La=null}BE.prototype={constructor:BE,polygons:function(){var t=this.edges;return this.cells.map(function(e){var r=e.halfedges.map(function(n){return YL(e,t[n])});return r.data=e.site.data,r})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(r,n){if(s=(a=r.halfedges).length)for(var i=r.site,a,h=-1,s,g,m=e[a[s-1]],w=m.left===i?m.right:m.left;++h<s;)g=w,m=e[a[h]],w=m.left===i?m.right:m.left,g&&w&&n<g.index&&n<w.index&&t9(i,g,w)<0&&t.push([i.data,g.data,w.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,r){for(var n=this,i,a=n._found||0,h=n.cells.length,s;!(s=n.cells[a]);)if(++a>=h)return null;var g=t-s.site[0],m=e-s.site[1],w=g*g+m*m;do s=n.cells[i=a],a=null,s.halfedges.forEach(function(b){var I=n.edges[b],A=I.left;if(!((A===s.site||!A)&&!(A=I.right))){var z=t-A[0],V=e-A[1],H=z*z+V*V;H<w&&(w=H,a=A.index)}});while(a!==null);return n._found=i,r==null||w<=r*r?s.site:null}};function n9(){var t=B8,e=U8,r=null;function n(i){return new BE(i.map(function(a,h){var s=[Math.round(t(a,h,i)/_i)*_i,Math.round(e(a,h,i)/_i)*_i];return s.index=h,s.data=a,s}),r)}return n.polygons=function(i){return n(i).polygons()},n.links=function(i){return n(i).links()},n.triangles=function(i){return n(i).triangles()},n.x=function(i){return arguments.length?(t=typeof i=="function"?i:AC(+i),n):t},n.y=function(i){return arguments.length?(e=typeof i=="function"?i:AC(+i),n):e},n.extent=function(i){return arguments.length?(r=i==null?null:[[+i[0][0],+i[0][1]],[+i[1][0],+i[1][1]]],n):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},n.size=function(i){return arguments.length?(r=i==null?null:[[0,0],[+i[0],+i[1]]],n):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},n}function i9(t){return t=t.slice(),t.push(t[0]),qr([t])}function o9(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(r))throw new Error("bbox is invalid");return Nc(t,"Point","points"),hr(n9().x(function(n){return n.geometry.coordinates[0]}).y(function(n){return n.geometry.coordinates[1]}).extent([[r[0],r[1]],[r[2],r[3]]]).polygons(t.features).map(i9))}function tO(t,e,r,n){n=n||{};var i=n.steps||64,a=n.units||"kilometers",h=n.angle||0,s=n.pivot||t,g=n.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!r)throw new Error("ySemiAxis is required");if(!Vn(n))throw new Error("options must be an object");if(!Lo(i))throw new Error("steps must be a number");if(!Lo(h))throw new Error("angle must be a number");var m=oi(t);if(a==="degrees")var w=Ao(h);else e=Gd(t,e,90,{units:a}),r=Gd(t,r,0,{units:a}),e=oi(e)[0]-m[0],r=oi(r)[1]-m[1];for(var b=[],I=0;I<i;I+=1){var A=I*-360/i,z=e*r/Math.sqrt(Math.pow(r,2)+Math.pow(e,2)*Math.pow(OC(A),2)),V=e*r/Math.sqrt(Math.pow(e,2)+Math.pow(r,2)/Math.pow(OC(A),2));if(A<-90&&A>=-270&&(z=-z),A<-180&&A>=-360&&(V=-V),a==="degrees"){var H=z*Math.cos(w)+V*Math.sin(w),Z=V*Math.cos(w)-z*Math.sin(w);z=H,V=Z}b.push([z+m[0],V+m[1]])}return b.push(b[0]),a==="degrees"?qr([b],g):kL(qr([b],g),h,{pivot:s})}function OC(t){var e=t*Math.PI/180;return Math.tan(e)}function aT(t,e){e===void 0&&(e={});var r=0,n=0,i=0;return ma(t,function(a,h,s){var g=e.weight?s==null?void 0:s[e.weight]:void 0;if(g=g??1,!Lo(g))throw new Error("weight value must be a number for feature index "+h);g=Number(g),g>0&&ji(a,function(m){r+=m[0]*g,n+=m[1]*g,i+=g})}),Gr([r/i,n/i],e.properties,e)}function s9(t,e){if(e===void 0&&(e={}),e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.counter||10;if(!Lo(r))throw new Error("counter must be a number");var n=e.weight,i=aT(t,{weight:e.weight}),a=hr([]);kn(t,function(s){var g;a.features.push(Ih(s,{properties:{weight:(g=s.properties)===null||g===void 0?void 0:g[n]}}))});var h={tolerance:e.tolerance,medianCandidates:[]};return rO(i.geometry.coordinates,[0,0],a,h,r)}function rO(t,e,r,n,i){var a=n.tolerance||.001,h=0,s=0,g=0,m=0;if(kn(r,function(I){var A,z=(A=I.properties)===null||A===void 0?void 0:A.weight,V=z??1;if(V=Number(V),!Lo(V))throw new Error("weight value must be a number");if(V>0){m+=1;var H=V*Rn(I,t);H===0&&(H=1);var Z=V/H;h+=I.geometry.coordinates[0]*Z,s+=I.geometry.coordinates[1]*Z,g+=Z}}),m<1)throw new Error("no features to measure");var w=h/g,b=s/g;return m===1||i===0||Math.abs(w-e[0])<a&&Math.abs(b-e[1])<a?Gr([w,b],{medianCandidates:n.medianCandidates}):(n.medianCandidates.push([w,b]),rO([w,b],t,r,n,i-1))}function a9(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.steps||64,n=e.weight,i=e.properties||{};if(!Lo(r))throw new Error("steps must be a number");if(!Vn(i))throw new Error("properties must be a number");var a=Bd(t).length,h=aT(t,{weight:n}),s=0,g=0,m=0;kn(t,function(ne){var ae=ne.properties[n]||1,W=DC(mr(ne),mr(h));s+=Math.pow(W.x,2)*ae,g+=Math.pow(W.y,2)*ae,m+=W.x*W.y*ae});var w=s-g,b=Math.sqrt(Math.pow(w,2)+4*Math.pow(m,2)),I=2*m,A=Math.atan((w+b)/I),z=A*180/Math.PI,V=0,H=0,Z=0;kn(t,function(ne){var ae=ne.properties[n]||1,W=DC(mr(ne),mr(h));V+=Math.pow(W.x*Math.cos(A)-W.y*Math.sin(A),2)*ae,H+=Math.pow(W.x*Math.sin(A)+W.y*Math.cos(A),2)*ae,Z+=ae});var D=Math.sqrt(2*V/Z),k=Math.sqrt(2*H/Z),j=tO(h,D,k,{units:"degrees",angle:z,steps:r,properties:i}),Y=wE(t,hr([j])),ie={meanCenterCoordinates:mr(h),semiMajorAxis:D,semiMinorAxis:k,numberOfFeatures:a,angle:z,percentageWithinEllipse:100*Bd(Y).length/a};return j.properties.standardDeviationalEllipse=ie,j}function DC(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function l9(t,e,r,n){if(n===void 0&&(n={}),!Vn(n))throw new Error("options is invalid");if(!t)throw new Error("startPoint is required");if(!e)throw new Error("midPoint is required");if(!r)throw new Error("endPoint is required");var i=t,a=e,h=r,s=jf(n.mercator!==!0?bc(i,a):Wf(i,a)),g=jf(n.mercator!==!0?bc(h,a):Wf(h,a)),m=Math.abs(s-g);return n.explementary===!0?360-m:m}function u9(t,e){var r=[],n=e.iterations||1;if(!t)throw new Error("inputPolys is required");return ma(t,function(i,a,h){var s,g,m;switch(i.type){case"Polygon":s=[[]];for(var w=0;w<n;w++)m=[[]],g=i,w>0&&(g=qr(s).geometry),c9(g,m),s=m.slice(0);r.push(qr(s,h));break;case"MultiPolygon":s=[[[]]];for(var b=0;b<n;b++)m=[[[]]],g=i,b>0&&(g=ga(s).geometry),h9(g,m),s=m.slice(0);r.push(ga(s,h));break;default:throw new Error("geometry is invalid, must be Polygon or MultiPolygon")}}),hr(r)}function c9(t,e){var r=0,n=0;ji(t,function(i,a,h,s,g){g>r&&(r=g,n=a,e.push([]));var m=a-n,w=t.coordinates[g][m+1],b=i[0],I=i[1],A=w[0],z=w[1];e[g].push([.75*b+.25*A,.75*I+.25*z]),e[g].push([.25*b+.75*A,.25*I+.75*z])},!0),e.forEach(function(i){i.push(i[0])})}function h9(t,e){var r=0,n=0,i=0;ji(t,function(a,h,s,g,m){g>i&&(i=g,n=h,e.push([[]])),m>r&&(r=m,n=h,e[g].push([]));var w=h-n,b=t.coordinates[g][m][w+1],I=a[0],A=a[1],z=b[0],V=b[1];e[g][m].push([.75*I+.25*z,.75*A+.25*V]),e[g][m].push([.25*I+.75*z,.25*A+.75*V])},!0),e.forEach(function(a){a.forEach(function(h){h.push(h[0])})})}function f9(t,e,r){r===void 0&&(r=2);var n=oi(t),i=oi(e),a=n[0]-i[0],h=n[1]-i[1];return r===1?Math.abs(a)+Math.abs(h):Math.pow(Math.pow(a,r)+Math.pow(h,r),1/r)}function nO(t,e){e=e||{};var r=e.threshold||1e4,n=e.p||2,i=e.binary||!1,a=e.alpha||-1,h=e.standardization||!1,s=[];kn(t,function(A){s.push(Ih(A))});for(var g=[],m=0;m<s.length;m++)g[m]=[];for(var m=0;m<s.length;m++)for(var w=m;w<s.length;w++){m===w&&(g[m][w]=0);var b=f9(s[m],s[w],n);g[m][w]=b,g[w][m]=b}for(var m=0;m<s.length;m++)for(var w=0;w<s.length;w++){var b=g[m][w];b!==0&&(i?b<=r?g[m][w]=1:g[m][w]=0:b<=r?g[m][w]=Math.pow(b,a):g[m][w]=0)}if(h)for(var m=0;m<s.length;m++)for(var I=g[m].reduce(function(z,V){return z+V},0),w=0;w<s.length;w++)g[m][w]=g[m][w]/I;return g}function p9(t,e){var r=e.inputField,n=e.threshold||1e5,i=e.p||2,a=e.binary||!1,h=e.alpha||-1,s=e.standardization||!0,g=nO(t,{alpha:h,binary:a,p:i,standardization:s,threshold:n}),m=[];kn(t,function(Oe){var ze=Oe.properties||{};m.push(ze[r])});for(var w=iO(m),b=d9(m),I=0,A=0,z=0,V=0,H=g.length,Z=0;Z<H;Z++){for(var D=0,k=0;k<H;k++)I+=g[Z][k]*(m[Z]-w)*(m[k]-w),A+=g[Z][k],z+=Math.pow(g[Z][k]+g[k][Z],2),D+=g[Z][k]+g[k][Z];V+=Math.pow(D,2)}z=.5*z;var j=I/A/b,Y=-1/(H-1),ie=H*H*z-H*V+3*(A*A),ne=(H-1)*(H+1)*(A*A),ae=ie/ne-Y*Y,W=Math.sqrt(ae),$e=(j-Y)/W;return{expectedMoranIndex:Y,moranIndex:j,stdNorm:W,zNorm:$e}}function iO(t){for(var e=0,r=0,n=t;r<n.length;r++){var i=n[r];e+=i}return e/t.length}function d9(t){for(var e=iO(t),r=0,n=0,i=t;n<i.length;n++){var a=i[n];r+=Math.pow(a-e,2)}return r/t.length}function oO(t,e){return e===void 0&&(e={}),aO(t,"mercator",e)}function sO(t,e){return e===void 0&&(e={}),aO(t,"wgs84",e)}function aO(t,e,r){r===void 0&&(r={}),r=r||{};var n=r.mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&Lo(t[0])?t=e==="mercator"?NC(t):RC(t):(n!==!0&&(t=ss(t)),ji(t,function(i){var a=e==="mercator"?NC(i):RC(i);i[0]=a[0],i[1]=a[1]})),t}function NC(t){var e=Math.PI/180,r=6378137,n=20037508342789244e-9,i=Math.abs(t[0])<=180?t[0]:t[0]-g9(t[0])*360,a=[r*i*e,r*Math.log(Math.tan(Math.PI*.25+.5*t[1]*e))];return a[0]>n&&(a[0]=n),a[0]<-n&&(a[0]=-n),a[1]>n&&(a[1]=n),a[1]<-n&&(a[1]=-n),a}function RC(t){var e=180/Math.PI,r=6378137;return[t[0]*e/r,(Math.PI*.5-2*Math.atan(Math.exp(-t[1]/r)))*e]}function g9(t){return t<0?-1:t>0?1:0}const m9=Object.freeze(Object.defineProperty({__proto__:null,toMercator:oO,toWgs84:sO},Symbol.toStringTag,{value:"Module"}));var y9=globalThis&&globalThis.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var a=arguments[e],h=0,s=a.length;h<s;h++,i++)n[i]=a[h];return n};function o_(t){return Array.isArray(t)?kC(t):t&&t.bbox?kC(t.bbox):[v9(),x9()]}function lO(t,e){e===void 0&&(e={}),t==null&&(t=1);for(var r=[],n=0;n<t;n++)r.push(Gr(o_(e.bbox)));return hr(r)}function uO(t,e){e===void 0&&(e={}),t==null&&(t=1),(!Lo(e.num_vertices)||e.num_vertices===void 0)&&(e.num_vertices=10),(!Lo(e.max_radial_length)||e.max_radial_length===void 0)&&(e.max_radial_length=10);for(var r=[],n=function(a){var h=[],s=y9(Array(e.num_vertices+1)).map(Math.random);s.forEach(function(g,m,w){w[m]=m>0?g+w[m-1]:g}),s.forEach(function(g){g=g*2*Math.PI/s[s.length-1];var m=Math.random();h.push([m*(e.max_radial_length||10)*Math.sin(g),m*(e.max_radial_length||10)*Math.cos(g)])}),h[h.length-1]=h[0],h=h.map(_9(o_(e.bbox))),r.push(qr([h]))},i=0;i<t;i++)n();return hr(r)}function cO(t,e){if(e===void 0&&(e={}),e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.bbox,n=e.num_vertices,i=e.max_length,a=e.max_rotation;t==null&&(t=1),(!Lo(n)||n===void 0||n<2)&&(n=10),(!Lo(i)||i===void 0)&&(i=1e-4),(!Lo(a)||a===void 0)&&(a=Math.PI/8);for(var h=[],s=0;s<t;s++){for(var g=o_(r),m=[g],w=0;w<n-1;w++){var b=w===0?Math.random()*2*Math.PI:Math.tan((m[w][1]-m[w-1][1])/(m[w][0]-m[w-1][0])),I=b+(Math.random()-.5)*a*2,A=Math.random()*i;m.push([m[w][0]+A*Math.cos(I),m[w][1]+A*Math.sin(I)])}h.push(Bn(m))}return hr(h)}function _9(t){return function(e){return[e[0]+t[0],e[1]+t[1]]}}function hO(){return Math.random()-.5}function v9(){return hO()*360}function x9(){return hO()*180}function kC(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}const w9=Object.freeze(Object.defineProperty({__proto__:null,randomLineString:cO,randomPoint:lO,randomPolygon:uO,randomPosition:o_},Symbol.toStringTag,{value:"Module"}));function fO(t,e){if(!t)throw new Error("geojson is required");if(t.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(e==null)throw new Error("filter is required");var r=[];return kn(t,function(n){x1(n.properties,e)&&r.push(n)}),hr(r)}function lT(t,e,r){if(!t)throw new Error("geojson is required");if(t.type!=="FeatureCollection")throw new Error("geojson must be a FeatureCollection");if(e==null)throw new Error("property is required");for(var n=uT(t,e),i=Object.keys(n),a=0;a<i.length;a++){for(var h=i[a],s=n[h],g=[],m=0;m<s.length;m++)g.push(t.features[s[m]]);r(hr(g),h,a)}}function pO(t,e,r,n){var i=n;return lT(t,e,function(a,h,s){s===0&&n===void 0?i=a:i=r(i,a,h,s)}),i}function uT(t,e){var r={};return kn(t,function(n,i){var a=n.properties||{};if(Object.prototype.hasOwnProperty.call(a,String(e))){var h=a[e];Object.prototype.hasOwnProperty.call(r,h)?r[h].push(i):r[h]=[i]}}),r}function x1(t,e){if(t===void 0)return!1;var r=typeof e;if(r==="number"||r==="string")return Object.prototype.hasOwnProperty.call(t,e);if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(!x1(t,e[n]))return!1;return!0}else return cT(t,e)}function cT(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];if(t[i]!==e[i])return!1}return!0}function dO(t,e){if(!e)return{};if(!e.length)return{};for(var r={},n=0;n<e.length;n++){var i=e[n];Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r}const E9=Object.freeze(Object.defineProperty({__proto__:null,applyFilter:x1,clusterEach:lT,clusterReduce:pO,createBins:uT,filterProperties:dO,getCluster:fO,propertiesContainsFilter:cT},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b9(t,e){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,h;return h={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function s(m){return function(w){return g([m,w])}}function g(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=m[0]&2?i.return:m[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,m[1])).done)return a;switch(i=0,a&&(m=[m[0]&2,a.value]),m[0]){case 0:case 1:a=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,i=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!a||m[1]>a[0]&&m[1]<a[3])){r.label=m[1];break}if(m[0]===6&&r.label<a[1]){r.label=a[1],a=m;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(m);break}a[2]&&r.ops.pop(),r.trys.pop();continue}m=e.call(t,r)}catch(w){m=[6,w],i=0}finally{n=a=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}var Ph=function(){function t(e,r){this.next=null,this.key=e,this.data=r,this.left=null,this.right=null}return t}();function T9(t,e){return t>e?1:t<e?-1:0}function yh(t,e,r){for(var n=new Ph(null,null),i=n,a=n;;){var h=r(t,e.key);if(h<0){if(e.left===null)break;if(r(t,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}a.left=e,a=e,e=e.left}else if(h>0){if(e.right===null)break;if(r(t,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,a.left=e.right,e.left=n.right,e.right=n.left,e}function Yw(t,e,r,n){var i=new Ph(t,e);if(r===null)return i.left=i.right=null,i;r=yh(t,r,n);var a=n(t,r.key);return a<0?(i.left=r.left,i.right=r,r.left=null):a>=0&&(i.right=r.right,i.left=r,r.right=null),i}function FC(t,e,r){var n=null,i=null;if(e){e=yh(t,e,r);var a=r(e.key,t);a===0?(n=e.left,i=e.right):a<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function S9(t,e,r){return e===null?t:(t===null||(e=yh(t.key,e,r),e.left=t),e)}function UE(t,e,r,n,i){if(t){n(""+e+(r?" ":" ")+i(t)+`
`);var a=e+(r?"    ":"   ");t.left&&UE(t.left,a,!1,n,i),t.right&&UE(t.right,a,!0,n,i)}}var hT=function(){function t(e){e===void 0&&(e=T9),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,r){return this._size++,this._root=Yw(e,r,this._root,this._comparator)},t.prototype.add=function(e,r){var n=new Ph(e,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=yh(e,this._root,i),h=i(e,a.key);return h===0?this._root=a:(h<0?(n.left=a.left,n.right=a,a.left=null):h>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,r,n){var i;if(r===null)return null;r=yh(e,r,n);var a=n(e,r.key);return a===0?(r.left===null?i=r.right:(i=yh(e,r.left,n),i.right=r.right),this._size--,i):r},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=yh(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var r=this._root,n=this._comparator;r;){var i=n(e,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},t.prototype.find=function(e){return this._root&&(this._root=yh(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var r=this._root,n=this._comparator;r;){var i=n(e,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},t.prototype.forEach=function(e,r){for(var n=this._root,i=[],a=!1;!a;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(r,n),n=n.right):a=!0;return this},t.prototype.range=function(e,r,n,i){for(var a=[],h=this._comparator,s=this._root,g;a.length!==0||s;)if(s)a.push(s),s=s.left;else{if(s=a.pop(),g=h(s.key,r),g>0)break;if(h(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(r){var n=r.key;return e.push(n)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(r){var n=r.data;return e.push(n)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var r=this._root,n=!1,i=0,a=[];!n;)if(r)a.push(r),r=r.left;else if(a.length>0){if(r=a.pop(),i===e)return r;i++,r=r.right}else n=!0;return null},t.prototype.next=function(e){var r=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var a=i(e.key,r.key);if(a===0)break;a<0?(n=r,r=r.left):r=r.right}return n},t.prototype.prev=function(e){var r=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var a=i(e.key,r.key);if(a===0)break;a<0?r=r.left:(n=r,r=r.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return P9(this._root)},t.prototype.load=function(e,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=e.length,a=this._comparator;if(n&&jE(e,r,0,i-1,a),this._root===null)this._root=GE(e,r,0,i),this._size=i;else{var h=C9(this.toList(),I9(e,r),a);i=this._size+i,this._root=VE({head:h},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var r=[];return UE(this._root,"",!0,function(n){return r.push(n)},e),r.join("")},t.prototype.update=function(e,r,n){var i=this._comparator,a=FC(e,this._root,i),h=a.left,s=a.right;i(e,r)<0?s=Yw(r,n,s,i):h=Yw(r,n,h,i),this._root=S9(h,s,i)},t.prototype.split=function(e){return FC(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,r,n;return b9(this,function(i){switch(i.label){case 0:e=this._root,r=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(r.push(e),e=e.left,[3,5]);case 2:return r.length===0?[3,4]:(e=r.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function GE(t,e,r,n){var i=n-r;if(i>0){var a=r+Math.floor(i/2),h=t[a],s=e[a],g=new Ph(h,s);return g.left=GE(t,e,r,a),g.right=GE(t,e,a+1,n),g}return null}function I9(t,e){for(var r=new Ph(null,null),n=r,i=0;i<t.length;i++)n=n.next=new Ph(t[i],e[i]);return n.next=null,r.next}function P9(t){for(var e=t,r=[],n=!1,i=new Ph(null,null),a=i;!n;)e?(r.push(e),e=e.left):r.length>0?(e=a=a.next=r.pop(),e=e.right):n=!0;return a.next=null,i.next}function VE(t,e,r){var n=r-e;if(n>0){var i=e+Math.floor(n/2),a=VE(t,e,i),h=t.head;return h.left=a,t.head=t.head.next,h.right=VE(t,i+1,r),h}return null}function C9(t,e,r){for(var n=new Ph(null,null),i=n,a=t,h=e;a!==null&&h!==null;)r(a.key,h.key)<0?(i.next=a,a=a.next):(i.next=h,h=h.next),i=i.next;return a!==null?i.next=a:h!==null&&(i.next=h),n.next}function jE(t,e,r,n,i){if(!(r>=n)){for(var a=t[r+n>>1],h=r-1,s=n+1;;){do h++;while(i(t[h],a)<0);do s--;while(i(t[s],a)>0);if(h>=s)break;var g=t[h];t[h]=t[s],t[s]=g,g=e[h],e[h]=e[s],e[s]=g}jE(t,e,r,s,i),jE(t,e,s+1,n,i)}}function xl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zC(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xs(t,e,r){return e&&zC(t.prototype,e),r&&zC(t,r),t}var iy=function(e,r){return e.ll.x<=r.x&&r.x<=e.ur.x&&e.ll.y<=r.y&&r.y<=e.ur.y},qE=function(e,r){if(r.ur.x<e.ll.x||e.ur.x<r.ll.x||r.ur.y<e.ll.y||e.ur.y<r.ll.y)return null;var n=e.ll.x<r.ll.x?r.ll.x:e.ll.x,i=e.ur.x<r.ur.x?e.ur.x:r.ur.x,a=e.ll.y<r.ll.y?r.ll.y:e.ll.y,h=e.ur.y<r.ur.y?e.ur.y:r.ur.y;return{ll:{x:n,y:a},ur:{x:i,y:h}}},vh=Number.EPSILON;vh===void 0&&(vh=Math.pow(2,-52));var A9=vh*vh,$E=function(e,r){if(-vh<e&&e<vh&&-vh<r&&r<vh)return 0;var n=e-r;return n*n<A9*e*r?0:e<r?-1:1},M9=function(){function t(){xl(this,t),this.reset()}return Xs(t,[{key:"reset",value:function(){this.xRounder=new BC,this.yRounder=new BC}},{key:"round",value:function(r,n){return{x:this.xRounder.round(r),y:this.yRounder.round(n)}}}]),t}(),BC=function(){function t(){xl(this,t),this.tree=new hT,this.round(0)}return Xs(t,[{key:"round",value:function(r){var n=this.tree.add(r),i=this.tree.prev(n);if(i!==null&&$E(n.key,i.key)===0)return this.tree.remove(r),i.key;var a=this.tree.next(n);return a!==null&&$E(n.key,a.key)===0?(this.tree.remove(r),a.key):r}}]),t}(),zy=new M9,wy=function(e,r){return e.x*r.y-e.y*r.x},gO=function(e,r){return e.x*r.x+e.y*r.y},UC=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},a={x:n.x-e.x,y:n.y-e.y},h=wy(i,a);return $E(h,0)},R0=function(e){return Math.sqrt(gO(e,e))},L9=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return wy(a,i)/R0(a)/R0(i)},O9=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return gO(a,i)/R0(a)/R0(i)},GC=function(e,r,n){return r.y===0?null:{x:e.x+r.x/r.y*(n-e.y),y:n}},VC=function(e,r,n){return r.x===0?null:{x:n,y:e.y+r.y/r.x*(n-e.x)}},D9=function(e,r,n,i){if(r.x===0)return VC(n,i,e.x);if(i.x===0)return VC(e,r,n.x);if(r.y===0)return GC(n,i,e.y);if(i.y===0)return GC(e,r,n.y);var a=wy(r,i);if(a==0)return null;var h={x:n.x-e.x,y:n.y-e.y},s=wy(h,r)/a,g=wy(h,i)/a,m=e.x+g*r.x,w=n.x+s*i.x,b=e.y+g*r.y,I=n.y+s*i.y,A=(m+w)/2,z=(b+I)/2;return{x:A,y:z}},Mu=function(){Xs(t,null,[{key:"compare",value:function(r,n){var i=t.comparePoints(r.point,n.point);return i!==0?i:(r.point!==n.point&&r.link(n),r.isLeft!==n.isLeft?r.isLeft?1:-1:k0.compare(r.segment,n.segment))}},{key:"comparePoints",value:function(r,n){return r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0}}]);function t(e,r){xl(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return Xs(t,[{key:"link",value:function(r){if(r.point===this.point)throw new Error("Tried to link already linked events");for(var n=r.point.events,i=0,a=n.length;i<a;i++){var h=n[i];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var r=this.point.events.length,n=0;n<r;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var a=n+1;a<r;a++){var h=this.point.events[a];h.consumedBy===void 0&&i.otherSE.point.events===h.otherSE.point.events&&i.segment.consume(h.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var r=[],n=0,i=this.point.events.length;n<i;n++){var a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&r.push(a)}return r}},{key:"getLeftmostComparator",value:function(r){var n=this,i=new Map,a=function(s){var g=s.otherSE;i.set(s,{sine:L9(n.point,r.point,g.point),cosine:O9(n.point,r.point,g.point)})};return function(h,s){i.has(h)||a(h),i.has(s)||a(s);var g=i.get(h),m=g.sine,w=g.cosine,b=i.get(s),I=b.sine,A=b.cosine;return m>=0&&I>=0?w<A?1:w>A?-1:0:m<0&&I<0?w<A?-1:w>A?1:0:I<m?-1:I>m?1:0}}}]),t}(),N9=0,k0=function(){Xs(t,null,[{key:"compare",value:function(r,n){var i=r.leftSE.point.x,a=n.leftSE.point.x,h=r.rightSE.point.x,s=n.rightSE.point.x;if(s<i)return 1;if(h<a)return-1;var g=r.leftSE.point.y,m=n.leftSE.point.y,w=r.rightSE.point.y,b=n.rightSE.point.y;if(i<a){if(m<g&&m<w)return 1;if(m>g&&m>w)return-1;var I=r.comparePoint(n.leftSE.point);if(I<0)return 1;if(I>0)return-1;var A=n.comparePoint(r.rightSE.point);return A!==0?A:-1}if(i>a){if(g<m&&g<b)return-1;if(g>m&&g>b)return 1;var z=n.comparePoint(r.leftSE.point);if(z!==0)return z;var V=r.comparePoint(n.rightSE.point);return V<0?1:V>0?-1:1}if(g<m)return-1;if(g>m)return 1;if(h<s){var H=n.comparePoint(r.rightSE.point);if(H!==0)return H}if(h>s){var Z=r.comparePoint(n.rightSE.point);if(Z<0)return 1;if(Z>0)return-1}if(h!==s){var D=w-g,k=h-i,j=b-m,Y=s-a;if(D>k&&j<Y)return 1;if(D<k&&j>Y)return-1}return h>s?1:h<s||w<b?-1:w>b?1:r.id<n.id?-1:r.id>n.id?1:0}}]);function t(e,r,n,i){xl(this,t),this.id=++N9,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=n,this.windings=i}return Xs(t,[{key:"replaceRightSE",value:function(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var r=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r<n?r:n},ur:{x:this.rightSE.point.x,y:r>n?r:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(r){return r.x===this.leftSE.point.x&&r.y===this.leftSE.point.y||r.x===this.rightSE.point.x&&r.y===this.rightSE.point.y}},{key:"comparePoint",value:function(r){if(this.isAnEndpoint(r))return 0;var n=this.leftSE.point,i=this.rightSE.point,a=this.vector();if(n.x===i.x)return r.x===n.x?0:r.x<n.x?1:-1;var h=(r.y-n.y)/a.y,s=n.x+h*a.x;if(r.x===s)return 0;var g=(r.x-n.x)/a.x,m=n.y+g*a.y;return r.y===m?0:r.y<m?-1:1}},{key:"getIntersection",value:function(r){var n=this.bbox(),i=r.bbox(),a=qE(n,i);if(a===null)return null;var h=this.leftSE.point,s=this.rightSE.point,g=r.leftSE.point,m=r.rightSE.point,w=iy(n,g)&&this.comparePoint(g)===0,b=iy(i,h)&&r.comparePoint(h)===0,I=iy(n,m)&&this.comparePoint(m)===0,A=iy(i,s)&&r.comparePoint(s)===0;if(b&&w)return A&&!I?s:!A&&I?m:null;if(b)return I&&h.x===m.x&&h.y===m.y?null:h;if(w)return A&&s.x===g.x&&s.y===g.y?null:g;if(A&&I)return null;if(A)return s;if(I)return m;var z=D9(h,this.vector(),g,r.vector());return z===null||!iy(a,z)?null:zy.round(z.x,z.y)}},{key:"split",value:function(r){var n=[],i=r.events!==void 0,a=new Mu(r,!0),h=new Mu(r,!1),s=this.rightSE;this.replaceRightSE(h),n.push(h),n.push(a);var g=new t(a,s,this.rings.slice(),this.windings.slice());return Mu.comparePoints(g.leftSE.point,g.rightSE.point)>0&&g.swapEvents(),Mu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(a.checkForConsuming(),h.checkForConsuming()),n}},{key:"swapEvents",value:function(){var r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(r){for(var n=this,i=r;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var a=t.compare(n,i);if(a!==0){if(a>0){var h=n;n=i,i=h}if(n.prev===i){var s=n;n=i,i=s}for(var g=0,m=i.rings.length;g<m;g++){var w=i.rings[g],b=i.windings[g],I=n.rings.indexOf(w);I===-1?(n.rings.push(w),n.windings.push(b)):n.windings[I]+=b}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,a=this._afterState.multiPolys,h=0,s=this.rings.length;h<s;h++){var g=this.rings[h],m=this.windings[h],w=n.indexOf(g);w===-1?(n.push(g),i.push(m)):i[w]+=m}for(var b=[],I=[],A=0,z=n.length;A<z;A++)if(i[A]!==0){var V=n[A],H=V.poly;if(I.indexOf(H)===-1)if(V.isExterior)b.push(H);else{I.indexOf(H)===-1&&I.push(H);var Z=b.indexOf(V.poly);Z!==-1&&b.splice(Z,1)}}for(var D=0,k=b.length;D<k;D++){var j=b[D].multiPoly;a.indexOf(j)===-1&&a.push(j)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var r=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Jl.type){case"union":{var i=r.length===0,a=n.length===0;this._isInResult=i!==a;break}case"intersection":{var h,s;r.length<n.length?(h=r.length,s=n.length):(h=n.length,s=r.length),this._isInResult=s===Jl.numMultiPolys&&h<s;break}case"xor":{var g=Math.abs(r.length-n.length);this._isInResult=g%2===1;break}case"difference":{var m=function(b){return b.length===1&&b[0].isSubject};this._isInResult=m(r)!==m(n);break}default:throw new Error("Unrecognized operation type found ".concat(Jl.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,n,i){var a,h,s,g=Mu.comparePoints(r,n);if(g<0)a=r,h=n,s=1;else if(g>0)a=n,h=r,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));var m=new Mu(a,!0),w=new Mu(h,!1);return new t(m,w,[i],[s])}}]),t}(),jC=function(){function t(e,r,n){if(xl(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=zy.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var a=i,h=1,s=e.length;h<s;h++){if(typeof e[h][0]!="number"||typeof e[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var g=zy.round(e[h][0],e[h][1]);g.x===a.x&&g.y===a.y||(this.segments.push(k0.fromRing(a,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),a=g)}(i.x!==a.x||i.y!==a.y)&&this.segments.push(k0.fromRing(a,i,this))}return Xs(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,i=this.segments.length;n<i;n++){var a=this.segments[n];r.push(a.leftSE),r.push(a.rightSE)}return r}}]),t}(),R9=function(){function t(e,r){if(xl(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new jC(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var a=new jC(e[n],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return Xs(t,[{key:"getSweepEvents",value:function(){for(var r=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var a=this.interiorRings[n].getSweepEvents(),h=0,s=a.length;h<s;h++)r.push(a[h]);return r}}]),t}(),qC=function(){function t(e,r){if(xl(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var a=new R9(e[n],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return Xs(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,i=this.polys.length;n<i;n++)for(var a=this.polys[n].getSweepEvents(),h=0,s=a.length;h<s;h++)r.push(a[h]);return r}}]),t}(),k9=function(){Xs(t,null,[{key:"factory",value:function(r){for(var n=[],i=0,a=r.length;i<a;i++){var h=r[i];if(!(!h.isInResult()||h.ringOut)){for(var s=null,g=h.leftSE,m=h.rightSE,w=[g],b=g.point,I=[];s=g,g=m,w.push(g),g.point!==b;)for(;;){var A=g.getAvailableLinkedEvents();if(A.length===0){var z=w[0].point,V=w[w.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(z.x,",")+" ".concat(z.y,"]. Last matching segment found ends at")+" [".concat(V.x,", ").concat(V.y,"]."))}if(A.length===1){m=A[0].otherSE;break}for(var H=null,Z=0,D=I.length;Z<D;Z++)if(I[Z].point===g.point){H=Z;break}if(H!==null){var k=I.splice(H)[0],j=w.splice(k.index);j.unshift(j[0].otherSE),n.push(new t(j.reverse()));continue}I.push({index:w.length,point:g.point});var Y=g.getLeftmostComparator(s);m=A.sort(Y)[0].otherSE;break}n.push(new t(w))}}return n}}]);function t(e){xl(this,t),this.events=e;for(var r=0,n=e.length;r<n;r++)e[r].segment.ringOut=this;this.poly=null}return Xs(t,[{key:"getGeom",value:function(){for(var r=this.events[0].point,n=[r],i=1,a=this.events.length-1;i<a;i++){var h=this.events[i].point,s=this.events[i+1].point;UC(h,r,s)!==0&&(n.push(h),r=h)}if(n.length===1)return null;var g=n[0],m=n[1];UC(g,r,m)===0&&n.shift(),n.push(n[0]);for(var w=this.isExteriorRing()?1:-1,b=this.isExteriorRing()?0:n.length-1,I=this.isExteriorRing()?n.length:-1,A=[],z=b;z!=I;z+=w)A.push([n[z].x,n[z].y]);return A}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var r=this.events[0],n=1,i=this.events.length;n<i;n++){var a=this.events[n];Mu.compare(r,a)>0&&(r=a)}for(var h=r.segment.prevInResult(),s=h?h.prevInResult():null;;){if(!h)return null;if(!s)return h.ringOut;if(s.ringOut!==h.ringOut)return s.ringOut.enclosingRing()!==h.ringOut?h.ringOut:h.ringOut.enclosingRing();h=s.prevInResult(),s=h?h.prevInResult():null}}}]),t}(),$C=function(){function t(e){xl(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Xs(t,[{key:"addInterior",value:function(r){this.interiorRings.push(r),r.poly=this}},{key:"getGeom",value:function(){var r=[this.exteriorRing.getGeom()];if(r[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var a=this.interiorRings[n].getGeom();a!==null&&r.push(a)}return r}}]),t}(),F9=function(){function t(e){xl(this,t),this.rings=e,this.polys=this._composePolys(e)}return Xs(t,[{key:"getGeom",value:function(){for(var r=[],n=0,i=this.polys.length;n<i;n++){var a=this.polys[n].getGeom();a!==null&&r.push(a)}return r}},{key:"_composePolys",value:function(r){for(var n=[],i=0,a=r.length;i<a;i++){var h=r[i];if(!h.poly)if(h.isExteriorRing())n.push(new $C(h));else{var s=h.enclosingRing();s.poly||n.push(new $C(s)),s.poly.addInterior(h)}}return n}}]),t}(),z9=function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:k0.compare;xl(this,t),this.queue=e,this.tree=new hT(r),this.segments=[]}return Xs(t,[{key:"process",value:function(r){var n=r.segment,i=[];if(r.consumedBy)return r.isLeft?this.queue.remove(r.otherSE):this.tree.remove(n),i;var a=r.isLeft?this.tree.insert(n):this.tree.find(n);if(!a)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var h=a,s=a,g=void 0,m=void 0;g===void 0;)h=this.tree.prev(h),h===null?g=null:h.key.consumedBy===void 0&&(g=h.key);for(;m===void 0;)s=this.tree.next(s),s===null?m=null:s.key.consumedBy===void 0&&(m=s.key);if(r.isLeft){var w=null;if(g){var b=g.getIntersection(n);if(b!==null&&(n.isAnEndpoint(b)||(w=b),!g.isAnEndpoint(b)))for(var I=this._splitSafely(g,b),A=0,z=I.length;A<z;A++)i.push(I[A])}var V=null;if(m){var H=m.getIntersection(n);if(H!==null&&(n.isAnEndpoint(H)||(V=H),!m.isAnEndpoint(H)))for(var Z=this._splitSafely(m,H),D=0,k=Z.length;D<k;D++)i.push(Z[D])}if(w!==null||V!==null){var j=null;if(w===null)j=V;else if(V===null)j=w;else{var Y=Mu.comparePoints(w,V);j=Y<=0?w:V}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var ie=n.split(j),ne=0,ae=ie.length;ne<ae;ne++)i.push(ie[ne])}i.length>0?(this.tree.remove(n),i.push(r)):(this.segments.push(n),n.prev=g)}else{if(g&&m){var W=g.getIntersection(m);if(W!==null){if(!g.isAnEndpoint(W))for(var $e=this._splitSafely(g,W),Oe=0,ze=$e.length;Oe<ze;Oe++)i.push($e[Oe]);if(!m.isAnEndpoint(W))for(var We=this._splitSafely(m,W),Ze=0,Pt=We.length;Ze<Pt;Ze++)i.push(We[Ze])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(r,n){this.tree.remove(r);var i=r.rightSE;this.queue.remove(i);var a=r.split(n);return a.push(i),r.consumedBy===void 0&&this.tree.insert(r),a}}]),t}(),ZC=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,B9=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,U9=function(){function t(){xl(this,t)}return Xs(t,[{key:"run",value:function(r,n,i){Jl.type=r,zy.reset();for(var a=[new qC(n,!0)],h=0,s=i.length;h<s;h++)a.push(new qC(i[h],!1));if(Jl.numMultiPolys=a.length,Jl.type==="difference")for(var g=a[0],m=1;m<a.length;)qE(a[m].bbox,g.bbox)!==null?m++:a.splice(m,1);if(Jl.type==="intersection"){for(var w=0,b=a.length;w<b;w++)for(var I=a[w],A=w+1,z=a.length;A<z;A++)if(qE(I.bbox,a[A].bbox)===null)return[]}for(var V=new hT(Mu.compare),H=0,Z=a.length;H<Z;H++)for(var D=a[H].getSweepEvents(),k=0,j=D.length;k<j;k++)if(V.insert(D[k]),V.size>ZC)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Y=new z9(V),ie=V.size,ne=V.pop();ne;){var ae=ne.key;if(V.size===ie){var W=ae.segment;throw new Error("Unable to pop() ".concat(ae.isLeft?"left":"right"," SweepEvent ")+"[".concat(ae.point.x,", ").concat(ae.point.y,"] from segment #").concat(W.id," ")+"[".concat(W.leftSE.point.x,", ").concat(W.leftSE.point.y,"] -> ")+"[".concat(W.rightSE.point.x,", ").concat(W.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(V.size>ZC)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Y.segments.length>B9)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var $e=Y.process(ae),Oe=0,ze=$e.length;Oe<ze;Oe++){var We=$e[Oe];We.consumedBy===void 0&&V.insert(We)}ie=V.size,ne=V.pop()}zy.reset();var Ze=k9.factory(Y.segments),Pt=new F9(Ze);return Pt.getGeom()}}]),t}(),Jl=new U9,G9=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Jl.run("union",e,n)},V9=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Jl.run("intersection",e,n)},j9=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Jl.run("xor",e,n)},q9=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Jl.run("difference",e,n)},$9={union:G9,intersection:V9,xor:j9,difference:q9};const _c=$9;function Z9(t,e){var r=hi(t),n=hi(e),i=t.properties||{},a=_c.difference(r.coordinates,n.coordinates);return a.length===0?null:a.length===1?qr(a[0],i):ga(a,i)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var r=Object(this),n=Math.max(Math.min(r.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var a=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(a=a<0?Math.max(n+arguments[2],0):Math.min(a,n);i<a;)r[i]=e,++i;return r},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Hf=function(){};Hf.prototype.interfaces_=function(){return[]};Hf.prototype.getClass=function(){return Hf};Hf.prototype.equalsWithTolerance=function(e,r,n){return Math.abs(e-r)<=n};var vi=function(t){function e(r){t.call(this,r),this.name="IllegalArgumentException",this.message=r,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),_r=function(){},mO={MAX_VALUE:{configurable:!0}};_r.isNaN=function(e){return Number.isNaN(e)};_r.doubleToLongBits=function(e){return e};_r.longBitsToDouble=function(e){return e};_r.isInfinite=function(e){return!Number.isFinite(e)};mO.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(_r,mO);var Ea=function(){},w1=function(){},Vd=function(){};function ba(){}var Le=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},up={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Le.prototype.setOrdinate=function(e,r){switch(e){case Le.X:this.x=r;break;case Le.Y:this.y=r;break;case Le.Z:this.z=r;break;default:throw new vi("Invalid ordinate index: "+e)}};Le.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return!(!Hf.equalsWithTolerance(this.x,r.x,n)||!Hf.equalsWithTolerance(this.y,r.y,n))}};Le.prototype.getOrdinate=function(e){switch(e){case Le.X:return this.x;case Le.Y:return this.y;case Le.Z:return this.z}throw new vi("Invalid ordinate index: "+e)};Le.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||_r.isNaN(this.z))&&_r.isNaN(e.z)};Le.prototype.equals=function(e){return e instanceof Le?this.equals2D(e):!1};Le.prototype.equalInZ=function(e,r){return Hf.equalsWithTolerance(this.z,e.z,r)};Le.prototype.compareTo=function(e){var r=e;return this.x<r.x?-1:this.x>r.x?1:this.y<r.y?-1:this.y>r.y?1:0};Le.prototype.clone=function(){};Le.prototype.copy=function(){return new Le(this)};Le.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Le.prototype.distance3D=function(e){var r=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return Math.sqrt(r*r+n*n+i*i)};Le.prototype.distance=function(e){var r=this.x-e.x,n=this.y-e.y;return Math.sqrt(r*r+n*n)};Le.prototype.hashCode=function(){var e=17;return e=37*e+Le.hashCode(this.x),e=37*e+Le.hashCode(this.y),e};Le.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};Le.prototype.interfaces_=function(){return[Ea,w1,ba]};Le.prototype.getClass=function(){return Le};Le.hashCode=function(){if(arguments.length===1){var e=arguments[0],r=_r.doubleToLongBits(e);return Math.trunc((r^r)>>>32)}};up.DimensionalComparator.get=function(){return yc};up.serialVersionUID.get=function(){return 6683108902428367e3};up.NULL_ORDINATE.get=function(){return _r.NaN};up.X.get=function(){return 0};up.Y.get=function(){return 1};up.Z.get=function(){return 2};Object.defineProperties(Le,up);var yc=function(e){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var r=arguments[0];if(r!==2&&r!==3)throw new vi("only 2 or 3 dimensions may be specified");this._dimensionsToTest=r}}};yc.prototype.compare=function(e,r){var n=e,i=r,a=yc.compare(n.x,i.x);if(a!==0)return a;var h=yc.compare(n.y,i.y);if(h!==0)return h;if(this._dimensionsToTest<=2)return 0;var s=yc.compare(n.z,i.z);return s};yc.prototype.interfaces_=function(){return[Vd]};yc.prototype.getClass=function(){return yc};yc.compare=function(e,r){return e<r?-1:e>r?1:_r.isNaN(e)?_r.isNaN(r)?0:-1:_r.isNaN(r)?1:0};var jd=function(){};jd.prototype.create=function(){};jd.prototype.interfaces_=function(){return[]};jd.prototype.getClass=function(){return jd};var Ge=function(){},s_={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ge.prototype.interfaces_=function(){return[]};Ge.prototype.getClass=function(){return Ge};Ge.toLocationSymbol=function(e){switch(e){case Ge.EXTERIOR:return"e";case Ge.BOUNDARY:return"b";case Ge.INTERIOR:return"i";case Ge.NONE:return"-"}throw new vi("Unknown location value: "+e)};s_.INTERIOR.get=function(){return 0};s_.BOUNDARY.get=function(){return 1};s_.EXTERIOR.get=function(){return 2};s_.NONE.get=function(){return-1};Object.defineProperties(Ge,s_);var cr=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Ws=function(){},yO={LOG_10:{configurable:!0}};Ws.prototype.interfaces_=function(){return[]};Ws.prototype.getClass=function(){return Ws};Ws.log10=function(e){var r=Math.log(e);return _r.isInfinite(r)||_r.isNaN(r)?r:r/Ws.LOG_10};Ws.min=function(e,r,n,i){var a=e;return r<a&&(a=r),n<a&&(a=n),i<a&&(a=i),a};Ws.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1],n=arguments[2];return e<r?r:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],a=arguments[1],h=arguments[2];return i<a?a:i>h?h:i}};Ws.wrap=function(e,r){return e<0?r- -e%r:e%r};Ws.max=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],n=arguments[2],i=e;return r>i&&(i=r),n>i&&(i=n),i}else if(arguments.length===4){var a=arguments[0],h=arguments[1],s=arguments[2],g=arguments[3],m=a;return h>m&&(m=h),s>m&&(m=s),g>m&&(m=g),m}};Ws.average=function(e,r){return(e+r)/2};yO.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Ws,yO);var wl=function(e){this.str=e};wl.prototype.append=function(e){this.str+=e};wl.prototype.setCharAt=function(e,r){this.str=this.str.substr(0,e)+r+this.str.substr(e+1)};wl.prototype.toString=function(e){return this.str};var ul=function(e){this.value=e};ul.prototype.intValue=function(){return this.value};ul.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};ul.isNaN=function(e){return Number.isNaN(e)};var By=function(){};By.isWhitespace=function(e){return e<=32&&e>=0||e===127};By.toUpperCase=function(e){return e.toUpperCase()};var Xe=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var n=arguments[0];t.call(this,t.parse(n))}}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.init(i,a)}},Ga={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Xe.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Xe.prototype.extractSignificantDigits=function(e,r){var n=this.abs(),i=Xe.magnitude(n._hi),a=Xe.TEN.pow(i);n=n.divide(a),n.gt(Xe.TEN)?(n=n.divide(Xe.TEN),i+=1):n.lt(Xe.ONE)&&(n=n.multiply(Xe.TEN),i-=1);for(var h=i+1,s=new wl,g=Xe.MAX_PRINT_DIGITS-1,m=0;m<=g;m++){e&&m===h&&s.append(".");var w=Math.trunc(n._hi);if(w<0)break;var b=!1,I=0;w>9?(b=!0,I="9"):I="0"+w,s.append(I),n=n.subtract(Xe.valueOf(w)).multiply(Xe.TEN),b&&n.selfAdd(Xe.TEN);var A=!0,z=Xe.magnitude(n._hi);if(z<0&&Math.abs(z)>=g-m&&(A=!1),!A)break}return r[0]=i,s.toString()};Xe.prototype.sqr=function(){return this.multiply(this)};Xe.prototype.doubleValue=function(){return this._hi+this._lo};Xe.prototype.subtract=function(){if(arguments[0]instanceof Xe){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.add(-r)}};Xe.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Xe.prototype.isZero=function(){return this._hi===0&&this._lo===0};Xe.prototype.selfSubtract=function(){if(arguments[0]instanceof Xe){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r,0)}};Xe.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Xe.prototype.min=function(e){return this.le(e)?this:e};Xe.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfDivide(r,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],a=null,h=null,s=null,g=null,m=null,w=null,b=null,I=null;return m=this._hi/n,w=Xe.SPLIT*m,a=w-m,I=Xe.SPLIT*n,a=w-a,h=m-a,s=I-n,b=m*n,s=I-s,g=n-s,I=a*s-b+a*g+h*s+h*g,w=(this._hi-b-I+this._lo-m*i)/n,I=m+w,this._hi=I,this._lo=m-I+w,this}};Xe.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Xe.prototype.divide=function(){if(arguments[0]instanceof Xe){var e=arguments[0],r=null,n=null,i=null,a=null,h=null,s=null,g=null,m=null;h=this._hi/e._hi,s=Xe.SPLIT*h,r=s-h,m=Xe.SPLIT*e._hi,r=s-r,n=h-r,i=m-e._hi,g=h*e._hi,i=m-i,a=e._hi-i,m=r*i-g+r*a+n*i+n*a,s=(this._hi-g-m+this._lo-h*e._lo)/e._hi,m=h+s;var w=m,b=h-m+s;return new Xe(w,b)}else if(typeof arguments[0]=="number"){var I=arguments[0];return _r.isNaN(I)?Xe.createNaN():Xe.copy(this).selfDivide(I,0)}};Xe.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Xe.prototype.pow=function(e){if(e===0)return Xe.valueOf(1);var r=new Xe(this),n=Xe.valueOf(1),i=Math.abs(e);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(r),i/=2,i>0&&(r=r.sqr());else n=r;return e<0?n.reciprocal():n};Xe.prototype.ceil=function(){if(this.isNaN())return Xe.NaN;var e=Math.ceil(this._hi),r=0;return e===this._hi&&(r=Math.ceil(this._lo)),new Xe(e,r)};Xe.prototype.compareTo=function(e){var r=e;return this._hi<r._hi?-1:this._hi>r._hi?1:this._lo<r._lo?-1:this._lo>r._lo?1:0};Xe.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Xe.prototype.setValue=function(){if(arguments[0]instanceof Xe){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.init(r),this}};Xe.prototype.max=function(e){return this.ge(e)?this:e};Xe.prototype.sqrt=function(){if(this.isZero())return Xe.valueOf(0);if(this.isNegative())return Xe.NaN;var e=1/Math.sqrt(this._hi),r=this._hi*e,n=Xe.valueOf(r),i=this.subtract(n.sqr()),a=i._hi*(e*.5);return n.add(a)};Xe.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0],n=null,i=null,a=null,h=null,s=null,g=null;return a=this._hi+r,s=a-this._hi,h=a-s,h=r-s+(this._hi-h),g=h+this._lo,n=a+g,i=g+(a-n),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(arguments.length===2){var m=arguments[0],w=arguments[1],b=null,I=null,A=null,z=null,V=null,H=null,Z=null,D=null;V=this._hi+m,A=this._lo+w,Z=V-this._hi,D=A-this._lo,H=V-Z,z=A-D,H=m-Z+(this._hi-H),z=w-D+(this._lo-z),Z=H+A,b=V+Z,I=Z+(V-b),Z=z+I;var k=b+Z,j=Z+(b-k);return this._hi=k,this._lo=j,this}};Xe.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var r=arguments[0];return this.selfMultiply(r,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],a=null,h=null,s=null,g=null,m=null,w=null;m=Xe.SPLIT*this._hi,a=m-this._hi,w=Xe.SPLIT*n,a=m-a,h=this._hi-a,s=w-n,m=this._hi*n,s=w-s,g=n-s,w=a*s-m+a*g+h*s+h*g+(this._hi*i+this._lo*n);var b=m+w;a=m-b;var I=w+a;return this._hi=b,this._lo=I,this}};Xe.prototype.selfSqr=function(){return this.selfMultiply(this)};Xe.prototype.floor=function(){if(this.isNaN())return Xe.NaN;var e=Math.floor(this._hi),r=0;return e===this._hi&&(r=Math.floor(this._lo)),new Xe(e,r)};Xe.prototype.negate=function(){return this.isNaN()?this:new Xe(-this._hi,-this._lo)};Xe.prototype.clone=function(){};Xe.prototype.multiply=function(){if(arguments[0]instanceof Xe){var e=arguments[0];return e.isNaN()?Xe.createNaN():Xe.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var r=arguments[0];return _r.isNaN(r)?Xe.createNaN():Xe.copy(this).selfMultiply(r,0)}};Xe.prototype.isNaN=function(){return _r.isNaN(this._hi)};Xe.prototype.intValue=function(){return Math.trunc(this._hi)};Xe.prototype.toString=function(){var e=Xe.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Xe.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var r=new Array(1).fill(null),n=this.extractSignificantDigits(!0,r),i=r[0]+1,a=n;if(n.charAt(0)===".")a="0"+n;else if(i<0)a="0."+Xe.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var h=i-n.length,s=Xe.stringOfChar("0",h);a=n+s+".0"}return this.isNegative()?"-"+a:a};Xe.prototype.reciprocal=function(){var e=null,r=null,n=null,i=null,a=null,h=null,s=null,g=null;a=1/this._hi,h=Xe.SPLIT*a,e=h-a,g=Xe.SPLIT*this._hi,e=h-e,r=a-e,n=g-this._hi,s=a*this._hi,n=g-n,i=this._hi-n,g=e*n-s+e*i+r*n+r*i,h=(1-s-g-a*this._lo)/this._hi;var m=a+h,w=a-m+h;return new Xe(m,w)};Xe.prototype.toSciNotation=function(){if(this.isZero())return Xe.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var r=new Array(1).fill(null),n=this.extractSignificantDigits(!1,r),i=Xe.SCI_NOT_EXPONENT_CHAR+r[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var a="";n.length>1&&(a=n.substring(1));var h=n.charAt(0)+"."+a;return this.isNegative()?"-"+h+i:h+i};Xe.prototype.abs=function(){return this.isNaN()?Xe.NaN:this.isNegative()?this.negate():new Xe(this)};Xe.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Xe.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Xe.prototype.add=function(){if(arguments[0]instanceof Xe){var e=arguments[0];return Xe.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var r=arguments[0];return Xe.copy(this).selfAdd(r)}};Xe.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Xe){var r=arguments[0];this._hi=r._hi,this._lo=r._lo}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}};Xe.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Xe.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Xe.prototype.trunc=function(){return this.isNaN()?Xe.NaN:this.isPositive()?this.floor():this.ceil()};Xe.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Xe.prototype.interfaces_=function(){return[ba,Ea,w1]};Xe.prototype.getClass=function(){return Xe};Xe.sqr=function(e){return Xe.valueOf(e).selfMultiply(e)};Xe.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Xe.parse(e)}else if(typeof arguments[0]=="number"){var r=arguments[0];return new Xe(r)}};Xe.sqrt=function(e){return Xe.valueOf(e).sqrt()};Xe.parse=function(e){for(var r=0,n=e.length;By.isWhitespace(e.charAt(r));)r++;var i=!1;if(r<n){var a=e.charAt(r);(a==="-"||a==="+")&&(r++,a==="-"&&(i=!0))}for(var h=new Xe,s=0,g=0,m=0;!(r>=n);){var w=e.charAt(r);if(r++,By.isDigit(w)){var b=w-"0";h.selfMultiply(Xe.TEN),h.selfAdd(b),s++;continue}if(w==="."){g=s;continue}if(w==="e"||w==="E"){var I=e.substring(r);try{m=ul.parseInt(I)}catch(Z){throw Z instanceof Error?new Error("Invalid exponent "+I+" in string "+e):Z}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+r+" in string "+e)}var A=h,z=s-g-m;if(z===0)A=h;else if(z>0){var V=Xe.TEN.pow(z);A=h.divide(V)}else if(z<0){var H=Xe.TEN.pow(-z);A=h.multiply(H)}return i?A.negate():A};Xe.createNaN=function(){return new Xe(_r.NaN,_r.NaN)};Xe.copy=function(e){return new Xe(e)};Xe.magnitude=function(e){var r=Math.abs(e),n=Math.log(r)/Math.log(10),i=Math.trunc(Math.floor(n)),a=Math.pow(10,i);return a*10<=r&&(i+=1),i};Xe.stringOfChar=function(e,r){for(var n=new wl,i=0;i<r;i++)n.append(e);return n.toString()};Ga.PI.get=function(){return new Xe(3.141592653589793,12246467991473532e-32)};Ga.TWO_PI.get=function(){return new Xe(6.283185307179586,24492935982947064e-32)};Ga.PI_2.get=function(){return new Xe(1.5707963267948966,6123233995736766e-32)};Ga.E.get=function(){return new Xe(2.718281828459045,14456468917292502e-32)};Ga.NaN.get=function(){return new Xe(_r.NaN,_r.NaN)};Ga.EPS.get=function(){return 123259516440783e-46};Ga.SPLIT.get=function(){return 134217729};Ga.MAX_PRINT_DIGITS.get=function(){return 32};Ga.TEN.get=function(){return Xe.valueOf(10)};Ga.ONE.get=function(){return Xe.valueOf(1)};Ga.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Ga.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Xe,Ga);var gs=function(){},_O={DP_SAFE_EPSILON:{configurable:!0}};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};gs.orientationIndex=function(e,r,n){var i=gs.orientationIndexFilter(e,r,n);if(i<=1)return i;var a=Xe.valueOf(r.x).selfAdd(-e.x),h=Xe.valueOf(r.y).selfAdd(-e.y),s=Xe.valueOf(n.x).selfAdd(-r.x),g=Xe.valueOf(n.y).selfAdd(-r.y);return a.selfMultiply(g).selfSubtract(h.selfMultiply(s)).signum()};gs.signOfDet2x2=function(e,r,n,i){var a=e.multiply(i).selfSubtract(r.multiply(n));return a.signum()};gs.intersection=function(e,r,n,i){var a=Xe.valueOf(i.y).selfSubtract(n.y).selfMultiply(Xe.valueOf(r.x).selfSubtract(e.x)),h=Xe.valueOf(i.x).selfSubtract(n.x).selfMultiply(Xe.valueOf(r.y).selfSubtract(e.y)),s=a.subtract(h),g=Xe.valueOf(i.x).selfSubtract(n.x).selfMultiply(Xe.valueOf(e.y).selfSubtract(n.y)),m=Xe.valueOf(i.y).selfSubtract(n.y).selfMultiply(Xe.valueOf(e.x).selfSubtract(n.x)),w=g.subtract(m),b=w.selfDivide(s).doubleValue(),I=Xe.valueOf(e.x).selfAdd(Xe.valueOf(r.x).selfSubtract(e.x).selfMultiply(b)).doubleValue(),A=Xe.valueOf(r.x).selfSubtract(e.x).selfMultiply(Xe.valueOf(e.y).selfSubtract(n.y)),z=Xe.valueOf(r.y).selfSubtract(e.y).selfMultiply(Xe.valueOf(e.x).selfSubtract(n.x)),V=A.subtract(z),H=V.selfDivide(s).doubleValue(),Z=Xe.valueOf(n.y).selfAdd(Xe.valueOf(i.y).selfSubtract(n.y).selfMultiply(H)).doubleValue();return new Le(I,Z)};gs.orientationIndexFilter=function(e,r,n){var i=null,a=(e.x-n.x)*(r.y-n.y),h=(e.y-n.y)*(r.x-n.x),s=a-h;if(a>0){if(h<=0)return gs.signum(s);i=a+h}else if(a<0){if(h>=0)return gs.signum(s);i=-a-h}else return gs.signum(s);var g=gs.DP_SAFE_EPSILON*i;return s>=g||-s>=g?gs.signum(s):2};gs.signum=function(e){return e>0?1:e<0?-1:0};_O.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(gs,_O);var Zr=function(){},a_={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};a_.X.get=function(){return 0};a_.Y.get=function(){return 1};a_.Z.get=function(){return 2};a_.M.get=function(){return 3};Zr.prototype.setOrdinate=function(e,r,n){};Zr.prototype.size=function(){};Zr.prototype.getOrdinate=function(e,r){};Zr.prototype.getCoordinate=function(){};Zr.prototype.getCoordinateCopy=function(e){};Zr.prototype.getDimension=function(){};Zr.prototype.getX=function(e){};Zr.prototype.clone=function(){};Zr.prototype.expandEnvelope=function(e){};Zr.prototype.copy=function(){};Zr.prototype.getY=function(e){};Zr.prototype.toCoordinateArray=function(){};Zr.prototype.interfaces_=function(){return[w1]};Zr.prototype.getClass=function(){return Zr};Object.defineProperties(Zr,a_);var vO=function(){},dg=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(vO),Oo=function(){};Oo.arraycopy=function(e,r,n,i,a){for(var h=0,s=r;s<r+a;s++)n[i+h]=e[s],h++};Oo.getProperty=function(e){return{"line.separator":`
`}[e]};var Oa=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],a=arguments[1];this.x=i.y*a.w-a.y*i.w,this.y=a.x*i.w-i.x*a.w,this.w=i.x*a.y-a.x*i.y}else if(arguments[0]instanceof Le&&arguments[1]instanceof Le){var h=arguments[0],s=arguments[1];this.x=h.y-s.y,this.y=s.x-h.x,this.w=h.x*s.y-s.x*h.y}}else if(arguments.length===3){var g=arguments[0],m=arguments[1],w=arguments[2];this.x=g,this.y=m,this.w=w}else if(arguments.length===4){var b=arguments[0],I=arguments[1],A=arguments[2],z=arguments[3],V=b.y-I.y,H=I.x-b.x,Z=b.x*I.y-I.x*b.y,D=A.y-z.y,k=z.x-A.x,j=A.x*z.y-z.x*A.y;this.x=H*j-k*Z,this.y=D*Z-V*j,this.w=V*k-D*H}};Oa.prototype.getY=function(){var e=this.y/this.w;if(_r.isNaN(e)||_r.isInfinite(e))throw new dg;return e};Oa.prototype.getX=function(){var e=this.x/this.w;if(_r.isNaN(e)||_r.isInfinite(e))throw new dg;return e};Oa.prototype.getCoordinate=function(){var e=new Le;return e.x=this.getX(),e.y=this.getY(),e};Oa.prototype.interfaces_=function(){return[]};Oa.prototype.getClass=function(){return Oa};Oa.intersection=function(e,r,n,i){var a=e.y-r.y,h=r.x-e.x,s=e.x*r.y-r.x*e.y,g=n.y-i.y,m=i.x-n.x,w=n.x*i.y-i.x*n.y,b=h*w-m*s,I=g*s-a*w,A=a*m-g*h,z=b/A,V=I/A;if(_r.isNaN(z)||_r.isInfinite(z)||_r.isNaN(V)||_r.isInfinite(V))throw new dg;return new Le(z,V)};var Yt=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Le){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var a=arguments[0],h=arguments[1],s=arguments[2],g=arguments[3];this.init(a,h,s,g)}},xO={serialVersionUID:{configurable:!0}};Yt.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Yt.prototype.equals=function(e){if(!(e instanceof Yt))return!1;var r=e;return this.isNull()?r.isNull():this._maxx===r.getMaxX()&&this._maxy===r.getMaxY()&&this._minx===r.getMinX()&&this._miny===r.getMinY()};Yt.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Yt;var r=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,i=this._maxx<e._maxx?this._maxx:e._maxx,a=this._maxy<e._maxy?this._maxy:e._maxy;return new Yt(r,i,n,a)};Yt.prototype.isNull=function(){return this._maxx<this._minx};Yt.prototype.getMaxX=function(){return this._maxx};Yt.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Le){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Yt){var r=arguments[0];return this.isNull()||r.isNull()?!1:r.getMinX()>=this._minx&&r.getMaxX()<=this._maxx&&r.getMinY()>=this._miny&&r.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}};Yt.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Yt){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof Le){var r=arguments[0];return this.intersects(r.x,r.y)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||i>this._maxy||i<this._miny)}};Yt.prototype.getMinY=function(){return this._miny};Yt.prototype.getMinX=function(){return this._minx};Yt.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Le){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Yt){var r=arguments[0];if(r.isNull())return null;this.isNull()?(this._minx=r.getMinX(),this._maxx=r.getMaxX(),this._miny=r.getMinY(),this._maxy=r.getMaxY()):(r._minx<this._minx&&(this._minx=r._minx),r._maxx>this._maxx&&(this._maxx=r._maxx),r._miny<this._miny&&(this._miny=r._miny),r._maxy>this._maxy&&(this._maxy=r._maxy))}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};Yt.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),r=this.getHeight();return e<r?e:r};Yt.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Yt.prototype.compareTo=function(e){var r=e;return this.isNull()?r.isNull()?0:-1:r.isNull()?1:this._minx<r._minx?-1:this._minx>r._minx?1:this._miny<r._miny?-1:this._miny>r._miny?1:this._maxx<r._maxx?-1:this._maxx>r._maxx?1:this._maxy<r._maxy?-1:this._maxy>r._maxy?1:0};Yt.prototype.translate=function(e,r){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+r,this.getMaxY()+r)};Yt.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Yt.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Yt.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Yt.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),r=this.getHeight();return e>r?e:r};Yt.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=r,this._maxx+=r,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Yt.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Yt){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof Le){var r=arguments[0];return this.covers(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.covers(n,i)}};Yt.prototype.centre=function(){return this.isNull()?null:new Le((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Yt.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Le){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Yt){var r=arguments[0];this._minx=r._minx,this._maxx=r._maxx,this._miny=r._miny,this._maxy=r._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var a=arguments[0],h=arguments[1],s=arguments[2],g=arguments[3];a<h?(this._minx=a,this._maxx=h):(this._minx=h,this._maxx=a),s<g?(this._miny=s,this._maxy=g):(this._miny=g,this._maxy=s)}};Yt.prototype.getMaxY=function(){return this._maxy};Yt.prototype.distance=function(e){if(this.intersects(e))return 0;var r=0;this._maxx<e._minx?r=e._minx-this._maxx:this._minx>e._maxx&&(r=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),r===0?n:n===0?r:Math.sqrt(r*r+n*n)};Yt.prototype.hashCode=function(){var e=17;return e=37*e+Le.hashCode(this._minx),e=37*e+Le.hashCode(this._maxx),e=37*e+Le.hashCode(this._miny),e=37*e+Le.hashCode(this._maxy),e};Yt.prototype.interfaces_=function(){return[Ea,ba]};Yt.prototype.getClass=function(){return Yt};Yt.intersects=function(){if(arguments.length===3){var e=arguments[0],r=arguments[1],n=arguments[2];return n.x>=(e.x<r.x?e.x:r.x)&&n.x<=(e.x>r.x?e.x:r.x)&&n.y>=(e.y<r.y?e.y:r.y)&&n.y<=(e.y>r.y?e.y:r.y)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],s=arguments[3],g=Math.min(h.x,s.x),m=Math.max(h.x,s.x),w=Math.min(i.x,a.x),b=Math.max(i.x,a.x);return!(w>m||b<g||(g=Math.min(h.y,s.y),m=Math.max(h.y,s.y),w=Math.min(i.y,a.y),b=Math.max(i.y,a.y),w>m)||b<g)}};xO.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Yt,xO);var tl={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},E1=function(e){this.geometryFactory=e||new zr};E1.prototype.read=function(e){var r,n,i;e=e.replace(/[\n\r]/g," ");var a=tl.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(a=tl.emptyTypeStr.exec(e),a[2]=void 0),a&&(n=a[1].toLowerCase(),i=a[2],Id[n]&&(r=Id[n].apply(this,[i]))),r===void 0)throw new Error("Could not parse WKT "+e);return r};E1.prototype.write=function(e){return this.extractGeometry(e)};E1.prototype.extractGeometry=function(e){var r=e.getGeometryType().toLowerCase();if(!Cu[r])return null;var n=r.toUpperCase(),i;return e.isEmpty()?i=n+" EMPTY":i=n+"("+Cu[r].apply(this,[e])+")",i};var Cu={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Cu.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var r=this,n=[],i=0,a=e._geometries.length;i<a;++i)n.push("("+Cu.point.apply(r,[e._geometries[i]])+")");return n.join(",")},linestring:function(e){for(var r=this,n=[],i=0,a=e._points._coordinates.length;i<a;++i)n.push(Cu.coordinate.apply(r,[e._points._coordinates[i]]));return n.join(",")},linearring:function(e){for(var r=this,n=[],i=0,a=e._points._coordinates.length;i<a;++i)n.push(Cu.coordinate.apply(r,[e._points._coordinates[i]]));return n.join(",")},multilinestring:function(e){for(var r=this,n=[],i=0,a=e._geometries.length;i<a;++i)n.push("("+Cu.linestring.apply(r,[e._geometries[i]])+")");return n.join(",")},polygon:function(e){var r=this,n=[];n.push("("+Cu.linestring.apply(this,[e._shell])+")");for(var i=0,a=e._holes.length;i<a;++i)n.push("("+Cu.linestring.apply(r,[e._holes[i]])+")");return n.join(",")},multipolygon:function(e){for(var r=this,n=[],i=0,a=e._geometries.length;i<a;++i)n.push("("+Cu.polygon.apply(r,[e._geometries[i]])+")");return n.join(",")},geometrycollection:function(e){for(var r=this,n=[],i=0,a=e._geometries.length;i<a;++i)n.push(r.extractGeometry(e._geometries[i]));return n.join(",")}},Id={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var r=e.trim().split(tl.spaces);return this.geometryFactory.createPoint(new Le(Number.parseFloat(r[0]),Number.parseFloat(r[1])))},multipoint:function(e){var r=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,i=e.trim().split(","),a=[],h=0,s=i.length;h<s;++h)n=i[h].replace(tl.trimParens,"$1"),a.push(Id.point.apply(r,[n]));return this.geometryFactory.createMultiPoint(a)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var r=e.trim().split(","),n=[],i,a=0,h=r.length;a<h;++a)i=r[a].trim().split(tl.spaces),n.push(new Le(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var r=e.trim().split(","),n=[],i,a=0,h=r.length;a<h;++a)i=r[a].trim().split(tl.spaces),n.push(new Le(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var r=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,i=e.trim().split(tl.parenComma),a=[],h=0,s=i.length;h<s;++h)n=i[h].replace(tl.trimParens,"$1"),a.push(Id.linestring.apply(r,[n]));return this.geometryFactory.createMultiLineString(a)},polygon:function(e){var r=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,i,a,h=e.trim().split(tl.parenComma),s,g=[],m=0,w=h.length;m<w;++m)n=h[m].replace(tl.trimParens,"$1"),i=Id.linestring.apply(r,[n]),a=r.geometryFactory.createLinearRing(i._points),m===0?s=a:g.push(a);return this.geometryFactory.createPolygon(s,g)},multipolygon:function(e){var r=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,i=e.trim().split(tl.doubleParenComma),a=[],h=0,s=i.length;h<s;++h)n=i[h].replace(tl.trimParens,"$1"),a.push(Id.polygon.apply(r,[n]));return this.geometryFactory.createMultiPolygon(a)},geometrycollection:function(e){var r=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),i=[],a=0,h=n.length;a<h;++a)i.push(r.read(n[a]));return this.geometryFactory.createGeometryCollection(i)}},Na=function(e){this.parser=new E1(e)};Na.prototype.write=function(e){return this.parser.write(e)};Na.toLineString=function(e,r){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+r.x+" "+r.y+" )"};var Bu=function(t){function e(r){t.call(this,r),this.name="RuntimeException",this.message=r,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),F0=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var r=arguments[0];t.call(this,r)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bu),Cr=function(){};Cr.prototype.interfaces_=function(){return[]};Cr.prototype.getClass=function(){return Cr};Cr.shouldNeverReachHere=function(){if(arguments.length===0)Cr.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new F0("Should never reach here"+(e!==null?": "+e:""))}};Cr.isTrue=function(){var e,r;if(arguments.length===1)e=arguments[0],Cr.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],r=arguments[1],!e))throw r===null?new F0:new F0(r)};Cr.equals=function(){var e,r,n;if(arguments.length===2)e=arguments[0],r=arguments[1],Cr.equals(e,r,null);else if(arguments.length===3&&(e=arguments[0],r=arguments[1],n=arguments[2],!r.equals(e)))throw new F0("Expected "+e+" but encountered "+r+(n!==null?": "+n:""))};var Ti=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Le,this._intPt[1]=new Le,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},cp={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Ti.prototype.getIndexAlongSegment=function(e,r){return this.computeIntLineIndex(),this._intLineIndex[e][r]};Ti.prototype.getTopologySummary=function(){var e=new wl;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};Ti.prototype.computeIntersection=function(e,r,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=r,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,r,n,i)};Ti.prototype.getIntersectionNum=function(){return this._result};Ti.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],r=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);r>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};Ti.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Ti.prototype.setPrecisionModel=function(e){this._precisionModel=e};Ti.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var r=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[r][0])||e._intPt[n].equals2D(e._inputLines[r][1])))return!0;return!1}};Ti.prototype.getIntersection=function(e){return this._intPt[e]};Ti.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Ti.prototype.hasIntersection=function(){return this._result!==Ti.NO_INTERSECTION};Ti.prototype.getEdgeDistance=function(e,r){var n=Ti.computeEdgeDistance(this._intPt[r],this._inputLines[e][0],this._inputLines[e][1]);return n};Ti.prototype.isCollinear=function(){return this._result===Ti.COLLINEAR_INTERSECTION};Ti.prototype.toString=function(){return Na.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Na.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Ti.prototype.getEndpoint=function(e,r){return this._inputLines[e][r]};Ti.prototype.isIntersection=function(e){for(var r=this,n=0;n<this._result;n++)if(r._intPt[n].equals2D(e))return!0;return!1};Ti.prototype.getIntersectionAlongSegment=function(e,r){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][r]]};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};Ti.computeEdgeDistance=function(e,r,n){var i=Math.abs(n.x-r.x),a=Math.abs(n.y-r.y),h=-1;if(e.equals(r))h=0;else if(e.equals(n))i>a?h=i:h=a;else{var s=Math.abs(e.x-r.x),g=Math.abs(e.y-r.y);i>a?h=s:h=g,h===0&&!e.equals(r)&&(h=Math.max(s,g))}return Cr.isTrue(!(h===0&&!e.equals(r)),"Bad distance calculation"),h};Ti.nonRobustComputeEdgeDistance=function(e,r,n){var i=e.x-r.x,a=e.y-r.y,h=Math.sqrt(i*i+a*a);return Cr.isTrue(!(h===0&&!e.equals(r)),"Invalid distance calculation"),h};cp.DONT_INTERSECT.get=function(){return 0};cp.DO_INTERSECT.get=function(){return 1};cp.COLLINEAR.get=function(){return 2};cp.NO_INTERSECTION.get=function(){return 0};cp.POINT_INTERSECTION.get=function(){return 1};cp.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Ti,cp);var zh=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var i=new Yt(this._inputLines[0][0],this._inputLines[0][1]),a=new Yt(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(n)&&a.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];if(this._isProper=!1,Yt.intersects(i,a,n)&&Ft.orientationIndex(i,a,n)===0&&Ft.orientationIndex(a,i,n)===0)return this._isProper=!0,(n.equals(i)||n.equals(a))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,i,a,h,s){s.x=this.smallestInAbsValue(n.x,i.x,a.x,h.x),s.y=this.smallestInAbsValue(n.y,i.y,a.y,h.y),n.x-=s.x,n.y-=s.y,i.x-=s.x,i.y-=s.y,a.x-=s.x,a.y-=s.y,h.x-=s.x,h.y-=s.y},e.prototype.safeHCoordinateIntersection=function(n,i,a,h){var s=null;try{s=Oa.intersection(n,i,a,h)}catch(g){if(g instanceof dg)s=e.nearestEndpoint(n,i,a,h);else throw g}finally{}return s},e.prototype.intersection=function(n,i,a,h){var s=this.intersectionWithNormalization(n,i,a,h);return this.isInSegmentEnvelopes(s)||(s=new Le(e.nearestEndpoint(n,i,a,h))),this._precisionModel!==null&&this._precisionModel.makePrecise(s),s},e.prototype.smallestInAbsValue=function(n,i,a,h){var s=n,g=Math.abs(s);return Math.abs(i)<g&&(s=i,g=Math.abs(i)),Math.abs(a)<g&&(s=a,g=Math.abs(a)),Math.abs(h)<g&&(s=h),s},e.prototype.checkDD=function(n,i,a,h,s){var g=gs.intersection(n,i,a,h),m=this.isInSegmentEnvelopes(g);Oo.out.println("DD in env = "+m+"  --------------------- "+g),s.distance(g)>1e-4&&Oo.out.println("Distance = "+s.distance(g))},e.prototype.intersectionWithNormalization=function(n,i,a,h){var s=new Le(n),g=new Le(i),m=new Le(a),w=new Le(h),b=new Le;this.normalizeToEnvCentre(s,g,m,w,b);var I=this.safeHCoordinateIntersection(s,g,m,w);return I.x+=b.x,I.y+=b.y,I},e.prototype.computeCollinearIntersection=function(n,i,a,h){var s=Yt.intersects(n,i,a),g=Yt.intersects(n,i,h),m=Yt.intersects(a,h,n),w=Yt.intersects(a,h,i);return s&&g?(this._intPt[0]=a,this._intPt[1]=h,t.COLLINEAR_INTERSECTION):m&&w?(this._intPt[0]=n,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):s&&m?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!g&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):s&&w?(this._intPt[0]=a,this._intPt[1]=i,a.equals(i)&&!g&&!m?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):g&&m?(this._intPt[0]=h,this._intPt[1]=n,h.equals(n)&&!s&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):g&&w?(this._intPt[0]=h,this._intPt[1]=i,h.equals(i)&&!s&&!m?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,i,a,h,s){var g=n.x<i.x?n.x:i.x,m=n.y<i.y?n.y:i.y,w=n.x>i.x?n.x:i.x,b=n.y>i.y?n.y:i.y,I=a.x<h.x?a.x:h.x,A=a.y<h.y?a.y:h.y,z=a.x>h.x?a.x:h.x,V=a.y>h.y?a.y:h.y,H=g>I?g:I,Z=w<z?w:z,D=m>A?m:A,k=b<V?b:V,j=(H+Z)/2,Y=(D+k)/2;s.x=j,s.y=Y,n.x-=s.x,n.y-=s.y,i.x-=s.x,i.y-=s.y,a.x-=s.x,a.y-=s.y,h.x-=s.x,h.y-=s.y},e.prototype.computeIntersect=function(n,i,a,h){if(this._isProper=!1,!Yt.intersects(n,i,a,h))return t.NO_INTERSECTION;var s=Ft.orientationIndex(n,i,a),g=Ft.orientationIndex(n,i,h);if(s>0&&g>0||s<0&&g<0)return t.NO_INTERSECTION;var m=Ft.orientationIndex(a,h,n),w=Ft.orientationIndex(a,h,i);if(m>0&&w>0||m<0&&w<0)return t.NO_INTERSECTION;var b=s===0&&g===0&&m===0&&w===0;return b?this.computeCollinearIntersection(n,i,a,h):(s===0||g===0||m===0||w===0?(this._isProper=!1,n.equals2D(a)||n.equals2D(h)?this._intPt[0]=n:i.equals2D(a)||i.equals2D(h)?this._intPt[0]=i:s===0?this._intPt[0]=new Le(a):g===0?this._intPt[0]=new Le(h):m===0?this._intPt[0]=new Le(n):w===0&&(this._intPt[0]=new Le(i))):(this._isProper=!0,this._intPt[0]=this.intersection(n,i,a,h)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,i,a,h){var s=n,g=Ft.distancePointLine(n,a,h),m=Ft.distancePointLine(i,a,h);return m<g&&(g=m,s=i),m=Ft.distancePointLine(a,n,i),m<g&&(g=m,s=a),m=Ft.distancePointLine(h,n,i),m<g&&(g=m,s=h),s},e}(Ti),Kf=function(){};Kf.prototype.interfaces_=function(){return[]};Kf.prototype.getClass=function(){return Kf};Kf.orientationIndex=function(e,r,n){var i=r.x-e.x,a=r.y-e.y,h=n.x-r.x,s=n.y-r.y;return Kf.signOfDet2x2(i,a,h,s)};Kf.signOfDet2x2=function(e,r,n,i){var a=null,h=null,s=null;if(a=1,e===0||i===0)return r===0||n===0?0:r>0?n>0?-a:a:n>0?a:-a;if(r===0||n===0)return i>0?e>0?a:-a:e>0?-a:a;if(r>0?i>0?r<=i||(a=-a,h=e,e=n,n=h,h=r,r=i,i=h):r<=-i?(a=-a,n=-n,i=-i):(h=e,e=-n,n=h,h=r,r=-i,i=h):i>0?-r<=i?(a=-a,e=-e,r=-r):(h=-e,e=n,n=h,h=-r,r=i,i=h):r>=i?(e=-e,r=-r,n=-n,i=-i):(a=-a,h=-e,e=-n,n=h,h=-r,r=-i,i=h),e>0)if(n>0){if(!(e<=n))return a}else return a;else{if(n>0)return-a;if(e>=n)a=-a,e=-e,n=-n;else return-a}for(;;){if(s=Math.floor(n/e),n=n-s*e,i=i-s*r,i<0)return-a;if(i>r)return a;if(e>n+n){if(r<i+i)return a}else{if(r>i+i)return-a;n=e-n,i=r-i,a=-a}if(i===0)return n===0?0:-a;if(n===0||(s=Math.floor(e/n),e=e-s*n,r=r-s*i,r<0))return a;if(r>i)return-a;if(n>e+e){if(i<r+r)return-a}else{if(i>r+r)return a;e=n-e,r=i-r,a=-a}if(r===0)return e===0?0:a;if(e===0)return-a}};var sl=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};sl.prototype.countSegment=function(e,r){if(e.x<this._p.x&&r.x<this._p.x)return null;if(this._p.x===r.x&&this._p.y===r.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&r.y===this._p.y){var n=e.x,i=r.x;return n>i&&(n=r.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&r.y<=this._p.y||r.y>this._p.y&&e.y<=this._p.y){var a=e.x-this._p.x,h=e.y-this._p.y,s=r.x-this._p.x,g=r.y-this._p.y,m=Kf.signOfDet2x2(a,h,s,g);if(m===0)return this._isPointOnSegment=!0,null;g<h&&(m=-m),m>0&&this._crossingCount++}};sl.prototype.isPointInPolygon=function(){return this.getLocation()!==Ge.EXTERIOR};sl.prototype.getLocation=function(){return this._isPointOnSegment?Ge.BOUNDARY:this._crossingCount%2===1?Ge.INTERIOR:Ge.EXTERIOR};sl.prototype.isOnSegment=function(){return this._isPointOnSegment};sl.prototype.interfaces_=function(){return[]};sl.prototype.getClass=function(){return sl};sl.locatePointInRing=function(){if(arguments[0]instanceof Le&&cr(arguments[1],Zr)){for(var e=arguments[0],r=arguments[1],n=new sl(e),i=new Le,a=new Le,h=1;h<r.size();h++)if(r.getCoordinate(h,i),r.getCoordinate(h-1,a),n.countSegment(i,a),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Le&&arguments[1]instanceof Array){for(var s=arguments[0],g=arguments[1],m=new sl(s),w=1;w<g.length;w++){var b=g[w],I=g[w-1];if(m.countSegment(b,I),m.isOnSegment())return m.getLocation()}return m.getLocation()}};var Ft=function(){},hp={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ft.prototype.interfaces_=function(){return[]};Ft.prototype.getClass=function(){return Ft};Ft.orientationIndex=function(e,r,n){return gs.orientationIndex(e,r,n)};Ft.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var r=0,n=e[0].x,i=1;i<e.length-1;i++){var a=e[i].x-n,h=e[i+1].y,s=e[i-1].y;r+=a*(s-h)}return r/2}else if(cr(arguments[0],Zr)){var g=arguments[0],m=g.size();if(m<3)return 0;var w=new Le,b=new Le,I=new Le;g.getCoordinate(0,b),g.getCoordinate(1,I);var A=b.x;I.x-=A;for(var z=0,V=1;V<m-1;V++)w.y=b.y,b.x=I.x,b.y=I.y,g.getCoordinate(V+1,I),I.x-=A,z+=b.x*(w.y-I.y);return z/2}};Ft.distanceLineLine=function(e,r,n,i){if(e.equals(r))return Ft.distancePointLine(e,n,i);if(n.equals(i))return Ft.distancePointLine(i,e,r);var a=!1;if(!Yt.intersects(e,r,n,i))a=!0;else{var h=(r.x-e.x)*(i.y-n.y)-(r.y-e.y)*(i.x-n.x);if(h===0)a=!0;else{var s=(e.y-n.y)*(i.x-n.x)-(e.x-n.x)*(i.y-n.y),g=(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y),m=g/h,w=s/h;(w<0||w>1||m<0||m>1)&&(a=!0)}}return a?Ws.min(Ft.distancePointLine(e,n,i),Ft.distancePointLine(r,n,i),Ft.distancePointLine(n,e,r),Ft.distancePointLine(i,e,r)):0};Ft.isPointInRing=function(e,r){return Ft.locatePointInRing(e,r)!==Ge.EXTERIOR};Ft.computeLength=function(e){var r=e.size();if(r<=1)return 0;var n=0,i=new Le;e.getCoordinate(0,i);for(var a=i.x,h=i.y,s=1;s<r;s++){e.getCoordinate(s,i);var g=i.x,m=i.y,w=g-a,b=m-h;n+=Math.sqrt(w*w+b*b),a=g,h=m}return n};Ft.isCCW=function(e){var r=e.length-1;if(r<3)throw new vi("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],i=0,a=1;a<=r;a++){var h=e[a];h.y>n.y&&(n=h,i=a)}var s=i;do s=s-1,s<0&&(s=r);while(e[s].equals2D(n)&&s!==i);var g=i;do g=(g+1)%r;while(e[g].equals2D(n)&&g!==i);var m=e[s],w=e[g];if(m.equals2D(n)||w.equals2D(n)||m.equals2D(w))return!1;var b=Ft.computeOrientation(m,n,w),I=!1;return b===0?I=m.x>w.x:I=b>0,I};Ft.locatePointInRing=function(e,r){return sl.locatePointInRing(e,r)};Ft.distancePointLinePerpendicular=function(e,r,n){var i=(n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y),a=((r.y-e.y)*(n.x-r.x)-(r.x-e.x)*(n.y-r.y))/i;return Math.abs(a)*Math.sqrt(i)};Ft.computeOrientation=function(e,r,n){return Ft.orientationIndex(e,r,n)};Ft.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(r.length===0)throw new vi("Line array must contain at least one vertex");for(var n=e.distance(r[0]),i=0;i<r.length-1;i++){var a=Ft.distancePointLine(e,r[i],r[i+1]);a<n&&(n=a)}return n}else if(arguments.length===3){var h=arguments[0],s=arguments[1],g=arguments[2];if(s.x===g.x&&s.y===g.y)return h.distance(s);var m=(g.x-s.x)*(g.x-s.x)+(g.y-s.y)*(g.y-s.y),w=((h.x-s.x)*(g.x-s.x)+(h.y-s.y)*(g.y-s.y))/m;if(w<=0)return h.distance(s);if(w>=1)return h.distance(g);var b=((s.y-h.y)*(g.x-s.x)-(s.x-h.x)*(g.y-s.y))/m;return Math.abs(b)*Math.sqrt(m)}};Ft.isOnLine=function(e,r){for(var n=new zh,i=1;i<r.length;i++){var a=r[i-1],h=r[i];if(n.computeIntersection(e,a,h),n.hasIntersection())return!0}return!1};hp.CLOCKWISE.get=function(){return-1};hp.RIGHT.get=function(){return Ft.CLOCKWISE};hp.COUNTERCLOCKWISE.get=function(){return 1};hp.LEFT.get=function(){return Ft.COUNTERCLOCKWISE};hp.COLLINEAR.get=function(){return 0};hp.STRAIGHT.get=function(){return Ft.COLLINEAR};Object.defineProperties(Ft,hp);var Uu=function(){};Uu.prototype.filter=function(e){};Uu.prototype.interfaces_=function(){return[]};Uu.prototype.getClass=function(){return Uu};var ur=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},fu={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ur.prototype.isGeometryCollection=function(){return this.getSortIndex()===ur.SORTINDEX_GEOMETRYCOLLECTION};ur.prototype.getFactory=function(){return this._factory};ur.prototype.getGeometryN=function(e){return this};ur.prototype.getArea=function(){return 0};ur.prototype.isRectangle=function(){return!1};ur.prototype.equals=function(){if(arguments[0]instanceof ur){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var r=arguments[0];if(!(r instanceof ur))return!1;var n=r;return this.equalsExact(n)}};ur.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};ur.prototype.geometryChanged=function(){this.apply(ur.geometryChangedFilter)};ur.prototype.geometryChangedAction=function(){this._envelope=null};ur.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};ur.prototype.getLength=function(){return 0};ur.prototype.getNumGeometries=function(){return 1};ur.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],r=e;return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}};ur.prototype.getUserData=function(){return this._userData};ur.prototype.getSRID=function(){return this._SRID};ur.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};ur.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===ur.SORTINDEX_GEOMETRYCOLLECTION)throw new vi("This method does not support GeometryCollection arguments")};ur.prototype.equal=function(e,r,n){return n===0?e.equals(r):e.distance(r)<=n};ur.prototype.norm=function(){var e=this.copy();return e.normalize(),e};ur.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};ur.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Yt(this._envelope)};ur.prototype.setSRID=function(e){this._SRID=e};ur.prototype.setUserData=function(e){this._userData=e};ur.prototype.compare=function(e,r){for(var n=e.iterator(),i=r.iterator();n.hasNext()&&i.hasNext();){var a=n.next(),h=i.next(),s=a.compareTo(h);if(s!==0)return s}return n.hasNext()?1:i.hasNext()?-1:0};ur.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};ur.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ur.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ur.SORTINDEX_MULTIPOINT||this.getSortIndex()===ur.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ur.SORTINDEX_MULTIPOLYGON};ur.prototype.interfaces_=function(){return[w1,Ea,ba]};ur.prototype.getClass=function(){return ur};ur.hasNonEmptyElements=function(e){for(var r=0;r<e.length;r++)if(!e[r].isEmpty())return!0;return!1};ur.hasNullElements=function(e){for(var r=0;r<e.length;r++)if(e[r]===null)return!0;return!1};fu.serialVersionUID.get=function(){return 8763622679187377e3};fu.SORTINDEX_POINT.get=function(){return 0};fu.SORTINDEX_MULTIPOINT.get=function(){return 1};fu.SORTINDEX_LINESTRING.get=function(){return 2};fu.SORTINDEX_LINEARRING.get=function(){return 3};fu.SORTINDEX_MULTILINESTRING.get=function(){return 4};fu.SORTINDEX_POLYGON.get=function(){return 5};fu.SORTINDEX_MULTIPOLYGON.get=function(){return 6};fu.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};fu.geometryChangedFilter.get=function(){return fT};Object.defineProperties(ur,fu);var fT=function(){};fT.interfaces_=function(){return[Uu]};fT.filter=function(e){e.geometryChangedAction()};var nu=function(){};nu.prototype.filter=function(e){};nu.prototype.interfaces_=function(){return[]};nu.prototype.getClass=function(){return nu};var ya=function(){},Xu={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ya.prototype.isInBoundary=function(e){};ya.prototype.interfaces_=function(){return[]};ya.prototype.getClass=function(){return ya};Xu.Mod2BoundaryNodeRule.get=function(){return qd};Xu.EndPointBoundaryNodeRule.get=function(){return $d};Xu.MultiValentEndPointBoundaryNodeRule.get=function(){return Zd};Xu.MonoValentEndPointBoundaryNodeRule.get=function(){return Xd};Xu.MOD2_BOUNDARY_RULE.get=function(){return new qd};Xu.ENDPOINT_BOUNDARY_RULE.get=function(){return new $d};Xu.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Zd};Xu.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Xd};Xu.OGC_SFS_BOUNDARY_RULE.get=function(){return ya.MOD2_BOUNDARY_RULE};Object.defineProperties(ya,Xu);var qd=function(){};qd.prototype.isInBoundary=function(e){return e%2===1};qd.prototype.interfaces_=function(){return[ya]};qd.prototype.getClass=function(){return qd};var $d=function(){};$d.prototype.isInBoundary=function(e){return e>0};$d.prototype.interfaces_=function(){return[ya]};$d.prototype.getClass=function(){return $d};var Zd=function(){};Zd.prototype.isInBoundary=function(e){return e>1};Zd.prototype.interfaces_=function(){return[ya]};Zd.prototype.getClass=function(){return Zd};var Xd=function(){};Xd.prototype.isInBoundary=function(e){return e===1};Xd.prototype.interfaces_=function(){return[ya]};Xd.prototype.getClass=function(){return Xd};var to=function(){};to.prototype.add=function(){};to.prototype.addAll=function(){};to.prototype.isEmpty=function(){};to.prototype.iterator=function(){};to.prototype.size=function(){};to.prototype.toArray=function(){};to.prototype.remove=function(){};function pT(t){this.message=t||""}pT.prototype=new Error;pT.prototype.name="IndexOutOfBoundsException";var gg=function(){};gg.prototype.hasNext=function(){};gg.prototype.next=function(){};gg.prototype.remove=function(){};var Da=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(to);function mg(t){this.message=t||""}mg.prototype=new Error;mg.prototype.name="NoSuchElementException";var At=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof to&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,to]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var i=this,a=n.iterator();a.hasNext();)i.add(a.next());return!0},e.prototype.set=function(n,i){var a=this.array_[n];return this.array_[n]=i,a},e.prototype.iterator=function(){return new X9(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new pT;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,i=[],a=0,h=this.array_.length;a<h;a++)i.push(n.array_[a]);return i},e.prototype.remove=function(n){for(var i=this,a=!1,h=0,s=this.array_.length;h<s;h++)if(i.array_[h]===n){i.array_.splice(h,1),a=!0;break}return a},e}(Da),X9=function(t){function e(r){t.call(this),this.arrayList_=r,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new mg;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(gg),l_=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.ensureCapacity(i.length),this.add(i,a)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(i){return this.get(i)},e.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var a=arguments[0],h=arguments[1],s=!1,g=a.iterator();g.hasNext();)i.add(g.next(),h),s=!0;return s}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var i=this,a=t.prototype.clone.call(this),h=0;h<this.size();h++)a.add(h,i.get(h).copy());return a},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var i=this;if(arguments.length===1){var a=arguments[0];t.prototype.add.call(this,a)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var h=arguments[0],s=arguments[1];return this.add(h,s,!0),!0}else if(arguments[0]instanceof Le&&typeof arguments[1]=="boolean"){var g=arguments[0],m=arguments[1];if(!m&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(g))return null}t.prototype.add.call(this,g)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var b=arguments[0],I=arguments[1];return this.add(b,I),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var A=arguments[0],z=arguments[1],V=arguments[2];if(V)for(var H=0;H<A.length;H++)i.add(A[H],z);else for(var Z=A.length-1;Z>=0;Z--)i.add(A[Z],z);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Le){var D=arguments[0],k=arguments[1],j=arguments[2];if(!j){var Y=this.size();if(Y>0){if(D>0){var ie=this.get(D-1);if(ie.equals2D(k))return null}if(D<Y){var ne=this.get(D);if(ne.equals2D(k))return null}}}t.prototype.add.call(this,D,k)}}else if(arguments.length===4){var ae=arguments[0],W=arguments[1],$e=arguments[2],Oe=arguments[3],ze=1;$e>Oe&&(ze=-1);for(var We=$e;We!==Oe;We+=ze)i.add(ae[We],W);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Le(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,r),e}(At),Br=function(){},b1={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};b1.ForwardComparator.get=function(){return Uy};b1.BidirectionalComparator.get=function(){return Wd};b1.coordArrayType.get=function(){return new Array(0).fill(null)};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};Br.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};Br.ptNotInList=function(e,r){for(var n=0;n<e.length;n++){var i=e[n];if(Br.indexOf(i,r)<0)return i}return null};Br.scroll=function(e,r){var n=Br.indexOf(r,e);if(n<0)return null;var i=new Array(e.length).fill(null);Oo.arraycopy(e,n,i,0,e.length-n),Oo.arraycopy(e,0,i,e.length-n,n),Oo.arraycopy(i,0,e,0,e.length)};Br.equals=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];if(e===r)return!0;if(e===null||r===null||e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(r[n]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];if(i===a)return!0;if(i===null||a===null||i.length!==a.length)return!1;for(var s=0;s<i.length;s++)if(h.compare(i[s],a[s])!==0)return!1;return!0}};Br.intersection=function(e,r){for(var n=new l_,i=0;i<e.length;i++)r.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()};Br.hasRepeatedPoints=function(e){for(var r=1;r<e.length;r++)if(e[r-1].equals(e[r]))return!0;return!1};Br.removeRepeatedPoints=function(e){if(!Br.hasRepeatedPoints(e))return e;var r=new l_(e,!1);return r.toCoordinateArray()};Br.reverse=function(e){for(var r=e.length-1,n=Math.trunc(r/2),i=0;i<=n;i++){var a=e[i];e[i]=e[r-i],e[r-i]=a}};Br.removeNull=function(e){for(var r=0,n=0;n<e.length;n++)e[n]!==null&&r++;var i=new Array(r).fill(null);if(r===0)return i;for(var a=0,h=0;h<e.length;h++)e[h]!==null&&(i[a++]=e[h]);return i};Br.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],r=new Array(e.length).fill(null),n=0;n<e.length;n++)r[n]=new Le(e[n]);return r}else if(arguments.length===5)for(var i=arguments[0],a=arguments[1],h=arguments[2],s=arguments[3],g=arguments[4],m=0;m<g;m++)h[s+m]=new Le(i[a+m])};Br.isEqualReversed=function(e,r){for(var n=0;n<e.length;n++){var i=e[n],a=r[e.length-n-1];if(i.compareTo(a)!==0)return!1}return!0};Br.envelope=function(e){for(var r=new Yt,n=0;n<e.length;n++)r.expandToInclude(e[n]);return r};Br.toCoordinateArray=function(e){return e.toArray(Br.coordArrayType)};Br.atLeastNCoordinatesOrNothing=function(e,r){return r.length>=e?r:[]};Br.indexOf=function(e,r){for(var n=0;n<r.length;n++)if(e.equals(r[n]))return n;return-1};Br.increasingDirection=function(e){for(var r=0;r<Math.trunc(e.length/2);r++){var n=e.length-1-r,i=e[r].compareTo(e[n]);if(i!==0)return i}return 1};Br.compare=function(e,r){for(var n=0;n<e.length&&n<r.length;){var i=e[n].compareTo(r[n]);if(i!==0)return i;n++}return n<r.length?-1:n<e.length?1:0};Br.minCoordinate=function(e){for(var r=null,n=0;n<e.length;n++)(r===null||r.compareTo(e[n])>0)&&(r=e[n]);return r};Br.extract=function(e,r,n){r=Ws.clamp(r,0,e.length),n=Ws.clamp(n,-1,e.length);var i=n-r+1;n<0&&(i=0),r>=e.length&&(i=0),n<r&&(i=0);var a=new Array(i).fill(null);if(i===0)return a;for(var h=0,s=r;s<=n;s++)a[h++]=e[s];return a};Object.defineProperties(Br,b1);var Uy=function(){};Uy.prototype.compare=function(e,r){var n=e,i=r;return Br.compare(n,i)};Uy.prototype.interfaces_=function(){return[Vd]};Uy.prototype.getClass=function(){return Uy};var Wd=function(){};Wd.prototype.compare=function(e,r){var n=e,i=r;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;var a=Br.compare(n,i),h=Br.isEqualReversed(n,i);return h?0:a};Wd.prototype.OLDcompare=function(e,r){var n=e,i=r;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;for(var a=Br.increasingDirection(n),h=Br.increasingDirection(i),s=a>0?0:n.length-1,g=h>0?0:n.length-1,m=0;m<n.length;m++){var w=n[s].compareTo(i[g]);if(w!==0)return w;s+=a,g+=h}return 0};Wd.prototype.interfaces_=function(){return[Vd]};Wd.prototype.getClass=function(){return Wd};var fp=function(){};fp.prototype.get=function(){};fp.prototype.put=function(){};fp.prototype.size=function(){};fp.prototype.values=function(){};fp.prototype.entrySet=function(){};var W9=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(fp);function u_(t){this.message=t||""}u_.prototype=new Error;u_.prototype.name="OperationNotSupported";function T1(){}T1.prototype=new to;T1.prototype.contains=function(){};var dT=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof to&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var i=this,a=0,h=this.array_.length;a<h;a++){var s=i.array_[a];if(s===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var i=this,a=n.iterator();a.hasNext();)i.add(a.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,i=[],a=0,h=this.array_.length;a<h;a++)i.push(n.array_[a]);return i},e.prototype.iterator=function(){return new H9(this)},e}(T1),H9=function(t){function e(r){t.call(this),this.hashSet_=r,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new mg;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new u_},e}(gg),Lu=0,dh=1;function XC(t){return t===null?Lu:t.color}function ni(t){return t===null?null:t.parent}function Pu(t,e){t!==null&&(t.color=e)}function Jw(t){return t===null?null:t.left}function WC(t){return t===null?null:t.right}function qo(){this.root_=null,this.size_=0}qo.prototype=new W9;qo.prototype.get=function(t){for(var e=this.root_;e!==null;){var r=t.compareTo(e.key);if(r<0)e=e.left;else if(r>0)e=e.right;else return e.value}return null};qo.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Lu,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r=this.root_,n,i;do if(n=r,i=t.compareTo(r.key),i<0)r=r.left;else if(i>0)r=r.right;else{var a=r.value;return r.value=e,a}while(r!==null);var h={key:t,left:null,right:null,value:e,parent:n,color:Lu,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=h:n.right=h,this.fixAfterInsertion(h),this.size_++,null};qo.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=dh;t!=null&&t!==this.root_&&t.parent.color===dh;)if(ni(t)===Jw(ni(ni(t)))){var r=WC(ni(ni(t)));XC(r)===dh?(Pu(ni(t),Lu),Pu(r,Lu),Pu(ni(ni(t)),dh),t=ni(ni(t))):(t===WC(ni(t))&&(t=ni(t),e.rotateLeft(t)),Pu(ni(t),Lu),Pu(ni(ni(t)),dh),e.rotateRight(ni(ni(t))))}else{var n=Jw(ni(ni(t)));XC(n)===dh?(Pu(ni(t),Lu),Pu(n,Lu),Pu(ni(ni(t)),dh),t=ni(ni(t))):(t===Jw(ni(t))&&(t=ni(t),e.rotateRight(t)),Pu(ni(t),Lu),Pu(ni(ni(t)),dh),e.rotateLeft(ni(ni(t))))}this.root_.color=Lu};qo.prototype.values=function(){var t=new At,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=qo.successor(e))!==null;)t.add(e.value);return t};qo.prototype.entrySet=function(){var t=new dT,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=qo.successor(e))!==null;)t.add(e);return t};qo.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};qo.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};qo.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};qo.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var r=t.parent,n=t;r!==null&&n===r.right;)n=r,r=r.parent;return r}};qo.prototype.size=function(){return this.size_};var Gy=function(){};Gy.prototype.interfaces_=function(){return[]};Gy.prototype.getClass=function(){return Gy};function wO(){}wO.prototype=new T1;function cl(){this.array_=[],arguments[0]instanceof to&&this.addAll(arguments[0])}cl.prototype=new wO;cl.prototype.contains=function(t){for(var e=this,r=0,n=this.array_.length;r<n;r++){var i=e.array_[r];if(i.compareTo(t)===0)return!0}return!1};cl.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var r=0,n=this.array_.length;r<n;r++){var i=e.array_[r];if(i.compareTo(t)===1)return e.array_.splice(r,0,t),!0}return this.array_.push(t),!0};cl.prototype.addAll=function(t){for(var e=this,r=t.iterator();r.hasNext();)e.add(r.next());return!0};cl.prototype.remove=function(t){throw new u_};cl.prototype.size=function(){return this.array_.length};cl.prototype.isEmpty=function(){return this.array_.length===0};cl.prototype.toArray=function(){for(var t=this,e=[],r=0,n=this.array_.length;r<n;r++)e.push(t.array_[r]);return e};cl.prototype.iterator=function(){return new S1(this)};var S1=function(t){this.treeSet_=t,this.position_=0};S1.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new mg;return this.treeSet_.array_[this.position_++]};S1.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};S1.prototype.remove=function(){throw new u_};var Eh=function(){};Eh.sort=function(){var e=arguments[0],r,n,i,a;if(arguments.length===1)a=function(s,g){return s.compareTo(g)},e.sort(a);else if(arguments.length===2)i=arguments[1],a=function(s,g){return i.compare(s,g)},e.sort(a);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var h=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),r=0;r<h.length;r++)e.push(h[r])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),i=arguments[3],a=function(s,g){return i.compare(s,g)},n.sort(a),h=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),r=0;r<h.length;r++)e.push(h[r])};Eh.asList=function(e){for(var r=new At,n=0,i=e.length;n<i;n++)r.add(e[n]);return r};var Cn=function(){},Va={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Va.P.get=function(){return 0};Va.L.get=function(){return 1};Va.A.get=function(){return 2};Va.FALSE.get=function(){return-1};Va.TRUE.get=function(){return-2};Va.DONTCARE.get=function(){return-3};Va.SYM_FALSE.get=function(){return"F"};Va.SYM_TRUE.get=function(){return"T"};Va.SYM_DONTCARE.get=function(){return"*"};Va.SYM_P.get=function(){return"0"};Va.SYM_L.get=function(){return"1"};Va.SYM_A.get=function(){return"2"};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.toDimensionSymbol=function(e){switch(e){case Cn.FALSE:return Cn.SYM_FALSE;case Cn.TRUE:return Cn.SYM_TRUE;case Cn.DONTCARE:return Cn.SYM_DONTCARE;case Cn.P:return Cn.SYM_P;case Cn.L:return Cn.SYM_L;case Cn.A:return Cn.SYM_A}throw new vi("Unknown dimension value: "+e)};Cn.toDimensionValue=function(e){switch(By.toUpperCase(e)){case Cn.SYM_FALSE:return Cn.FALSE;case Cn.SYM_TRUE:return Cn.TRUE;case Cn.SYM_DONTCARE:return Cn.DONTCARE;case Cn.SYM_P:return Cn.P;case Cn.SYM_L:return Cn.L;case Cn.SYM_A:return Cn.A}throw new vi("Unknown dimension symbol: "+e)};Object.defineProperties(Cn,Va);var hl=function(){};hl.prototype.filter=function(e){};hl.prototype.interfaces_=function(){return[]};hl.prototype.getClass=function(){return hl};var Ra=function(){};Ra.prototype.filter=function(e,r){};Ra.prototype.isDone=function(){};Ra.prototype.isGeometryChanged=function(){};Ra.prototype.interfaces_=function(){return[]};Ra.prototype.getClass=function(){return Ra};var as=function(t){function e(n,i){if(t.call(this,i),this._geometries=n||[],t.hasNullElements(this._geometries))throw new vi("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var i=this,a=new Yt,h=0;h<this._geometries.length;h++)a.expandToInclude(i._geometries[h].getEnvelopeInternal());return a},e.prototype.getGeometryN=function(i){return this._geometries[i]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var i=this,a=new Array(this.getNumPoints()).fill(null),h=-1,s=0;s<this._geometries.length;s++)for(var g=i._geometries[s].getCoordinates(),m=0;m<g.length;m++)h++,a[h]=g[m];return a},e.prototype.getArea=function(){for(var i=this,a=0,h=0;h<this._geometries.length;h++)a+=i._geometries[h].getArea();return a},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var a=arguments[0],h=arguments[1];if(!this.isEquivalentClass(a))return!1;var s=a;if(this._geometries.length!==s._geometries.length)return!1;for(var g=0;g<this._geometries.length;g++)if(!i._geometries[g].equalsExact(s._geometries[g],h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var i=this,a=0;a<this._geometries.length;a++)i._geometries[a].normalize();Eh.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var i=this,a=Cn.FALSE,h=0;h<this._geometries.length;h++)a=Math.max(a,i._geometries[h].getBoundaryDimension());return a},e.prototype.getDimension=function(){for(var i=this,a=Cn.FALSE,h=0;h<this._geometries.length;h++)a=Math.max(a,i._geometries[h].getDimension());return a},e.prototype.getLength=function(){for(var i=this,a=0,h=0;h<this._geometries.length;h++)a+=i._geometries[h].getLength();return a},e.prototype.getNumPoints=function(){for(var i=this,a=0,h=0;h<this._geometries.length;h++)a+=i._geometries[h].getNumPoints();return a},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var i=this,a=this._geometries.length,h=new Array(a).fill(null),s=0;s<this._geometries.length;s++)h[s]=i._geometries[s].reverse();return this.getFactory().createGeometryCollection(h)},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var a=arguments[0],h=new cl(Eh.asList(this._geometries)),s=new cl(Eh.asList(a._geometries));return this.compare(h,s)}else if(arguments.length===2){for(var g=arguments[0],m=arguments[1],w=g,b=this.getNumGeometries(),I=w.getNumGeometries(),A=0;A<b&&A<I;){var z=i.getGeometryN(A),V=w.getGeometryN(A),H=z.compareToSameClass(V,m);if(H!==0)return H;A++}return A<b?1:A<I?-1:0}},e.prototype.apply=function(){var i=this;if(cr(arguments[0],nu))for(var a=arguments[0],h=0;h<this._geometries.length;h++)i._geometries[h].apply(a);else if(cr(arguments[0],Ra)){var s=arguments[0];if(this._geometries.length===0)return null;for(var g=0;g<this._geometries.length&&(i._geometries[g].apply(s),!s.isDone());g++);s.isGeometryChanged()&&this.geometryChanged()}else if(cr(arguments[0],hl)){var m=arguments[0];m.filter(this);for(var w=0;w<this._geometries.length;w++)i._geometries[w].apply(m)}else if(cr(arguments[0],Uu)){var b=arguments[0];b.filter(this);for(var I=0;I<this._geometries.length;I++)i._geometries[I].apply(b)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Cr.shouldNeverReachHere(),null},e.prototype.clone=function(){var i=this,a=t.prototype.clone.call(this);a._geometries=new Array(this._geometries.length).fill(null);for(var h=0;h<this._geometries.length;h++)a._geometries[h]=i._geometries[h].clone();return a},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var i=this,a=new Array(this._geometries.length).fill(null),h=0;h<a.length;h++)a[h]=i._geometries[h].copy();return new e(a,this._factory)},e.prototype.isEmpty=function(){for(var i=this,a=0;a<this._geometries.length;a++)if(!i._geometries[a].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,r),e}(ur),Ch=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ur.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,a):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Cn.FALSE:0},e.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!i._geometries[a].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var i=this,a=this._geometries.length,h=new Array(a).fill(null),s=0;s<this._geometries.length;s++)h[a-1-s]=i._geometries[s].reverse();return this.getFactory().createMultiLineString(h)},e.prototype.getBoundary=function(){return new ha(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var i=this,a=new Array(this._geometries.length).fill(null),h=0;h<a.length;h++)a[h]=i._geometries[h].copy();return new e(a,this._factory)},e.prototype.interfaces_=function(){return[Gy]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,r),e}(as),ha=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],r=ya.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=r}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=i}};ha.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var r=this.computeBoundaryCoordinates(e);return r.length===1?this._geomFact.createPoint(r[0]):this._geomFact.createMultiPointFromCoords(r)};ha.prototype.getBoundary=function(){return this._geom instanceof Ai?this.boundaryLineString(this._geom):this._geom instanceof Ch?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};ha.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var r=this._bnRule.isInBoundary(2);return r?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};ha.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ha.prototype.computeBoundaryCoordinates=function(e){var r=this,n=new At;this._endpointMap=new qo;for(var i=0;i<e.getNumGeometries();i++){var a=e.getGeometryN(i);a.getNumPoints()!==0&&(r.addEndpoint(a.getCoordinateN(0)),r.addEndpoint(a.getCoordinateN(a.getNumPoints()-1)))}for(var h=this._endpointMap.entrySet().iterator();h.hasNext();){var s=h.next(),g=s.getValue(),m=g.count;r._bnRule.isInBoundary(m)&&n.add(s.getKey())}return Br.toCoordinateArray(n)};ha.prototype.addEndpoint=function(e){var r=this._endpointMap.get(e);r===null&&(r=new z0,this._endpointMap.put(e,r)),r.count++};ha.prototype.interfaces_=function(){return[]};ha.prototype.getClass=function(){return ha};ha.getBoundary=function(){if(arguments.length===1){var e=arguments[0],r=new ha(e);return r.getBoundary()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],a=new ha(n,i);return a.getBoundary()}};var z0=function(){this.count=null};z0.prototype.interfaces_=function(){return[]};z0.prototype.getClass=function(){return z0};function K9(){}function Y9(){}var J9=function(){};function Q9(){}function e7(){}function t7(){}var fa=function(){},gT={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};fa.chars=function(e,r){for(var n=new Array(r).fill(null),i=0;i<r;i++)n[i]=e;return String(n)};fa.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],r=new Q9,n=new K9;return e.printStackTrace(n),r.toString()}else if(arguments.length===2){var i=arguments[0],a=arguments[1],h="";new Y9(fa.getStackTrace(i));for(var s=new t7,g=0;g<a;g++)try{h+=s.readLine()+fa.NEWLINE}catch(m){if(m instanceof e7)Cr.shouldNeverReachHere();else throw m}finally{}return h}};fa.split=function(e,r){for(var n=r.length,i=new At,a=""+e,h=a.indexOf(r);h>=0;){var s=a.substring(0,h);i.add(s),a=a.substring(h+n),h=a.indexOf(r)}a.length>0&&i.add(a);for(var g=new Array(i.size()).fill(null),m=0;m<g.length;m++)g[m]=i.get(m);return g};fa.toString=function(){if(arguments.length===1){var e=arguments[0];return fa.SIMPLE_ORDINATE_FORMAT.format(e)}};fa.spaces=function(e){return fa.chars(" ",e)};gT.NEWLINE.get=function(){return Oo.getProperty("line.separator")};gT.SIMPLE_ORDINATE_FORMAT.get=function(){return new J9};Object.defineProperties(fa,gT);var ki=function(){};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};ki.copyCoord=function(e,r,n,i){for(var a=Math.min(e.getDimension(),n.getDimension()),h=0;h<a;h++)n.setOrdinate(i,h,e.getOrdinate(r,h))};ki.isRing=function(e){var r=e.size();return r===0?!0:r<=3?!1:e.getOrdinate(0,Zr.X)===e.getOrdinate(r-1,Zr.X)&&e.getOrdinate(0,Zr.Y)===e.getOrdinate(r-1,Zr.Y)};ki.isEqual=function(e,r){var n=e.size(),i=r.size();if(n!==i)return!1;for(var a=Math.min(e.getDimension(),r.getDimension()),h=0;h<n;h++)for(var s=0;s<a;s++){var g=e.getOrdinate(h,s),m=r.getOrdinate(h,s);if(e.getOrdinate(h,s)!==r.getOrdinate(h,s)&&!(_r.isNaN(g)&&_r.isNaN(m)))return!1}return!0};ki.extend=function(e,r,n){var i=e.create(n,r.getDimension()),a=r.size();if(ki.copy(r,0,i,0,a),a>0)for(var h=a;h<n;h++)ki.copy(r,a-1,i,h,1);return i};ki.reverse=function(e){for(var r=e.size()-1,n=Math.trunc(r/2),i=0;i<=n;i++)ki.swap(e,i,r-i)};ki.swap=function(e,r,n){if(r===n)return null;for(var i=0;i<e.getDimension();i++){var a=e.getOrdinate(r,i);e.setOrdinate(r,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,a)}};ki.copy=function(e,r,n,i,a){for(var h=0;h<a;h++)ki.copyCoord(e,r+h,n,i+h)};ki.toString=function(){if(arguments.length===1){var e=arguments[0],r=e.size();if(r===0)return"()";var n=e.getDimension(),i=new wl;i.append("(");for(var a=0;a<r;a++){a>0&&i.append(" ");for(var h=0;h<n;h++)h>0&&i.append(","),i.append(fa.toString(e.getOrdinate(a,h)))}return i.append(")"),i.toString()}};ki.ensureValidRing=function(e,r){var n=r.size();if(n===0)return r;if(n<=3)return ki.createClosedRing(e,r,4);var i=r.getOrdinate(0,Zr.X)===r.getOrdinate(n-1,Zr.X)&&r.getOrdinate(0,Zr.Y)===r.getOrdinate(n-1,Zr.Y);return i?r:ki.createClosedRing(e,r,n+1)};ki.createClosedRing=function(e,r,n){var i=e.create(n,r.getDimension()),a=r.size();ki.copy(r,0,i,0,a);for(var h=a;h<n;h++)ki.copy(r,0,i,h,1);return i};var Ai=function(t){function e(n,i){t.call(this,i),this._points=null,this.init(n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Yt:this._points.expandEnvelope(new Yt)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var a=arguments[0],h=arguments[1];if(!this.isEquivalentClass(a))return!1;var s=a;if(this._points.size()!==s._points.size())return!1;for(var g=0;g<this._points.size();g++)if(!i.equal(i._points.getCoordinate(g),s._points.getCoordinate(g),h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var i=this,a=0;a<Math.trunc(this._points.size()/2);a++){var h=i._points.size()-1-a;if(!i._points.getCoordinate(a).equals(i._points.getCoordinate(h)))return i._points.getCoordinate(a).compareTo(i._points.getCoordinate(h))>0&&ki.reverse(i._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Cn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Ft.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var i=this._points.copy();ki.reverse(i);var a=this.getFactory().createLineString(i);return a},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var a=arguments[0],h=a,s=0,g=0;s<this._points.size()&&g<h._points.size();){var m=i._points.getCoordinate(s).compareTo(h._points.getCoordinate(g));if(m!==0)return m;s++,g++}return s<this._points.size()?1:g<h._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],b=arguments[1],I=w;return b.compare(this._points,I._points)}},e.prototype.apply=function(){var i=this;if(cr(arguments[0],nu))for(var a=arguments[0],h=0;h<this._points.size();h++)a.filter(i._points.getCoordinate(h));else if(cr(arguments[0],Ra)){var s=arguments[0];if(this._points.size()===0)return null;for(var g=0;g<this._points.size()&&(s.filter(i._points,g),!s.isDone());g++);s.isGeometryChanged()&&this.geometryChanged()}else if(cr(arguments[0],hl)){var m=arguments[0];m.filter(this)}else if(cr(arguments[0],Uu)){var w=arguments[0];w.filter(this)}},e.prototype.getBoundary=function(){return new ha(this).getBoundary()},e.prototype.isEquivalentClass=function(i){return i instanceof e},e.prototype.clone=function(){var i=t.prototype.clone.call(this);return i._points=this._points.clone(),i},e.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new vi("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},e.prototype.isCoordinate=function(i){for(var a=this,h=0;h<this._points.size();h++)if(a._points.getCoordinate(h).equals(i))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},e.prototype.interfaces_=function(){return[Gy]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,r),e}(ur),Vy=function(){};Vy.prototype.interfaces_=function(){return[]};Vy.prototype.getClass=function(){return Vy};var Ds=function(t){function e(n,i){t.call(this,i),this._coordinates=n||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Yt;var i=new Yt;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),a):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Cn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],a=i;return this.getCoordinate().compareTo(a.getCoordinate())}else if(arguments.length===2){var h=arguments[0],s=arguments[1],g=h;return s.compare(this._coordinates,g._coordinates)}},e.prototype.apply=function(){if(cr(arguments[0],nu)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(cr(arguments[0],Ra)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else if(cr(arguments[0],hl)){var h=arguments[0];h.filter(this)}else if(cr(arguments[0],Uu)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var i=t.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),Cr.isTrue(i.size()<=1),this._coordinates=i},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Vy]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,r),e}(ur),Tc=function(){};Tc.prototype.interfaces_=function(){return[]};Tc.prototype.getClass=function(){return Tc};var ao=function(t){function e(n,i,a){if(t.call(this,a),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new vi("holes must not contain null elements");if(n.isEmpty()&&t.hasNonEmptyElements(i))throw new vi("shell is empty but holes are not");this._shell=n,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),h=-1,s=this._shell.getCoordinates(),g=0;g<s.length;g++)h++,a[h]=s[g];for(var m=0;m<this._holes.length;m++)for(var w=i._holes[m].getCoordinates(),b=0;b<w.length;b++)h++,a[h]=w[b];return a},e.prototype.getArea=function(){var i=this,a=0;a+=Math.abs(Ft.signedArea(this._shell.getCoordinateSequence()));for(var h=0;h<this._holes.length;h++)a-=Math.abs(Ft.signedArea(i._holes[h].getCoordinateSequence()));return a},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),h=0;h<5;h++){var s=i.getX(h);if(!(s===a.getMinX()||s===a.getMaxX()))return!1;var g=i.getY(h);if(!(g===a.getMinY()||g===a.getMaxY()))return!1}for(var m=i.getX(0),w=i.getY(0),b=1;b<=4;b++){var I=i.getX(b),A=i.getY(b),z=I!==m,V=A!==w;if(z===V)return!1;m=I,w=A}return!0},e.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var a=arguments[0],h=arguments[1];if(!this.isEquivalentClass(a))return!1;var s=a,g=this._shell,m=s._shell;if(!g.equalsExact(m,h)||this._holes.length!==s._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!i._holes[w].equalsExact(s._holes[w],h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var a=0;a<this._holes.length;a++)i.normalize(i._holes[a],!1);Eh.sort(this._holes)}else if(arguments.length===2){var h=arguments[0],s=arguments[1];if(h.isEmpty())return null;var g=new Array(h.getCoordinates().length-1).fill(null);Oo.arraycopy(h.getCoordinates(),0,g,0,g.length);var m=Br.minCoordinate(h.getCoordinates());Br.scroll(g,m),Oo.arraycopy(g,0,h.getCoordinates(),0,g.length),h.getCoordinates()[g.length]=g[0],Ft.isCCW(h.getCoordinates())===s&&Br.reverse(h.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var i=this,a=0;a+=this._shell.getLength();for(var h=0;h<this._holes.length;h++)a+=i._holes[h].getLength();return a},e.prototype.getNumPoints=function(){for(var i=this,a=this._shell.getNumPoints(),h=0;h<this._holes.length;h++)a+=i._holes[h].getNumPoints();return a},e.prototype.reverse=function(){var i=this,a=this.copy();a._shell=this._shell.copy().reverse(),a._holes=new Array(this._holes.length).fill(null);for(var h=0;h<this._holes.length;h++)a._holes[h]=i._holes[h].copy().reverse();return a},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var a=arguments[0],h=this._shell,s=a._shell;return h.compareToSameClass(s)}else if(arguments.length===2){var g=arguments[0],m=arguments[1],w=g,b=this._shell,I=w._shell,A=b.compareToSameClass(I,m);if(A!==0)return A;for(var z=this.getNumInteriorRing(),V=w.getNumInteriorRing(),H=0;H<z&&H<V;){var Z=i.getInteriorRingN(H),D=w.getInteriorRingN(H),k=Z.compareToSameClass(D,m);if(k!==0)return k;H++}return H<z?1:H<V?-1:0}},e.prototype.apply=function(i){var a=this;if(cr(i,nu)){this._shell.apply(i);for(var h=0;h<this._holes.length;h++)a._holes[h].apply(i)}else if(cr(i,Ra)){if(this._shell.apply(i),!i.isDone())for(var s=0;s<this._holes.length&&(a._holes[s].apply(i),!i.isDone());s++);i.isGeometryChanged()&&this.geometryChanged()}else if(cr(i,hl))i.filter(this);else if(cr(i,Uu)){i.filter(this),this._shell.apply(i);for(var g=0;g<this._holes.length;g++)a._holes[g].apply(i)}},e.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var h=0;h<this._holes.length;h++)a[h+1]=i._holes[h];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)},e.prototype.clone=function(){var i=this,a=t.prototype.clone.call(this);a._shell=this._shell.clone(),a._holes=new Array(this._holes.length).fill(null);for(var h=0;h<this._holes.length;h++)a._holes[h]=i._holes[h].clone();return a},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var i=this,a=this._shell.copy(),h=new Array(this._holes.length).fill(null),s=0;s<h.length;s++)h[s]=i._holes[s].copy();return new e(a,h,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(i){return this._holes[i]},e.prototype.interfaces_=function(){return[Tc]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,r),e}(ur),Hd=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ur.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,a):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Cn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var i=this,a=new Array(this._geometries.length).fill(null),h=0;h<a.length;h++)a[h]=i._geometries[h].copy();return new e(a,this._factory)},e.prototype.interfaces_=function(){return[Vy]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,r),e}(as),iu=function(t){function e(n,i){n instanceof Le&&i instanceof zr&&(n=i.getCoordinateSequenceFactory().create(n)),t.call(this,n,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ur.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Cn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var i=this._points.copy();ki.reverse(i);var a=this.getFactory().createLinearRing(i);return a},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new vi("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new vi("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,r),e}(Ai),tu=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ur.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.isEquivalentClass(i)?t.prototype.equalsExact.call(this,i,a):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var i=this,a=this._geometries.length,h=new Array(a).fill(null),s=0;s<this._geometries.length;s++)h[s]=i._geometries[s].reverse();return this.getFactory().createMultiPolygon(h)},e.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new At,h=0;h<this._geometries.length;h++)for(var s=i._geometries[h],g=s.getBoundary(),m=0;m<g.getNumGeometries();m++)a.add(g.getGeometryN(m));var w=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(w))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var i=this,a=new Array(this._geometries.length).fill(null),h=0;h<a.length;h++)a[h]=i._geometries[h].copy();return new e(a,this._factory)},e.prototype.interfaces_=function(){return[Tc]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,r),e}(as),_a=function(e){this._factory=e||null,this._isUserDataCopied=!1},I1={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};_a.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};_a.prototype.edit=function(e,r){if(e===null)return null;var n=this.editInternal(e,r);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};_a.prototype.editInternal=function(e,r){return this._factory===null&&(this._factory=e.getFactory()),e instanceof as?this.editGeometryCollection(e,r):e instanceof ao?this.editPolygon(e,r):e instanceof Ds?r.edit(e,this._factory):e instanceof Ai?r.edit(e,this._factory):(Cr.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};_a.prototype.editGeometryCollection=function(e,r){for(var n=this,i=r.edit(e,this._factory),a=new At,h=0;h<i.getNumGeometries();h++){var s=n.edit(i.getGeometryN(h),r);s===null||s.isEmpty()||a.add(s)}return i.getClass()===Hd?this._factory.createMultiPoint(a.toArray([])):i.getClass()===Ch?this._factory.createMultiLineString(a.toArray([])):i.getClass()===tu?this._factory.createMultiPolygon(a.toArray([])):this._factory.createGeometryCollection(a.toArray([]))};_a.prototype.editPolygon=function(e,r){var n=this,i=r.edit(e,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var a=this.edit(i.getExteriorRing(),r);if(a===null||a.isEmpty())return this._factory.createPolygon();for(var h=new At,s=0;s<i.getNumInteriorRing();s++){var g=n.edit(i.getInteriorRingN(s),r);g===null||g.isEmpty()||h.add(g)}return this._factory.createPolygon(a,h.toArray([]))};_a.prototype.interfaces_=function(){return[]};_a.prototype.getClass=function(){return _a};_a.GeometryEditorOperation=function(){};I1.NoOpGeometryOperation.get=function(){return jy};I1.CoordinateOperation.get=function(){return qy};I1.CoordinateSequenceOperation.get=function(){return $y};Object.defineProperties(_a,I1);var jy=function(){};jy.prototype.edit=function(e,r){return e};jy.prototype.interfaces_=function(){return[_a.GeometryEditorOperation]};jy.prototype.getClass=function(){return jy};var qy=function(){};qy.prototype.edit=function(e,r){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof iu?r.createLinearRing(n):e instanceof Ai?r.createLineString(n):e instanceof Ds?n.length>0?r.createPoint(n[0]):r.createPoint():e};qy.prototype.interfaces_=function(){return[_a.GeometryEditorOperation]};qy.prototype.getClass=function(){return qy};var $y=function(){};$y.prototype.edit=function(e,r){return e instanceof iu?r.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Ai?r.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Ds?r.createPoint(this.edit(e.getCoordinateSequence(),e)):e};$y.prototype.interfaces_=function(){return[_a.GeometryEditorOperation]};$y.prototype.getClass=function(){return $y};var Ni=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var r=arguments[0];this._coordinates=new Array(r).fill(null);for(var n=0;n<r;n++)e._coordinates[n]=new Le}else if(cr(arguments[0],Zr)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)e._coordinates[a]=i.getCoordinateCopy(a)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var h=arguments[0],s=arguments[1];this._coordinates=h,this._dimension=s,h===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var g=arguments[0],m=arguments[1];this._coordinates=new Array(g).fill(null),this._dimension=m;for(var w=0;w<g;w++)e._coordinates[w]=new Le}}},EO={serialVersionUID:{configurable:!0}};Ni.prototype.setOrdinate=function(e,r,n){switch(r){case Zr.X:this._coordinates[e].x=n;break;case Zr.Y:this._coordinates[e].y=n;break;case Zr.Z:this._coordinates[e].z=n;break;default:throw new vi("invalid ordinateIndex")}};Ni.prototype.size=function(){return this._coordinates.length};Ni.prototype.getOrdinate=function(e,r){switch(r){case Zr.X:return this._coordinates[e].x;case Zr.Y:return this._coordinates[e].y;case Zr.Z:return this._coordinates[e].z}return _r.NaN};Ni.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var r=arguments[0],n=arguments[1];n.x=this._coordinates[r].x,n.y=this._coordinates[r].y,n.z=this._coordinates[r].z}};Ni.prototype.getCoordinateCopy=function(e){return new Le(this._coordinates[e])};Ni.prototype.getDimension=function(){return this._dimension};Ni.prototype.getX=function(e){return this._coordinates[e].x};Ni.prototype.clone=function(){for(var e=this,r=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)r[n]=e._coordinates[n].clone();return new Ni(r,this._dimension)};Ni.prototype.expandEnvelope=function(e){for(var r=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(r._coordinates[n]);return e};Ni.prototype.copy=function(){for(var e=this,r=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)r[n]=e._coordinates[n].copy();return new Ni(r,this._dimension)};Ni.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var r=new wl(17*this._coordinates.length);r.append("("),r.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)r.append(", "),r.append(e._coordinates[n]);return r.append(")"),r.toString()}else return"()"};Ni.prototype.getY=function(e){return this._coordinates[e].y};Ni.prototype.toCoordinateArray=function(){return this._coordinates};Ni.prototype.interfaces_=function(){return[Zr,ba]};Ni.prototype.getClass=function(){return Ni};EO.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Ni,EO);var ou=function(){},mT={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ou.prototype.readResolve=function(){return ou.instance()};ou.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Ni(e)}else if(cr(arguments[0],Zr)){var r=arguments[0];return new Ni(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Ni(n):new Ni(n,i)}};ou.prototype.interfaces_=function(){return[jd,ba]};ou.prototype.getClass=function(){return ou};ou.instance=function(){return ou.instanceObject};mT.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};mT.instanceObject.get=function(){return new ou};Object.defineProperties(ou,mT);var bO=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,i){return this.map_.set(n,i),i},e.prototype.values=function(){for(var n=new At,i=this.map_.values(),a=i.next();!a.done;)n.add(a.value),a=i.next();return n},e.prototype.entrySet=function(){var n=new dT;return this.map_.entries().forEach(function(i){return n.add(i)}),n},e.prototype.size=function(){return this.map_.size()},e}(fp),Mn=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof fl){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this._modelType=t.FIXED,this.setScale(r)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},yT={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Mn.prototype.equals=function(e){if(!(e instanceof Mn))return!1;var r=e;return this._modelType===r._modelType&&this._scale===r._scale};Mn.prototype.compareTo=function(e){var r=e,n=this.getMaximumSignificantDigits(),i=r.getMaximumSignificantDigits();return new ul(n).compareTo(new ul(i))};Mn.prototype.getScale=function(){return this._scale};Mn.prototype.isFloating=function(){return this._modelType===Mn.FLOATING||this._modelType===Mn.FLOATING_SINGLE};Mn.prototype.getType=function(){return this._modelType};Mn.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Mn.FLOATING?e="Floating":this._modelType===Mn.FLOATING_SINGLE?e="Floating-Single":this._modelType===Mn.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};Mn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(_r.isNaN(e))return e;if(this._modelType===Mn.FLOATING_SINGLE){var r=e;return r}return this._modelType===Mn.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof Le){var n=arguments[0];if(this._modelType===Mn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Mn.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Mn.FLOATING?e=16:this._modelType===Mn.FLOATING_SINGLE?e=6:this._modelType===Mn.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};Mn.prototype.setScale=function(e){this._scale=Math.abs(e)};Mn.prototype.interfaces_=function(){return[ba,Ea]};Mn.prototype.getClass=function(){return Mn};Mn.mostPrecise=function(e,r){return e.compareTo(r)>=0?e:r};yT.serialVersionUID.get=function(){return 7777263578777804e3};yT.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Mn,yT);var fl=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},_T={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};fl.prototype.readResolve=function(){return fl.nameToTypeMap.get(this._name)};fl.prototype.toString=function(){return this._name};fl.prototype.interfaces_=function(){return[ba]};fl.prototype.getClass=function(){return fl};_T.serialVersionUID.get=function(){return-552860263173159e4};_T.nameToTypeMap.get=function(){return new bO};Object.defineProperties(fl,_T);Mn.Type=fl;Mn.FIXED=new fl("FIXED");Mn.FLOATING=new fl("FLOATING");Mn.FLOATING_SINGLE=new fl("FLOATING SINGLE");var zr=function t(){this._precisionModel=new Mn,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?cr(arguments[0],jd)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Mn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},TO={serialVersionUID:{configurable:!0}};zr.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Le(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Le(e.getMinX(),e.getMinY()),new Le(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Le(e.getMinX(),e.getMinY()),new Le(e.getMinX(),e.getMaxY()),new Le(e.getMaxX(),e.getMaxY()),new Le(e.getMaxX(),e.getMinY()),new Le(e.getMinX(),e.getMinY())]),null)};zr.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new Ai(this.getCoordinateSequenceFactory().create(e),this);if(cr(e,Zr))return new Ai(e,this)}else return new Ai(this.getCoordinateSequenceFactory().create([]),this)};zr.prototype.createMultiLineString=function(){if(arguments.length===0)return new Ch(null,this);if(arguments.length===1){var e=arguments[0];return new Ch(e,this)}};zr.prototype.buildGeometry=function(e){for(var r=null,n=!1,i=!1,a=e.iterator();a.hasNext();){var h=a.next(),s=h.getClass();r===null&&(r=s),s!==r&&(n=!0),h.isGeometryCollectionOrDerived()&&(i=!0)}if(r===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(zr.toGeometryArray(e));var g=e.iterator().next(),m=e.size()>1;if(m){if(g instanceof ao)return this.createMultiPolygon(zr.toPolygonArray(e));if(g instanceof Ai)return this.createMultiLineString(zr.toLineStringArray(e));if(g instanceof Ds)return this.createMultiPoint(zr.toPointArray(e));Cr.shouldNeverReachHere("Unhandled class: "+g.getClass().getName())}return g};zr.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};zr.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Le){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(cr(arguments[0],Zr)){var r=arguments[0];return new Ds(r,this)}}};zr.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};zr.prototype.createPolygon=function(){if(arguments.length===0)return new ao(null,null,this);if(arguments.length===1){if(cr(arguments[0],Zr)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createPolygon(this.createLinearRing(r))}else if(arguments[0]instanceof iu){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return new ao(i,a,this)}};zr.prototype.getSRID=function(){return this._SRID};zr.prototype.createGeometryCollection=function(){if(arguments.length===0)return new as(null,this);if(arguments.length===1){var e=arguments[0];return new as(e,this)}};zr.prototype.createGeometry=function(e){var r=new _a(this);return r.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};zr.prototype.getPrecisionModel=function(){return this._precisionModel};zr.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(cr(arguments[0],Zr)){var r=arguments[0];return new iu(r,this)}}};zr.prototype.createMultiPolygon=function(){if(arguments.length===0)return new tu(null,this);if(arguments.length===1){var e=arguments[0];return new tu(e,this)}};zr.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Hd(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];return new Hd(r,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(cr(arguments[0],Zr)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(i.size()).fill(null),h=0;h<i.size();h++){var s=e.getCoordinateSequenceFactory().create(1,i.getDimension());ki.copy(i,h,s,0,1),a[h]=e.createPoint(s)}return this.createMultiPoint(a)}}};zr.prototype.interfaces_=function(){return[ba]};zr.prototype.getClass=function(){return zr};zr.toMultiPolygonArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toGeometryArray=function(e){if(e===null)return null;var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.getDefaultCoordinateSequenceFactory=function(){return ou.instance()};zr.toMultiLineStringArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toLineStringArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toMultiPointArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toLinearRingArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toPointArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.toPolygonArray=function(e){var r=new Array(e.size()).fill(null);return e.toArray(r)};zr.createPointFromInternalCoord=function(e,r){return r.getPrecisionModel().makePrecise(e),r.getFactory().createPoint(e)};TO.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(zr,TO);var r7=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],P1=function(e){this.geometryFactory=e||new zr};P1.prototype.read=function(e){var r;typeof e=="string"?r=JSON.parse(e):r=e;var n=r.type;if(!nl[n])throw new Error("Unknown GeoJSON type: "+r.type);return r7.indexOf(n)!==-1?nl[n].apply(this,[r.coordinates]):n==="GeometryCollection"?nl[n].apply(this,[r.geometries]):nl[n].apply(this,[r])};P1.prototype.write=function(e){var r=e.getGeometryType();if(!Au[r])throw new Error("Geometry is not supported");return Au[r].apply(this,[e])};var nl={Feature:function(t){var e={};for(var r in t)e[r]=t[r];if(t.geometry){var n=t.geometry.type;if(!nl[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=nl.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,r={};if(t.features){r.features=[];for(var n=0;n<t.features.length;++n)r.features.push(e.read(t.features[n]))}return t.bbox&&(r.bbox=this.parse.bbox.apply(this,[t.bbox])),r},coordinates:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(new Le(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Le(t[0],t[1]),new Le(t[2],t[1]),new Le(t[2],t[3]),new Le(t[0],t[3]),new Le(t[0],t[1])])},Point:function(t){var e=new Le(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,r=[],n=0;n<t.length;++n)r.push(nl.Point.apply(e,[t[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(t){var e=nl.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,r=[],n=0;n<t.length;++n)r.push(nl.LineString.apply(e,[t[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(t){for(var e=this,r=nl.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(r),i=[],a=1;a<t.length;++a){var h=t[a],s=nl.coordinates.apply(e,[h]),g=e.geometryFactory.createLinearRing(s);i.push(g)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=this,r=[],n=0;n<t.length;++n){var i=t[n];r.push(nl.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(t){for(var e=this,r=[],n=0;n<t.length;++n){var i=t[n];r.push(e.read(i))}return this.geometryFactory.createGeometryCollection(r)}},Au={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=Au.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,r=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],a=Au.Point.apply(e,[i]);r.push(a.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(t){for(var e=this,r=[],n=t.getCoordinates(),i=0;i<n.length;++i){var a=n[i];r.push(Au.coordinate.apply(e,[a]))}return{type:"LineString",coordinates:r}},MultiLineString:function(t){for(var e=this,r=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],a=Au.LineString.apply(e,[i]);r.push(a.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(t){var e=this,r=[],n=Au.LineString.apply(this,[t._shell]);r.push(n.coordinates);for(var i=0;i<t._holes.length;++i){var a=t._holes[i],h=Au.LineString.apply(e,[a]);r.push(h.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(t){for(var e=this,r=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],a=Au.Polygon.apply(e,[i]);r.push(a.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(t){for(var e=this,r=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],a=i.getGeometryType();r.push(Au[a].apply(e,[i]))}return{type:"GeometryCollection",geometries:r}}},vT=function(e){this.geometryFactory=e||new zr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new P1(this.geometryFactory)};vT.prototype.read=function(e){var r=this.parser.read(e);return this.precisionModel.getType()===Mn.FIXED&&this.reducePrecision(r),r};vT.prototype.reducePrecision=function(e){var r=this,n,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,i=e.points.length;n<i;n++)r.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,i=e.geometries.length;n<i;n++)r.reducePrecision(e.geometries[n])};var SO=function(){this.parser=new P1(this.geometryFactory)};SO.prototype.write=function(e){return this.parser.write(e)};var Et=function(){},C1={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Et.prototype.interfaces_=function(){return[]};Et.prototype.getClass=function(){return Et};Et.opposite=function(e){return e===Et.LEFT?Et.RIGHT:e===Et.RIGHT?Et.LEFT:e};C1.ON.get=function(){return 0};C1.LEFT.get=function(){return 1};C1.RIGHT.get=function(){return 2};Object.defineProperties(Et,C1);function A1(t){this.message=t||""}A1.prototype=new Error;A1.prototype.name="EmptyStackException";function El(){this.array_=[]}El.prototype=new Da;El.prototype.add=function(t){return this.array_.push(t),!0};El.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};El.prototype.push=function(t){return this.array_.push(t),t};El.prototype.pop=function(t){if(this.array_.length===0)throw new A1;return this.array_.pop()};El.prototype.peek=function(){if(this.array_.length===0)throw new A1;return this.array_[this.array_.length-1]};El.prototype.empty=function(){return this.array_.length===0};El.prototype.isEmpty=function(){return this.empty()};El.prototype.search=function(t){return this.array_.indexOf(t)};El.prototype.size=function(){return this.array_.length};El.prototype.toArray=function(){for(var t=this,e=[],r=0,n=this.array_.length;r<n;r++)e.push(t.array_[r]);return e};var pl=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};pl.prototype.getCoordinate=function(){return this._minCoord};pl.prototype.getRightmostSide=function(e,r){var n=this.getRightmostSideOfSegment(e,r);return n<0&&(n=this.getRightmostSideOfSegment(e,r-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};pl.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();Cr.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var r=e[this._minIndex-1],n=e[this._minIndex+1],i=Ft.computeOrientation(this._minCoord,n,r),a=!1;(r.y<this._minCoord.y&&n.y<this._minCoord.y&&i===Ft.COUNTERCLOCKWISE||r.y>this._minCoord.y&&n.y>this._minCoord.y&&i===Ft.CLOCKWISE)&&(a=!0),a&&(this._minIndex=this._minIndex-1)};pl.prototype.getRightmostSideOfSegment=function(e,r){var n=e.getEdge(),i=n.getCoordinates();if(r<0||r+1>=i.length||i[r].y===i[r+1].y)return-1;var a=Et.LEFT;return i[r].y<i[r+1].y&&(a=Et.RIGHT),a};pl.prototype.getEdge=function(){return this._orientedDe};pl.prototype.checkForRightmostCoordinate=function(e){for(var r=this,n=e.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(r._minCoord===null||n[i].x>r._minCoord.x)&&(r._minDe=e,r._minIndex=i,r._minCoord=n[i])};pl.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),r=e.getEdges();this._minDe=r.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};pl.prototype.findEdge=function(e){for(var r=this,n=e.iterator();n.hasNext();){var i=n.next();i.isForward()&&r.checkForRightmostCoordinate(i)}Cr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var a=this.getRightmostSide(this._minDe,this._minIndex);a===Et.LEFT&&(this._orientedDe=this._minDe.getSym())};pl.prototype.interfaces_=function(){return[]};pl.prototype.getClass=function(){return pl};var Gu=function(t){function e(r,n){t.call(this,e.msgWithCoord(r,n)),this.pt=n?new Le(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,i){return i?n:n+" [ "+i+" ]"},e}(Bu),M1=function(){this.array_=[]};M1.prototype.addLast=function(e){this.array_.push(e)};M1.prototype.removeFirst=function(){return this.array_.shift()};M1.prototype.isEmpty=function(){return this.array_.length===0};var ls=function(){this._finder=null,this._dirEdgeList=new At,this._nodes=new At,this._rightMostCoord=null,this._env=null,this._finder=new pl};ls.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var r=e.next();r.setVisited(!1)}};ls.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};ls.prototype.computeNodeDepth=function(e){for(var r=this,n=null,i=e.getEdges().iterator();i.hasNext();){var a=i.next();if(a.isVisited()||a.getSym().isVisited()){n=a;break}}if(n===null)throw new Gu("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var h=e.getEdges().iterator();h.hasNext();){var s=h.next();s.setVisited(!0),r.copySymDepths(s)}};ls.prototype.computeDepth=function(e){this.clearVisitedEdges();var r=this._finder.getEdge();r.setEdgeDepths(Et.RIGHT,e),this.copySymDepths(r),this.computeDepths(r)};ls.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};ls.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var r=e.next();r.getDepth(Et.RIGHT)>=1&&r.getDepth(Et.LEFT)<=0&&!r.isInteriorAreaEdge()&&r.setInResult(!0)}};ls.prototype.computeDepths=function(e){var r=this,n=new dT,i=new M1,a=e.getNode();for(i.addLast(a),n.add(a),e.setVisited(!0);!i.isEmpty();){var h=i.removeFirst();n.add(h),r.computeNodeDepth(h);for(var s=h.getEdges().iterator();s.hasNext();){var g=s.next(),m=g.getSym();if(!m.isVisited()){var w=m.getNode();n.contains(w)||(i.addLast(w),n.add(w))}}}};ls.prototype.compareTo=function(e){var r=e;return this._rightMostCoord.x<r._rightMostCoord.x?-1:this._rightMostCoord.x>r._rightMostCoord.x?1:0};ls.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Yt,r=this._dirEdgeList.iterator();r.hasNext();)for(var n=r.next(),i=n.getEdge().getCoordinates(),a=0;a<i.length-1;a++)e.expandToInclude(i[a]);this._env=e}return this._env};ls.prototype.addReachable=function(e){var r=this,n=new El;for(n.add(e);!n.empty();){var i=n.pop();r.add(i,n)}};ls.prototype.copySymDepths=function(e){var r=e.getSym();r.setDepth(Et.LEFT,e.getDepth(Et.RIGHT)),r.setDepth(Et.RIGHT,e.getDepth(Et.LEFT))};ls.prototype.add=function(e,r){var n=this;e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var a=i.next();n._dirEdgeList.add(a);var h=a.getSym(),s=h.getNode();s.isVisited()||r.push(s)}};ls.prototype.getNodes=function(){return this._nodes};ls.prototype.getDirectedEdges=function(){return this._dirEdgeList};ls.prototype.interfaces_=function(){return[Ea]};ls.prototype.getClass=function(){return ls};var ii=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Et.ON]=n}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var a=0;a<this.location.length;a++)e.location[a]=i.location[a]}}else if(arguments.length===3){var h=arguments[0],s=arguments[1],g=arguments[2];this.init(3),this.location[Et.ON]=h,this.location[Et.LEFT]=s,this.location[Et.RIGHT]=g}};ii.prototype.setAllLocations=function(e){for(var r=this,n=0;n<this.location.length;n++)r.location[n]=e};ii.prototype.isNull=function(){for(var e=this,r=0;r<this.location.length;r++)if(e.location[r]!==Ge.NONE)return!1;return!0};ii.prototype.setAllLocationsIfNull=function(e){for(var r=this,n=0;n<this.location.length;n++)r.location[n]===Ge.NONE&&(r.location[n]=e)};ii.prototype.isLine=function(){return this.location.length===1};ii.prototype.merge=function(e){var r=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[Et.ON]=this.location[Et.ON],n[Et.LEFT]=Ge.NONE,n[Et.RIGHT]=Ge.NONE,this.location=n}for(var i=0;i<this.location.length;i++)r.location[i]===Ge.NONE&&i<e.location.length&&(r.location[i]=e.location[i])};ii.prototype.getLocations=function(){return this.location};ii.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[Et.LEFT];this.location[Et.LEFT]=this.location[Et.RIGHT],this.location[Et.RIGHT]=e};ii.prototype.toString=function(){var e=new wl;return this.location.length>1&&e.append(Ge.toLocationSymbol(this.location[Et.LEFT])),e.append(Ge.toLocationSymbol(this.location[Et.ON])),this.location.length>1&&e.append(Ge.toLocationSymbol(this.location[Et.RIGHT])),e.toString()};ii.prototype.setLocations=function(e,r,n){this.location[Et.ON]=e,this.location[Et.LEFT]=r,this.location[Et.RIGHT]=n};ii.prototype.get=function(e){return e<this.location.length?this.location[e]:Ge.NONE};ii.prototype.isArea=function(){return this.location.length>1};ii.prototype.isAnyNull=function(){for(var e=this,r=0;r<this.location.length;r++)if(e.location[r]===Ge.NONE)return!0;return!1};ii.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(Et.ON,e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.location[r]=n}};ii.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Ge.NONE)};ii.prototype.isEqualOnSide=function(e,r){return this.location[r]===e.location[r]};ii.prototype.allPositionsEqual=function(e){for(var r=this,n=0;n<this.location.length;n++)if(r.location[n]!==e)return!1;return!0};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};var zn=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new ii(e),this.elt[1]=new ii(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.elt[0]=new ii(r.elt[0]),this.elt[1]=new ii(r.elt[1])}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.elt[0]=new ii(Ge.NONE),this.elt[1]=new ii(Ge.NONE),this.elt[n].setLocation(i)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],s=arguments[2];this.elt[0]=new ii(a,h,s),this.elt[1]=new ii(a,h,s)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],w=arguments[2],b=arguments[3];this.elt[0]=new ii(Ge.NONE,Ge.NONE,Ge.NONE),this.elt[1]=new ii(Ge.NONE,Ge.NONE,Ge.NONE),this.elt[g].setLocations(m,w,b)}};zn.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};zn.prototype.setAllLocations=function(e,r){this.elt[e].setAllLocations(r)};zn.prototype.isNull=function(e){return this.elt[e].isNull()};zn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.elt[r].setAllLocationsIfNull(n)}};zn.prototype.isLine=function(e){return this.elt[e].isLine()};zn.prototype.merge=function(e){for(var r=this,n=0;n<2;n++)r.elt[n]===null&&e.elt[n]!==null?r.elt[n]=new ii(e.elt[n]):r.elt[n].merge(e.elt[n])};zn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};zn.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(Et.ON)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.elt[r].get(n)}};zn.prototype.toString=function(){var e=new wl;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};zn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};zn.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};zn.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];this.elt[e].setLocation(Et.ON,r)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this.elt[n].setLocation(i,a)}};zn.prototype.isEqualOnSide=function(e,r){return this.elt[0].isEqualOnSide(e.elt[0],r)&&this.elt[1].isEqualOnSide(e.elt[1],r)};zn.prototype.allPositionsEqual=function(e,r){return this.elt[e].allPositionsEqual(r)};zn.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new ii(this.elt[e].location[0]))};zn.prototype.interfaces_=function(){return[]};zn.prototype.getClass=function(){return zn};zn.toLineLabel=function(e){for(var r=new zn(Ge.NONE),n=0;n<2;n++)r.setLocation(n,e.getLocation(n));return r};var qi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new At,this._pts=new At,this._label=new zn(Ge.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new At,this._geometryFactory=null;var e=arguments[0],r=arguments[1];this._geometryFactory=r,this.computePoints(e),this.computeRing()};qi.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var r=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)r[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(r),this._isHole=Ft.isCCW(this._ring.getCoordinates())};qi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};qi.prototype.computePoints=function(e){var r=this;this._startDe=e;var n=e,i=!0;do{if(n===null)throw new Gu("Found null DirectedEdge");if(n.getEdgeRing()===r)throw new Gu("Directed Edge visited twice during ring-building at "+n.getCoordinate());r._edges.add(n);var a=n.getLabel();Cr.isTrue(a.isArea()),r.mergeLabel(a),r.addPoints(n.getEdge(),n.isForward(),i),i=!1,r.setEdgeRing(n,r),n=r.getNext(n)}while(n!==this._startDe)};qi.prototype.getLinearRing=function(){return this._ring};qi.prototype.getCoordinate=function(e){return this._pts.get(e)};qi.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var r=this._startDe;do{var n=r.getNode(),i=n.getEdges().getOutgoingDegree(e);i>e._maxNodeDegree&&(e._maxNodeDegree=i),r=e.getNext(r)}while(r!==this._startDe);this._maxNodeDegree*=2};qi.prototype.addPoints=function(e,r,n){var i=this,a=e.getCoordinates();if(r){var h=1;n&&(h=0);for(var s=h;s<a.length;s++)i._pts.add(a[s])}else{var g=a.length-2;n&&(g=a.length-1);for(var m=g;m>=0;m--)i._pts.add(a[m])}};qi.prototype.isHole=function(){return this._isHole};qi.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};qi.prototype.containsPoint=function(e){var r=this.getLinearRing(),n=r.getEnvelopeInternal();if(!n.contains(e)||!Ft.isPointInRing(e,r.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var a=i.next();if(a.containsPoint(e))return!1}return!0};qi.prototype.addHole=function(e){this._holes.add(e)};qi.prototype.isShell=function(){return this._shell===null};qi.prototype.getLabel=function(){return this._label};qi.prototype.getEdges=function(){return this._edges};qi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};qi.prototype.getShell=function(){return this._shell};qi.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=r.getLocation(n,Et.RIGHT);if(i===Ge.NONE)return null;if(this._label.getLocation(n)===Ge.NONE)return this._label.setLocation(n,i),null}};qi.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};qi.prototype.toPolygon=function(e){for(var r=this,n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=r._holes.get(i).getLinearRing();var a=e.createPolygon(this.getLinearRing(),n);return a};qi.prototype.interfaces_=function(){return[]};qi.prototype.getClass=function(){return qi};var n7=function(t){function e(){var r=arguments[0],n=arguments[1];t.call(this,r,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,i){n.setMinEdgeRing(i)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qi),i7=function(t){function e(){var r=arguments[0],n=arguments[1];t.call(this,r,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,i=new At,a=this._startDe;do{if(a.getMinEdgeRing()===null){var h=new n7(a,n._geometryFactory);i.add(h)}a=a.getNext()}while(a!==this._startDe);return i},e.prototype.setEdgeRing=function(n,i){n.setEdgeRing(i)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,i=this._startDe;do{var a=i.getNode();a.getEdges().linkMinimalDirectedEdges(n),i=i.getNext()}while(i!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qi),Hs=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._label=e}}};Hs.prototype.setVisited=function(e){this._isVisited=e};Hs.prototype.setInResult=function(e){this._isInResult=e};Hs.prototype.isCovered=function(){return this._isCovered};Hs.prototype.isCoveredSet=function(){return this._isCoveredSet};Hs.prototype.setLabel=function(e){this._label=e};Hs.prototype.getLabel=function(){return this._label};Hs.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Hs.prototype.updateIM=function(e){Cr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Hs.prototype.isInResult=function(){return this._isInResult};Hs.prototype.isVisited=function(){return this._isVisited};Hs.prototype.interfaces_=function(){return[]};Hs.prototype.getClass=function(){return Hs};var L1=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new zn(0,Ge.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,i){var a=Ge.NONE;if(a=this._label.getLocation(i),!n.isNull(i)){var h=n.getLocation(i);a!==Ge.BOUNDARY&&(a=h)}return a},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this._label===null?this._label=new zn(n,i):this._label.setLocation(n,i)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof zn)for(var a=arguments[0],h=0;h<2;h++){var s=n.computeMergedLocation(a,h),g=n._label.getLocation(h);g===Ge.NONE&&n._label.setLocation(h,s)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var i=Ge.NONE;this._label!==null&&(i=this._label.getLocation(n));var a=null;switch(i){case Ge.BOUNDARY:a=Ge.INTERIOR;break;case Ge.INTERIOR:a=Ge.BOUNDARY;break;default:a=Ge.BOUNDARY;break}this._label.setLocation(n,a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hs),dl=function(){this.nodeMap=new qo,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};dl.prototype.find=function(e){return this.nodeMap.get(e)};dl.prototype.addNode=function(){if(arguments[0]instanceof Le){var e=arguments[0],r=this.nodeMap.get(e);return r===null&&(r=this.nodeFact.createNode(e),this.nodeMap.put(e,r)),r}else if(arguments[0]instanceof L1){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return i===null?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}};dl.prototype.print=function(e){for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(e)}};dl.prototype.iterator=function(){return this.nodeMap.values().iterator()};dl.prototype.values=function(){return this.nodeMap.values()};dl.prototype.getBoundaryNodes=function(e){for(var r=new At,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===Ge.BOUNDARY&&r.add(i)}return r};dl.prototype.add=function(e){var r=e.getCoordinate(),n=this.addNode(r);n.add(e)};dl.prototype.interfaces_=function(){return[]};dl.prototype.getClass=function(){return dl};var Gn=function(){},c_={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Gn.prototype.interfaces_=function(){return[]};Gn.prototype.getClass=function(){return Gn};Gn.isNorthern=function(e){return e===Gn.NE||e===Gn.NW};Gn.isOpposite=function(e,r){if(e===r)return!1;var n=(e-r+4)%4;return n===2};Gn.commonHalfPlane=function(e,r){if(e===r)return e;var n=(e-r+4)%4;if(n===2)return-1;var i=e<r?e:r,a=e>r?e:r;return i===0&&a===3?3:i};Gn.isInHalfPlane=function(e,r){return r===Gn.SE?e===Gn.SE||e===Gn.SW:e===r||e===r+1};Gn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];if(e===0&&r===0)throw new vi("Cannot compute the quadrant for point ( "+e+", "+r+" )");return e>=0?r>=0?Gn.NE:Gn.SE:r>=0?Gn.NW:Gn.SW}else if(arguments[0]instanceof Le&&arguments[1]instanceof Le){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new vi("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Gn.NE:Gn.SE:i.y>=n.y?Gn.NW:Gn.SW}};c_.NE.get=function(){return 0};c_.NW.get=function(){return 1};c_.SW.get=function(){return 2};c_.SE.get=function(){return 3};Object.defineProperties(Gn,c_);var $o=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2],a=null;this._edge=r,this.init(n,i),this._label=a}else if(arguments.length===4){var h=arguments[0],s=arguments[1],g=arguments[2],m=arguments[3];this._edge=h,this.init(s,g),this._label=m}};$o.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:Ft.computeOrientation(e._p0,e._p1,this._p1)};$o.prototype.getDy=function(){return this._dy};$o.prototype.getCoordinate=function(){return this._p0};$o.prototype.setNode=function(e){this._node=e};$o.prototype.print=function(e){var r=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),a=n.substring(i+1);e.print("  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label)};$o.prototype.compareTo=function(e){var r=e;return this.compareDirection(r)};$o.prototype.getDirectedCoordinate=function(){return this._p1};$o.prototype.getDx=function(){return this._dx};$o.prototype.getLabel=function(){return this._label};$o.prototype.getEdge=function(){return this._edge};$o.prototype.getQuadrant=function(){return this._quadrant};$o.prototype.getNode=function(){return this._node};$o.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};$o.prototype.computeLabel=function(e){};$o.prototype.init=function(e,r){this._p0=e,this._p1=r,this._dx=r.x-e.x,this._dy=r.y-e.y,this._quadrant=Gn.quadrant(this._dx,this._dy),Cr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};$o.prototype.interfaces_=function(){return[Ea]};$o.prototype.getClass=function(){return $o};var ZE=function(t){function e(){var r=arguments[0],n=arguments[1];if(t.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var i=r.getNumPoints()-1;this.init(r.getCoordinate(i),r.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new zn(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,i){if(this._depth[n]!==-999&&this._depth[n]!==i)throw new Gu("assigned depths do not match",this.getCoordinate());this._depth[n]=i},e.prototype.isInteriorAreaEdge=function(){for(var n=this,i=!0,a=0;a<2;a++)n._label.isArea(a)&&n._label.getLocation(a,Et.LEFT)===Ge.INTERIOR&&n._label.getLocation(a,Et.RIGHT)===Ge.INTERIOR||(i=!1);return i},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[Et.LEFT]+"/"+this._depth[Et.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ge.EXTERIOR),a=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ge.EXTERIOR);return n&&i&&a},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,i){var a=this.getEdge().getDepthDelta();this._isForward||(a=-a);var h=1;n===Et.LEFT&&(h=-1);var s=Et.opposite(n),g=a*h,m=i+g;this.setDepth(n,i),this.setDepth(s,m)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,i){return n===Ge.EXTERIOR&&i===Ge.INTERIOR?1:n===Ge.INTERIOR&&i===Ge.EXTERIOR?-1:0},e}($o),Kd=function(){};Kd.prototype.createNode=function(e){return new L1(e,null)};Kd.prototype.interfaces_=function(){return[]};Kd.prototype.getClass=function(){return Kd};var Si=function(){if(this._edges=new At,this._nodes=null,this._edgeEndList=new At,arguments.length===0)this._nodes=new dl(new Kd);else if(arguments.length===1){var e=arguments[0];this._nodes=new dl(e)}};Si.prototype.printEdges=function(e){var r=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var i=r._edges.get(n);i.print(e),i.eiList.print(e)}};Si.prototype.find=function(e){return this._nodes.find(e)};Si.prototype.addNode=function(){if(arguments[0]instanceof L1){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof Le){var r=arguments[0];return this._nodes.addNode(r)}};Si.prototype.getNodeIterator=function(){return this._nodes.iterator()};Si.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var r=e.next();r.getEdges().linkResultDirectedEdges()}};Si.prototype.debugPrintln=function(e){Oo.out.println(e)};Si.prototype.isBoundaryNode=function(e,r){var n=this._nodes.find(r);if(n===null)return!1;var i=n.getLabel();return i!==null&&i.getLocation(e)===Ge.BOUNDARY};Si.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var r=e.next();r.getEdges().linkAllDirectedEdges()}};Si.prototype.matchInSameDirection=function(e,r,n,i){return e.equals(n)?Ft.computeOrientation(e,r,i)===Ft.COLLINEAR&&Gn.quadrant(e,r)===Gn.quadrant(n,i):!1};Si.prototype.getEdgeEnds=function(){return this._edgeEndList};Si.prototype.debugPrint=function(e){Oo.out.print(e)};Si.prototype.getEdgeIterator=function(){return this._edges.iterator()};Si.prototype.findEdgeInSameDirection=function(e,r){for(var n=this,i=0;i<this._edges.size();i++){var a=n._edges.get(i),h=a.getCoordinates();if(n.matchInSameDirection(e,r,h[0],h[1])||n.matchInSameDirection(e,r,h[h.length-1],h[h.length-2]))return a}return null};Si.prototype.insertEdge=function(e){this._edges.add(e)};Si.prototype.findEdgeEnd=function(e){for(var r=this.getEdgeEnds().iterator();r.hasNext();){var n=r.next();if(n.getEdge()===e)return n}return null};Si.prototype.addEdges=function(e){for(var r=this,n=e.iterator();n.hasNext();){var i=n.next();r._edges.add(i);var a=new ZE(i,!0),h=new ZE(i,!1);a.setSym(h),h.setSym(a),r.add(a),r.add(h)}};Si.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};Si.prototype.getNodes=function(){return this._nodes.values()};Si.prototype.findEdge=function(e,r){for(var n=this,i=0;i<this._edges.size();i++){var a=n._edges.get(i),h=a.getCoordinates();if(e.equals(h[0])&&r.equals(h[1]))return a}return null};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};Si.linkResultDirectedEdges=function(e){for(var r=e.iterator();r.hasNext();){var n=r.next();n.getEdges().linkResultDirectedEdges()}};var Ns=function(){this._geometryFactory=null,this._shellList=new At;var e=arguments[0];this._geometryFactory=e};Ns.prototype.sortShellsAndHoles=function(e,r,n){for(var i=e.iterator();i.hasNext();){var a=i.next();a.isHole()?n.add(a):r.add(a)}};Ns.prototype.computePolygons=function(e){for(var r=this,n=new At,i=e.iterator();i.hasNext();){var a=i.next(),h=a.toPolygon(r._geometryFactory);n.add(h)}return n};Ns.prototype.placeFreeHoles=function(e,r){for(var n=this,i=r.iterator();i.hasNext();){var a=i.next();if(a.getShell()===null){var h=n.findEdgeRingContaining(a,e);if(h===null)throw new Gu("unable to assign hole to a shell",a.getCoordinate(0));a.setShell(h)}}};Ns.prototype.buildMinimalEdgeRings=function(e,r,n){for(var i=this,a=new At,h=e.iterator();h.hasNext();){var s=h.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var g=s.buildMinimalRings(),m=i.findShell(g);m!==null?(i.placePolygonHoles(m,g),r.add(m)):n.addAll(g)}else a.add(s)}return a};Ns.prototype.containsPoint=function(e){for(var r=this._shellList.iterator();r.hasNext();){var n=r.next();if(n.containsPoint(e))return!0}return!1};Ns.prototype.buildMaximalEdgeRings=function(e){for(var r=this,n=new At,i=e.iterator();i.hasNext();){var a=i.next();if(a.isInResult()&&a.getLabel().isArea()&&a.getEdgeRing()===null){var h=new i7(a,r._geometryFactory);n.add(h),h.setInResult()}}return n};Ns.prototype.placePolygonHoles=function(e,r){for(var n=r.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}};Ns.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};Ns.prototype.findEdgeRingContaining=function(e,r){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),a=n.getCoordinateN(0),h=null,s=null,g=r.iterator();g.hasNext();){var m=g.next(),w=m.getLinearRing(),b=w.getEnvelopeInternal();h!==null&&(s=h.getLinearRing().getEnvelopeInternal());var I=!1;b.contains(i)&&Ft.isPointInRing(a,w.getCoordinates())&&(I=!0),I&&(h===null||s.contains(b))&&(h=m)}return h};Ns.prototype.findShell=function(e){for(var r=0,n=null,i=e.iterator();i.hasNext();){var a=i.next();a.isHole()||(n=a,r++)}return Cr.isTrue(r<=1,"found two shells in MinimalEdgeRing list"),n};Ns.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var r=arguments[0],n=arguments[1];Si.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(r),a=new At,h=this.buildMinimalEdgeRings(i,this._shellList,a);this.sortShellsAndHoles(h,this._shellList,a),this.placeFreeHoles(this._shellList,a)}};Ns.prototype.interfaces_=function(){return[]};Ns.prototype.getClass=function(){return Ns};var Yd=function(){};Yd.prototype.getBounds=function(){};Yd.prototype.interfaces_=function(){return[]};Yd.prototype.getClass=function(){return Yd};var ka=function(){this._bounds=null,this._item=null;var e=arguments[0],r=arguments[1];this._bounds=e,this._item=r};ka.prototype.getItem=function(){return this._item};ka.prototype.getBounds=function(){return this._bounds};ka.prototype.interfaces_=function(){return[Yd,ba]};ka.prototype.getClass=function(){return ka};var Vu=function(){this._size=null,this._items=null,this._size=0,this._items=new At,this._items.add(null)};Vu.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Vu.prototype.size=function(){return this._size};Vu.prototype.reorder=function(e){for(var r=this,n=null,i=this._items.get(e);e*2<=this._size&&(n=e*2,n!==r._size&&r._items.get(n+1).compareTo(r._items.get(n))<0&&n++,r._items.get(n).compareTo(i)<0);e=n)r._items.set(e,r._items.get(n));this._items.set(e,i)};Vu.prototype.clear=function(){this._size=0,this._items.clear()};Vu.prototype.isEmpty=function(){return this._size===0};Vu.prototype.add=function(e){var r=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)r._items.set(n,r._items.get(Math.trunc(n/2)));this._items.set(n,e)};Vu.prototype.interfaces_=function(){return[]};Vu.prototype.getClass=function(){return Vu};var Sc=function(){};Sc.prototype.visitItem=function(e){};Sc.prototype.interfaces_=function(){return[]};Sc.prototype.getClass=function(){return Sc};var Yf=function(){};Yf.prototype.insert=function(e,r){};Yf.prototype.remove=function(e,r){};Yf.prototype.query=function(){};Yf.prototype.interfaces_=function(){return[]};Yf.prototype.getClass=function(){return Yf};var oo=function(){if(this._childBoundables=new At,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._level=e}}},IO={serialVersionUID:{configurable:!0}};oo.prototype.getLevel=function(){return this._level};oo.prototype.size=function(){return this._childBoundables.size()};oo.prototype.getChildBoundables=function(){return this._childBoundables};oo.prototype.addChildBoundable=function(e){Cr.isTrue(this._bounds===null),this._childBoundables.add(e)};oo.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};oo.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};oo.prototype.interfaces_=function(){return[Yd,ba]};oo.prototype.getClass=function(){return oo};IO.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(oo,IO);var Fa=function(){};Fa.reverseOrder=function(){return{compare:function(r,n){return n.compareTo(r)}}};Fa.min=function(e){return Fa.sort(e),e.get(0)};Fa.sort=function(e,r){var n=e.toArray();r?Eh.sort(n,r):Eh.sort(n);for(var i=e.iterator(),a=0,h=n.length;a<h;a++)i.next(),i.set(n[a])};Fa.singletonList=function(e){var r=new At;return r.add(e),r};var Gi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],r=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=r,this._itemDistance=n,this._distance=this.distance()};Gi.prototype.expandToQueue=function(e,r){var n=Gi.isComposite(this._boundable1),i=Gi.isComposite(this._boundable2);if(n&&i)return Gi.area(this._boundable1)>Gi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,r),null):(this.expand(this._boundable2,this._boundable1,e,r),null);if(n)return this.expand(this._boundable1,this._boundable2,e,r),null;if(i)return this.expand(this._boundable2,this._boundable1,e,r),null;throw new vi("neither boundable is composite")};Gi.prototype.isLeaves=function(){return!(Gi.isComposite(this._boundable1)||Gi.isComposite(this._boundable2))};Gi.prototype.compareTo=function(e){var r=e;return this._distance<r._distance?-1:this._distance>r._distance?1:0};Gi.prototype.expand=function(e,r,n,i){for(var a=this,h=e.getChildBoundables(),s=h.iterator();s.hasNext();){var g=s.next(),m=new Gi(g,r,a._itemDistance);m.getDistance()<i&&n.add(m)}};Gi.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Gi.prototype.getDistance=function(){return this._distance};Gi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Gi.prototype.interfaces_=function(){return[Ea]};Gi.prototype.getClass=function(){return Gi};Gi.area=function(e){return e.getBounds().getArea()};Gi.isComposite=function(e){return e instanceof oo};var po=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new At,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var r=arguments[0];Cr.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},O1={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};po.prototype.getNodeCapacity=function(){return this._nodeCapacity};po.prototype.lastNode=function(e){return e.get(e.size()-1)};po.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var r=arguments[0],n=0,i=r.getChildBoundables().iterator();i.hasNext();){var a=i.next();a instanceof oo?n+=e.size(a):a instanceof ka&&(n+=1)}return n}};po.prototype.removeItem=function(e,r){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var a=i.next();a instanceof ka&&a.getItem()===r&&(n=a)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};po.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var r=this.itemsTree(this._root);return r===null?new At:r}else if(arguments.length===1){for(var n=arguments[0],i=new At,a=n.getChildBoundables().iterator();a.hasNext();){var h=a.next();if(h instanceof oo){var s=e.itemsTree(h);s!==null&&i.add(s)}else h instanceof ka?i.add(h.getItem()):Cr.shouldNeverReachHere()}return i.size()<=0?null:i}};po.prototype.insert=function(e,r){Cr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ka(e,r))};po.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var r=arguments[0],n=new At;return this.boundablesAtLevel(r,this._root,n),n}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];if(Cr.isTrue(i>-2),a.getLevel()===i)return h.add(a),null;for(var s=a.getChildBoundables().iterator();s.hasNext();){var g=s.next();g instanceof oo?e.boundablesAtLevel(i,g,h):(Cr.isTrue(g instanceof ka),i===-1&&h.add(g))}return null}};po.prototype.query=function(){var e=this;if(arguments.length===1){var r=arguments[0];this.build();var n=new At;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,n),n}else if(arguments.length===2){var i=arguments[0],a=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,a)}else if(arguments.length===3){if(cr(arguments[2],Sc)&&arguments[0]instanceof Object&&arguments[1]instanceof oo)for(var h=arguments[0],s=arguments[1],g=arguments[2],m=s.getChildBoundables(),w=0;w<m.size();w++){var b=m.get(w);e.getIntersectsOp().intersects(b.getBounds(),h)&&(b instanceof oo?e.query(h,b,g):b instanceof ka?g.visitItem(b.getItem()):Cr.shouldNeverReachHere())}else if(cr(arguments[2],Da)&&arguments[0]instanceof Object&&arguments[1]instanceof oo)for(var I=arguments[0],A=arguments[1],z=arguments[2],V=A.getChildBoundables(),H=0;H<V.size();H++){var Z=V.get(H);e.getIntersectsOp().intersects(Z.getBounds(),I)&&(Z instanceof oo?e.query(I,Z,z):Z instanceof ka?z.add(Z.getItem()):Cr.shouldNeverReachHere())}}};po.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};po.prototype.getRoot=function(){return this.build(),this._root};po.prototype.remove=function(){var e=this;if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),r)?this.remove(r,this._root,n):!1}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2],s=this.removeItem(a,h);if(s)return!0;for(var g=null,m=a.getChildBoundables().iterator();m.hasNext();){var w=m.next();if(e.getIntersectsOp().intersects(w.getBounds(),i)&&w instanceof oo&&(s=e.remove(i,w,h),s)){g=w;break}}return g!==null&&g.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(g),s}};po.prototype.createHigherLevels=function(e,r){Cr.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,r+1);return n.size()===1?n.get(0):this.createHigherLevels(n,r+1)};po.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var r=arguments[0],n=0,i=r.getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof oo){var h=e.depth(a);h>n&&(n=h)}}return n+1}};po.prototype.createParentBoundables=function(e,r){var n=this;Cr.isTrue(!e.isEmpty());var i=new At;i.add(this.createNode(r));var a=new At(e);Fa.sort(a,this.getComparator());for(var h=a.iterator();h.hasNext();){var s=h.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(r)),n.lastNode(i).addChildBoundable(s)}return i};po.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};po.prototype.interfaces_=function(){return[ba]};po.prototype.getClass=function(){return po};po.compareDoubles=function(e,r){return e>r?1:e<r?-1:0};O1.IntersectsOp.get=function(){return o7};O1.serialVersionUID.get=function(){return-3886435814360241e3};O1.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(po,O1);var o7=function(){},Jd=function(){};Jd.prototype.distance=function(e,r){};Jd.prototype.interfaces_=function(){return[]};Jd.prototype.getClass=function(){return Jd};var PO=function(t){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,t.call(this,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(i,a){var h=this;Cr.isTrue(i.length>0);for(var s=new At,g=0;g<i.length;g++)s.addAll(h.createParentBoundablesFromVerticalSlice(i[g],a));return s},e.prototype.createNode=function(i){return new HC(i)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];if(i.isNull())return null;t.prototype.insert.call(this,i,a)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(i,a){for(var h=Math.trunc(Math.ceil(i.size()/a)),s=new Array(a).fill(null),g=i.iterator(),m=0;m<a;m++){s[m]=new At;for(var w=0;g.hasNext()&&w<h;){var b=g.next();s[m].add(b),w++}}return s},e.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return t.prototype.query.call(this,i)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];t.prototype.query.call(this,a,h)}else if(arguments.length===3){if(cr(arguments[2],Sc)&&arguments[0]instanceof Object&&arguments[1]instanceof oo){var s=arguments[0],g=arguments[1],m=arguments[2];t.prototype.query.call(this,s,g,m)}else if(cr(arguments[2],Da)&&arguments[0]instanceof Object&&arguments[1]instanceof oo){var w=arguments[0],b=arguments[1],I=arguments[2];t.prototype.query.call(this,w,b,I)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(i,a){return t.prototype.createParentBoundables.call(this,i,a)},e.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return t.prototype.remove.call(this,i,a)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(i,a){Cr.isTrue(!i.isEmpty());var h=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),s=new At(i);Fa.sort(s,e.xComparator);var g=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(h))));return this.createParentBoundablesFromVerticalSlices(g,a)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(cr(arguments[0],Jd)){var i=arguments[0],a=new Gi(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(a)}else if(arguments[0]instanceof Gi){var h=arguments[0];return this.nearestNeighbour(h,_r.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&cr(arguments[1],Jd)){var s=arguments[0],g=arguments[1],m=new Gi(this.getRoot(),s.getRoot(),g);return this.nearestNeighbour(m)}else if(arguments[0]instanceof Gi&&typeof arguments[1]=="number"){var w=arguments[0],b=arguments[1],I=b,A=null,z=new Vu;for(z.add(w);!z.isEmpty()&&I>0;){var V=z.poll(),H=V.getDistance();if(H>=I)break;V.isLeaves()?(I=H,A=V):V.expandToQueue(z,I)}return[A.getBoundable(0).getItem(),A.getBoundable(1).getItem()]}}else if(arguments.length===3){var Z=arguments[0],D=arguments[1],k=arguments[2],j=new ka(Z,D),Y=new Gi(this.getRoot(),j,k);return this.nearestNeighbour(Y)[0]}},e.prototype.interfaces_=function(){return[Yf,ba]},e.prototype.getClass=function(){return e},e.centreX=function(i){return e.avg(i.getMinX(),i.getMaxX())},e.avg=function(i,a){return(i+a)/2},e.centreY=function(i){return e.avg(i.getMinY(),i.getMaxY())},r.STRtreeNode.get=function(){return HC},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[Vd]},compare:function(n,i){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(i.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[Vd]},compare:function(n,i){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(i.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(n,i){return n.intersects(i)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,r),e}(po),HC=function(t){function e(){var r=arguments[0];t.call(this,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,i=this.getChildBoundables().iterator();i.hasNext();){var a=i.next();n===null?n=new Yt(a.getBounds()):n.expandToInclude(a.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(oo),ps=function(){};ps.prototype.interfaces_=function(){return[]};ps.prototype.getClass=function(){return ps};ps.relativeSign=function(e,r){return e<r?-1:e>r?1:0};ps.compare=function(e,r,n){if(r.equals2D(n))return 0;var i=ps.relativeSign(r.x,n.x),a=ps.relativeSign(r.y,n.y);switch(e){case 0:return ps.compareValue(i,a);case 1:return ps.compareValue(a,i);case 2:return ps.compareValue(a,-i);case 3:return ps.compareValue(-i,a);case 4:return ps.compareValue(-i,-a);case 5:return ps.compareValue(-a,-i);case 6:return ps.compareValue(-a,i);case 7:return ps.compareValue(i,-a)}return Cr.shouldNeverReachHere("invalid octant value"),0};ps.compareValue=function(e,r){return e<0?-1:e>0?1:r<0?-1:r>0?1:0};var Ic=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new Le(r),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!r.equals2D(e.getCoordinate(n))};Ic.prototype.getCoordinate=function(){return this.coord};Ic.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};Ic.prototype.compareTo=function(e){var r=e;return this.segmentIndex<r.segmentIndex?-1:this.segmentIndex>r.segmentIndex?1:this.coord.equals2D(r.coord)?0:ps.compare(this._segmentOctant,this.coord,r.coord)};Ic.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};Ic.prototype.isInterior=function(){return this._isInterior};Ic.prototype.interfaces_=function(){return[Ea]};Ic.prototype.getClass=function(){return Ic};var us=function(){this._nodeMap=new qo,this._edge=null;var e=arguments[0];this._edge=e};us.prototype.getSplitCoordinates=function(){var e=this,r=new l_;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next();e.addEdgeCoordinates(i,a,r),i=a}return r.toCoordinateArray()};us.prototype.addCollapsedNodes=function(){var e=this,r=new At;this.findCollapsesFromInsertedNodes(r),this.findCollapsesFromExistingVertices(r);for(var n=r.iterator();n.hasNext();){var i=n.next().intValue();e.add(e._edge.getCoordinate(i),i)}};us.prototype.print=function(e){e.println("Intersections:");for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(e)}};us.prototype.findCollapsesFromExistingVertices=function(e){for(var r=this,n=0;n<this._edge.size()-2;n++){var i=r._edge.getCoordinate(n),a=r._edge.getCoordinate(n+2);i.equals2D(a)&&e.add(new ul(n+1))}};us.prototype.addEdgeCoordinates=function(e,r,n){var i=this,a=this._edge.getCoordinate(r.segmentIndex),h=r.isInterior()||!r.coord.equals2D(a);n.add(new Le(e.coord),!1);for(var s=e.segmentIndex+1;s<=r.segmentIndex;s++)n.add(i._edge.getCoordinate(s));h&&n.add(new Le(r.coord))};us.prototype.iterator=function(){return this._nodeMap.values().iterator()};us.prototype.addSplitEdges=function(e){var r=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next(),h=r.createSplitEdge(i,a);e.add(h),i=a}};us.prototype.findCollapseIndex=function(e,r,n){if(!e.coord.equals2D(r.coord))return!1;var i=r.segmentIndex-e.segmentIndex;return r.isInterior()||i--,i===1?(n[0]=e.segmentIndex+1,!0):!1};us.prototype.findCollapsesFromInsertedNodes=function(e){for(var r=this,n=new Array(1).fill(null),i=this.iterator(),a=i.next();i.hasNext();){var h=i.next(),s=r.findCollapseIndex(a,h,n);s&&e.add(new ul(n[0])),a=h}};us.prototype.getEdge=function(){return this._edge};us.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};us.prototype.createSplitEdge=function(e,r){var n=this,i=r.segmentIndex-e.segmentIndex+2,a=this._edge.getCoordinate(r.segmentIndex),h=r.isInterior()||!r.coord.equals2D(a);h||i--;var s=new Array(i).fill(null),g=0;s[g++]=new Le(e.coord);for(var m=e.segmentIndex+1;m<=r.segmentIndex;m++)s[g++]=n._edge.getCoordinate(m);return h&&(s[g]=new Le(r.coord)),new zi(s,this._edge.getData())};us.prototype.add=function(e,r){var n=new Ic(this._edge,e,r,this._edge.getSegmentOctant(r)),i=this._nodeMap.get(n);return i!==null?(Cr.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)};us.prototype.checkSplitEdgesCorrectness=function(e){var r=this._edge.getCoordinates(),n=e.get(0),i=n.getCoordinate(0);if(!i.equals2D(r[0]))throw new Bu("bad split edge start point at "+i);var a=e.get(e.size()-1),h=a.getCoordinates(),s=h[h.length-1];if(!s.equals2D(r[r.length-1]))throw new Bu("bad split edge end point at "+s)};us.prototype.interfaces_=function(){return[]};us.prototype.getClass=function(){return us};var Jf=function(){};Jf.prototype.interfaces_=function(){return[]};Jf.prototype.getClass=function(){return Jf};Jf.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];if(e===0&&r===0)throw new vi("Cannot compute the octant for point ( "+e+", "+r+" )");var n=Math.abs(e),i=Math.abs(r);return e>=0?r>=0?n>=i?0:1:n>=i?7:6:r>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof Le&&arguments[1]instanceof Le){var a=arguments[0],h=arguments[1],s=h.x-a.x,g=h.y-a.y;if(s===0&&g===0)throw new vi("Cannot compute the octant for two identical points "+a);return Jf.octant(s,g)}};var su=function(){};su.prototype.getCoordinates=function(){};su.prototype.size=function(){};su.prototype.getCoordinate=function(e){};su.prototype.isClosed=function(){};su.prototype.setData=function(e){};su.prototype.getData=function(){};su.prototype.interfaces_=function(){return[]};su.prototype.getClass=function(){return su};var Zy=function(){};Zy.prototype.addIntersection=function(e,r){};Zy.prototype.interfaces_=function(){return[su]};Zy.prototype.getClass=function(){return Zy};var zi=function(){this._nodeList=new us(this),this._pts=null,this._data=null;var e=arguments[0],r=arguments[1];this._pts=e,this._data=r};zi.prototype.getCoordinates=function(){return this._pts};zi.prototype.size=function(){return this._pts.length};zi.prototype.getCoordinate=function(e){return this._pts[e]};zi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};zi.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};zi.prototype.setData=function(e){this._data=e};zi.prototype.safeOctant=function(e,r){return e.equals2D(r)?0:Jf.octant(e,r)};zi.prototype.getData=function(){return this._data};zi.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1];this.addIntersectionNode(e,r)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],a=arguments[3],h=new Le(n.getIntersection(a));this.addIntersection(h,i)}};zi.prototype.toString=function(){return Na.toLineString(new Ni(this._pts))};zi.prototype.getNodeList=function(){return this._nodeList};zi.prototype.addIntersectionNode=function(e,r){var n=r,i=n+1;if(i<this._pts.length){var a=this._pts[i];e.equals2D(a)&&(n=i)}var h=this._nodeList.add(e,n);return h};zi.prototype.addIntersections=function(e,r,n){for(var i=this,a=0;a<e.getIntersectionNum();a++)i.addIntersection(e,r,n,a)};zi.prototype.interfaces_=function(){return[Zy]};zi.prototype.getClass=function(){return zi};zi.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],r=new At;return zi.getNodedSubstrings(e,r),r}else if(arguments.length===2)for(var n=arguments[0],i=arguments[1],a=n.iterator();a.hasNext();){var h=a.next();h.getNodeList().addSplitEdges(i)}};var tr=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Le,this.p1=new Le;else if(arguments.length===1){var e=arguments[0];this.p0=new Le(e.p0),this.p1=new Le(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var r=arguments[0],n=arguments[1],i=arguments[2],a=arguments[3];this.p0=new Le(r,n),this.p1=new Le(i,a)}},CO={serialVersionUID:{configurable:!0}};tr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};tr.prototype.orientationIndex=function(){if(arguments[0]instanceof tr){var e=arguments[0],r=Ft.orientationIndex(this.p0,this.p1,e.p0),n=Ft.orientationIndex(this.p0,this.p1,e.p1);return r>=0&&n>=0||r<=0&&n<=0?Math.max(r,n):0}else if(arguments[0]instanceof Le){var i=arguments[0];return Ft.orientationIndex(this.p0,this.p1,i)}};tr.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};tr.prototype.isVertical=function(){return this.p0.x===this.p1.x};tr.prototype.equals=function(e){if(!(e instanceof tr))return!1;var r=e;return this.p0.equals(r.p0)&&this.p1.equals(r.p1)};tr.prototype.intersection=function(e){var r=new zh;return r.computeIntersection(this.p0,this.p1,e.p0,e.p1),r.hasIntersection()?r.getIntersection(0):null};tr.prototype.project=function(){if(arguments[0]instanceof Le){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Le(e);var r=this.projectionFactor(e),n=new Le;return n.x=this.p0.x+r*(this.p1.x-this.p0.x),n.y=this.p0.y+r*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof tr){var i=arguments[0],a=this.projectionFactor(i.p0),h=this.projectionFactor(i.p1);if(a>=1&&h>=1||a<=0&&h<=0)return null;var s=this.project(i.p0);a<0&&(s=this.p0),a>1&&(s=this.p1);var g=this.project(i.p1);return h<0&&(g=this.p0),h>1&&(g=this.p1),new tr(s,g)}};tr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};tr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};tr.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};tr.prototype.distancePerpendicular=function(e){return Ft.distancePointLinePerpendicular(e,this.p0,this.p1)};tr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};tr.prototype.midPoint=function(){return tr.midPoint(this.p0,this.p1)};tr.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var r=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=r*r+n*n;if(i<=0)return _r.NaN;var a=((e.x-this.p0.x)*r+(e.y-this.p0.y)*n)/i;return a};tr.prototype.closestPoints=function(e){var r=this.intersection(e);if(r!==null)return[r,r];var n=new Array(2).fill(null),i=_r.MAX_VALUE,a=null,h=this.closestPoint(e.p0);i=h.distance(e.p0),n[0]=h,n[1]=e.p0;var s=this.closestPoint(e.p1);a=s.distance(e.p1),a<i&&(i=a,n[0]=s,n[1]=e.p1);var g=e.closestPoint(this.p0);a=g.distance(this.p0),a<i&&(i=a,n[0]=this.p0,n[1]=g);var m=e.closestPoint(this.p1);return a=m.distance(this.p1),a<i&&(i=a,n[0]=this.p1,n[1]=m),n};tr.prototype.closestPoint=function(e){var r=this.projectionFactor(e);if(r>0&&r<1)return this.project(e);var n=this.p0.distance(e),i=this.p1.distance(e);return n<i?this.p0:this.p1};tr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};tr.prototype.getLength=function(){return this.p0.distance(this.p1)};tr.prototype.compareTo=function(e){var r=e,n=this.p0.compareTo(r.p0);return n!==0?n:this.p1.compareTo(r.p1)};tr.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};tr.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};tr.prototype.lineIntersection=function(e){try{var r=Oa.intersection(this.p0,this.p1,e.p0,e.p1);return r}catch(n){if(!(n instanceof dg))throw n}finally{}return null};tr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};tr.prototype.pointAlongOffset=function(e,r){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),a=this.p1.x-this.p0.x,h=this.p1.y-this.p0.y,s=Math.sqrt(a*a+h*h),g=0,m=0;if(r!==0){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");g=r*a/s,m=r*h/s}var w=n-m,b=i+g,I=new Le(w,b);return I};tr.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.p0.x=r.x,this.p0.y=r.y,this.p1.x=n.x,this.p1.y=n.y}};tr.prototype.segmentFraction=function(e){var r=this.projectionFactor(e);return r<0?r=0:(r>1||_r.isNaN(r))&&(r=1),r};tr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};tr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};tr.prototype.distance=function(){if(arguments[0]instanceof tr){var e=arguments[0];return Ft.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof Le){var r=arguments[0];return Ft.distancePointLine(r,this.p0,this.p1)}};tr.prototype.pointAlong=function(e){var r=new Le;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r};tr.prototype.hashCode=function(){var e=_r.doubleToLongBits(this.p0.x);e^=_r.doubleToLongBits(this.p0.y)*31;var r=Math.trunc(e)^Math.trunc(e>>32),n=_r.doubleToLongBits(this.p1.x);n^=_r.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(n)^Math.trunc(n>>32);return r^i};tr.prototype.interfaces_=function(){return[Ea,ba]};tr.prototype.getClass=function(){return tr};tr.midPoint=function(e,r){return new Le((e.x+r.x)/2,(e.y+r.y)/2)};CO.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(tr,CO);var Xy=function(){this.tempEnv1=new Yt,this.tempEnv2=new Yt,this._overlapSeg1=new tr,this._overlapSeg2=new tr};Xy.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];e.getLineSegment(r,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};Xy.prototype.interfaces_=function(){return[]};Xy.prototype.getClass=function(){return Xy};var Rs=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=r,this._end=n,this._context=i};Rs.prototype.getLineSegment=function(e,r){r.p0=this._pts[e],r.p1=this._pts[e+1]};Rs.prototype.computeSelect=function(e,r,n,i){var a=this._pts[r],h=this._pts[n];if(i.tempEnv1.init(a,h),n-r===1)return i.select(this,r),null;if(!e.intersects(i.tempEnv1))return null;var s=Math.trunc((r+n)/2);r<s&&this.computeSelect(e,r,s,i),s<n&&this.computeSelect(e,s,n,i)};Rs.prototype.getCoordinates=function(){for(var e=this,r=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)r[n++]=e._pts[i];return r};Rs.prototype.computeOverlaps=function(e,r){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,r)};Rs.prototype.setId=function(e){this._id=e};Rs.prototype.select=function(e,r){this.computeSelect(e,this._start,this._end,r)};Rs.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],r=this._pts[this._end];this._env=new Yt(e,r)}return this._env};Rs.prototype.getEndIndex=function(){return this._end};Rs.prototype.getStartIndex=function(){return this._start};Rs.prototype.getContext=function(){return this._context};Rs.prototype.getId=function(){return this._id};Rs.prototype.computeOverlapsInternal=function(e,r,n,i,a,h){var s=this._pts[e],g=this._pts[r],m=n._pts[i],w=n._pts[a];if(r-e===1&&a-i===1)return h.overlap(this,e,n,i),null;if(h.tempEnv1.init(s,g),h.tempEnv2.init(m,w),!h.tempEnv1.intersects(h.tempEnv2))return null;var b=Math.trunc((e+r)/2),I=Math.trunc((i+a)/2);e<b&&(i<I&&this.computeOverlapsInternal(e,b,n,i,I,h),I<a&&this.computeOverlapsInternal(e,b,n,I,a,h)),b<r&&(i<I&&this.computeOverlapsInternal(b,r,n,i,I,h),I<a&&this.computeOverlapsInternal(b,r,n,I,a,h))};Rs.prototype.interfaces_=function(){return[]};Rs.prototype.getClass=function(){return Rs};var al=function(){};al.prototype.interfaces_=function(){return[]};al.prototype.getClass=function(){return al};al.getChainStartIndices=function(e){var r=0,n=new At;n.add(new ul(r));do{var i=al.findChainEnd(e,r);n.add(new ul(i)),r=i}while(r<e.length-1);var a=al.toIntArray(n);return a};al.findChainEnd=function(e,r){for(var n=r;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=Gn.quadrant(e[n],e[n+1]),a=r+1;a<e.length;){if(!e[a-1].equals2D(e[a])){var h=Gn.quadrant(e[a-1],e[a]);if(h!==i)break}a++}return a-1};al.getChains=function(){if(arguments.length===1){var e=arguments[0];return al.getChains(e,null)}else if(arguments.length===2){for(var r=arguments[0],n=arguments[1],i=new At,a=al.getChainStartIndices(r),h=0;h<a.length-1;h++){var s=new Rs(r,a[h],a[h+1],n);i.add(s)}return i}};al.toIntArray=function(e){for(var r=new Array(e.size()).fill(null),n=0;n<r.length;n++)r[n]=e.get(n).intValue();return r};var Ah=function(){};Ah.prototype.computeNodes=function(e){};Ah.prototype.getNodedSubstrings=function(){};Ah.prototype.interfaces_=function(){return[]};Ah.prototype.getClass=function(){return Ah};var Wy=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}}};Wy.prototype.setSegmentIntersector=function(e){this._segInt=e};Wy.prototype.interfaces_=function(){return[Ah]};Wy.prototype.getClass=function(){return Wy};var xT=function(t){function e(n){n?t.call(this,n):t.call(this),this._monoChains=new At,this._index=new PO,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return zi.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(i){for(var a=this,h=al.getChains(i.getCoordinates(),i),s=h.iterator();s.hasNext();){var g=s.next();g.setId(a._idCounter++),a._index.insert(g.getEnvelope(),g),a._monoChains.add(g)}},e.prototype.computeNodes=function(i){var a=this;this._nodedSegStrings=i;for(var h=i.iterator();h.hasNext();)a.add(h.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var i=this,a=new KC(this._segInt),h=this._monoChains.iterator();h.hasNext();)for(var s=h.next(),g=i._index.query(s.getEnvelope()),m=g.iterator();m.hasNext();){var w=m.next();if(w.getId()>s.getId()&&(s.computeOverlaps(w,a),i._nOverlaps++),i._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.SegmentOverlapAction.get=function(){return KC},Object.defineProperties(e,r),e}(Wy),KC=function(t){function e(){t.call(this),this._si=null;var r=arguments[0];this._si=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3],s=n.getContext(),g=a.getContext();this._si.processIntersections(s,i,g,h)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Xy),An=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],s=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(a),this.setJoinStyle(h),this.setMitreLimit(s)}}},Wu={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};An.prototype.getEndCapStyle=function(){return this._endCapStyle};An.prototype.isSingleSided=function(){return this._isSingleSided};An.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=An.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=An.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==An.JOIN_ROUND&&(this._quadrantSegments=An.DEFAULT_QUADRANT_SEGMENTS)};An.prototype.getJoinStyle=function(){return this._joinStyle};An.prototype.setJoinStyle=function(e){this._joinStyle=e};An.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};An.prototype.getSimplifyFactor=function(){return this._simplifyFactor};An.prototype.getQuadrantSegments=function(){return this._quadrantSegments};An.prototype.setEndCapStyle=function(e){this._endCapStyle=e};An.prototype.getMitreLimit=function(){return this._mitreLimit};An.prototype.setMitreLimit=function(e){this._mitreLimit=e};An.prototype.setSingleSided=function(e){this._isSingleSided=e};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.bufferDistanceError=function(e){var r=Math.PI/2/e;return 1-Math.cos(r/2)};Wu.CAP_ROUND.get=function(){return 1};Wu.CAP_FLAT.get=function(){return 2};Wu.CAP_SQUARE.get=function(){return 3};Wu.JOIN_ROUND.get=function(){return 1};Wu.JOIN_MITRE.get=function(){return 2};Wu.JOIN_BEVEL.get=function(){return 3};Wu.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Wu.DEFAULT_MITRE_LIMIT.get=function(){return 5};Wu.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(An,Wu);var Mi=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ft.COUNTERCLOCKWISE,this._inputLine=e||null},h_={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Mi.prototype.isDeletable=function(e,r,n,i){var a=this._inputLine[e],h=this._inputLine[r],s=this._inputLine[n];return!this.isConcave(a,h,s)||!this.isShallow(a,h,s,i)?!1:this.isShallowSampled(a,h,e,n,i)};Mi.prototype.deleteShallowConcavities=function(){for(var e=this,r=1,n=this.findNextNonDeletedIndex(r),i=this.findNextNonDeletedIndex(n),a=!1;i<this._inputLine.length;){var h=!1;e.isDeletable(r,n,i,e._distanceTol)&&(e._isDeleted[n]=Mi.DELETE,h=!0,a=!0),h?r=i:r=n,n=e.findNextNonDeletedIndex(r),i=e.findNextNonDeletedIndex(n)}return a};Mi.prototype.isShallowConcavity=function(e,r,n,i){var a=Ft.computeOrientation(e,r,n),h=a===this._angleOrientation;if(!h)return!1;var s=Ft.distancePointLine(r,e,n);return s<i};Mi.prototype.isShallowSampled=function(e,r,n,i,a){var h=this,s=Math.trunc((i-n)/Mi.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var g=n;g<i;g+=s)if(!h.isShallow(e,r,h._inputLine[g],a))return!1;return!0};Mi.prototype.isConcave=function(e,r,n){var i=Ft.computeOrientation(e,r,n),a=i===this._angleOrientation;return a};Mi.prototype.simplify=function(e){var r=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=Ft.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=r.deleteShallowConcavities();while(n);return this.collapseLine()};Mi.prototype.findNextNonDeletedIndex=function(e){for(var r=e+1;r<this._inputLine.length&&this._isDeleted[r]===Mi.DELETE;)r++;return r};Mi.prototype.isShallow=function(e,r,n,i){var a=Ft.distancePointLine(r,e,n);return a<i};Mi.prototype.collapseLine=function(){for(var e=this,r=new l_,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==Mi.DELETE&&r.add(e._inputLine[n]);return r.toCoordinateArray()};Mi.prototype.interfaces_=function(){return[]};Mi.prototype.getClass=function(){return Mi};Mi.simplify=function(e,r){var n=new Mi(e);return n.simplify(r)};h_.INIT.get=function(){return 0};h_.DELETE.get=function(){return 1};h_.KEEP.get=function(){return 1};h_.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Mi,h_);var Ks=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new At},AO={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ks.prototype.getCoordinates=function(){var e=this._ptList.toArray(Ks.COORDINATE_ARRAY_TYPE);return e};Ks.prototype.setPrecisionModel=function(e){this._precisionModel=e};Ks.prototype.addPt=function(e){var r=new Le(e);if(this._precisionModel.makePrecise(r),this.isRedundant(r))return null;this._ptList.add(r)};Ks.prototype.revere=function(){};Ks.prototype.addPts=function(e,r){var n=this;if(r)for(var i=0;i<e.length;i++)n.addPt(e[i]);else for(var a=e.length-1;a>=0;a--)n.addPt(e[a])};Ks.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var r=this._ptList.get(this._ptList.size()-1),n=e.distance(r);return n<this._minimimVertexDistance};Ks.prototype.toString=function(){var e=new zr,r=e.createLineString(this.getCoordinates());return r.toString()};Ks.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new Le(this._ptList.get(0)),r=this._ptList.get(this._ptList.size()-1);if(e.equals(r))return null;this._ptList.add(e)};Ks.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};Ks.prototype.interfaces_=function(){return[]};Ks.prototype.getClass=function(){return Ks};AO.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Ks,AO);var $r=function(){},pp={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.toDegrees=function(e){return e*180/Math.PI};$r.normalize=function(e){for(;e>Math.PI;)e-=$r.PI_TIMES_2;for(;e<=-Math.PI;)e+=$r.PI_TIMES_2;return e};$r.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=n.x-r.x,a=n.y-r.y;return Math.atan2(a,i)}};$r.isAcute=function(e,r,n){var i=e.x-r.x,a=e.y-r.y,h=n.x-r.x,s=n.y-r.y,g=i*h+a*s;return g>0};$r.isObtuse=function(e,r,n){var i=e.x-r.x,a=e.y-r.y,h=n.x-r.x,s=n.y-r.y,g=i*h+a*s;return g<0};$r.interiorAngle=function(e,r,n){var i=$r.angle(r,e),a=$r.angle(r,n);return Math.abs(a-i)};$r.normalizePositive=function(e){if(e<0){for(;e<0;)e+=$r.PI_TIMES_2;e>=$r.PI_TIMES_2&&(e=0)}else{for(;e>=$r.PI_TIMES_2;)e-=$r.PI_TIMES_2;e<0&&(e=0)}return e};$r.angleBetween=function(e,r,n){var i=$r.angle(r,e),a=$r.angle(r,n);return $r.diff(i,a)};$r.diff=function(e,r){var n=null;return e<r?n=r-e:n=e-r,n>Math.PI&&(n=2*Math.PI-n),n};$r.toRadians=function(e){return e*Math.PI/180};$r.getTurn=function(e,r){var n=Math.sin(r-e);return n>0?$r.COUNTERCLOCKWISE:n<0?$r.CLOCKWISE:$r.NONE};$r.angleBetweenOriented=function(e,r,n){var i=$r.angle(r,e),a=$r.angle(r,n),h=a-i;return h<=-Math.PI?h+$r.PI_TIMES_2:h>Math.PI?h-$r.PI_TIMES_2:h};pp.PI_TIMES_2.get=function(){return 2*Math.PI};pp.PI_OVER_2.get=function(){return Math.PI/2};pp.PI_OVER_4.get=function(){return Math.PI/4};pp.COUNTERCLOCKWISE.get=function(){return Ft.COUNTERCLOCKWISE};pp.CLOCKWISE.get=function(){return Ft.CLOCKWISE};pp.NONE.get=function(){return Ft.COLLINEAR};Object.defineProperties($r,pp);var fi=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new tr,this._seg1=new tr,this._offset0=new tr,this._offset1=new tr,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=r,this._li=new zh,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===An.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},f_={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};fi.prototype.addNextSegment=function(e,r){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=Ft.computeOrientation(this._s0,this._s1,this._s2),i=n===Ft.CLOCKWISE&&this._side===Et.LEFT||n===Ft.COUNTERCLOCKWISE&&this._side===Et.RIGHT;n===0?this.addCollinear(r):i?this.addOutsideTurn(n,r):this.addInsideTurn(n,r)};fi.prototype.addLineEndCap=function(e,r){var n=new tr(e,r),i=new tr;this.computeOffsetSegment(n,Et.LEFT,this._distance,i);var a=new tr;this.computeOffsetSegment(n,Et.RIGHT,this._distance,a);var h=r.x-e.x,s=r.y-e.y,g=Math.atan2(s,h);switch(this._bufParams.getEndCapStyle()){case An.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(r,g+Math.PI/2,g-Math.PI/2,Ft.CLOCKWISE,this._distance),this._segList.addPt(a.p1);break;case An.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(a.p1);break;case An.CAP_SQUARE:var m=new Le;m.x=Math.abs(this._distance)*Math.cos(g),m.y=Math.abs(this._distance)*Math.sin(g);var w=new Le(i.p1.x+m.x,i.p1.y+m.y),b=new Le(a.p1.x+m.x,a.p1.y+m.y);this._segList.addPt(w),this._segList.addPt(b);break}};fi.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};fi.prototype.addMitreJoin=function(e,r,n,i){var a=!0,h=null;try{h=Oa.intersection(r.p0,r.p1,n.p0,n.p1);var s=i<=0?1:h.distance(e)/Math.abs(i);s>this._bufParams.getMitreLimit()&&(a=!1)}catch(g){if(g instanceof dg)h=new Le(0,0),a=!1;else throw g}finally{}a?this._segList.addPt(h):this.addLimitedMitreJoin(r,n,i,this._bufParams.getMitreLimit())};fi.prototype.addFilletCorner=function(e,r,n,i,a){var h=r.x-e.x,s=r.y-e.y,g=Math.atan2(s,h),m=n.x-e.x,w=n.y-e.y,b=Math.atan2(w,m);i===Ft.CLOCKWISE?g<=b&&(g+=2*Math.PI):g>=b&&(g-=2*Math.PI),this._segList.addPt(r),this.addFilletArc(e,g,b,i,a),this._segList.addPt(n)};fi.prototype.addOutsideTurn=function(e,r){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*fi.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===An.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===An.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(r&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};fi.prototype.createSquare=function(e){this._segList.addPt(new Le(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new Le(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new Le(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new Le(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};fi.prototype.addSegments=function(e,r){this._segList.addPts(e,r)};fi.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};fi.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};fi.prototype.initSideSegments=function(e,r,n){this._s1=e,this._s2=r,this._side=n,this._seg1.setCoordinates(e,r),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};fi.prototype.addLimitedMitreJoin=function(e,r,n,i){var a=this._seg0.p1,h=$r.angle(a,this._seg0.p0),s=$r.angleBetweenOriented(this._seg0.p0,a,this._seg1.p1),g=s/2,m=$r.normalize(h+g),w=$r.normalize(m+Math.PI),b=i*n,I=b*Math.abs(Math.sin(g)),A=n-I,z=a.x+b*Math.cos(w),V=a.y+b*Math.sin(w),H=new Le(z,V),Z=new tr(a,H),D=Z.pointAlongOffset(1,A),k=Z.pointAlongOffset(1,-A);this._side===Et.LEFT?(this._segList.addPt(D),this._segList.addPt(k)):(this._segList.addPt(k),this._segList.addPt(D))};fi.prototype.computeOffsetSegment=function(e,r,n,i){var a=r===Et.LEFT?1:-1,h=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,g=Math.sqrt(h*h+s*s),m=a*n*h/g,w=a*n*s/g;i.p0.x=e.p0.x-w,i.p0.y=e.p0.y+m,i.p1.x=e.p1.x-w,i.p1.y=e.p1.y+m};fi.prototype.addFilletArc=function(e,r,n,i,a){var h=this,s=i===Ft.CLOCKWISE?-1:1,g=Math.abs(r-n),m=Math.trunc(g/this._filletAngleQuantum+.5);if(m<1)return null;for(var w=0,b=g/m,I=w,A=new Le;I<g;){var z=r+s*I;A.x=e.x+a*Math.cos(z),A.y=e.y+a*Math.sin(z),h._segList.addPt(A),I+=b}};fi.prototype.addInsideTurn=function(e,r){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*fi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Le((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new Le((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};fi.prototype.createCircle=function(e){var r=new Le(e.x+this._distance,e.y);this._segList.addPt(r),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};fi.prototype.addBevelJoin=function(e,r){this._segList.addPt(e.p1),this._segList.addPt(r.p0)};fi.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ks,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*fi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};fi.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var r=this._li.getIntersectionNum();r>=2&&(this._bufParams.getJoinStyle()===An.JOIN_BEVEL||this._bufParams.getJoinStyle()===An.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Ft.CLOCKWISE,this._distance))};fi.prototype.closeRing=function(){this._segList.closeRing()};fi.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};fi.prototype.interfaces_=function(){return[]};fi.prototype.getClass=function(){return fi};f_.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};f_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};f_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};f_.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(fi,f_);var _s=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],r=arguments[1];this._precisionModel=e,this._bufParams=r};_s.prototype.getOffsetCurve=function(e,r){if(this._distance=r,r===0)return null;var n=r<0,i=Math.abs(r),a=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],a):this.computeOffsetCurve(e,n,a);var h=a.getCoordinates();return n&&Br.reverse(h),h};_s.prototype.computeSingleSidedBufferCurve=function(e,r,n){var i=this.simplifyTolerance(this._distance);if(r){n.addSegments(e,!0);var a=Mi.simplify(e,-i),h=a.length-1;n.initSideSegments(a[h],a[h-1],Et.LEFT),n.addFirstSegment();for(var s=h-2;s>=0;s--)n.addNextSegment(a[s],!0)}else{n.addSegments(e,!1);var g=Mi.simplify(e,i),m=g.length-1;n.initSideSegments(g[0],g[1],Et.LEFT),n.addFirstSegment();for(var w=2;w<=m;w++)n.addNextSegment(g[w],!0)}n.addLastSegment(),n.closeRing()};_s.prototype.computeRingBufferCurve=function(e,r,n){var i=this.simplifyTolerance(this._distance);r===Et.RIGHT&&(i=-i);var a=Mi.simplify(e,i),h=a.length-1;n.initSideSegments(a[h-1],a[0],r);for(var s=1;s<=h;s++){var g=s!==1;n.addNextSegment(a[s],g)}n.closeRing()};_s.prototype.computeLineBufferCurve=function(e,r){var n=this.simplifyTolerance(this._distance),i=Mi.simplify(e,n),a=i.length-1;r.initSideSegments(i[0],i[1],Et.LEFT);for(var h=2;h<=a;h++)r.addNextSegment(i[h],!0);r.addLastSegment(),r.addLineEndCap(i[a-1],i[a]);var s=Mi.simplify(e,-n),g=s.length-1;r.initSideSegments(s[g],s[g-1],Et.LEFT);for(var m=g-2;m>=0;m--)r.addNextSegment(s[m],!0);r.addLastSegment(),r.addLineEndCap(s[1],s[0]),r.closeRing()};_s.prototype.computePointCurve=function(e,r){switch(this._bufParams.getEndCapStyle()){case An.CAP_ROUND:r.createCircle(e);break;case An.CAP_SQUARE:r.createSquare(e);break}};_s.prototype.getLineCurve=function(e,r){if(this._distance=r,r<0&&!this._bufParams.isSingleSided()||r===0)return null;var n=Math.abs(r),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var a=r<0;this.computeSingleSidedBufferCurve(e,a,i)}else this.computeLineBufferCurve(e,i);var h=i.getCoordinates();return h};_s.prototype.getBufferParameters=function(){return this._bufParams};_s.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};_s.prototype.getRingCurve=function(e,r,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return _s.copyCoordinates(e);var i=this.getSegGen(n);return this.computeRingBufferCurve(e,r,i),i.getCoordinates()};_s.prototype.computeOffsetCurve=function(e,r,n){var i=this.simplifyTolerance(this._distance);if(r){var a=Mi.simplify(e,-i),h=a.length-1;n.initSideSegments(a[h],a[h-1],Et.LEFT),n.addFirstSegment();for(var s=h-2;s>=0;s--)n.addNextSegment(a[s],!0)}else{var g=Mi.simplify(e,i),m=g.length-1;n.initSideSegments(g[0],g[1],Et.LEFT),n.addFirstSegment();for(var w=2;w<=m;w++)n.addNextSegment(g[w],!0)}n.addLastSegment()};_s.prototype.getSegGen=function(e){return new fi(this._precisionModel,this._bufParams,e)};_s.prototype.interfaces_=function(){return[]};_s.prototype.getClass=function(){return _s};_s.copyCoordinates=function(e){for(var r=new Array(e.length).fill(null),n=0;n<r.length;n++)r[n]=new Le(e[n]);return r};var Qf=function(){this._subgraphs=null,this._seg=new tr,this._cga=new Ft;var e=arguments[0];this._subgraphs=e},MO={DepthSegment:{configurable:!0}};Qf.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var r=arguments[0],n=new At,i=this._subgraphs.iterator();i.hasNext();){var a=i.next(),h=a.getEnvelope();r.y<h.getMinY()||r.y>h.getMaxY()||e.findStabbedSegments(r,a.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(cr(arguments[2],Da)&&arguments[0]instanceof Le&&arguments[1]instanceof ZE)for(var s=arguments[0],g=arguments[1],m=arguments[2],w=g.getEdge().getCoordinates(),b=0;b<w.length-1;b++){e._seg.p0=w[b],e._seg.p1=w[b+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var I=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(I<s.x)&&!e._seg.isHorizontal()&&!(s.y<e._seg.p0.y||s.y>e._seg.p1.y)&&Ft.computeOrientation(e._seg.p0,e._seg.p1,s)!==Ft.RIGHT){var A=g.getDepth(Et.LEFT);e._seg.p0.equals(w[b])||(A=g.getDepth(Et.RIGHT));var z=new Mh(e._seg,A);m.add(z)}}else if(cr(arguments[2],Da)&&arguments[0]instanceof Le&&cr(arguments[1],Da))for(var V=arguments[0],H=arguments[1],Z=arguments[2],D=H.iterator();D.hasNext();){var k=D.next();k.isForward()&&e.findStabbedSegments(V,k,Z)}}};Qf.prototype.getDepth=function(e){var r=this.findStabbedSegments(e);if(r.size()===0)return 0;var n=Fa.min(r);return n._leftDepth};Qf.prototype.interfaces_=function(){return[]};Qf.prototype.getClass=function(){return Qf};MO.DepthSegment.get=function(){return Mh};Object.defineProperties(Qf,MO);var Mh=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],r=arguments[1];this._upwardSeg=new tr(e),this._leftDepth=r};Mh.prototype.compareTo=function(e){var r=e;if(this._upwardSeg.minX()>=r._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=r._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(r._upwardSeg);return n!==0||(n=-1*r._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(r._upwardSeg)};Mh.prototype.compareX=function(e,r){var n=e.p0.compareTo(r.p0);return n!==0?n:e.p1.compareTo(r.p1)};Mh.prototype.toString=function(){return this._upwardSeg.toString()};Mh.prototype.interfaces_=function(){return[Ea]};Mh.prototype.getClass=function(){return Mh};var Ln=function(e,r,n){this.p0=e||null,this.p1=r||null,this.p2=n||null};Ln.prototype.area=function(){return Ln.area(this.p0,this.p1,this.p2)};Ln.prototype.signedArea=function(){return Ln.signedArea(this.p0,this.p1,this.p2)};Ln.prototype.interpolateZ=function(e){if(e===null)throw new vi("Supplied point is null.");return Ln.interpolateZ(e,this.p0,this.p1,this.p2)};Ln.prototype.longestSideLength=function(){return Ln.longestSideLength(this.p0,this.p1,this.p2)};Ln.prototype.isAcute=function(){return Ln.isAcute(this.p0,this.p1,this.p2)};Ln.prototype.circumcentre=function(){return Ln.circumcentre(this.p0,this.p1,this.p2)};Ln.prototype.area3D=function(){return Ln.area3D(this.p0,this.p1,this.p2)};Ln.prototype.centroid=function(){return Ln.centroid(this.p0,this.p1,this.p2)};Ln.prototype.inCentre=function(){return Ln.inCentre(this.p0,this.p1,this.p2)};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};Ln.area=function(e,r,n){return Math.abs(((n.x-e.x)*(r.y-e.y)-(r.x-e.x)*(n.y-e.y))/2)};Ln.signedArea=function(e,r,n){return((n.x-e.x)*(r.y-e.y)-(r.x-e.x)*(n.y-e.y))/2};Ln.det=function(e,r,n,i){return e*i-r*n};Ln.interpolateZ=function(e,r,n,i){var a=r.x,h=r.y,s=n.x-a,g=i.x-a,m=n.y-h,w=i.y-h,b=s*w-g*m,I=e.x-a,A=e.y-h,z=(w*I-g*A)/b,V=(-m*I+s*A)/b,H=r.z+z*(n.z-r.z)+V*(i.z-r.z);return H};Ln.longestSideLength=function(e,r,n){var i=e.distance(r),a=r.distance(n),h=n.distance(e),s=i;return a>s&&(s=a),h>s&&(s=h),s};Ln.isAcute=function(e,r,n){return!(!$r.isAcute(e,r,n)||!$r.isAcute(r,n,e)||!$r.isAcute(n,e,r))};Ln.circumcentre=function(e,r,n){var i=n.x,a=n.y,h=e.x-i,s=e.y-a,g=r.x-i,m=r.y-a,w=2*Ln.det(h,s,g,m),b=Ln.det(s,h*h+s*s,m,g*g+m*m),I=Ln.det(h,h*h+s*s,g,g*g+m*m),A=i-b/w,z=a+I/w;return new Le(A,z)};Ln.perpendicularBisector=function(e,r){var n=r.x-e.x,i=r.y-e.y,a=new Oa(e.x+n/2,e.y+i/2,1),h=new Oa(e.x-i+n/2,e.y+n+i/2,1);return new Oa(a,h)};Ln.angleBisector=function(e,r,n){var i=r.distance(e),a=r.distance(n),h=i/(i+a),s=n.x-e.x,g=n.y-e.y,m=new Le(e.x+h*s,e.y+h*g);return m};Ln.area3D=function(e,r,n){var i=r.x-e.x,a=r.y-e.y,h=r.z-e.z,s=n.x-e.x,g=n.y-e.y,m=n.z-e.z,w=a*m-h*g,b=h*s-i*m,I=i*g-a*s,A=w*w+b*b+I*I,z=Math.sqrt(A)/2;return z};Ln.centroid=function(e,r,n){var i=(e.x+r.x+n.x)/3,a=(e.y+r.y+n.y)/3;return new Le(i,a)};Ln.inCentre=function(e,r,n){var i=r.distance(n),a=e.distance(n),h=e.distance(r),s=i+a+h,g=(i*e.x+a*r.x+h*n.x)/s,m=(i*e.y+a*r.y+h*n.y)/s;return new Le(g,m)};var va=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new At;var e=arguments[0],r=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=r,this._curveBuilder=n};va.prototype.addPoint=function(e){if(this._distance<=0)return null;var r=e.getCoordinates(),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,Ge.EXTERIOR,Ge.INTERIOR)};va.prototype.addPolygon=function(e){var r=this,n=this._distance,i=Et.LEFT;this._distance<0&&(n=-this._distance,i=Et.RIGHT);var a=e.getExteriorRing(),h=Br.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&h.length<3)return null;this.addPolygonRing(h,n,i,Ge.EXTERIOR,Ge.INTERIOR);for(var s=0;s<e.getNumInteriorRing();s++){var g=e.getInteriorRingN(s),m=Br.removeRepeatedPoints(g.getCoordinates());r._distance>0&&r.isErodedCompletely(g,-r._distance)||r.addPolygonRing(m,n,Et.opposite(i),Ge.INTERIOR,Ge.EXTERIOR)}};va.prototype.isTriangleErodedCompletely=function(e,r){var n=new Ln(e[0],e[1],e[2]),i=n.inCentre(),a=Ft.distancePointLine(i,n.p0,n.p1);return a<Math.abs(r)};va.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var r=Br.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(r,this._distance);this.addCurve(n,Ge.EXTERIOR,Ge.INTERIOR)};va.prototype.addCurve=function(e,r,n){if(e===null||e.length<2)return null;var i=new zi(e,new zn(0,Ge.BOUNDARY,r,n));this._curveList.add(i)};va.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};va.prototype.addPolygonRing=function(e,r,n,i,a){if(r===0&&e.length<iu.MINIMUM_VALID_SIZE)return null;var h=i,s=a;e.length>=iu.MINIMUM_VALID_SIZE&&Ft.isCCW(e)&&(h=a,s=i,n=Et.opposite(n));var g=this._curveBuilder.getRingCurve(e,n,r);this.addCurve(g,h,s)};va.prototype.add=function(e){if(e.isEmpty())return null;e instanceof ao?this.addPolygon(e):e instanceof Ai?this.addLineString(e):e instanceof Ds?this.addPoint(e):e instanceof Hd?this.addCollection(e):e instanceof Ch?this.addCollection(e):e instanceof tu?this.addCollection(e):e instanceof as&&this.addCollection(e)};va.prototype.isErodedCompletely=function(e,r){var n=e.getCoordinates();if(n.length<4)return r<0;if(n.length===4)return this.isTriangleErodedCompletely(n,r);var i=e.getEnvelopeInternal(),a=Math.min(i.getHeight(),i.getWidth());return r<0&&2*Math.abs(r)>a};va.prototype.addCollection=function(e){for(var r=this,n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);r.add(i)}};va.prototype.interfaces_=function(){return[]};va.prototype.getClass=function(){return va};var Qd=function(){};Qd.prototype.locate=function(e){};Qd.prototype.interfaces_=function(){return[]};Qd.prototype.getClass=function(){return Qd};var ru=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};ru.prototype.next=function(){if(this._atStart)return this._atStart=!1,ru.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new mg;var e=this._parent.getGeometryN(this._index++);return e instanceof as?(this._subcollectionIterator=new ru(e),this._subcollectionIterator.next()):e};ru.prototype.remove=function(){throw new Error(this.getClass().getName())};ru.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ru.prototype.interfaces_=function(){return[gg]};ru.prototype.getClass=function(){return ru};ru.isAtomic=function(e){return!(e instanceof as)};var $s=function(){this._geom=null;var e=arguments[0];this._geom=e};$s.prototype.locate=function(e){return $s.locate(e,this._geom)};$s.prototype.interfaces_=function(){return[Qd]};$s.prototype.getClass=function(){return $s};$s.isPointInRing=function(e,r){return r.getEnvelopeInternal().intersects(e)?Ft.isPointInRing(e,r.getCoordinates()):!1};$s.containsPointInPolygon=function(e,r){if(r.isEmpty())return!1;var n=r.getExteriorRing();if(!$s.isPointInRing(e,n))return!1;for(var i=0;i<r.getNumInteriorRing();i++){var a=r.getInteriorRingN(i);if($s.isPointInRing(e,a))return!1}return!0};$s.containsPoint=function(e,r){if(r instanceof ao)return $s.containsPointInPolygon(e,r);if(r instanceof as)for(var n=new ru(r);n.hasNext();){var i=n.next();if(i!==r&&$s.containsPoint(e,i))return!0}return!1};$s.locate=function(e,r){return r.isEmpty()?Ge.EXTERIOR:$s.containsPoint(e,r)?Ge.INTERIOR:Ge.EXTERIOR};var Zo=function(){this._edgeMap=new qo,this._edgeList=null,this._ptInAreaLocation=[Ge.NONE,Ge.NONE]};Zo.prototype.getNextCW=function(e){this.getEdges();var r=this._edgeList.indexOf(e),n=r-1;return r===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Zo.prototype.propagateSideLabels=function(e){for(var r=Ge.NONE,n=this.iterator();n.hasNext();){var i=n.next(),a=i.getLabel();a.isArea(e)&&a.getLocation(e,Et.LEFT)!==Ge.NONE&&(r=a.getLocation(e,Et.LEFT))}if(r===Ge.NONE)return null;for(var h=r,s=this.iterator();s.hasNext();){var g=s.next(),m=g.getLabel();if(m.getLocation(e,Et.ON)===Ge.NONE&&m.setLocation(e,Et.ON,h),m.isArea(e)){var w=m.getLocation(e,Et.LEFT),b=m.getLocation(e,Et.RIGHT);if(b!==Ge.NONE){if(b!==h)throw new Gu("side location conflict",g.getCoordinate());w===Ge.NONE&&Cr.shouldNeverReachHere("found single null side (at "+g.getCoordinate()+")"),h=w}else Cr.isTrue(m.getLocation(e,Et.LEFT)===Ge.NONE,"found single null side"),m.setLocation(e,Et.RIGHT,h),m.setLocation(e,Et.LEFT,h)}}};Zo.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var r=e.next();return r.getCoordinate()};Zo.prototype.print=function(e){Oo.out.println("EdgeEndStar:   "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(e)}};Zo.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Zo.prototype.checkAreaLabelsConsistent=function(e){var r=this.getEdges();if(r.size()<=0)return!0;var n=r.size()-1,i=r.get(n).getLabel(),a=i.getLocation(e,Et.LEFT);Cr.isTrue(a!==Ge.NONE,"Found unlabelled area edge");for(var h=a,s=this.iterator();s.hasNext();){var g=s.next(),m=g.getLabel();Cr.isTrue(m.isArea(e),"Found non-area edge");var w=m.getLocation(e,Et.LEFT),b=m.getLocation(e,Et.RIGHT);if(w===b||b!==h)return!1;h=w}return!0};Zo.prototype.findIndex=function(e){var r=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var i=r._edgeList.get(n);if(i===e)return n}return-1};Zo.prototype.iterator=function(){return this.getEdges().iterator()};Zo.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new At(this._edgeMap.values())),this._edgeList};Zo.prototype.getLocation=function(e,r,n){return this._ptInAreaLocation[e]===Ge.NONE&&(this._ptInAreaLocation[e]=$s.locate(r,n[e].getGeometry())),this._ptInAreaLocation[e]};Zo.prototype.toString=function(){var e=new wl;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var r=this.iterator();r.hasNext();){var n=r.next();e.append(n),e.append(`
`)}return e.toString()};Zo.prototype.computeEdgeEndLabels=function(e){for(var r=this.iterator();r.hasNext();){var n=r.next();n.computeLabel(e)}};Zo.prototype.computeLabelling=function(e){var r=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var a=i.next(),h=a.getLabel(),s=0;s<2;s++)h.isLine(s)&&h.getLocation(s)===Ge.BOUNDARY&&(n[s]=!0);for(var g=this.iterator();g.hasNext();)for(var m=g.next(),w=m.getLabel(),b=0;b<2;b++)if(w.isAnyNull(b)){var I=Ge.NONE;if(n[b])I=Ge.EXTERIOR;else{var A=m.getCoordinate();I=r.getLocation(b,A,e)}w.setAllLocationsIfNull(b,I)}};Zo.prototype.getDegree=function(){return this._edgeMap.size()};Zo.prototype.insertEdgeEnd=function(e,r){this._edgeMap.put(e,r),this._edgeList=null};Zo.prototype.interfaces_=function(){return[]};Zo.prototype.getClass=function(){return Zo};var s7=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var i=null,a=null,h=this._SCANNING_FOR_INCOMING,s=0;s<this._resultAreaEdgeList.size();s++){var g=n._resultAreaEdgeList.get(s),m=g.getSym();if(g.getLabel().isArea())switch(i===null&&g.isInResult()&&(i=g),h){case n._SCANNING_FOR_INCOMING:if(!m.isInResult())continue;a=m,h=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!g.isInResult())continue;a.setNext(g),h=n._SCANNING_FOR_INCOMING;break}}if(h===this._LINKING_TO_OUTGOING){if(i===null)throw new Gu("no outgoing dirEdge found",this.getCoordinate());Cr.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),a.setNext(i)}},e.prototype.insert=function(n){var i=n;this.insertEdgeEnd(i,i)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),i=n.size();if(i<1)return null;var a=n.get(0);if(i===1)return a;var h=n.get(i-1),s=a.getQuadrant(),g=h.getQuadrant();return Gn.isNorthern(s)&&Gn.isNorthern(g)?a:!Gn.isNorthern(s)&&!Gn.isNorthern(g)?h:a.getDy()!==0?a:h.getDy()!==0?h:(Cr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){Oo.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var a=i.next();n.print("out "),a.print(n),n.println(),n.print("in "),a.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new At;for(var i=this.iterator();i.hasNext();){var a=i.next();(a.isInResult()||a.getSym().isInResult())&&n._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var i=this.iterator();i.hasNext();){var a=i.next(),h=a.getLabel();h.setAllLocationsIfNull(0,n.getLocation(0)),h.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var i=null,a=null,h=this._edgeList.size()-1;h>=0;h--){var s=n._edgeList.get(h),g=s.getSym();a===null&&(a=g),i!==null&&g.setNext(i),i=s}a.setNext(i)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var i=arguments[0],a=this.findIndex(i),h=i.getDepth(Et.LEFT),s=i.getDepth(Et.RIGHT),g=this.computeDepths(a+1,this._edgeList.size(),h),m=this.computeDepths(0,a,g);if(m!==s)throw new Gu("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],b=arguments[1],I=arguments[2],A=I,z=w;z<b;z++){var V=n._edgeList.get(z);V.setEdgeDepths(Et.RIGHT,A),A=V.getDepth(Et.LEFT)}return A}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var i=n.next(),a=i.getLabel();a.merge(i.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var i=this,a=null,h=null,s=this._SCANNING_FOR_INCOMING,g=this._resultAreaEdgeList.size()-1;g>=0;g--){var m=i._resultAreaEdgeList.get(g),w=m.getSym();switch(a===null&&m.getEdgeRing()===n&&(a=m),s){case i._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;h=w,s=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(m.getEdgeRing()!==n)continue;h.setNextMin(m),s=i._SCANNING_FOR_INCOMING;break}}s===this._LINKING_TO_OUTGOING&&(Cr.isTrue(a!==null,"found null for first outgoing dirEdge"),Cr.isTrue(a.getEdgeRing()===n,"unable to link last incoming dirEdge"),h.setNextMin(a))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,i=this.iterator();i.hasNext();){var a=i.next();a.isInResult()&&n++}return n}else if(arguments.length===1){for(var h=arguments[0],s=0,g=this.iterator();g.hasNext();){var m=g.next();m.getEdgeRing()===h&&s++}return s}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=Ge.NONE,i=this.iterator();i.hasNext();){var a=i.next(),h=a.getSym();if(!a.isLineEdge()){if(a.isInResult()){n=Ge.INTERIOR;break}if(h.isInResult()){n=Ge.EXTERIOR;break}}}if(n===Ge.NONE)return null;for(var s=n,g=this.iterator();g.hasNext();){var m=g.next(),w=m.getSym();m.isLineEdge()?m.getEdge().setCovered(s===Ge.INTERIOR):(m.isInResult()&&(s=Ge.EXTERIOR),w.isInResult()&&(s=Ge.INTERIOR))}},e.prototype.computeLabelling=function(n){var i=this;t.prototype.computeLabelling.call(this,n),this._label=new zn(Ge.NONE);for(var a=this.iterator();a.hasNext();)for(var h=a.next(),s=h.getEdge(),g=s.getLabel(),m=0;m<2;m++){var w=g.getLocation(m);(w===Ge.INTERIOR||w===Ge.BOUNDARY)&&i._label.setLocation(m,Ge.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zo),LO=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new L1(n,new s7)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kd),Pc=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Pc.prototype.compareTo=function(e){var r=e,n=Pc.compareOriented(this._pts,this._orientation,r._pts,r._orientation);return n};Pc.prototype.interfaces_=function(){return[Ea]};Pc.prototype.getClass=function(){return Pc};Pc.orientation=function(e){return Br.increasingDirection(e)===1};Pc.compareOriented=function(e,r,n,i){for(var a=r?1:-1,h=i?1:-1,s=r?e.length:-1,g=i?n.length:-1,m=r?0:e.length-1,w=i?0:n.length-1;;){var b=e[m].compareTo(n[w]);if(b!==0)return b;m+=a,w+=h;var I=m===s,A=w===g;if(I&&!A)return-1;if(!I&&A)return 1;if(I&&A)return 0}};var za=function(){this._edges=new At,this._ocaMap=new qo};za.prototype.print=function(e){var r=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=r._edges.get(n);n>0&&e.print(","),e.print("(");for(var a=i.getCoordinates(),h=0;h<a.length;h++)h>0&&e.print(","),e.print(a[h].x+" "+a[h].y);e.println(")")}e.print(")  ")};za.prototype.addAll=function(e){for(var r=this,n=e.iterator();n.hasNext();)r.add(n.next())};za.prototype.findEdgeIndex=function(e){for(var r=this,n=0;n<this._edges.size();n++)if(r._edges.get(n).equals(e))return n;return-1};za.prototype.iterator=function(){return this._edges.iterator()};za.prototype.getEdges=function(){return this._edges};za.prototype.get=function(e){return this._edges.get(e)};za.prototype.findEqualEdge=function(e){var r=new Pc(e.getCoordinates()),n=this._ocaMap.get(r);return n};za.prototype.add=function(e){this._edges.add(e);var r=new Pc(e.getCoordinates());this._ocaMap.put(r,e)};za.prototype.interfaces_=function(){return[]};za.prototype.getClass=function(){return za};var Lh=function(){};Lh.prototype.processIntersections=function(e,r,n,i){};Lh.prototype.isDone=function(){};Lh.prototype.interfaces_=function(){return[]};Lh.prototype.getClass=function(){return Lh};var Ys=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Ys.prototype.isTrivialIntersection=function(e,r,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Ys.isAdjacentSegments(r,i))return!0;if(e.isClosed()){var a=e.size()-1;if(r===0&&i===a||i===0&&r===a)return!0}}return!1};Ys.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ys.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ys.prototype.getLineIntersector=function(){return this._li};Ys.prototype.hasProperIntersection=function(){return this._hasProper};Ys.prototype.processIntersections=function(e,r,n,i){if(e===n&&r===i)return null;this.numTests++;var a=e.getCoordinates()[r],h=e.getCoordinates()[r+1],s=n.getCoordinates()[i],g=n.getCoordinates()[i+1];this._li.computeIntersection(a,h,s,g),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,r,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Ys.prototype.hasIntersection=function(){return this._hasIntersection};Ys.prototype.isDone=function(){return!1};Ys.prototype.hasInteriorIntersection=function(){return this._hasInterior};Ys.prototype.interfaces_=function(){return[Lh]};Ys.prototype.getClass=function(){return Ys};Ys.isAdjacentSegments=function(e,r){return Math.abs(e-r)===1};var gl=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],r=arguments[1],n=arguments[2];this.coord=new Le(e),this.segmentIndex=r,this.dist=n};gl.prototype.getSegmentIndex=function(){return this.segmentIndex};gl.prototype.getCoordinate=function(){return this.coord};gl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};gl.prototype.compareTo=function(e){var r=e;return this.compare(r.segmentIndex,r.dist)};gl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};gl.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};gl.prototype.getDistance=function(){return this.dist};gl.prototype.compare=function(e,r){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<r?-1:this.dist>r?1:0};gl.prototype.interfaces_=function(){return[Ea]};gl.prototype.getClass=function(){return gl};var au=function(){this._nodeMap=new qo,this.edge=null;var e=arguments[0];this.edge=e};au.prototype.print=function(e){e.println("Intersections:");for(var r=this.iterator();r.hasNext();){var n=r.next();n.print(e)}};au.prototype.iterator=function(){return this._nodeMap.values().iterator()};au.prototype.addSplitEdges=function(e){var r=this;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next(),h=r.createSplitEdge(i,a);e.add(h),i=a}};au.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};au.prototype.createSplitEdge=function(e,r){var n=this,i=r.segmentIndex-e.segmentIndex+2,a=this.edge.pts[r.segmentIndex],h=r.dist>0||!r.coord.equals2D(a);h||i--;var s=new Array(i).fill(null),g=0;s[g++]=new Le(e.coord);for(var m=e.segmentIndex+1;m<=r.segmentIndex;m++)s[g++]=n.edge.pts[m];return h&&(s[g]=r.coord),new B0(s,new zn(this.edge._label))};au.prototype.add=function(e,r,n){var i=new gl(e,r,n),a=this._nodeMap.get(i);return a!==null?a:(this._nodeMap.put(i,i),i)};au.prototype.isIntersection=function(e){for(var r=this.iterator();r.hasNext();){var n=r.next();if(n.coord.equals(e))return!0}return!1};au.prototype.interfaces_=function(){return[]};au.prototype.getClass=function(){return au};var Oh=function(){};Oh.prototype.getChainStartIndices=function(e){var r=this,n=0,i=new At;i.add(new ul(n));do{var a=r.findChainEnd(e,n);i.add(new ul(a)),n=a}while(n<e.length-1);var h=Oh.toIntArray(i);return h};Oh.prototype.findChainEnd=function(e,r){for(var n=Gn.quadrant(e[r],e[r+1]),i=r+1;i<e.length;){var a=Gn.quadrant(e[i-1],e[i]);if(a!==n)break;i++}return i-1};Oh.prototype.interfaces_=function(){return[]};Oh.prototype.getClass=function(){return Oh};Oh.toIntArray=function(e){for(var r=new Array(e.size()).fill(null),n=0;n<r.length;n++)r[n]=e.get(n).intValue();return r};var ju=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Yt,this.env2=new Yt;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var r=new Oh;this.startIndex=r.getChainStartIndices(this.pts)};ju.prototype.getCoordinates=function(){return this.pts};ju.prototype.getMaxX=function(e){var r=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return r>n?r:n};ju.prototype.getMinX=function(e){var r=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return r<n?r:n};ju.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],r,r.startIndex[n],r.startIndex[n+1],i)}else if(arguments.length===6){var a=arguments[0],h=arguments[1],s=arguments[2],g=arguments[3],m=arguments[4],w=arguments[5],b=this.pts[a],I=this.pts[h],A=s.pts[g],z=s.pts[m];if(h-a===1&&m-g===1)return w.addIntersections(this.e,a,s.e,g),null;if(this.env1.init(b,I),this.env2.init(A,z),!this.env1.intersects(this.env2))return null;var V=Math.trunc((a+h)/2),H=Math.trunc((g+m)/2);a<V&&(g<H&&this.computeIntersectsForChain(a,V,s,g,H,w),H<m&&this.computeIntersectsForChain(a,V,s,H,m,w)),V<h&&(g<H&&this.computeIntersectsForChain(V,h,s,g,H,w),H<m&&this.computeIntersectsForChain(V,h,s,H,m,w))}};ju.prototype.getStartIndexes=function(){return this.startIndex};ju.prototype.computeIntersects=function(e,r){for(var n=this,i=0;i<this.startIndex.length-1;i++)for(var a=0;a<e.startIndex.length-1;a++)n.computeIntersectsForChain(i,e,a,r)};ju.prototype.interfaces_=function(){return[]};ju.prototype.getClass=function(){return ju};var Mo=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var r=0;r<2;r++)for(var n=0;n<3;n++)e._depth[r][n]=t.NULL_VALUE},OO={NULL_VALUE:{configurable:!0}};Mo.prototype.getDepth=function(e,r){return this._depth[e][r]};Mo.prototype.setDepth=function(e,r,n){this._depth[e][r]=n};Mo.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var r=0;r<2;r++)for(var n=0;n<3;n++)if(e._depth[r][n]!==Mo.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Mo.NULL_VALUE}else if(arguments.length===2){var a=arguments[0],h=arguments[1];return this._depth[a][h]===Mo.NULL_VALUE}};Mo.prototype.normalize=function(){for(var e=this,r=0;r<2;r++)if(!e.isNull(r)){var n=e._depth[r][1];e._depth[r][2]<n&&(n=e._depth[r][2]),n<0&&(n=0);for(var i=1;i<3;i++){var a=0;e._depth[r][i]>n&&(a=1),e._depth[r][i]=a}}};Mo.prototype.getDelta=function(e){return this._depth[e][Et.RIGHT]-this._depth[e][Et.LEFT]};Mo.prototype.getLocation=function(e,r){return this._depth[e][r]<=0?Ge.EXTERIOR:Ge.INTERIOR};Mo.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Mo.prototype.add=function(){var e=this;if(arguments.length===1)for(var r=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var a=r.getLocation(n,i);(a===Ge.EXTERIOR||a===Ge.INTERIOR)&&(e.isNull(n,i)?e._depth[n][i]=Mo.depthAtLocation(a):e._depth[n][i]+=Mo.depthAtLocation(a))}else if(arguments.length===3){var h=arguments[0],s=arguments[1],g=arguments[2];g===Ge.INTERIOR&&this._depth[h][s]++}};Mo.prototype.interfaces_=function(){return[]};Mo.prototype.getClass=function(){return Mo};Mo.depthAtLocation=function(e){return e===Ge.EXTERIOR?0:e===Ge.INTERIOR?1:Mo.NULL_VALUE};OO.NULL_VALUE.get=function(){return-1};Object.defineProperties(Mo,OO);var B0=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new au(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Mo,this._depthDelta=0,arguments.length===1){var r=arguments[0];e.call(this,r,null)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.pts=n,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var i=new e(n,zn.toLineLabel(this._label));return i},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var i=this;if(!(n instanceof e))return!1;var a=n;if(this.pts.length!==a.pts.length)return!1;for(var h=!0,s=!0,g=this.pts.length,m=0;m<this.pts.length;m++)if(i.pts[m].equals2D(a.pts[m])||(h=!1),i.pts[m].equals2D(a.pts[--g])||(s=!1),!h&&!s)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var i=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&n.print(","),n.print(i.pts[a].x+" "+i.pts[a].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var i=this;n.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)n.print(i.pts[a]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new ju(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Yt;for(var i=0;i<this.pts.length;i++)n._env.expandToInclude(n.pts[i])}return this._env},e.prototype.addIntersection=function(n,i,a,h){var s=new Le(n.getIntersection(h)),g=i,m=n.getEdgeDistance(a,h),w=g+1;if(w<this.pts.length){var b=this.pts[w];s.equals2D(b)&&(g=w,m=0)}this.eiList.add(s,g,m)},e.prototype.toString=function(){var n=this,i=new wl;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&i.append(","),i.append(n.pts[a].x+" "+n.pts[a].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},e.prototype.isPointwiseEqual=function(n){var i=this;if(this.pts.length!==n.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!i.pts[a].equals2D(n.pts[a]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,i,a){for(var h=this,s=0;s<n.getIntersectionNum();s++)h.addIntersection(n,i,a,s)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,Et.ON),n.getLocation(1,Et.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,Et.LEFT),n.getLocation(1,Et.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,Et.RIGHT),n.getLocation(1,Et.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(Hs),os=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new za,this._bufParams=e||null};os.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};os.prototype.insertUniqueEdge=function(e){var r=this._edgeList.findEqualEdge(e);if(r!==null){var n=r.getLabel(),i=e.getLabel();r.isPointwiseEqual(e)||(i=new zn(e.getLabel()),i.flip()),n.merge(i);var a=os.depthDelta(i),h=r.getDepthDelta(),s=h+a;r.setDepthDelta(s)}else this._edgeList.add(e),e.setDepthDelta(os.depthDelta(e.getLabel()))};os.prototype.buildSubgraphs=function(e,r){for(var n=new At,i=e.iterator();i.hasNext();){var a=i.next(),h=a.getRightmostCoordinate(),s=new Qf(n),g=s.getDepth(h);a.computeDepth(g),a.findResultEdges(),n.add(a),r.add(a.getDirectedEdges(),a.getNodes())}};os.prototype.createSubgraphs=function(e){for(var r=new At,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var a=new ls;a.create(i),r.add(a)}}return Fa.sort(r,Fa.reverseOrder()),r};os.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};os.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var r=new xT,n=new zh;return n.setPrecisionModel(e),r.setSegmentIntersector(new Ys(n)),r};os.prototype.buffer=function(e,r){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new _s(n,this._bufParams),a=new va(e,r,i),h=a.getCurves();if(h.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(h,n),this._graph=new Si(new LO),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),g=new Ns(this._geomFact);this.buildSubgraphs(s,g);var m=g.getPolygons();if(m.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(m);return w};os.prototype.computeNodedEdges=function(e,r){var n=this,i=this.getNoder(r);i.computeNodes(e);for(var a=i.getNodedSubstrings(),h=a.iterator();h.hasNext();){var s=h.next(),g=s.getCoordinates();if(!(g.length===2&&g[0].equals2D(g[1]))){var m=s.getData(),w=new B0(s.getCoordinates(),new zn(m));n.insertUniqueEdge(w)}}};os.prototype.setNoder=function(e){this._workingNoder=e};os.prototype.interfaces_=function(){return[]};os.prototype.getClass=function(){return os};os.depthDelta=function(e){var r=e.getLocation(0,Et.LEFT),n=e.getLocation(0,Et.RIGHT);return r===Ge.INTERIOR&&n===Ge.EXTERIOR?1:r===Ge.EXTERIOR&&n===Ge.INTERIOR?-1:0};os.convertSegStrings=function(e){for(var r=new zr,n=new At;e.hasNext();){var i=e.next(),a=r.createLineString(i.getCoordinates());n.add(a)}return r.buildGeometry(n)};var Cc=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],r=arguments[1];this._noder=e,this._scaleFactor=r,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3];this._noder=n,this._scaleFactor=i,this._offsetX=a,this._offsetY=h,this._isScaled=!this.isIntegerPrecision()}};Cc.prototype.rescale=function(){var e=this;if(cr(arguments[0],to))for(var r=arguments[0],n=r.iterator();n.hasNext();){var i=n.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],h=0;h<a.length;h++)a[h].x=a[h].x/e._scaleFactor+e._offsetX,a[h].y=a[h].y/e._scaleFactor+e._offsetY;a.length===2&&a[0].equals2D(a[1])&&Oo.out.println(a)}};Cc.prototype.scale=function(){var e=this;if(cr(arguments[0],to)){for(var r=arguments[0],n=new At,i=r.iterator();i.hasNext();){var a=i.next();n.add(new zi(e.scale(a.getCoordinates()),a.getData()))}return n}else if(arguments[0]instanceof Array){for(var h=arguments[0],s=new Array(h.length).fill(null),g=0;g<h.length;g++)s[g]=new Le(Math.round((h[g].x-e._offsetX)*e._scaleFactor),Math.round((h[g].y-e._offsetY)*e._scaleFactor),h[g].z);var m=Br.removeRepeatedPoints(s);return m}};Cc.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Cc.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};Cc.prototype.computeNodes=function(e){var r=e;this._isScaled&&(r=this.scale(e)),this._noder.computeNodes(r)};Cc.prototype.interfaces_=function(){return[Ah]};Cc.prototype.getClass=function(){return Cc};var ml=function(){this._li=new zh,this._segStrings=null;var e=arguments[0];this._segStrings=e},DO={fact:{configurable:!0}};ml.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var n=r.next(),i=n.getCoordinates();e.checkEndPtVertexIntersections(i[0],e._segStrings),e.checkEndPtVertexIntersections(i[i.length-1],e._segStrings)}else if(arguments.length===2){for(var a=arguments[0],h=arguments[1],s=h.iterator();s.hasNext();)for(var g=s.next(),m=g.getCoordinates(),w=1;w<m.length-1;w++)if(m[w].equals(a))throw new Bu("found endpt/interior pt intersection at index "+w+" :pt "+a)}};ml.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();)for(var n=r.next(),i=this._segStrings.iterator();i.hasNext();){var a=i.next();e.checkInteriorIntersections(n,a)}else if(arguments.length===2)for(var h=arguments[0],s=arguments[1],g=h.getCoordinates(),m=s.getCoordinates(),w=0;w<g.length-1;w++)for(var b=0;b<m.length-1;b++)e.checkInteriorIntersections(h,w,s,b);else if(arguments.length===4){var I=arguments[0],A=arguments[1],z=arguments[2],V=arguments[3];if(I===z&&A===V)return null;var H=I.getCoordinates()[A],Z=I.getCoordinates()[A+1],D=z.getCoordinates()[V],k=z.getCoordinates()[V+1];if(this._li.computeIntersection(H,Z,D,k),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,H,Z)||this.hasInteriorIntersection(this._li,D,k)))throw new Bu("found non-noded intersection at "+H+"-"+Z+" and "+D+"-"+k)}};ml.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};ml.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var r=this._segStrings.iterator();r.hasNext();){var n=r.next();e.checkCollapses(n)}else if(arguments.length===1)for(var i=arguments[0],a=i.getCoordinates(),h=0;h<a.length-2;h++)e.checkCollapse(a[h],a[h+1],a[h+2])};ml.prototype.hasInteriorIntersection=function(e,r,n){for(var i=0;i<e.getIntersectionNum();i++){var a=e.getIntersection(i);if(!(a.equals(r)||a.equals(n)))return!0}return!1};ml.prototype.checkCollapse=function(e,r,n){if(e.equals(n))throw new Bu("found non-noded collapse at "+ml.fact.createLineString([e,r,n]))};ml.prototype.interfaces_=function(){return[]};ml.prototype.getClass=function(){return ml};DO.fact.get=function(){return new zr};Object.defineProperties(ml,DO);var vs=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],r=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=r,this._li=n,r<=0)throw new vi("Scale factor must be non-zero");r!==1&&(this._pt=new Le(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new Le,this._p1Scaled=new Le),this.initCorners(this._pt)},NO={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};vs.prototype.intersectsScaled=function(e,r){var n=Math.min(e.x,r.x),i=Math.max(e.x,r.x),a=Math.min(e.y,r.y),h=Math.max(e.y,r.y),s=this._maxx<n||this._minx>i||this._maxy<a||this._miny>h;if(s)return!1;var g=this.intersectsToleranceSquare(e,r);return Cr.isTrue(!(s&&g),"Found bad envelope test"),g};vs.prototype.initCorners=function(e){var r=.5;this._minx=e.x-r,this._maxx=e.x+r,this._miny=e.y-r,this._maxy=e.y+r,this._corner[0]=new Le(this._maxx,this._maxy),this._corner[1]=new Le(this._minx,this._maxy),this._corner[2]=new Le(this._minx,this._miny),this._corner[3]=new Le(this._maxx,this._miny)};vs.prototype.intersects=function(e,r){return this._scaleFactor===1?this.intersectsScaled(e,r):(this.copyScaled(e,this._p0Scaled),this.copyScaled(r,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};vs.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};vs.prototype.getCoordinate=function(){return this._originalPt};vs.prototype.copyScaled=function(e,r){r.x=this.scale(e.x),r.y=this.scale(e.y)};vs.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=vs.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Yt(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};vs.prototype.intersectsPixelClosure=function(e,r){return this._li.computeIntersection(e,r,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,r,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,r,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,r,this._corner[3],this._corner[0]),this._li.hasIntersection()))};vs.prototype.intersectsToleranceSquare=function(e,r){var n=!1,i=!1;return this._li.computeIntersection(e,r,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,r,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,r,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,r,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||e.equals(this._pt)||r.equals(this._pt))};vs.prototype.addSnappedNode=function(e,r){var n=e.getCoordinate(r),i=e.getCoordinate(r+1);return this.intersects(n,i)?(e.addIntersection(this.getCoordinate(),r),!0):!1};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};NO.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(vs,NO);var Hy=function(){this.tempEnv1=new Yt,this.selectedSegment=new tr};Hy.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var e=arguments[0],r=arguments[1];e.getLineSegment(r,this.selectedSegment),this.select(this.selectedSegment)}}};Hy.prototype.interfaces_=function(){return[]};Hy.prototype.getClass=function(){return Hy};var eg=function(){this._index=null;var e=arguments[0];this._index=e},RO={HotPixelSnapAction:{configurable:!0}};eg.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2],a=r.getSafeEnvelope(),h=new kO(r,n,i);return this._index.query(a,{interfaces_:function(){return[Sc]},visitItem:function(s){var g=s;g.select(a,h)}}),h.isNodeAdded()}};eg.prototype.interfaces_=function(){return[]};eg.prototype.getClass=function(){return eg};RO.HotPixelSnapAction.get=function(){return kO};Object.defineProperties(eg,RO);var kO=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],i=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1],a=n.getContext();if(this._parentEdge!==null&&a===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(a,i)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hy),ep=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new At};ep.prototype.processIntersections=function(e,r,n,i){var a=this;if(e===n&&r===i)return null;var h=e.getCoordinates()[r],s=e.getCoordinates()[r+1],g=n.getCoordinates()[i],m=n.getCoordinates()[i+1];if(this._li.computeIntersection(h,s,g,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)a._interiorIntersections.add(a._li.getIntersection(w));e.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1)}};ep.prototype.isDone=function(){return!1};ep.prototype.getInteriorIntersections=function(){return this._interiorIntersections};ep.prototype.interfaces_=function(){return[Lh]};ep.prototype.getClass=function(){return ep};var lu=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new zh,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};lu.prototype.checkCorrectness=function(e){var r=zi.getNodedSubstrings(e),n=new ml(r);try{n.checkValid()}catch(i){if(i instanceof vO)i.printStackTrace();else throw i}finally{}};lu.prototype.getNodedSubstrings=function(){return zi.getNodedSubstrings(this._nodedSegStrings)};lu.prototype.snapRound=function(e,r){var n=this.findInteriorIntersections(e,r);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};lu.prototype.findInteriorIntersections=function(e,r){var n=new ep(r);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};lu.prototype.computeVertexSnaps=function(){var e=this;if(cr(arguments[0],to))for(var r=arguments[0],n=r.iterator();n.hasNext();){var i=n.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof zi)for(var a=arguments[0],h=a.getCoordinates(),s=0;s<h.length;s++){var g=new vs(h[s],e._scaleFactor,e._li),m=e._pointSnapper.snap(g,a,s);m&&a.addIntersection(h[s],s)}};lu.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new xT,this._pointSnapper=new eg(this._noder.getIndex()),this.snapRound(e,this._li)};lu.prototype.computeIntersectionSnaps=function(e){for(var r=this,n=e.iterator();n.hasNext();){var i=n.next(),a=new vs(i,r._scaleFactor,r._li);r._pointSnapper.snap(a)}};lu.prototype.interfaces_=function(){return[Ah]};lu.prototype.getClass=function(){return lu};var Co=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new An,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._argGeom=r,this._bufParams=n}},yg={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Co.prototype.bufferFixedPrecision=function(e){var r=new Cc(new lu(new Mn(1)),e.getScale()),n=new os(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(r),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Co.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var r=Co.MAX_PRECISION_DIGITS;r>=0;r--){try{e.bufferReducedPrecision(r)}catch(h){if(h instanceof Gu)e._saveException=h;else throw h}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],i=Co.precisionScaleFactor(this._argGeom,this._distance,n),a=new Mn(i);this.bufferFixedPrecision(a)}};Co.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Mn.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};Co.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};Co.prototype.bufferOriginalPrecision=function(){try{var e=new os(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(r){if(r instanceof Bu)this._saveException=r;else throw r}finally{}};Co.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};Co.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};Co.prototype.interfaces_=function(){return[]};Co.prototype.getClass=function(){return Co};Co.bufferOp=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],n=new Co(e),i=n.getResultGeometry(r);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ur&&typeof arguments[1]=="number"){var a=arguments[0],h=arguments[1],s=arguments[2],g=new Co(a);g.setQuadrantSegments(s);var m=g.getResultGeometry(h);return m}else if(arguments[2]instanceof An&&arguments[0]instanceof ur&&typeof arguments[1]=="number"){var w=arguments[0],b=arguments[1],I=arguments[2],A=new Co(w,I),z=A.getResultGeometry(b);return z}}else if(arguments.length===4){var V=arguments[0],H=arguments[1],Z=arguments[2],D=arguments[3],k=new Co(V);k.setQuadrantSegments(Z),k.setEndCapStyle(D);var j=k.getResultGeometry(H);return j}};Co.precisionScaleFactor=function(e,r,n){var i=e.getEnvelopeInternal(),a=Ws.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),h=r>0?r:0,s=a+2*h,g=Math.trunc(Math.log(s)/Math.log(10)+1),m=n-g,w=Math.pow(10,m);return w};yg.CAP_ROUND.get=function(){return An.CAP_ROUND};yg.CAP_BUTT.get=function(){return An.CAP_FLAT};yg.CAP_FLAT.get=function(){return An.CAP_FLAT};yg.CAP_SQUARE.get=function(){return An.CAP_SQUARE};yg.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Co,yg);var rs=function(){this._pt=[new Le,new Le],this._distance=_r.NaN,this._isNull=!0};rs.prototype.getCoordinates=function(){return this._pt};rs.prototype.getCoordinate=function(e){return this._pt[e]};rs.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i<this._distance&&this.initialize(r,n,i)}};rs.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(r),this._distance=e.distance(r),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=a,this._isNull=!1}};rs.prototype.getDistance=function(){return this._distance};rs.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i>this._distance&&this.initialize(r,n,i)}};rs.prototype.interfaces_=function(){return[]};rs.prototype.getClass=function(){return rs};var Wl=function(){};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};Wl.computeDistance=function(){if(arguments[2]instanceof rs&&arguments[0]instanceof Ai&&arguments[1]instanceof Le)for(var e=arguments[0],r=arguments[1],n=arguments[2],i=e.getCoordinates(),a=new tr,h=0;h<i.length-1;h++){a.setCoordinates(i[h],i[h+1]);var s=a.closestPoint(r);n.setMinimum(s,r)}else if(arguments[2]instanceof rs&&arguments[0]instanceof ao&&arguments[1]instanceof Le){var g=arguments[0],m=arguments[1],w=arguments[2];Wl.computeDistance(g.getExteriorRing(),m,w);for(var b=0;b<g.getNumInteriorRing();b++)Wl.computeDistance(g.getInteriorRingN(b),m,w)}else if(arguments[2]instanceof rs&&arguments[0]instanceof ur&&arguments[1]instanceof Le){var I=arguments[0],A=arguments[1],z=arguments[2];if(I instanceof Ai)Wl.computeDistance(I,A,z);else if(I instanceof ao)Wl.computeDistance(I,A,z);else if(I instanceof as)for(var V=I,H=0;H<V.getNumGeometries();H++){var Z=V.getGeometryN(H);Wl.computeDistance(Z,A,z)}else z.setMinimum(I.getCoordinate(),A)}else if(arguments[2]instanceof rs&&arguments[0]instanceof tr&&arguments[1]instanceof Le){var D=arguments[0],k=arguments[1],j=arguments[2],Y=D.closestPoint(k);j.setMinimum(Y,k)}};var Dh=function(e){this._maxPtDist=new rs,this._inputGeom=e||null},wT={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Dh.prototype.computeMaxMidpointDistance=function(e){var r=new Ac(this._inputGeom);e.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())};Dh.prototype.computeMaxVertexDistance=function(e){var r=new tp(this._inputGeom);e.apply(r),this._maxPtDist.setMaximum(r.getMaxPointDistance())};Dh.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Dh.prototype.getDistancePoints=function(){return this._maxPtDist};Dh.prototype.interfaces_=function(){return[]};Dh.prototype.getClass=function(){return Dh};wT.MaxPointDistanceFilter.get=function(){return tp};wT.MaxMidpointDistanceFilter.get=function(){return Ac};Object.defineProperties(Dh,wT);var tp=function(e){this._maxPtDist=new rs,this._minPtDist=new rs,this._geom=e||null};tp.prototype.filter=function(e){this._minPtDist.initialize(),Wl.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};tp.prototype.getMaxPointDistance=function(){return this._maxPtDist};tp.prototype.interfaces_=function(){return[nu]};tp.prototype.getClass=function(){return tp};var Ac=function(e){this._maxPtDist=new rs,this._minPtDist=new rs,this._geom=e||null};Ac.prototype.filter=function(e,r){if(r===0)return null;var n=e.getCoordinate(r-1),i=e.getCoordinate(r),a=new Le((n.x+i.x)/2,(n.y+i.y)/2);this._minPtDist.initialize(),Wl.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ac.prototype.isDone=function(){return!1};Ac.prototype.isGeometryChanged=function(){return!1};Ac.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ac.prototype.interfaces_=function(){return[Ra]};Ac.prototype.getClass=function(){return Ac};var ku=function(e){this._comps=e||null};ku.prototype.filter=function(e){e instanceof ao&&this._comps.add(e)};ku.prototype.interfaces_=function(){return[hl]};ku.prototype.getClass=function(){return ku};ku.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return ku.getPolygons(e,new At)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r instanceof ao?n.add(r):r instanceof as&&r.apply(new ku(n)),n}};var Po=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._lines=r,this._isForcedToLineString=n}};Po.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof iu){var r=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(r),null}e instanceof Ai&&this._lines.add(e)};Po.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};Po.prototype.interfaces_=function(){return[Uu]};Po.prototype.getClass=function(){return Po};Po.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(Po.getLines(e))}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r.getFactory().buildGeometry(Po.getLines(r,n))}};Po.getLines=function(){if(arguments.length===1){var e=arguments[0];return Po.getLines(e,!1)}else if(arguments.length===2){if(cr(arguments[0],to)&&cr(arguments[1],to)){for(var r=arguments[0],n=arguments[1],i=r.iterator();i.hasNext();){var a=i.next();Po.getLines(a,n)}return n}else if(arguments[0]instanceof ur&&typeof arguments[1]=="boolean"){var h=arguments[0],s=arguments[1],g=new At;return h.apply(new Po(g,s)),g}else if(arguments[0]instanceof ur&&cr(arguments[1],to)){var m=arguments[0],w=arguments[1];return m instanceof Ai?w.add(m):m.apply(new Po(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&cr(arguments[0],to)&&cr(arguments[1],to)){for(var b=arguments[0],I=arguments[1],A=arguments[2],z=b.iterator();z.hasNext();){var V=z.next();Po.getLines(V,I,A)}return I}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof ur&&cr(arguments[1],to)){var H=arguments[0],Z=arguments[1],D=arguments[2];return H.apply(new Po(Z,D)),Z}}};var Ba=function(){if(this._boundaryRule=ya.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];if(e===null)throw new vi("Rule must be non-null");this._boundaryRule=e}}};Ba.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof Le&&arguments[1]instanceof ao){var r=arguments[0],n=arguments[1];if(n.isEmpty())return Ge.EXTERIOR;var i=n.getExteriorRing(),a=this.locateInPolygonRing(r,i);if(a===Ge.EXTERIOR)return Ge.EXTERIOR;if(a===Ge.BOUNDARY)return Ge.BOUNDARY;for(var h=0;h<n.getNumInteriorRing();h++){var s=n.getInteriorRingN(h),g=e.locateInPolygonRing(r,s);if(g===Ge.INTERIOR)return Ge.EXTERIOR;if(g===Ge.BOUNDARY)return Ge.BOUNDARY}return Ge.INTERIOR}else if(arguments[0]instanceof Le&&arguments[1]instanceof Ai){var m=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(m))return Ge.EXTERIOR;var b=w.getCoordinates();return!w.isClosed()&&(m.equals(b[0])||m.equals(b[b.length-1]))?Ge.BOUNDARY:Ft.isOnLine(m,b)?Ge.INTERIOR:Ge.EXTERIOR}else if(arguments[0]instanceof Le&&arguments[1]instanceof Ds){var I=arguments[0],A=arguments[1],z=A.getCoordinate();return z.equals2D(I)?Ge.INTERIOR:Ge.EXTERIOR}};Ba.prototype.locateInPolygonRing=function(e,r){return r.getEnvelopeInternal().intersects(e)?Ft.locatePointInRing(e,r.getCoordinates()):Ge.EXTERIOR};Ba.prototype.intersects=function(e,r){return this.locate(e,r)!==Ge.EXTERIOR};Ba.prototype.updateLocationInfo=function(e){e===Ge.INTERIOR&&(this._isIn=!0),e===Ge.BOUNDARY&&this._numBoundaries++};Ba.prototype.computeLocation=function(e,r){var n=this;if(r instanceof Ds&&this.updateLocationInfo(this.locateInternal(e,r)),r instanceof Ai)this.updateLocationInfo(this.locateInternal(e,r));else if(r instanceof ao)this.updateLocationInfo(this.locateInternal(e,r));else if(r instanceof Ch)for(var i=r,a=0;a<i.getNumGeometries();a++){var h=i.getGeometryN(a);n.updateLocationInfo(n.locateInternal(e,h))}else if(r instanceof tu)for(var s=r,g=0;g<s.getNumGeometries();g++){var m=s.getGeometryN(g);n.updateLocationInfo(n.locateInternal(e,m))}else if(r instanceof as)for(var w=new ru(r);w.hasNext();){var b=w.next();b!==r&&n.computeLocation(e,b)}};Ba.prototype.locate=function(e,r){return r.isEmpty()?Ge.EXTERIOR:r instanceof Ai?this.locateInternal(e,r):r instanceof ao?this.locateInternal(e,r):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,r),this._boundaryRule.isInBoundary(this._numBoundaries)?Ge.BOUNDARY:this._numBoundaries>0||this._isIn?Ge.INTERIOR:Ge.EXTERIOR)};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};var ns=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],r=arguments[1];t.call(this,e,t.INSIDE_AREA,r)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this._component=n,this._segIndex=i,this._pt=a}},FO={INSIDE_AREA:{configurable:!0}};ns.prototype.isInsideArea=function(){return this._segIndex===ns.INSIDE_AREA};ns.prototype.getCoordinate=function(){return this._pt};ns.prototype.getGeometryComponent=function(){return this._component};ns.prototype.getSegmentIndex=function(){return this._segIndex};ns.prototype.interfaces_=function(){return[]};ns.prototype.getClass=function(){return ns};FO.INSIDE_AREA.get=function(){return-1};Object.defineProperties(ns,FO);var vc=function(e){this._pts=e||null};vc.prototype.filter=function(e){e instanceof Ds&&this._pts.add(e)};vc.prototype.interfaces_=function(){return[hl]};vc.prototype.getClass=function(){return vc};vc.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Ds?Fa.singletonList(e):vc.getPoints(e,new At)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return r instanceof Ds?n.add(r):r instanceof as&&r.apply(new vc(n)),n}};var rp=function(){this._locations=null;var e=arguments[0];this._locations=e};rp.prototype.filter=function(e){(e instanceof Ds||e instanceof Ai||e instanceof ao)&&this._locations.add(new ns(e,0,e.getCoordinate()))};rp.prototype.interfaces_=function(){return[hl]};rp.prototype.getClass=function(){return rp};rp.getLocations=function(e){var r=new At;return e.apply(new rp(r)),r};var Do=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ba,this._minDistanceLocation=null,this._minDistance=_r.MAX_VALUE,arguments.length===2){var e=arguments[0],r=arguments[1];this._geom=[e,r],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=a}};Do.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var r=new Array(2).fill(null);if(this.computeContainmentDistance(0,r),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,r)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],a=1-n,h=ku.getPolygons(this._geom[n]);if(h.size()>0){var s=rp.getLocations(this._geom[a]);if(this.computeContainmentDistance(s,h,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=i[0],this._minDistanceLocation[n]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&cr(arguments[0],Da)&&cr(arguments[1],Da)){for(var g=arguments[0],m=arguments[1],w=arguments[2],b=0;b<g.size();b++)for(var I=g.get(b),A=0;A<m.size();A++)if(e.computeContainmentDistance(I,m.get(A),w),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof ns&&arguments[1]instanceof ao){var z=arguments[0],V=arguments[1],H=arguments[2],Z=z.getCoordinate();if(Ge.EXTERIOR!==this._ptLocator.locate(Z,V))return this._minDistance=0,H[0]=z,H[1]=new ns(V,Z),null}}};Do.prototype.computeMinDistanceLinesPoints=function(e,r,n){for(var i=this,a=0;a<e.size();a++)for(var h=e.get(a),s=0;s<r.size();s++){var g=r.get(s);if(i.computeMinDistance(h,g,n),i._minDistance<=i._terminateDistance)return null}};Do.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),r=Po.getLines(this._geom[0]),n=Po.getLines(this._geom[1]),i=vc.getPoints(this._geom[0]),a=vc.getPoints(this._geom[1]);if(this.computeMinDistanceLines(r,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,a,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,i,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(i,a,e),this.updateMinDistance(e,!1)};Do.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Do.prototype.updateMinDistance=function(e,r){if(e[0]===null)return null;r?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};Do.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};Do.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Ai&&arguments[1]instanceof Ds){var r=arguments[0],n=arguments[1],i=arguments[2];if(r.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var a=r.getCoordinates(),h=n.getCoordinate(),s=0;s<a.length-1;s++){var g=Ft.distancePointLine(h,a[s],a[s+1]);if(g<e._minDistance){e._minDistance=g;var m=new tr(a[s],a[s+1]),w=m.closestPoint(h);i[0]=new ns(r,s,w),i[1]=new ns(n,0,h)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ai&&arguments[1]instanceof Ai){var b=arguments[0],I=arguments[1],A=arguments[2];if(b.getEnvelopeInternal().distance(I.getEnvelopeInternal())>this._minDistance)return null;for(var z=b.getCoordinates(),V=I.getCoordinates(),H=0;H<z.length-1;H++)for(var Z=0;Z<V.length-1;Z++){var D=Ft.distanceLineLine(z[H],z[H+1],V[Z],V[Z+1]);if(D<e._minDistance){e._minDistance=D;var k=new tr(z[H],z[H+1]),j=new tr(V[Z],V[Z+1]),Y=k.closestPoints(j);A[0]=new ns(b,H,Y[0]),A[1]=new ns(I,Z,Y[1])}if(e._minDistance<=e._terminateDistance)return null}}}};Do.prototype.computeMinDistancePoints=function(e,r,n){for(var i=this,a=0;a<e.size();a++)for(var h=e.get(a),s=0;s<r.size();s++){var g=r.get(s),m=h.getCoordinate().distance(g.getCoordinate());if(m<i._minDistance&&(i._minDistance=m,n[0]=new ns(h,0,h.getCoordinate()),n[1]=new ns(g,0,g.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};Do.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new vi("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Do.prototype.computeMinDistanceLines=function(e,r,n){for(var i=this,a=0;a<e.size();a++)for(var h=e.get(a),s=0;s<r.size();s++){var g=r.get(s);if(i.computeMinDistance(h,g,n),i._minDistance<=i._terminateDistance)return null}};Do.prototype.interfaces_=function(){return[]};Do.prototype.getClass=function(){return Do};Do.distance=function(e,r){var n=new Do(e,r);return n.distance()};Do.isWithinDistance=function(e,r,n){var i=new Do(e,r,n);return i.distance()<=n};Do.nearestPoints=function(e,r){var n=new Do(e,r);return n.nearestPoints()};var Go=function(){this._pt=[new Le,new Le],this._distance=_r.NaN,this._isNull=!0};Go.prototype.getCoordinates=function(){return this._pt};Go.prototype.getCoordinate=function(e){return this._pt[e]};Go.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i<this._distance&&this.initialize(r,n,i)}};Go.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(r),this._distance=e.distance(r),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=a,this._isNull=!1}};Go.prototype.toString=function(){return Na.toLineString(this._pt[0],this._pt[1])};Go.prototype.getDistance=function(){return this._distance};Go.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var r=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(r,n),null;var i=r.distance(n);i>this._distance&&this.initialize(r,n,i)}};Go.prototype.interfaces_=function(){return[]};Go.prototype.getClass=function(){return Go};var il=function(){};il.prototype.interfaces_=function(){return[]};il.prototype.getClass=function(){return il};il.computeDistance=function(){if(arguments[2]instanceof Go&&arguments[0]instanceof Ai&&arguments[1]instanceof Le)for(var e=arguments[0],r=arguments[1],n=arguments[2],i=new tr,a=e.getCoordinates(),h=0;h<a.length-1;h++){i.setCoordinates(a[h],a[h+1]);var s=i.closestPoint(r);n.setMinimum(s,r)}else if(arguments[2]instanceof Go&&arguments[0]instanceof ao&&arguments[1]instanceof Le){var g=arguments[0],m=arguments[1],w=arguments[2];il.computeDistance(g.getExteriorRing(),m,w);for(var b=0;b<g.getNumInteriorRing();b++)il.computeDistance(g.getInteriorRingN(b),m,w)}else if(arguments[2]instanceof Go&&arguments[0]instanceof ur&&arguments[1]instanceof Le){var I=arguments[0],A=arguments[1],z=arguments[2];if(I instanceof Ai)il.computeDistance(I,A,z);else if(I instanceof ao)il.computeDistance(I,A,z);else if(I instanceof as)for(var V=I,H=0;H<V.getNumGeometries();H++){var Z=V.getGeometryN(H);il.computeDistance(Z,A,z)}else z.setMinimum(I.getCoordinate(),A)}else if(arguments[2]instanceof Go&&arguments[0]instanceof tr&&arguments[1]instanceof Le){var D=arguments[0],k=arguments[1],j=arguments[2],Y=D.closestPoint(k);j.setMinimum(Y,k)}};var pa=function(){this._g0=null,this._g1=null,this._ptDist=new Go,this._densifyFrac=0;var e=arguments[0],r=arguments[1];this._g0=e,this._g1=r},ET={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};pa.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};pa.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new vi("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};pa.prototype.compute=function(e,r){this.computeOrientedDistance(e,r,this._ptDist),this.computeOrientedDistance(r,e,this._ptDist)};pa.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};pa.prototype.computeOrientedDistance=function(e,r,n){var i=new np(r);if(e.apply(i),n.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var a=new Mc(r,this._densifyFrac);e.apply(a),n.setMaximum(a.getMaxPointDistance())}};pa.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};pa.distance=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],n=new pa(e,r);return n.distance()}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2],s=new pa(i,a);return s.setDensifyFraction(h),s.distance()}};ET.MaxPointDistanceFilter.get=function(){return np};ET.MaxDensifiedByFractionDistanceFilter.get=function(){return Mc};Object.defineProperties(pa,ET);var np=function(){this._maxPtDist=new Go,this._minPtDist=new Go,this._euclideanDist=new il,this._geom=null;var e=arguments[0];this._geom=e};np.prototype.filter=function(e){this._minPtDist.initialize(),il.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};np.prototype.getMaxPointDistance=function(){return this._maxPtDist};np.prototype.interfaces_=function(){return[nu]};np.prototype.getClass=function(){return np};var Mc=function(){this._maxPtDist=new Go,this._minPtDist=new Go,this._geom=null,this._numSubSegs=0;var e=arguments[0],r=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/r))};Mc.prototype.filter=function(e,r){var n=this;if(r===0)return null;for(var i=e.getCoordinate(r-1),a=e.getCoordinate(r),h=(a.x-i.x)/this._numSubSegs,s=(a.y-i.y)/this._numSubSegs,g=0;g<this._numSubSegs;g++){var m=i.x+g*h,w=i.y+g*s,b=new Le(m,w);n._minPtDist.initialize(),il.computeDistance(n._geom,b,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Mc.prototype.isDone=function(){return!1};Mc.prototype.isGeometryChanged=function(){return!1};Mc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Mc.prototype.interfaces_=function(){return[Ra]};Mc.prototype.getClass=function(){return Mc};var Os=function(e,r,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=r||null,this._result=n||null},bT={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Os.prototype.checkMaximumDistance=function(e,r,n){var i=new pa(r,e);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var a=i.getCoordinates();this._errorLocation=a[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Na.toLineString(a[0],a[1])+")"}};Os.prototype.isValid=function(){var e=Math.abs(this._bufDistance),r=Os.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-r,this._maxValidDistance=e+r,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Os.VERBOSE&&Oo.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Os.prototype.checkNegativeValid=function(){if(!(this._input instanceof ao||this._input instanceof tu||this._input instanceof as))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Os.prototype.getErrorIndicator=function(){return this._errorIndicator};Os.prototype.checkMinimumDistance=function(e,r,n){var i=new Do(e,r,n);if(this._minDistanceFound=i.distance(),this._minDistanceFound<n){this._isValid=!1;var a=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Na.toLineString(a[0],a[1])+" )"}};Os.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Os.prototype.getErrorLocation=function(){return this._errorLocation};Os.prototype.getPolygonLines=function(e){for(var r=new At,n=new Po(r),i=ku.getPolygons(e),a=i.iterator();a.hasNext();){var h=a.next();h.apply(n)}return e.getFactory().buildGeometry(r)};Os.prototype.getErrorMessage=function(){return this._errMsg};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};bT.VERBOSE.get=function(){return!1};bT.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Os,bT);var No=function(e,r,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=r||null,this._result=n||null},TT={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};No.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};No.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*No.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var r=new Yt(this._input.getEnvelopeInternal());r.expandBy(this._distance);var n=new Yt(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(r)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};No.prototype.checkDistance=function(){var e=new Os(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};No.prototype.checkArea=function(){var e=this._input.getArea(),r=this._result.getArea();this._distance>0&&e>r&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<r&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};No.prototype.checkPolygonal=function(){this._result instanceof ao||this._result instanceof tu||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};No.prototype.getErrorIndicator=function(){return this._errorIndicator};No.prototype.getErrorLocation=function(){return this._errorLocation};No.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};No.prototype.report=function(e){if(!No.VERBOSE)return null;Oo.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};No.prototype.getErrorMessage=function(){return this._errorMsg};No.prototype.interfaces_=function(){return[]};No.prototype.getClass=function(){return No};No.isValidMsg=function(e,r,n){var i=new No(e,r,n);return i.isValid()?null:i.getErrorMessage()};No.isValid=function(e,r,n){var i=new No(e,r,n);return!!i.isValid()};TT.VERBOSE.get=function(){return!1};TT.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(No,TT);var yl=function(){this._pts=null,this._data=null;var e=arguments[0],r=arguments[1];this._pts=e,this._data=r};yl.prototype.getCoordinates=function(){return this._pts};yl.prototype.size=function(){return this._pts.length};yl.prototype.getCoordinate=function(e){return this._pts[e]};yl.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};yl.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Jf.octant(this.getCoordinate(e),this.getCoordinate(e+1))};yl.prototype.setData=function(e){this._data=e};yl.prototype.getData=function(){return this._data};yl.prototype.toString=function(){return Na.toLineString(new Ni(this._pts))};yl.prototype.interfaces_=function(){return[su]};yl.prototype.getClass=function(){return yl};var go=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new At,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};go.prototype.getInteriorIntersection=function(){return this._interiorIntersection};go.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};go.prototype.getIntersectionSegments=function(){return this._intSegments};go.prototype.count=function(){return this._intersectionCount};go.prototype.getIntersections=function(){return this._intersections};go.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};go.prototype.setKeepIntersections=function(e){this._keepIntersections=e};go.prototype.processIntersections=function(e,r,n,i){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&r===i)return null;if(this._isCheckEndSegmentsOnly){var a=this.isEndSegment(e,r)||this.isEndSegment(n,i);if(!a)return null}var h=e.getCoordinates()[r],s=e.getCoordinates()[r+1],g=n.getCoordinates()[i],m=n.getCoordinates()[i+1];this._li.computeIntersection(h,s,g,m),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=h,this._intSegments[1]=s,this._intSegments[2]=g,this._intSegments[3]=m,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};go.prototype.isEndSegment=function(e,r){return r===0||r>=e.size()-2};go.prototype.hasIntersection=function(){return this._interiorIntersection!==null};go.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};go.prototype.interfaces_=function(){return[Lh]};go.prototype.getClass=function(){return go};go.createAllIntersectionsFinder=function(e){var r=new go(e);return r.setFindAllIntersections(!0),r};go.createAnyIntersectionFinder=function(e){return new go(e)};go.createIntersectionCounter=function(e){var r=new go(e);return r.setFindAllIntersections(!0),r.setKeepIntersections(!1),r};var Ua=function(){this._li=new zh,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Ua.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ua.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ua.prototype.isValid=function(){return this.execute(),this._isValid};Ua.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Ua.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new go(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new xT;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ua.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Gu(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ua.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Na.toLineString(e[0],e[1])+" and "+Na.toLineString(e[2],e[3])};Ua.prototype.interfaces_=function(){return[]};Ua.prototype.getClass=function(){return Ua};Ua.computeIntersections=function(e){var r=new Ua(e);return r.setFindAllIntersections(!0),r.isValid(),r.getIntersections()};var Nh=function t(){this._nv=null;var e=arguments[0];this._nv=new Ua(t.toSegmentStrings(e))};Nh.prototype.checkValid=function(){this._nv.checkValid()};Nh.prototype.interfaces_=function(){return[]};Nh.prototype.getClass=function(){return Nh};Nh.toSegmentStrings=function(e){for(var r=new At,n=e.iterator();n.hasNext();){var i=n.next();r.add(new yl(i.getCoordinates(),i))}return r};Nh.checkValid=function(e){var r=new Nh(e);r.checkValid()};var ip=function(e){this._mapOp=e};ip.prototype.map=function(e){for(var r=this,n=new At,i=0;i<e.getNumGeometries();i++){var a=r._mapOp.map(e.getGeometryN(i));a.isEmpty()||n.add(a)}return e.getFactory().createGeometryCollection(zr.toGeometryArray(n))};ip.prototype.interfaces_=function(){return[]};ip.prototype.getClass=function(){return ip};ip.map=function(e,r){var n=new ip(r);return n.map(e)};var _l=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new At,this._resultLineList=new At;var e=arguments[0],r=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=r,this._ptLocator=n};_l.prototype.collectLines=function(e){for(var r=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();r.collectLineEdge(i,e,r._lineEdgesList),r.collectBoundaryTouchEdge(i,e,r._lineEdgesList)}};_l.prototype.labelIsolatedLine=function(e,r){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(r));e.getLabel().setLocation(r,n)};_l.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};_l.prototype.collectLineEdge=function(e,r,n){var i=e.getLabel(),a=e.getEdge();e.isLineEdge()&&!e.isVisited()&&Pr.isResultOfOp(i,r)&&!a.isCovered()&&(n.add(a),e.setVisitedEdge(!0))};_l.prototype.findCoveredLineEdges=function(){for(var e=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();n.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var a=i.next(),h=a.getEdge();if(a.isLineEdge()&&!h.isCoveredSet()){var s=e._op.isCoveredByA(a.getCoordinate());h.setCovered(s)}}};_l.prototype.labelIsolatedLines=function(e){for(var r=this,n=e.iterator();n.hasNext();){var i=n.next(),a=i.getLabel();i.isIsolated()&&(a.isNull(0)?r.labelIsolatedLine(i,0):r.labelIsolatedLine(i,1))}};_l.prototype.buildLines=function(e){for(var r=this,n=this._lineEdgesList.iterator();n.hasNext();){var i=n.next(),a=r._geometryFactory.createLineString(i.getCoordinates());r._resultLineList.add(a),i.setInResult(!0)}};_l.prototype.collectBoundaryTouchEdge=function(e,r,n){var i=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;Cr.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),Pr.isResultOfOp(i,r)&&r===Pr.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};var op=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new At;var e=arguments[0],r=arguments[1];this._op=e,this._geometryFactory=r};op.prototype.filterCoveredNodeToPoint=function(e){var r=e.getCoordinate();if(!this._op.isCoveredByLA(r)){var n=this._geometryFactory.createPoint(r);this._resultPointList.add(n)}};op.prototype.extractNonCoveredResultNodes=function(e){for(var r=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||e===Pr.INTERSECTION)){var a=i.getLabel();Pr.isResultOfOp(a,e)&&r.filterCoveredNodeToPoint(i)}}};op.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};op.prototype.interfaces_=function(){return[]};op.prototype.getClass=function(){return op};var xs=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};xs.prototype.transformPoint=function(e,r){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};xs.prototype.transformPolygon=function(e,r){var n=this,i=!0,a=this.transformLinearRing(e.getExteriorRing(),e);(a===null||!(a instanceof iu)||a.isEmpty())&&(i=!1);for(var h=new At,s=0;s<e.getNumInteriorRing();s++){var g=n.transformLinearRing(e.getInteriorRingN(s),e);g===null||g.isEmpty()||(g instanceof iu||(i=!1),h.add(g))}if(i)return this._factory.createPolygon(a,h.toArray([]));var m=new At;return a!==null&&m.add(a),m.addAll(h),this._factory.buildGeometry(m)};xs.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};xs.prototype.getInputGeometry=function(){return this._inputGeom};xs.prototype.transformMultiLineString=function(e,r){for(var n=this,i=new At,a=0;a<e.getNumGeometries();a++){var h=n.transformLineString(e.getGeometryN(a),e);h!==null&&(h.isEmpty()||i.add(h))}return this._factory.buildGeometry(i)};xs.prototype.transformCoordinates=function(e,r){return this.copy(e)};xs.prototype.transformLineString=function(e,r){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};xs.prototype.transformMultiPoint=function(e,r){for(var n=this,i=new At,a=0;a<e.getNumGeometries();a++){var h=n.transformPoint(e.getGeometryN(a),e);h!==null&&(h.isEmpty()||i.add(h))}return this._factory.buildGeometry(i)};xs.prototype.transformMultiPolygon=function(e,r){for(var n=this,i=new At,a=0;a<e.getNumGeometries();a++){var h=n.transformPolygon(e.getGeometryN(a),e);h!==null&&(h.isEmpty()||i.add(h))}return this._factory.buildGeometry(i)};xs.prototype.copy=function(e){return e.copy()};xs.prototype.transformGeometryCollection=function(e,r){for(var n=this,i=new At,a=0;a<e.getNumGeometries();a++){var h=n.transform(e.getGeometryN(a));h!==null&&(n._pruneEmptyGeometry&&h.isEmpty()||i.add(h))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(zr.toGeometryArray(i)):this._factory.buildGeometry(i)};xs.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Ds)return this.transformPoint(e,null);if(e instanceof Hd)return this.transformMultiPoint(e,null);if(e instanceof iu)return this.transformLinearRing(e,null);if(e instanceof Ai)return this.transformLineString(e,null);if(e instanceof Ch)return this.transformMultiLineString(e,null);if(e instanceof ao)return this.transformPolygon(e,null);if(e instanceof tu)return this.transformMultiPolygon(e,null);if(e instanceof as)return this.transformGeometryCollection(e,null);throw new vi("Unknown Geometry subtype: "+e.getClass().getName())};xs.prototype.transformLinearRing=function(e,r){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};xs.prototype.interfaces_=function(){return[]};xs.prototype.getClass=function(){return xs};var uu=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new tr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Ai&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];t.call(this,e.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this._srcPts=n,this._isClosed=t.isClosed(n),this._snapTolerance=i}};uu.prototype.snapVertices=function(e,r){for(var n=this,i=this._isClosed?e.size()-1:e.size(),a=0;a<i;a++){var h=e.get(a),s=n.findSnapForVertex(h,r);s!==null&&(e.set(a,new Le(s)),a===0&&n._isClosed&&e.set(e.size()-1,new Le(s)))}};uu.prototype.findSnapForVertex=function(e,r){for(var n=this,i=0;i<r.length;i++){if(e.equals2D(r[i]))return null;if(e.distance(r[i])<n._snapTolerance)return r[i]}return null};uu.prototype.snapTo=function(e){var r=new l_(this._srcPts);this.snapVertices(r,e),this.snapSegments(r,e);var n=r.toCoordinateArray();return n};uu.prototype.snapSegments=function(e,r){var n=this;if(r.length===0)return null;var i=r.length;r[0].equals2D(r[r.length-1])&&(i=r.length-1);for(var a=0;a<i;a++){var h=r[a],s=n.findSegmentIndexToSnap(h,e);s>=0&&e.add(s+1,new Le(h),!1)}};uu.prototype.findSegmentIndexToSnap=function(e,r){for(var n=this,i=_r.MAX_VALUE,a=-1,h=0;h<r.size()-1;h++){if(n._seg.p0=r.get(h),n._seg.p1=r.get(h+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var s=n._seg.distance(e);s<n._snapTolerance&&s<i&&(i=s,a=h)}return a};uu.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};uu.prototype.interfaces_=function(){return[]};uu.prototype.getClass=function(){return uu};uu.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var Ri=function(e){this._srcGeom=e||null},zO={SNAP_PRECISION_FACTOR:{configurable:!0}};Ri.prototype.snapTo=function(e,r){var n=this.extractTargetCoordinates(e),i=new BO(r,n);return i.transform(this._srcGeom)};Ri.prototype.snapToSelf=function(e,r){var n=this.extractTargetCoordinates(this._srcGeom),i=new BO(e,n,!0),a=i.transform(this._srcGeom),h=a;return r&&cr(h,Tc)&&(h=a.buffer(0)),h};Ri.prototype.computeSnapTolerance=function(e){var r=this.computeMinimumSegmentLength(e),n=r/10;return n};Ri.prototype.extractTargetCoordinates=function(e){for(var r=new cl,n=e.getCoordinates(),i=0;i<n.length;i++)r.add(n[i]);return r.toArray(new Array(0).fill(null))};Ri.prototype.computeMinimumSegmentLength=function(e){for(var r=_r.MAX_VALUE,n=0;n<e.length-1;n++){var i=e[n].distance(e[n+1]);i<r&&(r=i)}return r};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};Ri.snap=function(e,r,n){var i=new Array(2).fill(null),a=new Ri(e);i[0]=a.snapTo(r,n);var h=new Ri(r);return i[1]=h.snapTo(i[0],n),i};Ri.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],r=Ri.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===Mn.FIXED){var i=1/n.getScale()*2/1.415;i>r&&(r=i)}return r}else if(arguments.length===2){var a=arguments[0],h=arguments[1];return Math.min(Ri.computeOverlaySnapTolerance(a),Ri.computeOverlaySnapTolerance(h))}};Ri.computeSizeBasedSnapTolerance=function(e){var r=e.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth()),i=n*Ri.SNAP_PRECISION_FACTOR;return i};Ri.snapToSelf=function(e,r,n){var i=new Ri(e);return i.snapToSelf(r,n)};zO.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Ri,zO);var BO=function(t){function e(r,n,i){t.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,i){var a=new uu(n,this._snapTolerance);return a.setAllowSnappingToSourceVertices(this._isSelfSnap),a.snapTo(i)},e.prototype.transformCoordinates=function(n,i){var a=n.toCoordinateArray(),h=this.snapLine(a,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xs),ts=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};ts.prototype.getCommon=function(){return _r.longBitsToDouble(this._commonBits)};ts.prototype.add=function(e){var r=_r.doubleToLongBits(e);if(this._isFirst)return this._commonBits=r,this._commonSignExp=ts.signExpBits(this._commonBits),this._isFirst=!1,null;var n=ts.signExpBits(r);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=ts.numCommonMostSigMantissaBits(this._commonBits,r),this._commonBits=ts.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};ts.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],r=_r.longBitsToDouble(e),n=_r.toBinaryString(e),i="0000000000000000000000000000000000000000000000000000000000000000"+n,a=i.substring(i.length-64),h=a.substring(0,1)+"  "+a.substring(1,12)+"(exp) "+a.substring(12)+" [ "+r+" ]";return h}};ts.prototype.interfaces_=function(){return[]};ts.prototype.getClass=function(){return ts};ts.getBit=function(e,r){var n=1<<r;return e&n?1:0};ts.signExpBits=function(e){return e>>52};ts.zeroLowerBits=function(e,r){var n=(1<<r)-1,i=~n,a=e&i;return a};ts.numCommonMostSigMantissaBits=function(e,r){for(var n=0,i=52;i>=0;i--){if(ts.getBit(e,i)!==ts.getBit(r,i))return n;n++}return 52};var Lc=function(){this._commonCoord=null,this._ccFilter=new sp},ST={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Lc.prototype.addCommonBits=function(e){var r=new Oc(this._commonCoord);e.apply(r),e.geometryChanged()};Lc.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var r=new Le(this._commonCoord);r.x=-r.x,r.y=-r.y;var n=new Oc(r);return e.apply(n),e.geometryChanged(),e};Lc.prototype.getCommonCoordinate=function(){return this._commonCoord};Lc.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Lc.prototype.interfaces_=function(){return[]};Lc.prototype.getClass=function(){return Lc};ST.CommonCoordinateFilter.get=function(){return sp};ST.Translater.get=function(){return Oc};Object.defineProperties(Lc,ST);var sp=function(){this._commonBitsX=new ts,this._commonBitsY=new ts};sp.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};sp.prototype.getCommonCoordinate=function(){return new Le(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};sp.prototype.interfaces_=function(){return[nu]};sp.prototype.getClass=function(){return sp};var Oc=function(){this.trans=null;var e=arguments[0];this.trans=e};Oc.prototype.filter=function(e,r){var n=e.getOrdinate(r,0)+this.trans.x,i=e.getOrdinate(r,1)+this.trans.y;e.setOrdinate(r,0,n),e.setOrdinate(r,1,i)};Oc.prototype.isDone=function(){return!1};Oc.prototype.isGeometryChanged=function(){return!0};Oc.prototype.interfaces_=function(){return[Ra]};Oc.prototype.getClass=function(){return Oc};var mo=function(e,r){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=r,this.computeSnapTolerance()};mo.prototype.selfSnap=function(e){var r=new Ri(e),n=r.snapTo(e,this._snapTolerance);return n};mo.prototype.removeCommonBits=function(e){this._cbr=new Lc,this._cbr.add(e[0]),this._cbr.add(e[1]);var r=new Array(2).fill(null);return r[0]=this._cbr.removeCommonBits(e[0].copy()),r[1]=this._cbr.removeCommonBits(e[1].copy()),r};mo.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};mo.prototype.getResultGeometry=function(e){var r=this.snap(this._geom),n=Pr.overlayOp(r[0],r[1],e);return this.prepareResult(n)};mo.prototype.checkValid=function(e){e.isValid()||Oo.out.println("Snapped geometry is invalid")};mo.prototype.computeSnapTolerance=function(){this._snapTolerance=Ri.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};mo.prototype.snap=function(e){var r=this.removeCommonBits(e),n=Ri.snap(r[0],r[1],this._snapTolerance);return n};mo.prototype.interfaces_=function(){return[]};mo.prototype.getClass=function(){return mo};mo.overlayOp=function(e,r,n){var i=new mo(e,r);return i.getResultGeometry(n)};mo.union=function(e,r){return mo.overlayOp(e,r,Pr.UNION)};mo.intersection=function(e,r){return mo.overlayOp(e,r,Pr.INTERSECTION)};mo.symDifference=function(e,r){return mo.overlayOp(e,r,Pr.SYMDIFFERENCE)};mo.difference=function(e,r){return mo.overlayOp(e,r,Pr.DIFFERENCE)};var cs=function(e,r){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=r};cs.prototype.getResultGeometry=function(e){var r=null,n=!1,i=null;try{r=Pr.overlayOp(this._geom[0],this._geom[1],e);var a=!0;a&&(n=!0)}catch(h){if(h instanceof Bu)i=h;else throw h}finally{}if(!n)try{r=mo.overlayOp(this._geom[0],this._geom[1],e)}catch(h){throw h instanceof Bu?i:h}finally{}return r};cs.prototype.interfaces_=function(){return[]};cs.prototype.getClass=function(){return cs};cs.overlayOp=function(e,r,n){var i=new cs(e,r);return i.getResultGeometry(n)};cs.union=function(e,r){return cs.overlayOp(e,r,Pr.UNION)};cs.intersection=function(e,r){return cs.overlayOp(e,r,Pr.INTERSECTION)};cs.symDifference=function(e,r){return cs.overlayOp(e,r,Pr.SYMDIFFERENCE)};cs.difference=function(e,r){return cs.overlayOp(e,r,Pr.DIFFERENCE)};var Ky=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],r=arguments[1];this.mce=e,this.chainIndex=r};Ky.prototype.computeIntersections=function(e,r){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,r)};Ky.prototype.interfaces_=function(){return[]};Ky.prototype.getClass=function(){return Ky};var ks=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],r=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=r}else if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=i,this._obj=a}},IT={INSERT:{configurable:!0},DELETE:{configurable:!0}};ks.prototype.isDelete=function(){return this._eventType===ks.DELETE};ks.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};ks.prototype.getObject=function(){return this._obj};ks.prototype.compareTo=function(e){var r=e;return this._xValue<r._xValue?-1:this._xValue>r._xValue?1:this._eventType<r._eventType?-1:this._eventType>r._eventType?1:0};ks.prototype.getInsertEvent=function(){return this._insertEvent};ks.prototype.isInsert=function(){return this._eventType===ks.INSERT};ks.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};ks.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ks.prototype.interfaces_=function(){return[Ea]};ks.prototype.getClass=function(){return ks};IT.INSERT.get=function(){return 1};IT.DELETE.get=function(){return 2};Object.defineProperties(ks,IT);var U0=function(){};U0.prototype.interfaces_=function(){return[]};U0.prototype.getClass=function(){return U0};var Ro=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._li=e,this._includeProper=r,this._recordIsolated=n};Ro.prototype.isTrivialIntersection=function(e,r,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Ro.isAdjacentSegments(r,i))return!0;if(e.isClosed()){var a=e.getNumPoints()-1;if(r===0&&i===a||i===0&&r===a)return!0}}return!1};Ro.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ro.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Ro.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ro.prototype.isBoundaryPointInternal=function(e,r){for(var n=r.iterator();n.hasNext();){var i=n.next(),a=i.getCoordinate();if(e.isIntersection(a))return!0}return!1};Ro.prototype.hasProperIntersection=function(){return this._hasProper};Ro.prototype.hasIntersection=function(){return this._hasIntersection};Ro.prototype.isDone=function(){return this._isDone};Ro.prototype.isBoundaryPoint=function(e,r){return r===null?!1:!!(this.isBoundaryPointInternal(e,r[0])||this.isBoundaryPointInternal(e,r[1]))};Ro.prototype.setBoundaryNodes=function(e,r){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=r};Ro.prototype.addIntersections=function(e,r,n,i){if(e===n&&r===i)return null;this.numTests++;var a=e.getCoordinates()[r],h=e.getCoordinates()[r+1],s=n.getCoordinates()[i],g=n.getCoordinates()[i+1];this._li.computeIntersection(a,h,s,g),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,r,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,r,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.isAdjacentSegments=function(e,r){return Math.abs(e-r)===1};var a7=function(t){function e(){t.call(this),this.events=new At,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;Fa.sort(this.events);for(var i=0;i<this.events.size();i++){var a=n.events.get(i);a.isDelete()&&a.getInsertEvent().setDeleteEventIndex(i)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var a=0;a<this.events.size();a++){var h=n.events.get(a);if(h.isInsert()&&n.processOverlaps(a,h.getDeleteEventIndex(),h,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Ro&&cr(arguments[0],Da)&&cr(arguments[1],Da)){var s=arguments[0],g=arguments[1],m=arguments[2];this.addEdges(s,s),this.addEdges(g,g),this.computeIntersections(m)}else if(typeof arguments[2]=="boolean"&&cr(arguments[0],Da)&&arguments[1]instanceof Ro){var w=arguments[0],b=arguments[1],I=arguments[2];I?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(b)}}},e.prototype.addEdge=function(n,i){for(var a=this,h=n.getMonotoneChainEdge(),s=h.getStartIndexes(),g=0;g<s.length-1;g++){var m=new Ky(h,g),w=new ks(i,h.getMinX(g),m);a.events.add(w),a.events.add(new ks(h.getMaxX(g),w))}},e.prototype.processOverlaps=function(n,i,a,h){for(var s=this,g=a.getObject(),m=n;m<i;m++){var w=s.events.get(m);if(w.isInsert()){var b=w.getObject();a.isSameLabel(w)||(g.computeIntersections(b,h),s.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var i=arguments[0],a=i.iterator();a.hasNext();){var h=a.next();n.addEdge(h,h)}else if(arguments.length===2)for(var s=arguments[0],g=arguments[1],m=s.iterator();m.hasNext();){var w=m.next();n.addEdge(w,g)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(U0),cu=function(){this._min=_r.POSITIVE_INFINITY,this._max=_r.NEGATIVE_INFINITY},UO={NodeComparator:{configurable:!0}};cu.prototype.getMin=function(){return this._min};cu.prototype.intersects=function(e,r){return!(this._min>r||this._max<e)};cu.prototype.getMax=function(){return this._max};cu.prototype.toString=function(){return Na.toLineString(new Le(this._min,0),new Le(this._max,0))};cu.prototype.interfaces_=function(){return[]};cu.prototype.getClass=function(){return cu};UO.NodeComparator.get=function(){return Yy};Object.defineProperties(cu,UO);var Yy=function(){};Yy.prototype.compare=function(e,r){var n=e,i=r,a=(n._min+n._max)/2,h=(i._min+i._max)/2;return a<h?-1:a>h?1:0};Yy.prototype.interfaces_=function(){return[Vd]};Yy.prototype.getClass=function(){return Yy};var l7=function(t){function e(){t.call(this),this._item=null;var r=arguments[0],n=arguments[1],i=arguments[2];this._min=r,this._max=n,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,i,a){if(!this.intersects(n,i))return null;a.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cu),u7=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,i){this._min=Math.min(n._min,i._min),this._max=Math.max(n._max,i._max)},e.prototype.query=function(n,i,a){if(!this.intersects(n,i))return null;this._node1!==null&&this._node1.query(n,i,a),this._node2!==null&&this._node2.query(n,i,a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cu),hu=function(){this._leaves=new At,this._root=null,this._level=0};hu.prototype.buildTree=function(){var e=this;Fa.sort(this._leaves,new cu.NodeComparator);for(var r=this._leaves,n=null,i=new At;;){if(e.buildLevel(r,i),i.size()===1)return i.get(0);n=r,r=i,i=n}};hu.prototype.insert=function(e,r,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new l7(e,r,n))};hu.prototype.query=function(e,r,n){this.init(),this._root.query(e,r,n)};hu.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};hu.prototype.printNode=function(e){Oo.out.println(Na.toLineString(new Le(e._min,this._level),new Le(e._max,this._level)))};hu.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};hu.prototype.buildLevel=function(e,r){this._level++,r.clear();for(var n=0;n<e.size();n+=2){var i=e.get(n),a=n+1<e.size()?e.get(n):null;if(a===null)r.add(i);else{var h=new u7(e.get(n),e.get(n+1));r.add(h)}}};hu.prototype.interfaces_=function(){return[]};hu.prototype.getClass=function(){return hu};var tg=function(){this._items=new At};tg.prototype.visitItem=function(e){this._items.add(e)};tg.prototype.getItems=function(){return this._items};tg.prototype.interfaces_=function(){return[Sc]};tg.prototype.getClass=function(){return tg};var rg=function(){this._index=null;var e=arguments[0];if(!cr(e,Tc))throw new vi("Argument must be Polygonal");this._index=new Rh(e)},PT={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};rg.prototype.locate=function(e){var r=new sl(e),n=new ng(r);return this._index.query(e.y,e.y,n),r.getLocation()};rg.prototype.interfaces_=function(){return[Qd]};rg.prototype.getClass=function(){return rg};PT.SegmentVisitor.get=function(){return ng};PT.IntervalIndexedGeometry.get=function(){return Rh};Object.defineProperties(rg,PT);var ng=function(){this._counter=null;var e=arguments[0];this._counter=e};ng.prototype.visitItem=function(e){var r=e;this._counter.countSegment(r.getCoordinate(0),r.getCoordinate(1))};ng.prototype.interfaces_=function(){return[Sc]};ng.prototype.getClass=function(){return ng};var Rh=function(){this._index=new hu;var e=arguments[0];this.init(e)};Rh.prototype.init=function(e){for(var r=this,n=Po.getLines(e),i=n.iterator();i.hasNext();){var a=i.next(),h=a.getCoordinates();r.addLine(h)}};Rh.prototype.addLine=function(e){for(var r=this,n=1;n<e.length;n++){var i=new tr(e[n-1],e[n]),a=Math.min(i.p0.y,i.p1.y),h=Math.max(i.p0.y,i.p1.y);r._index.insert(a,h,i)}};Rh.prototype.query=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],n=new tg;return this._index.query(e,r,n),n.getItems()}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];this._index.query(i,a,h)}};Rh.prototype.interfaces_=function(){return[]};Rh.prototype.getClass=function(){return Rh};var oy=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new bO,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ba,arguments.length===2){var r=arguments[0],n=arguments[1],i=ya.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=i,n!==null&&this.add(n)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],s=arguments[2];this._argIndex=a,this._parentGeom=h,this._boundaryNodeRule=s,h!==null&&this.add(h)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,i){var a=this._nodes.addNode(i),h=a.getLabel(),s=1,g=Ge.NONE;g=h.getLocation(n,Et.ON),g===Ge.BOUNDARY&&s++;var m=e.determineBoundary(this._boundaryNodeRule,s);h.setLocation(n,m)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.computeSelfNodes(n,i,!1)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],s=arguments[2],g=new Ro(a,!0,!1);g.setIsDoneIfProperInt(s);var m=this.createEdgeSetIntersector(),w=this._parentGeom instanceof iu||this._parentGeom instanceof ao||this._parentGeom instanceof tu,b=h||!w;return m.computeIntersections(this._edges,g,b),this.addSelfIntersectionNodes(this._argIndex),g}},e.prototype.computeSplitEdges=function(n){for(var i=this._edges.iterator();i.hasNext();){var a=i.next();a.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,i,a){var h=new Ro(i,a,!0);h.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var s=this.createEdgeSetIntersector();return s.computeIntersections(this._edges,n._edges,h),h},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Ds){var n=arguments[0],i=n.getCoordinate();this.insertPoint(this._argIndex,i,Ge.INTERIOR)}else if(arguments[0]instanceof Le){var a=arguments[0];this.insertPoint(this._argIndex,a,Ge.INTERIOR)}},e.prototype.addPolygon=function(n){var i=this;this.addPolygonRing(n.getExteriorRing(),Ge.EXTERIOR,Ge.INTERIOR);for(var a=0;a<n.getNumInteriorRing();a++){var h=n.getInteriorRingN(a);i.addPolygonRing(h,Ge.INTERIOR,Ge.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var i=n.getCoordinates();this.insertPoint(this._argIndex,i[0],Ge.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],Ge.BOUNDARY)},e.prototype.addLineString=function(n){var i=Br.removeRepeatedPoints(n.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var a=new B0(i,new zn(this._argIndex,Ge.INTERIOR));this._lineEdgeMap.put(n,a),this.insertEdge(a),Cr.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),i=new Array(n.size()).fill(null),a=0,h=n.iterator();h.hasNext();){var s=h.next();i[a++]=s.getCoordinate().copy()}return i},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,i,a){if(this.isBoundaryNode(n,i))return null;a===Ge.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,i):this.insertPoint(n,i,a)},e.prototype.addPolygonRing=function(n,i,a){if(n.isEmpty())return null;var h=Br.removeRepeatedPoints(n.getCoordinates());if(h.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=h[0],null;var s=i,g=a;Ft.isCCW(h)&&(s=a,g=i);var m=new B0(h,new zn(this._argIndex,Ge.BOUNDARY,s,g));this._lineEdgeMap.put(n,m),this.insertEdge(m),this.insertPoint(this._argIndex,h[0],Ge.BOUNDARY)},e.prototype.insertPoint=function(n,i,a){var h=this._nodes.addNode(i),s=h.getLabel();s===null?h._label=new zn(n,a):s.setLocation(n,a)},e.prototype.createEdgeSetIntersector=function(){return new a7},e.prototype.addSelfIntersectionNodes=function(n){for(var i=this,a=this._edges.iterator();a.hasNext();)for(var h=a.next(),s=h.getLabel().getLocation(n),g=h.eiList.iterator();g.hasNext();){var m=g.next();i.addSelfIntersectionNode(n,m.coord,s)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof tu&&(this._useBoundaryDeterminationRule=!1),n instanceof ao)this.addPolygon(n);else if(n instanceof Ai)this.addLineString(n);else if(n instanceof Ds)this.addPoint(n);else if(n instanceof Hd)this.addCollection(n);else if(n instanceof Ch)this.addCollection(n);else if(n instanceof tu)this.addCollection(n);else if(n instanceof as)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var i=this,a=0;a<n.getNumGeometries();a++){var h=n.getGeometryN(a);i.add(h)}},e.prototype.locate=function(n){return cr(this._parentGeom,Tc)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new rg(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,i){return n.isInBoundary(i)?Ge.BOUNDARY:Ge.INTERIOR},e}(Si),ig=function(){if(this._li=new zh,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new oy(0,e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=ya.OGC_SFS_BOUNDARY_RULE;r.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new oy(0,r,i),this._arg[1]=new oy(1,n,i)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],s=arguments[2];a.getPrecisionModel().compareTo(h.getPrecisionModel())>=0?this.setComputationPrecision(a.getPrecisionModel()):this.setComputationPrecision(h.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new oy(0,a,s),this._arg[1]=new oy(1,h,s)}};ig.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};ig.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};ig.prototype.interfaces_=function(){return[]};ig.prototype.getClass=function(){return ig};var bh=function(){};bh.prototype.interfaces_=function(){return[]};bh.prototype.getClass=function(){return bh};bh.map=function(){if(arguments[0]instanceof ur&&cr(arguments[1],bh.MapOp)){for(var e=arguments[0],r=arguments[1],n=new At,i=0;i<e.getNumGeometries();i++){var a=r.map(e.getGeometryN(i));a!==null&&n.add(a)}return e.getFactory().buildGeometry(n)}else if(cr(arguments[0],to)&&cr(arguments[1],bh.MapOp)){for(var h=arguments[0],s=arguments[1],g=new At,m=h.iterator();m.hasNext();){var w=m.next(),b=s.map(w);b!==null&&g.add(b)}return g}};bh.MapOp=function(){};var Pr=function(t){function e(){var r=arguments[0],n=arguments[1];t.call(this,r,n),this._ptLocator=new Ba,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new za,this._resultPolyList=new At,this._resultLineList=new At,this._resultPointList=new At,this._graph=new Si(new LO),this._geomFact=r.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var a=i.getLabel(),h=n.getLabel();i.isPointwiseEqual(n)||(h=new zn(n.getLabel()),h.flip());var s=i.getDepth();s.isNull()&&s.add(a),s.add(h),a.merge(h)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),a=i.getSym();i.isInResult()&&a.isInResult()&&(i.setInResult(!1),a.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,i,a,h){var s=new At;return s.addAll(n),s.addAll(i),s.addAll(a),s.isEmpty()?e.createEmptyResult(h,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(s)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,i){for(var a=this,h=i.iterator();h.hasNext();){var s=h.next(),g=a._ptLocator.locate(n,s);if(g!==Ge.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new At,i=this._edgeList.iterator();i.hasNext();){var a=i.next();a.isCollapsed()&&(i.remove(),n.add(a.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),a=i.getEdges().getLabel();i.getLabel().merge(a)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var i=this,a=n.iterator();a.hasNext();){var h=a.next();i.insertUniqueEdge(h)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new At;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Nh.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var a=new Ns(this._geomFact);a.add(this._graph),this._resultPolyList=a.getPolygons();var h=new _l(this,this._geomFact,this._ptLocator);this._resultLineList=h.build(n);var s=new op(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,i){var a=this._ptLocator.locate(n.getCoordinate(),this._arg[i].getGeometry());n.getLabel().setLocation(i,a)},e.prototype.copyPoints=function(n){for(var i=this,a=this._arg[n].getNodeIterator();a.hasNext();){var h=a.next(),s=i._graph.addNode(h.getCoordinate());s.setLabel(n,h.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var a=i.next(),h=a.getLabel();h.isArea()&&!a.isInteriorAreaEdge()&&e.isResultOfOp(h.getLocation(0,Et.RIGHT),h.getLocation(1,Et.RIGHT),n)&&a.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var i=n.next(),a=i.getLabel(),h=i.getDepth();if(!h.isNull()){h.normalize();for(var s=0;s<2;s++)!a.isNull(s)&&a.isArea()&&!h.isNull(s)&&(h.getDelta(s)===0?a.toLine(s):(Cr.isTrue(!h.isNull(s,Et.LEFT),"depth of LEFT side has not been initialized"),a.setLocation(s,Et.LEFT,h.getLocation(s,Et.LEFT)),Cr.isTrue(!h.isNull(s,Et.RIGHT),"depth of RIGHT side has not been initialized"),a.setLocation(s,Et.RIGHT,h.getLocation(s,Et.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var a=i.next();a.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var a=i.next(),h=a.getLabel();a.isIsolated()&&(h.isNull(0)?n.labelIncompleteNode(a,0):n.labelIncompleteNode(a,1)),a.getEdges().updateLabelling(h)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ig);Pr.overlayOp=function(t,e,r){var n=new Pr(t,e),i=n.getResultGeometry(r);return i};Pr.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Pr.createEmptyResult(Pr.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var r=e;return ip.map(t,{interfaces_:function(){return[bh.MapOp]},map:function(n){return n.intersection(r)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cs.overlayOp(t,e,Pr.INTERSECTION)};Pr.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Pr.createEmptyResult(Pr.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cs.overlayOp(t,e,Pr.SYMDIFFERENCE)};Pr.resultDimension=function(t,e,r){var n=e.getDimension(),i=r.getDimension(),a=-1;switch(t){case Pr.INTERSECTION:a=Math.min(n,i);break;case Pr.UNION:a=Math.max(n,i);break;case Pr.DIFFERENCE:a=n;break;case Pr.SYMDIFFERENCE:a=Math.max(n,i);break}return a};Pr.createEmptyResult=function(t,e,r,n){var i=null;switch(Pr.resultDimension(t,e,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon();break}return i};Pr.difference=function(t,e){return t.isEmpty()?Pr.createEmptyResult(Pr.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cs.overlayOp(t,e,Pr.DIFFERENCE))};Pr.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],r=t.getLocation(0),n=t.getLocation(1);return Pr.isResultOfOp(r,n,e)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];switch(i===Ge.BOUNDARY&&(i=Ge.INTERIOR),a===Ge.BOUNDARY&&(a=Ge.INTERIOR),h){case Pr.INTERSECTION:return i===Ge.INTERIOR&&a===Ge.INTERIOR;case Pr.UNION:return i===Ge.INTERIOR||a===Ge.INTERIOR;case Pr.DIFFERENCE:return i===Ge.INTERIOR&&a!==Ge.INTERIOR;case Pr.SYMDIFFERENCE:return i===Ge.INTERIOR&&a!==Ge.INTERIOR||i!==Ge.INTERIOR&&a===Ge.INTERIOR}return!1}};Pr.INTERSECTION=1;Pr.UNION=2;Pr.DIFFERENCE=3;Pr.SYMDIFFERENCE=4;var xc=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ba,this._seg=new tr;var e=arguments[0],r=arguments[1];this._g=e,this._boundaryDistanceTolerance=r,this._linework=this.extractLinework(e)};xc.prototype.isWithinToleranceOfBoundary=function(e){for(var r=this,n=0;n<this._linework.getNumGeometries();n++)for(var i=r._linework.getGeometryN(n),a=i.getCoordinateSequence(),h=0;h<a.size()-1;h++){a.getCoordinate(h,r._seg.p0),a.getCoordinate(h+1,r._seg.p1);var s=r._seg.distance(e);if(s<=r._boundaryDistanceTolerance)return!0}return!1};xc.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Ge.BOUNDARY:this._ptLocator.locate(e,this._g)};xc.prototype.extractLinework=function(e){var r=new og;e.apply(r);var n=r.getLinework(),i=zr.toLineStringArray(n);return e.getFactory().createMultiLineString(i)};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};var og=function(){this._linework=null,this._linework=new At};og.prototype.getLinework=function(){return this._linework};og.prototype.filter=function(e){var r=this;if(e instanceof ao){var n=e;this._linework.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)r._linework.add(n.getInteriorRingN(i))}};og.prototype.interfaces_=function(){return[hl]};og.prototype.getClass=function(){return og};var kh=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};kh.prototype.extractPoints=function(e,r,n){for(var i=this,a=e.getCoordinates(),h=0;h<a.length-1;h++)i.computeOffsetPoints(a[h],a[h+1],r,n)};kh.prototype.setSidesToGenerate=function(e,r){this._doLeft=e,this._doRight=r};kh.prototype.getPoints=function(e){for(var r=this,n=new At,i=Po.getLines(this._g),a=i.iterator();a.hasNext();){var h=a.next();r.extractPoints(h,e,n)}return n};kh.prototype.computeOffsetPoints=function(e,r,n,i){var a=r.x-e.x,h=r.y-e.y,s=Math.sqrt(a*a+h*h),g=n*a/s,m=n*h/s,w=(r.x+e.x)/2,b=(r.y+e.y)/2;if(this._doLeft){var I=new Le(w-m,b+g);i.add(I)}if(this._doRight){var A=new Le(w+m,b-g);i.add(A)}};kh.prototype.interfaces_=function(){return[]};kh.prototype.getClass=function(){return kh};var Js=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new At;var e=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,r),this._geom=[e,r,n],this._locFinder=[new xc(this._geom[0],this._boundaryDistanceTolerance),new xc(this._geom[1],this._boundaryDistanceTolerance),new xc(this._geom[2],this._boundaryDistanceTolerance)]},GO={TOLERANCE:{configurable:!0}};Js.prototype.reportResult=function(e,r,n){Oo.out.println("Overlay result invalid - A:"+Ge.toLocationSymbol(r[0])+" B:"+Ge.toLocationSymbol(r[1])+" expected:"+(n?"i":"e")+" actual:"+Ge.toLocationSymbol(r[2]))};Js.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var r=this.checkValid(e);return r};Js.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var r=arguments[0],n=0;n<this._testCoords.size();n++){var i=e._testCoords.get(n);if(!e.checkValid(r,i))return e._invalidLocation=i,!1}return!0}else if(arguments.length===2){var a=arguments[0],h=arguments[1];return this._location[0]=this._locFinder[0].getLocation(h),this._location[1]=this._locFinder[1].getLocation(h),this._location[2]=this._locFinder[2].getLocation(h),Js.hasLocation(this._location,Ge.BOUNDARY)?!0:this.isValidResult(a,this._location)}};Js.prototype.addTestPts=function(e){var r=new kh(e);this._testCoords.addAll(r.getPoints(5*this._boundaryDistanceTolerance))};Js.prototype.isValidResult=function(e,r){var n=Pr.isResultOfOp(r[0],r[1],e),i=r[2]===Ge.INTERIOR,a=!(n^i);return a||this.reportResult(e,r,n),a};Js.prototype.getInvalidLocation=function(){return this._invalidLocation};Js.prototype.interfaces_=function(){return[]};Js.prototype.getClass=function(){return Js};Js.hasLocation=function(e,r){for(var n=0;n<3;n++)if(e[n]===r)return!0;return!1};Js.computeBoundaryDistanceTolerance=function(e,r){return Math.min(Ri.computeSizeBasedSnapTolerance(e),Ri.computeSizeBasedSnapTolerance(r))};Js.isValid=function(e,r,n,i){var a=new Js(e,r,i);return a.isValid(n)};GO.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Js,GO);var js=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};js.prototype.extractElements=function(e,r){var n=this;if(e===null)return null;for(var i=0;i<e.getNumGeometries();i++){var a=e.getGeometryN(i);n._skipEmpty&&a.isEmpty()||r.add(a)}};js.prototype.combine=function(){for(var e=this,r=new At,n=this._inputGeoms.iterator();n.hasNext();){var i=n.next();e.extractElements(i,r)}return r.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(r)};js.prototype.interfaces_=function(){return[]};js.prototype.getClass=function(){return js};js.combine=function(){if(arguments.length===1){var e=arguments[0],r=new js(e);return r.combine()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],a=new js(js.createList(n,i));return a.combine()}else if(arguments.length===3){var h=arguments[0],s=arguments[1],g=arguments[2],m=new js(js.createList(h,s,g));return m.combine()}};js.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};js.createList=function(){if(arguments.length===2){var e=arguments[0],r=arguments[1],n=new At;return n.add(e),n.add(r),n}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2],s=new At;return s.add(i),s.add(a),s.add(h),s}};var Vi=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new At)},VO={STRTREE_NODE_CAPACITY:{configurable:!0}};Vi.prototype.reduceToGeometries=function(e){for(var r=this,n=new At,i=e.iterator();i.hasNext();){var a=i.next(),h=null;cr(a,Da)?h=r.unionTree(a):a instanceof ur&&(h=a),n.add(h)}return n};Vi.prototype.extractByEnvelope=function(e,r,n){for(var i=new At,a=0;a<r.getNumGeometries();a++){var h=r.getGeometryN(a);h.getEnvelopeInternal().intersects(e)?i.add(h):n.add(h)}return this._geomFactory.buildGeometry(i)};Vi.prototype.unionOptimized=function(e,r){var n=e.getEnvelopeInternal(),i=r.getEnvelopeInternal();if(!n.intersects(i)){var a=js.combine(e,r);return a}if(e.getNumGeometries()<=1&&r.getNumGeometries()<=1)return this.unionActual(e,r);var h=n.intersection(i);return this.unionUsingEnvelopeIntersection(e,r,h)};Vi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new PO(Vi.STRTREE_NODE_CAPACITY),r=this._inputPolys.iterator();r.hasNext();){var n=r.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=e.itemsTree(),a=this.unionTree(i);return a};Vi.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var a=Vi.getGeometry(r,n);return this.unionSafe(a,null)}else{if(i-n===2)return this.unionSafe(Vi.getGeometry(r,n),Vi.getGeometry(r,n+1));var h=Math.trunc((i+n)/2),s=this.binaryUnion(r,n,h),g=this.binaryUnion(r,h,i);return this.unionSafe(s,g)}}};Vi.prototype.repeatedUnion=function(e){for(var r=null,n=e.iterator();n.hasNext();){var i=n.next();r===null?r=i.copy():r=r.union(i)}return r};Vi.prototype.unionSafe=function(e,r){return e===null&&r===null?null:e===null?r.copy():r===null?e.copy():this.unionOptimized(e,r)};Vi.prototype.unionActual=function(e,r){return Vi.restrictToPolygons(e.union(r))};Vi.prototype.unionTree=function(e){var r=this.reduceToGeometries(e),n=this.binaryUnion(r);return n};Vi.prototype.unionUsingEnvelopeIntersection=function(e,r,n){var i=new At,a=this.extractByEnvelope(n,e,i),h=this.extractByEnvelope(n,r,i),s=this.unionActual(a,h);i.add(s);var g=js.combine(i);return g};Vi.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],r=e.get(0).getFactory(),n=r.buildGeometry(e),i=n.buffer(0);return i}else if(arguments.length===2){var a=arguments[0],h=arguments[1],s=a.getFactory(),g=s.createGeometryCollection([a,h]),m=g.buffer(0);return m}};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};Vi.restrictToPolygons=function(e){if(cr(e,Tc))return e;var r=ku.getPolygons(e);return r.size()===1?r.get(0):e.getFactory().createMultiPolygon(zr.toPolygonArray(r))};Vi.getGeometry=function(e,r){return r>=e.size()?null:e.get(r)};Vi.union=function(e){var r=new Vi(e);return r.union()};VO.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Vi,VO);var G0=function(){};G0.prototype.interfaces_=function(){return[]};G0.prototype.getClass=function(){return G0};G0.union=function(e,r){if(e.isEmpty()||r.isEmpty()){if(e.isEmpty()&&r.isEmpty())return Pr.createEmptyResult(Pr.UNION,e,r,e.getFactory());if(e.isEmpty())return r.copy();if(r.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(r),cs.overlayOp(e,r,Pr.UNION)};function Bh(){return new V0}function V0(){this.reset()}V0.prototype={constructor:V0,reset:function(){this.s=this.t=0},add:function(t){YC(r0,t,this.t),YC(this,r0.s,this.s),this.s?this.t+=r0.t:this.s=r0.t},valueOf:function(){return this.s}};var r0=new V0;function YC(t,e,r){var n=t.s=e+r,i=n-e,a=n-i;t.t=e-a+(r-i)}var Ci=1e-6,Jn=Math.PI,Nu=Jn/2,JC=Jn/4,qu=Jn*2,gh=180/Jn,rl=Jn/180,is=Math.abs,c7=Math.atan,sg=Math.atan2,ro=Math.cos,no=Math.sin,_g=Math.sqrt;function jO(t){return t>1?0:t<-1?Jn:Math.acos(t)}function ap(t){return t>1?Nu:t<-1?-Nu:Math.asin(t)}function my(){}function j0(t,e){t&&eA.hasOwnProperty(t.type)&&eA[t.type](t,e)}var QC={Feature:function(t,e){j0(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,n=-1,i=r.length;++n<i;)j0(r[n].geometry,e)}},eA={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)t=r[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){XE(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)XE(r[n],e,0)},Polygon:function(t,e){tA(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)tA(r[n],e)},GeometryCollection:function(t,e){for(var r=t.geometries,n=-1,i=r.length;++n<i;)j0(r[n],e)}};function XE(t,e,r){var n=-1,i=t.length-r,a;for(e.lineStart();++n<i;)a=t[n],e.point(a[0],a[1],a[2]);e.lineEnd()}function tA(t,e){var r=-1,n=t.length;for(e.polygonStart();++r<n;)XE(t[r],e,1);e.polygonEnd()}function h7(t,e){t&&QC.hasOwnProperty(t.type)?QC[t.type](t,e):j0(t,e)}Bh();Bh();function WE(t){return[sg(t[1],t[0]),ap(t[2])]}function ag(t){var e=t[0],r=t[1],n=ro(r);return[n*ro(e),n*no(e),no(r)]}function n0(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function q0(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Qw(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function i0(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function HE(t){var e=_g(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}Bh();function qO(t,e){function r(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(r.invert=function(n,i){return n=e.invert(n,i),n&&t.invert(n[0],n[1])}),r}function KE(t,e){return[t>Jn?t-qu:t<-Jn?t+qu:t,e]}KE.invert=KE;function f7(t,e,r){return(t%=qu)?e||r?qO(nA(t),iA(e,r)):nA(t):e||r?iA(e,r):KE}function rA(t){return function(e,r){return e+=t,[e>Jn?e-qu:e<-Jn?e+qu:e,r]}}function nA(t){var e=rA(t);return e.invert=rA(-t),e}function iA(t,e){var r=ro(t),n=no(t),i=ro(e),a=no(e);function h(s,g){var m=ro(g),w=ro(s)*m,b=no(s)*m,I=no(g),A=I*r+w*n;return[sg(b*i-A*a,w*r-I*n),ap(A*i+b*a)]}return h.invert=function(s,g){var m=ro(g),w=ro(s)*m,b=no(s)*m,I=no(g),A=I*i-b*a;return[sg(b*i+I*a,w*r+A*n),ap(A*r-w*n)]},h}function p7(t,e,r,n,i,a){if(r){var h=ro(e),s=no(e),g=n*r;i==null?(i=e+n*qu,a=e-g/2):(i=oA(h,i),a=oA(h,a),(n>0?i<a:i>a)&&(i+=n*qu));for(var m,w=i;n>0?w>a:w<a;w-=g)m=WE([h,-s*ro(w),-s*no(w)]),t.point(m[0],m[1])}}function oA(t,e){e=ag(e),e[0]-=t,HE(e);var r=jO(-e[1]);return((-e[2]<0?-r:r)+qu-Ci)%qu}function $O(){var t=[],e;return{point:function(r,n){e.push([r,n])},lineStart:function(){t.push(e=[])},lineEnd:my,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],e=null,r}}}function d7(t,e,r,n,i,a){var h=t[0],s=t[1],g=e[0],m=e[1],w=0,b=1,I=g-h,A=m-s,z;if(z=r-h,!(!I&&z>0)){if(z/=I,I<0){if(z<w)return;z<b&&(b=z)}else if(I>0){if(z>b)return;z>w&&(w=z)}if(z=i-h,!(!I&&z<0)){if(z/=I,I<0){if(z>b)return;z>w&&(w=z)}else if(I>0){if(z<w)return;z<b&&(b=z)}if(z=n-s,!(!A&&z>0)){if(z/=A,A<0){if(z<w)return;z<b&&(b=z)}else if(A>0){if(z>b)return;z>w&&(w=z)}if(z=a-s,!(!A&&z<0)){if(z/=A,A<0){if(z>b)return;z>w&&(w=z)}else if(A>0){if(z<w)return;z<b&&(b=z)}return w>0&&(t[0]=h+w*I,t[1]=s+w*A),b<1&&(e[0]=h+b*I,e[1]=s+b*A),!0}}}}}function y0(t,e){return is(t[0]-e[0])<Ci&&is(t[1]-e[1])<Ci}function o0(t,e,r,n){this.x=t,this.z=e,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function ZO(t,e,r,n,i){var a=[],h=[],s,g;if(t.forEach(function(z){if(!((V=z.length-1)<=0)){var V,H=z[0],Z=z[V],D;if(y0(H,Z)){for(i.lineStart(),s=0;s<V;++s)i.point((H=z[s])[0],H[1]);i.lineEnd();return}a.push(D=new o0(H,z,null,!0)),h.push(D.o=new o0(H,null,D,!1)),a.push(D=new o0(Z,z,null,!1)),h.push(D.o=new o0(Z,null,D,!0))}}),!!a.length){for(h.sort(e),sA(a),sA(h),s=0,g=h.length;s<g;++s)h[s].e=r=!r;for(var m=a[0],w,b;;){for(var I=m,A=!0;I.v;)if((I=I.n)===m)return;w=I.z,i.lineStart();do{if(I.v=I.o.v=!0,I.e){if(A)for(s=0,g=w.length;s<g;++s)i.point((b=w[s])[0],b[1]);else n(I.x,I.n.x,1,i);I=I.n}else{if(A)for(w=I.p.z,s=w.length-1;s>=0;--s)i.point((b=w[s])[0],b[1]);else n(I.x,I.p.x,-1,i);I=I.p}I=I.o,w=I.z,A=!A}while(!I.v);i.lineEnd()}}}function sA(t){if(e=t.length){for(var e,r=0,n=t[0],i;++r<e;)n.n=i=t[r],i.p=n,n=i;n.n=i=t[0],i.p=n}}function XO(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function g7(t){return t.length===1&&(t=m7(t)),{left:function(e,r,n,i){for(n==null&&(n=0),i==null&&(i=e.length);n<i;){var a=n+i>>>1;t(e[a],r)<0?n=a+1:i=a}return n},right:function(e,r,n,i){for(n==null&&(n=0),i==null&&(i=e.length);n<i;){var a=n+i>>>1;t(e[a],r)>0?i=a:n=a+1}return n}}}function m7(t){return function(e,r){return XO(t(e),r)}}g7(XO);function WO(t){for(var e=t.length,r,n=-1,i=0,a,h;++n<e;)i+=t[n].length;for(a=new Array(i);--e>=0;)for(h=t[e],r=h.length;--r>=0;)a[--i]=h[r];return a}var yy=1e9,s0=-yy;function y7(t,e,r,n){function i(m,w){return t<=m&&m<=r&&e<=w&&w<=n}function a(m,w,b,I){var A=0,z=0;if(m==null||(A=h(m,b))!==(z=h(w,b))||g(m,w)<0^b>0)do I.point(A===0||A===3?t:r,A>1?n:e);while((A=(A+b+4)%4)!==z);else I.point(w[0],w[1])}function h(m,w){return is(m[0]-t)<Ci?w>0?0:3:is(m[0]-r)<Ci?w>0?2:1:is(m[1]-e)<Ci?w>0?1:0:w>0?3:2}function s(m,w){return g(m.x,w.x)}function g(m,w){var b=h(m,1),I=h(w,1);return b!==I?b-I:b===0?w[1]-m[1]:b===1?m[0]-w[0]:b===2?m[1]-w[1]:w[0]-m[0]}return function(m){var w=m,b=$O(),I,A,z,V,H,Z,D,k,j,Y,ie,ne={point:ae,lineStart:ze,lineEnd:We,polygonStart:$e,polygonEnd:Oe};function ae(Pt,at){i(Pt,at)&&w.point(Pt,at)}function W(){for(var Pt=0,at=0,St=A.length;at<St;++at)for(var et=A[at],zt=1,mt=et.length,bt=et[0],It,jt,Jt=bt[0],yr=bt[1];zt<mt;++zt)It=Jt,jt=yr,bt=et[zt],Jt=bt[0],yr=bt[1],jt<=n?yr>n&&(Jt-It)*(n-jt)>(yr-jt)*(t-It)&&++Pt:yr<=n&&(Jt-It)*(n-jt)<(yr-jt)*(t-It)&&--Pt;return Pt}function $e(){w=b,I=[],A=[],ie=!0}function Oe(){var Pt=W(),at=ie&&Pt,St=(I=WO(I)).length;(at||St)&&(m.polygonStart(),at&&(m.lineStart(),a(null,null,1,m),m.lineEnd()),St&&ZO(I,s,Pt,a,m),m.polygonEnd()),w=m,I=A=z=null}function ze(){ne.point=Ze,A&&A.push(z=[]),Y=!0,j=!1,D=k=NaN}function We(){I&&(Ze(V,H),Z&&j&&b.rejoin(),I.push(b.result())),ne.point=ae,j&&w.lineEnd()}function Ze(Pt,at){var St=i(Pt,at);if(A&&z.push([Pt,at]),Y)V=Pt,H=at,Z=St,Y=!1,St&&(w.lineStart(),w.point(Pt,at));else if(St&&j)w.point(Pt,at);else{var et=[D=Math.max(s0,Math.min(yy,D)),k=Math.max(s0,Math.min(yy,k))],zt=[Pt=Math.max(s0,Math.min(yy,Pt)),at=Math.max(s0,Math.min(yy,at))];d7(et,zt,t,e,r,n)?(j||(w.lineStart(),w.point(et[0],et[1])),w.point(zt[0],zt[1]),St||w.lineEnd(),ie=!1):St&&(w.lineStart(),w.point(Pt,at),ie=!1)}D=Pt,k=at,j=St}return ne}}var eE=Bh();function _7(t,e){var r=e[0],n=e[1],i=[no(r),-ro(r),0],a=0,h=0;eE.reset();for(var s=0,g=t.length;s<g;++s)if(w=(m=t[s]).length)for(var m,w,b=m[w-1],I=b[0],A=b[1]/2+JC,z=no(A),V=ro(A),H=0;H<w;++H,I=D,z=j,V=Y,b=Z){var Z=m[H],D=Z[0],k=Z[1]/2+JC,j=no(k),Y=ro(k),ie=D-I,ne=ie>=0?1:-1,ae=ne*ie,W=ae>Jn,$e=z*j;if(eE.add(sg($e*ne*no(ae),V*Y+$e*ro(ae))),a+=W?ie+ne*qu:ie,W^I>=r^D>=r){var Oe=q0(ag(b),ag(Z));HE(Oe);var ze=q0(i,Oe);HE(ze);var We=(W^ie>=0?-1:1)*ap(ze[2]);(n>We||n===We&&(Oe[0]||Oe[1]))&&(h+=W^ie>=0?1:-1)}}return(a<-Ci||a<Ci&&eE<-Ci)^h&1}Bh();function aA(t){return t}Bh();Bh();var lg=1/0,$0=lg,Jy=-lg,Z0=Jy,lA={point:v7,lineStart:my,lineEnd:my,polygonStart:my,polygonEnd:my,result:function(){var t=[[lg,$0],[Jy,Z0]];return Jy=Z0=-($0=lg=1/0),t}};function v7(t,e){t<lg&&(lg=t),t>Jy&&(Jy=t),e<$0&&($0=e),e>Z0&&(Z0=e)}Bh();function HO(t,e,r,n){return function(i,a){var h=e(a),s=i.invert(n[0],n[1]),g=$O(),m=e(g),w=!1,b,I,A,z={point:V,lineStart:Z,lineEnd:D,polygonStart:function(){z.point=k,z.lineStart=j,z.lineEnd=Y,I=[],b=[]},polygonEnd:function(){z.point=V,z.lineStart=Z,z.lineEnd=D,I=WO(I);var ie=_7(b,s);I.length?(w||(a.polygonStart(),w=!0),ZO(I,w7,ie,r,a)):ie&&(w||(a.polygonStart(),w=!0),a.lineStart(),r(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),I=b=null},sphere:function(){a.polygonStart(),a.lineStart(),r(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function V(ie,ne){var ae=i(ie,ne);t(ie=ae[0],ne=ae[1])&&a.point(ie,ne)}function H(ie,ne){var ae=i(ie,ne);h.point(ae[0],ae[1])}function Z(){z.point=H,h.lineStart()}function D(){z.point=V,h.lineEnd()}function k(ie,ne){A.push([ie,ne]);var ae=i(ie,ne);m.point(ae[0],ae[1])}function j(){m.lineStart(),A=[]}function Y(){k(A[0][0],A[0][1]),m.lineEnd();var ie=m.clean(),ne=g.result(),ae,W=ne.length,$e,Oe,ze;if(A.pop(),b.push(A),A=null,!!W){if(ie&1){if(Oe=ne[0],($e=Oe.length-1)>0){for(w||(a.polygonStart(),w=!0),a.lineStart(),ae=0;ae<$e;++ae)a.point((ze=Oe[ae])[0],ze[1]);a.lineEnd()}return}W>1&&ie&2&&ne.push(ne.pop().concat(ne.shift())),I.push(ne.filter(x7))}}return z}}function x7(t){return t.length>1}function w7(t,e){return((t=t.x)[0]<0?t[1]-Nu-Ci:Nu-t[1])-((e=e.x)[0]<0?e[1]-Nu-Ci:Nu-e[1])}const uA=HO(function(){return!0},E7,T7,[-Jn,-Nu]);function E7(t){var e=NaN,r=NaN,n=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,h){var s=a>0?Jn:-Jn,g=is(a-e);is(g-Jn)<Ci?(t.point(e,r=(r+h)/2>0?Nu:-Nu),t.point(n,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(a,r),i=0):n!==s&&g>=Jn&&(is(e-n)<Ci&&(e-=n*Ci),is(a-s)<Ci&&(a-=s*Ci),r=b7(e,r,a,h),t.point(n,r),t.lineEnd(),t.lineStart(),t.point(s,r),i=0),t.point(e=a,r=h),n=s},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-i}}}function b7(t,e,r,n){var i,a,h=no(t-r);return is(h)>Ci?c7((no(e)*(a=ro(n))*no(r)-no(n)*(i=ro(e))*no(t))/(i*a*h)):(e+n)/2}function T7(t,e,r,n){var i;if(t==null)i=r*Nu,n.point(-Jn,i),n.point(0,i),n.point(Jn,i),n.point(Jn,0),n.point(Jn,-i),n.point(0,-i),n.point(-Jn,-i),n.point(-Jn,0),n.point(-Jn,i);else if(is(t[0]-e[0])>Ci){var a=t[0]<e[0]?Jn:-Jn;i=r*a/2,n.point(-a,i),n.point(0,i),n.point(a,i)}else n.point(e[0],e[1])}function S7(t,e){var r=ro(t),n=r>0,i=is(r)>Ci;function a(w,b,I,A){p7(A,t,e,I,w,b)}function h(w,b){return ro(w)*ro(b)>r}function s(w){var b,I,A,z,V;return{lineStart:function(){z=A=!1,V=1},point:function(H,Z){var D=[H,Z],k,j=h(H,Z),Y=n?j?0:m(H,Z):j?m(H+(H<0?Jn:-Jn),Z):0;if(!b&&(z=A=j)&&w.lineStart(),j!==A&&(k=g(b,D),(!k||y0(b,k)||y0(D,k))&&(D[0]+=Ci,D[1]+=Ci,j=h(D[0],D[1]))),j!==A)V=0,j?(w.lineStart(),k=g(D,b),w.point(k[0],k[1])):(k=g(b,D),w.point(k[0],k[1]),w.lineEnd()),b=k;else if(i&&b&&n^j){var ie;!(Y&I)&&(ie=g(D,b,!0))&&(V=0,n?(w.lineStart(),w.point(ie[0][0],ie[0][1]),w.point(ie[1][0],ie[1][1]),w.lineEnd()):(w.point(ie[1][0],ie[1][1]),w.lineEnd(),w.lineStart(),w.point(ie[0][0],ie[0][1])))}j&&(!b||!y0(b,D))&&w.point(D[0],D[1]),b=D,A=j,I=Y},lineEnd:function(){A&&w.lineEnd(),b=null},clean:function(){return V|(z&&A)<<1}}}function g(w,b,I){var A=ag(w),z=ag(b),V=[1,0,0],H=q0(A,z),Z=n0(H,H),D=H[0],k=Z-D*D;if(!k)return!I&&w;var j=r*Z/k,Y=-r*D/k,ie=q0(V,H),ne=i0(V,j),ae=i0(H,Y);Qw(ne,ae);var W=ie,$e=n0(ne,W),Oe=n0(W,W),ze=$e*$e-Oe*(n0(ne,ne)-1);if(!(ze<0)){var We=_g(ze),Ze=i0(W,(-$e-We)/Oe);if(Qw(Ze,ne),Ze=WE(Ze),!I)return Ze;var Pt=w[0],at=b[0],St=w[1],et=b[1],zt;at<Pt&&(zt=Pt,Pt=at,at=zt);var mt=at-Pt,bt=is(mt-Jn)<Ci,It=bt||mt<Ci;if(!bt&&et<St&&(zt=St,St=et,et=zt),It?bt?St+et>0^Ze[1]<(is(Ze[0]-Pt)<Ci?St:et):St<=Ze[1]&&Ze[1]<=et:mt>Jn^(Pt<=Ze[0]&&Ze[0]<=at)){var jt=i0(W,(-$e+We)/Oe);return Qw(jt,ne),[Ze,WE(jt)]}}}function m(w,b){var I=n?t:Jn-t,A=0;return w<-I?A|=1:w>I&&(A|=2),b<-I?A|=4:b>I&&(A|=8),A}return HO(h,s,a,n?[0,-t]:[-Jn,t-Jn])}function KO(t){return function(e){var r=new YE;for(var n in t)r[n]=t[n];return r.stream=e,r}}function YE(){}YE.prototype={constructor:YE,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function YO(t,e,r){var n=e[1][0]-e[0][0],i=e[1][1]-e[0][1],a=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),a!=null&&t.clipExtent(null),h7(r,t.stream(lA));var h=lA.result(),s=Math.min(n/(h[1][0]-h[0][0]),i/(h[1][1]-h[0][1])),g=+e[0][0]+(n-s*(h[1][0]+h[0][0]))/2,m=+e[0][1]+(i-s*(h[1][1]+h[0][1]))/2;return a!=null&&t.clipExtent(a),t.scale(s*150).translate([g,m])}function I7(t,e,r){return YO(t,[[0,0],e],r)}var cA=16,P7=ro(30*rl);function hA(t,e){return+e?A7(t,e):C7(t)}function C7(t){return KO({point:function(e,r){e=t(e,r),this.stream.point(e[0],e[1])}})}function A7(t,e){function r(n,i,a,h,s,g,m,w,b,I,A,z,V,H){var Z=m-n,D=w-i,k=Z*Z+D*D;if(k>4*e&&V--){var j=h+I,Y=s+A,ie=g+z,ne=_g(j*j+Y*Y+ie*ie),ae=ap(ie/=ne),W=is(is(ie)-1)<Ci||is(a-b)<Ci?(a+b)/2:sg(Y,j),$e=t(W,ae),Oe=$e[0],ze=$e[1],We=Oe-n,Ze=ze-i,Pt=D*We-Z*Ze;(Pt*Pt/k>e||is((Z*We+D*Ze)/k-.5)>.3||h*I+s*A+g*z<P7)&&(r(n,i,a,h,s,g,Oe,ze,W,j/=ne,Y/=ne,ie,V,H),H.point(Oe,ze),r(Oe,ze,W,j,Y,ie,m,w,b,I,A,z,V,H))}}return function(n){var i,a,h,s,g,m,w,b,I,A,z,V,H={point:Z,lineStart:D,lineEnd:j,polygonStart:function(){n.polygonStart(),H.lineStart=Y},polygonEnd:function(){n.polygonEnd(),H.lineStart=D}};function Z(ae,W){ae=t(ae,W),n.point(ae[0],ae[1])}function D(){b=NaN,H.point=k,n.lineStart()}function k(ae,W){var $e=ag([ae,W]),Oe=t(ae,W);r(b,I,w,A,z,V,b=Oe[0],I=Oe[1],w=ae,A=$e[0],z=$e[1],V=$e[2],cA,n),n.point(b,I)}function j(){H.point=Z,n.lineEnd()}function Y(){D(),H.point=ie,H.lineEnd=ne}function ie(ae,W){k(i=ae,W),a=b,h=I,s=A,g=z,m=V,H.point=k}function ne(){r(b,I,w,A,z,V,a,h,i,s,g,m,cA,n),H.lineEnd=j,j()}return H}}var M7=KO({point:function(t,e){this.stream.point(t*rl,e*rl)}});function L7(t){return O7(function(){return t})()}function O7(t){var e,r=150,n=480,i=250,a,h,s=0,g=0,m=0,w=0,b=0,I,A,z=null,V=uA,H=null,Z,D,k,j=aA,Y=.5,ie=hA(Oe,Y),ne,ae;function W(Ze){return Ze=A(Ze[0]*rl,Ze[1]*rl),[Ze[0]*r+a,h-Ze[1]*r]}function $e(Ze){return Ze=A.invert((Ze[0]-a)/r,(h-Ze[1])/r),Ze&&[Ze[0]*gh,Ze[1]*gh]}function Oe(Ze,Pt){return Ze=e(Ze,Pt),[Ze[0]*r+a,h-Ze[1]*r]}W.stream=function(Ze){return ne&&ae===Ze?ne:ne=M7(V(I,ie(j(ae=Ze))))},W.clipAngle=function(Ze){return arguments.length?(V=+Ze?S7(z=Ze*rl,6*rl):(z=null,uA),We()):z*gh},W.clipExtent=function(Ze){return arguments.length?(j=Ze==null?(H=Z=D=k=null,aA):y7(H=+Ze[0][0],Z=+Ze[0][1],D=+Ze[1][0],k=+Ze[1][1]),We()):H==null?null:[[H,Z],[D,k]]},W.scale=function(Ze){return arguments.length?(r=+Ze,ze()):r},W.translate=function(Ze){return arguments.length?(n=+Ze[0],i=+Ze[1],ze()):[n,i]},W.center=function(Ze){return arguments.length?(s=Ze[0]%360*rl,g=Ze[1]%360*rl,ze()):[s*gh,g*gh]},W.rotate=function(Ze){return arguments.length?(m=Ze[0]%360*rl,w=Ze[1]%360*rl,b=Ze.length>2?Ze[2]%360*rl:0,ze()):[m*gh,w*gh,b*gh]},W.precision=function(Ze){return arguments.length?(ie=hA(Oe,Y=Ze*Ze),We()):_g(Y)},W.fitExtent=function(Ze,Pt){return YO(W,Ze,Pt)},W.fitSize=function(Ze,Pt){return I7(W,Ze,Pt)};function ze(){A=qO(I=f7(m,w,b),e);var Ze=e(s,g);return a=n-Ze[0]*r,h=i+Ze[1]*r,We()}function We(){return ne=ae=null,W}return function(){return e=t.apply(this,arguments),W.invert=e.invert&&$e,ze()}}function JO(t){return function(e,r){var n=ro(e),i=ro(r),a=t(n*i);return[a*i*no(e),a*no(r)]}}function QO(t){return function(e,r){var n=_g(e*e+r*r),i=t(n),a=no(i),h=ro(i);return[sg(e*a,n*h),ap(n&&r*a/n)]}}var D7=JO(function(t){return _g(2/(1+t))});D7.invert=QO(function(t){return 2*ap(t/2)});var eD=JO(function(t){return(t=jO(t))&&t/no(t)});eD.invert=QO(function(t){return t});function N7(){return L7(eD).scale(79.4188).clipAngle(180-.001)}function fA(t,e){return[t,e]}fA.invert=fA;function R7(t,e,r){r=r||{};var n=r.units||"kilometers",i=r.steps||8;if(!t)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var a=[];switch(t.type){case"GeometryCollection":return ma(t,function(h){var s=_0(h,e,n,i);s&&a.push(s)}),hr(a);case"FeatureCollection":return kn(t,function(h){var s=_0(h,e,n,i);s&&kn(s,function(g){g&&a.push(g)})}),hr(a)}return _0(t,e,n,i)}function _0(t,e,r,n){var i=t.properties||{},a=t.type==="Feature"?t.geometry:t;if(a.type==="GeometryCollection"){var h=[];return ma(t,function(V){var H=_0(V,e,r,n);H&&h.push(H)}),hr(h)}var s=k7(a),g={type:a.type,coordinates:rD(a.coordinates,s)},m=new vT,w=m.read(g),b=zd(Vf(e,r),"meters"),I=Co.bufferOp(w,b,n),A=new SO;if(I=A.write(I),!tD(I.coordinates)){var z={type:I.type,coordinates:nD(I.coordinates,s)};return fo(z,i)}}function tD(t){return Array.isArray(t[0])?tD(t[0]):isNaN(t[0])}function rD(t,e){return typeof t[0]!="object"?e(t):t.map(function(r){return rD(r,e)})}function nD(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(r){return nD(r,e)})}function k7(t){var e=c1(t).geometry.coordinates,r=[-e[0],-e[1]];return N7().rotate(r).scale(Io)}function F7(t,e,r){r===void 0&&(r={});var n=hi(t),i=hi(e),a=_c.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?qr(a[0],r.properties):ga(a,r.properties)}function Qy(t,e,r){r===void 0&&(r={});var n=hi(t),i=hi(e),a=_c.intersection(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?qr(a[0],r.properties):ga(a,r.properties)}function z7(t,e){if(e=e||{},!Vn(e))throw new Error("options is invalid");var r=e.propertyName;Nc(t,"Polygon","dissolve");var n=[];if(e.propertyName){var i={};kn(t,function(g){Object.prototype.hasOwnProperty.call(i,g.properties[r])||(i[g.properties[r]]=[]),i[g.properties[r]].push(g)});for(var a=Object.keys(i),h=0;h<a.length;h++){var s=ga(_c.union.apply(null,i[a[h]].map(function(g){return g.geometry.coordinates})));s.properties[r]=a[h],n.push(s)}}else return AE(ga(_c.union.apply(null,t.features.map(function(g){return g.geometry.coordinates}))));return AE(hr(n))}function iD(t,e,r){r===void 0&&(r={});var n=JSON.stringify(r.properties||{}),i=t[0],a=t[1],h=t[2],s=t[3],g=(a+s)/2,m=(i+h)/2,w=e*2/Rn([i,g],[h,g],r),b=w*(h-i),I=e*2/Rn([m,a],[m,s],r),A=I*(s-a),z=b/2,V=z*2,H=Math.sqrt(3)/2*A,Z=h-i,D=s-a,k=3/4*V,j=H,Y=(Z-V)/(V-z/2),ie=Math.floor(Y),ne=(ie*k-z/2-Z)/2-z/2+k/2,ae=Math.floor((D-H)/H),W=(D-ae*H)/2,$e=ae*H-D>H/2;$e&&(W-=H/4);for(var Oe=[],ze=[],We=0;We<6;We++){var Ze=2*Math.PI/6*We;Oe.push(Math.cos(Ze)),ze.push(Math.sin(Ze))}for(var Pt=[],at=0;at<=ie;at++)for(var St=0;St<=ae;St++){var et=at%2===1;if(!(St===0&&et)&&!(St===0&&$e)){var zt=at*k+i-ne,mt=St*j+a+W;if(et&&(mt-=H/2),r.triangles===!0)U7([zt,mt],b/2,A/2,JSON.parse(n),Oe,ze).forEach(function(It){r.mask?Qy(r.mask,It)&&Pt.push(It):Pt.push(It)});else{var bt=B7([zt,mt],b/2,A/2,JSON.parse(n),Oe,ze);r.mask?Qy(r.mask,bt)&&Pt.push(bt):Pt.push(bt)}}}return hr(Pt)}function B7(t,e,r,n,i,a){for(var h=[],s=0;s<6;s++){var g=t[0]+e*i[s],m=t[1]+r*a[s];h.push([g,m])}return h.push(h[0].slice()),qr([h],n)}function U7(t,e,r,n,i,a){for(var h=[],s=0;s<6;s++){var g=[];g.push(t),g.push([t[0]+e*i[s],t[1]+r*a[s]]),g.push([t[0]+e*i[(s+1)%6],t[1]+r*a[(s+1)%6]]),g.push(t),h.push(qr([g],n))}return h}function G7(t,e){var r=j7(e),n=null;return t.type==="FeatureCollection"?n=V7(t):n=oD(_c.union(t.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){r.geometry.coordinates.push(i[0])}),r}function V7(t){var e=t.features.length===2?_c.union(t.features[0].geometry.coordinates,t.features[1].geometry.coordinates):_c.union.apply(_c,t.features.map(function(r){return r.geometry.coordinates}));return oD(e)}function oD(t){return ga(t)}function j7(t){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],r=t&&t.geometry.coordinates||e;return qr(r)}function q7(t,e,r,n){n===void 0&&(n={});for(var i=[],a=t[0],h=t[1],s=t[2],g=t[3],m=e/Rn([a,h],[s,h],n),w=m*(s-a),b=r/Rn([a,h],[a,g],n),I=b*(g-h),A=s-a,z=g-h,V=Math.floor(A/w),H=Math.floor(z/I),Z=(A-V*w)/2,D=(z-H*I)/2,k=a+Z,j=0;j<V;j++){for(var Y=h+D,ie=0;ie<H;ie++){var ne=qr([[[k,Y],[k,Y+I],[k+w,Y+I],[k+w,Y],[k,Y]]],n.properties);n.mask?qL(n.mask,ne)&&i.push(ne):i.push(ne),Y+=I}k+=w}return hr(i)}function sD(t,e,r){return r===void 0&&(r={}),q7(t,e,e,r)}function aD(t,e,r){r===void 0&&(r={});for(var n=[],i=e/Rn([t[0],t[1]],[t[2],t[1]],r),a=i*(t[2]-t[0]),h=e/Rn([t[0],t[1]],[t[0],t[3]],r),s=h*(t[3]-t[1]),g=0,m=t[0];m<=t[2];){for(var w=0,b=t[1];b<=t[3];){var I=null,A=null;g%2===0&&w%2===0?(I=qr([[[m,b],[m,b+s],[m+a,b],[m,b]]],r.properties),A=qr([[[m,b+s],[m+a,b+s],[m+a,b],[m,b+s]]],r.properties)):g%2===0&&w%2===1?(I=qr([[[m,b],[m+a,b+s],[m+a,b],[m,b]]],r.properties),A=qr([[[m,b],[m,b+s],[m+a,b+s],[m,b]]],r.properties)):w%2===0&&g%2===1?(I=qr([[[m,b],[m,b+s],[m+a,b+s],[m,b]]],r.properties),A=qr([[[m,b],[m+a,b+s],[m+a,b],[m,b]]],r.properties)):w%2===1&&g%2===1&&(I=qr([[[m,b],[m,b+s],[m+a,b],[m,b]]],r.properties),A=qr([[[m,b+s],[m+a,b+s],[m+a,b],[m,b+s]]],r.properties)),r.mask?(Qy(r.mask,I)&&n.push(I),Qy(r.mask,A)&&n.push(A)):(n.push(I),n.push(A)),b+=s,w++}g++,m+=a}return hr(n)}function $7(t,e,r){if(r=r||{},typeof r!="object")throw new Error("options is invalid");var n=r.gridType,i=r.property,a=r.weight;if(!t)throw new Error("points is required");if(Nc(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(a!==void 0&&typeof a!="number")throw new Error("weight must be a number");i=i||"elevation",n=n||"square",a=a||1;var h=Fi(t),s;switch(n){case"point":case"points":s=nL(h,e,r);break;case"square":case"squares":s=sD(h,e,r);break;case"hex":case"hexes":s=iD(h,e,r);break;case"triangle":case"triangles":s=aD(h,e,r);break;default:throw new Error("invalid gridType")}var g=[];return kn(s,function(m){var w=0,b=0;kn(t,function(A){var z=n==="point"?m:Ih(m),V=Rn(z,A,r),H;if(i!==void 0&&(H=A.properties[i]),H===void 0&&(H=A.geometry.coordinates[2]),H===void 0)throw new Error("zValue is missing");V===0&&(w=H);var Z=1/Math.pow(V,a);b+=Z,w+=Z*H});var I=ss(m);I.properties[i]=w/b,g.push(I)}),hr(g)}const Z7=Object.freeze(Object.defineProperty({__proto__:null,along:Iz,angle:l9,applyFilter:x1,area:Gb,areaFactors:I0,bbox:Fi,bboxClip:Jz,bboxPolygon:Fb,bearing:bc,bearingToAngle:jf,bearingToAzimuth:jf,bezier:dP,bezierSpline:dP,booleanClockwise:L0,booleanContains:r8,booleanCrosses:h8,booleanDisjoint:BL,booleanEqual:y8,booleanIntersects:qL,booleanOverlap:m8,booleanParallel:N8,booleanPointInPolygon:ci,booleanPointOnLine:ca,booleanWithin:eL,buffer:R7,center:c1,centerMean:aT,centerMedian:s9,centerOfMass:qM,centroid:Ih,circle:zb,cleanCoords:$f,clone:ss,clusterEach:lT,clusterReduce:pO,clusters:E9,clustersDbscan:b8,clustersKmeans:D8,collect:SF,collectionOf:Nc,combine:VF,concave:yF,containsNumber:Ab,convertArea:_M,convertDistance:qf,convertLength:qf,convex:DM,coordAll:Bd,coordEach:ji,coordReduce:Eb,createBins:uT,degrees2radians:Ao,degreesToRadians:Ao,destination:zu,difference:Z9,dissolve:z7,distance:Rn,distanceToDegrees:P0,distanceToRadians:Vf,distanceWeight:nO,earthRadius:Io,ellipse:tO,envelope:VM,explode:h1,factors:a1,feature:fo,featureCollection:hr,featureEach:kn,featureOf:Cy,featureReduce:Tb,filterProperties:dO,findPoint:SM,findSegment:TM,flatten:AE,flattenEach:jo,flattenReduce:bM,flip:IF,geojsonType:PM,geomEach:ma,geomReduce:Sb,geometry:pM,geometryCollection:wb,getCluster:fO,getCoord:oi,getCoords:mr,getGeom:hi,getType:Zs,greatCircle:Zz,helpers:wM,hexGrid:iD,inside:ci,interpolate:$7,intersect:Qy,invariant:nk,isNumber:Lo,isObject:Vn,isobands:S6,isolines:mk,kinks:Ez,length:CE,lengthToDegrees:P0,lengthToRadians:Vf,lineArc:aL,lineChunk:zz,lineDistance:CE,lineEach:Pb,lineIntersect:Rc,lineOffset:U6,lineOverlap:RL,lineReduce:Cb,lineSegment:Xf,lineSlice:Pz,lineSliceAlong:QM,lineSplit:Xz,lineString:Bn,lineStringToPolygon:LP,lineStrings:mM,lineToPolygon:LP,mask:G7,meta:IM,midpoint:GF,moranIndex:p9,multiLineString:Fh,multiPoint:t_,multiPolygon:ga,nearest:C0,nearestPoint:C0,nearestPointOnLine:mc,nearestPointToLine:vz,planepoint:wz,point:Gr,pointGrid:nL,pointOnFeature:xP,pointOnLine:mc,pointOnSurface:xP,pointToLineDistance:JM,points:dM,pointsWithinPolygon:wE,polygon:qr,polygonSmooth:u9,polygonTangents:DU,polygonToLine:Ny,polygonToLineString:Ny,polygonize:K6,polygons:gM,projection:m9,propEach:bb,propReduce:EM,propertiesContainsFilter:cT,radians2degrees:Sh,radiansToDegrees:Sh,radiansToDistance:zd,radiansToLength:zd,random:w9,randomLineString:cO,randomPoint:lO,randomPolygon:uO,randomPosition:o_,rewind:kU,rhumbBearing:Wf,rhumbDestination:Gd,rhumbDistance:g1,round:yM,sample:zF,sector:LU,segmentEach:gc,segmentReduce:Ib,shortestPath:F8,simplify:LF,square:jM,squareGrid:sD,standardDeviationalEllipse:a9,tag:FF,tesselate:sz,tin:NM,toMercator:oO,toWgs84:sO,transformRotate:kL,transformScale:FL,transformTranslate:D6,triangleGrid:aD,truncate:iL,union:F7,unitsFactors:fM,unkinkPolygon:$z,validateBBox:vM,validateId:xM,voronoi:o9,within:wE},Symbol.toStringTag,{value:"Module"}));var CT={exports:{}},Nd=typeof Reflect=="object"?Reflect:null,pA=Nd&&typeof Nd.apply=="function"?Nd.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},v0;Nd&&typeof Nd.ownKeys=="function"?v0=Nd.ownKeys:Object.getOwnPropertySymbols?v0=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:v0=function(e){return Object.getOwnPropertyNames(e)};function X7(t){console&&console.warn&&console.warn(t)}var lD=Number.isNaN||function(e){return e!==e};function xi(){xi.init.call(this)}CT.exports=xi;CT.exports.once=Y7;xi.EventEmitter=xi;xi.prototype._events=void 0;xi.prototype._eventsCount=0;xi.prototype._maxListeners=void 0;var dA=10;function D1(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(xi,"defaultMaxListeners",{enumerable:!0,get:function(){return dA},set:function(t){if(typeof t!="number"||t<0||lD(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");dA=t}});xi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};xi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||lD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function uD(t){return t._maxListeners===void 0?xi.defaultMaxListeners:t._maxListeners}xi.prototype.getMaxListeners=function(){return uD(this)};xi.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var h;if(r.length>0&&(h=r[0]),h instanceof Error)throw h;var s=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw s.context=h,s}var g=a[e];if(g===void 0)return!1;if(typeof g=="function")pA(g,this,r);else for(var m=g.length,w=dD(g,m),n=0;n<m;++n)pA(w[n],this,r);return!0};function cD(t,e,r,n){var i,a,h;if(D1(r),a=t._events,a===void 0?(a=t._events=Object.create(null),t._eventsCount=0):(a.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),h=a[e]),h===void 0)h=a[e]=r,++t._eventsCount;else if(typeof h=="function"?h=a[e]=n?[r,h]:[h,r]:n?h.unshift(r):h.push(r),i=uD(t),i>0&&h.length>i&&!h.warned){h.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=h.length,X7(s)}return t}xi.prototype.addListener=function(e,r){return cD(this,e,r,!1)};xi.prototype.on=xi.prototype.addListener;xi.prototype.prependListener=function(e,r){return cD(this,e,r,!0)};function W7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hD(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=W7.bind(n);return i.listener=r,n.wrapFn=i,i}xi.prototype.once=function(e,r){return D1(r),this.on(e,hD(this,e,r)),this};xi.prototype.prependOnceListener=function(e,r){return D1(r),this.prependListener(e,hD(this,e,r)),this};xi.prototype.removeListener=function(e,r){var n,i,a,h,s;if(D1(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(a=-1,h=n.length-1;h>=0;h--)if(n[h]===r||n[h].listener===r){s=n[h].listener,a=h;break}if(a<0)return this;a===0?n.shift():H7(n,a),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,s||r)}return this};xi.prototype.off=xi.prototype.removeListener;xi.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var a=Object.keys(n),h;for(i=0;i<a.length;++i)h=a[i],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function fD(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?K7(i):dD(i,i.length)}xi.prototype.listeners=function(e){return fD(this,e,!0)};xi.prototype.rawListeners=function(e){return fD(this,e,!1)};xi.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):pD.call(t,e)};xi.prototype.listenerCount=pD;function pD(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}xi.prototype.eventNames=function(){return this._eventsCount>0?v0(this._events):[]};function dD(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function H7(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function K7(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Y7(t,e){return new Promise(function(r,n){function i(h){t.removeListener(e,a),n(h)}function a(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}gD(t,e,a,{once:!0}),e!=="error"&&J7(t,i,{once:!0})})}function J7(t,e,r){typeof t.on=="function"&&gD(t,"error",e,r)}function gD(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(a){n.once&&t.removeEventListener(e,i),r(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Q7=CT.exports;function $u(t){if(typeof t!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=t}typeof Symbol<"u"&&($u.prototype[Symbol.iterator]=function(){return this});$u.of=function(){var t=arguments,e=t.length,r=0;return new $u(function(){return r>=e?{done:!0}:{done:!1,value:t[r++]}})};$u.empty=function(){var t=new $u(function(){return{done:!0}});return t};$u.fromSequence=function(t){var e=0,r=t.length;return new $u(function(){return e>=r?{done:!0}:{done:!1,value:t[e++]}})};$u.is=function(t){return t instanceof $u?!0:typeof t=="object"&&t!==null&&typeof t.next=="function"};var N1=$u;const vl=wa(N1);var R1={};R1.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";R1.SYMBOL_SUPPORT=typeof Symbol<"u";var eG=N1,mD=R1,tG=mD.ARRAY_BUFFER_SUPPORT,rG=mD.SYMBOL_SUPPORT;function nG(t){return typeof t=="string"||Array.isArray(t)||tG&&ArrayBuffer.isView(t)?eG.fromSequence(t):typeof t!="object"||t===null?null:rG&&typeof t[Symbol.iterator]=="function"?t[Symbol.iterator]():typeof t.next=="function"?t:null}var yD=function(e){var r=nG(e);if(!r)throw new Error("obliterator: target is not iterable nor a valid iterator.");return r},iG=yD,oG=function(e,r){for(var n=arguments.length>1?r:1/0,i=n!==1/0?new Array(n):[],a,h=0,s=iG(e);;){if(h===n)return i;if(a=s.next(),a.done)return h!==r&&(i.length=h),i;i[h++]=a.value}};const _D=wa(oG);var sG=N1,aG=yD,lG=function(){var e=arguments,r=null,n=-1;return new sG(function(){var a=null;do{if(r===null){if(n++,n>=e.length)return{done:!0};r=aG(e[n])}if(a=r.next(),a.done===!0){r=null;continue}break}while(!0);return a})};const wc=wa(lG);function uG(){const t=arguments[0];for(let e=1,r=arguments.length;e<r;e++)if(arguments[e])for(const n in arguments[e])t[n]=arguments[e][n];return t}let Uo=uG;typeof Object.assign=="function"&&(Uo=Object.assign);function ll(t,e,r,n){const i=t._nodes.get(e);let a=null;return i&&(n==="mixed"?a=i.out&&i.out[r]||i.undirected&&i.undirected[r]:n==="directed"?a=i.out&&i.out[r]:a=i.undirected&&i.undirected[r]),a}function ms(t){return typeof t=="object"&&t!==null}function vD(t){let e;for(e in t)return!1;return!0}function el(t,e,r){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!0,value:r})}function $l(t,e,r){const n={enumerable:!0,configurable:!0};typeof r=="function"?n.get=r:(n.value=r,n.writable=!1),Object.defineProperty(t,e,n)}function gA(t){return!(!ms(t)||t.attributes&&!Array.isArray(t.attributes))}function cG(){let t=Math.floor(Math.random()*256)&255;return()=>t++}class AT extends Error{constructor(e){super(),this.name="GraphError",this.message=e}}class Wt extends AT{constructor(e){super(e),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Wt.prototype.constructor)}}class kt extends AT{constructor(e){super(e),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,kt.prototype.constructor)}}class Er extends AT{constructor(e){super(e),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Er.prototype.constructor)}}function xD(t,e){this.key=t,this.attributes=e,this.clear()}xD.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function wD(t,e){this.key=t,this.attributes=e,this.clear()}wD.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function ED(t,e){this.key=t,this.attributes=e,this.clear()}ED.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function vg(t,e,r,n,i){this.key=e,this.attributes=i,this.undirected=t,this.source=r,this.target=n}vg.prototype.attach=function(){let t="out",e="in";this.undirected&&(t=e="undirected");const r=this.source.key,n=this.target.key;this.source[t][n]=this,!(this.undirected&&r===n)&&(this.target[e][r]=this)};vg.prototype.attachMulti=function(){let t="out",e="in";const r=this.source.key,n=this.target.key;this.undirected&&(t=e="undirected");const i=this.source[t],a=i[n];if(typeof a>"u"){i[n]=this,this.undirected&&r===n||(this.target[e][r]=this);return}a.previous=this,this.next=a,i[n]=this,this.target[e][r]=this};vg.prototype.detach=function(){const t=this.source.key,e=this.target.key;let r="out",n="in";this.undirected&&(r=n="undirected"),delete this.source[r][e],delete this.target[n][t]};vg.prototype.detachMulti=function(){const t=this.source.key,e=this.target.key;let r="out",n="in";this.undirected&&(r=n="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[r][e],delete this.target[n][t]):(this.next.previous=void 0,this.source[r][e]=this.next,this.target[n][t]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const bD=0,TD=1,hG=2,SD=3;function kc(t,e,r,n,i,a,h){let s,g,m,w;if(n=""+n,r===bD){if(s=t._nodes.get(n),!s)throw new kt(`Graph.${e}: could not find the "${n}" node in the graph.`);m=i,w=a}else if(r===SD){if(i=""+i,g=t._edges.get(i),!g)throw new kt(`Graph.${e}: could not find the "${i}" edge in the graph.`);const b=g.source.key,I=g.target.key;if(n===b)s=g.target;else if(n===I)s=g.source;else throw new kt(`Graph.${e}: the "${n}" node is not attached to the "${i}" edge (${b}, ${I}).`);m=a,w=h}else{if(g=t._edges.get(n),!g)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`);r===TD?s=g.source:s=g.target,m=i,w=a}return[s,m,w]}function fG(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);return h.attributes[s]}}function pG(t,e,r){t.prototype[e]=function(n,i){const[a]=kc(this,e,r,n,i);return a.attributes}}function dG(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);return h.attributes.hasOwnProperty(s)}}function gG(t,e,r){t.prototype[e]=function(n,i,a,h){const[s,g,m]=kc(this,e,r,n,i,a,h);return s.attributes[g]=m,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:g}),this}}function mG(t,e,r){t.prototype[e]=function(n,i,a,h){const[s,g,m]=kc(this,e,r,n,i,a,h);if(typeof m!="function")throw new Wt(`Graph.${e}: updater should be a function.`);const w=s.attributes,b=m(w[g]);return w[g]=b,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:g}),this}}function yG(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);return delete h.attributes[s],this.emit("nodeAttributesUpdated",{key:h.key,type:"remove",attributes:h.attributes,name:s}),this}}function _G(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);if(!ms(s))throw new Wt(`Graph.${e}: provided attributes are not a plain object.`);return h.attributes=s,this.emit("nodeAttributesUpdated",{key:h.key,type:"replace",attributes:h.attributes}),this}}function vG(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);if(!ms(s))throw new Wt(`Graph.${e}: provided attributes are not a plain object.`);return Uo(h.attributes,s),this.emit("nodeAttributesUpdated",{key:h.key,type:"merge",attributes:h.attributes,data:s}),this}}function xG(t,e,r){t.prototype[e]=function(n,i,a){const[h,s]=kc(this,e,r,n,i,a);if(typeof s!="function")throw new Wt(`Graph.${e}: provided updater is not a function.`);return h.attributes=s(h.attributes),this.emit("nodeAttributesUpdated",{key:h.key,type:"update",attributes:h.attributes}),this}}const wG=[{name:t=>`get${t}Attribute`,attacher:fG},{name:t=>`get${t}Attributes`,attacher:pG},{name:t=>`has${t}Attribute`,attacher:dG},{name:t=>`set${t}Attribute`,attacher:gG},{name:t=>`update${t}Attribute`,attacher:mG},{name:t=>`remove${t}Attribute`,attacher:yG},{name:t=>`replace${t}Attributes`,attacher:_G},{name:t=>`merge${t}Attributes`,attacher:vG},{name:t=>`update${t}Attributes`,attacher:xG}];function EG(t){wG.forEach(function({name:e,attacher:r}){r(t,e("Node"),bD),r(t,e("Source"),TD),r(t,e("Target"),hG),r(t,e("Opposite"),SD)})}function bG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}return a.attributes[i]}}function TG(t,e,r){t.prototype[e]=function(n){let i;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+n,h=""+arguments[1];if(i=ll(this,a,h,r),!i)throw new kt(`Graph.${e}: could not find an edge for the given path ("${a}" - "${h}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,i=this._edges.get(n),!i)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}return i.attributes}}function SG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}return a.attributes.hasOwnProperty(i)}}function IG(t,e,r){t.prototype[e]=function(n,i,a){let h;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+n,g=""+i;if(i=arguments[2],a=arguments[3],h=ll(this,s,g,r),!h)throw new kt(`Graph.${e}: could not find an edge for the given path ("${s}" - "${g}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,h=this._edges.get(n),!h)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}return h.attributes[i]=a,this.emit("edgeAttributesUpdated",{key:h.key,type:"set",attributes:h.attributes,name:i}),this}}function PG(t,e,r){t.prototype[e]=function(n,i,a){let h;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+n,g=""+i;if(i=arguments[2],a=arguments[3],h=ll(this,s,g,r),!h)throw new kt(`Graph.${e}: could not find an edge for the given path ("${s}" - "${g}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,h=this._edges.get(n),!h)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}if(typeof a!="function")throw new Wt(`Graph.${e}: updater should be a function.`);return h.attributes[i]=a(h.attributes[i]),this.emit("edgeAttributesUpdated",{key:h.key,type:"set",attributes:h.attributes,name:i}),this}}function CG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}return delete a.attributes[i],this.emit("edgeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:i}),this}}function AG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}if(!ms(i))throw new Wt(`Graph.${e}: provided attributes are not a plain object.`);return a.attributes=i,this.emit("edgeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function MG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}if(!ms(i))throw new Wt(`Graph.${e}: provided attributes are not a plain object.`);return Uo(a.attributes,i),this.emit("edgeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:i}),this}}function LG(t,e,r){t.prototype[e]=function(n,i){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new Er(`Graph.${e}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Er(`Graph.${e}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const h=""+n,s=""+i;if(i=arguments[2],a=ll(this,h,s,r),!a)throw new kt(`Graph.${e}: could not find an edge for the given path ("${h}" - "${s}").`)}else{if(r!=="mixed")throw new Er(`Graph.${e}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(n=""+n,a=this._edges.get(n),!a)throw new kt(`Graph.${e}: could not find the "${n}" edge in the graph.`)}if(typeof i!="function")throw new Wt(`Graph.${e}: provided updater is not a function.`);return a.attributes=i(a.attributes),this.emit("edgeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const OG=[{name:t=>`get${t}Attribute`,attacher:bG},{name:t=>`get${t}Attributes`,attacher:TG},{name:t=>`has${t}Attribute`,attacher:SG},{name:t=>`set${t}Attribute`,attacher:IG},{name:t=>`update${t}Attribute`,attacher:PG},{name:t=>`remove${t}Attribute`,attacher:CG},{name:t=>`replace${t}Attributes`,attacher:AG},{name:t=>`merge${t}Attributes`,attacher:MG},{name:t=>`update${t}Attributes`,attacher:LG}];function DG(t){OG.forEach(function({name:e,attacher:r}){r(t,e("Edge"),"mixed"),r(t,e("DirectedEdge"),"directed"),r(t,e("UndirectedEdge"),"undirected")})}const NG=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function RG(t,e,r,n){let i=!1;for(const a in e){if(a===n)continue;const h=e[a];if(i=r(h.key,h.attributes,h.source.key,h.target.key,h.source.attributes,h.target.attributes,h.undirected),t&&i)return h.key}}function kG(t,e,r,n){let i,a,h,s=!1;for(const g in e)if(g!==n){i=e[g];do{if(a=i.source,h=i.target,s=r(i.key,i.attributes,a.key,h.key,a.attributes,h.attributes,i.undirected),t&&s)return i.key;i=i.next}while(i!==void 0)}}function tE(t,e){const r=Object.keys(t),n=r.length;let i,a=0;return new vl(function(){do if(i)i=i.next;else{if(a>=n)return{done:!0};const s=r[a++];if(s===e){i=void 0;continue}i=t[s]}while(!i);return{done:!1,value:{edge:i.key,attributes:i.attributes,source:i.source.key,target:i.target.key,sourceAttributes:i.source.attributes,targetAttributes:i.target.attributes,undirected:i.undirected}}})}function FG(t,e,r,n){const i=e[r];if(!i)return;const a=i.source,h=i.target;if(n(i.key,i.attributes,a.key,h.key,a.attributes,h.attributes,i.undirected)&&t)return i.key}function zG(t,e,r,n){let i=e[r];if(!i)return;let a=!1;do{if(a=n(i.key,i.attributes,i.source.key,i.target.key,i.source.attributes,i.target.attributes,i.undirected),t&&a)return i.key;i=i.next}while(i!==void 0)}function rE(t,e){let r=t[e];return r.next!==void 0?new vl(function(){if(!r)return{done:!0};const n={edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected};return r=r.next,{done:!1,value:n}}):vl.of({edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected})}function BG(t,e){if(t.size===0)return[];if(e==="mixed"||e===t.type)return typeof Array.from=="function"?Array.from(t._edges.keys()):_D(t._edges.keys(),t._edges.size);const r=e==="undirected"?t.undirectedSize:t.directedSize,n=new Array(r),i=e==="undirected",a=t._edges.values();let h=0,s,g;for(;s=a.next(),s.done!==!0;)g=s.value,g.undirected===i&&(n[h++]=g.key);return n}function ID(t,e,r,n){if(e.size===0)return;const i=r!=="mixed"&&r!==e.type,a=r==="undirected";let h,s,g=!1;const m=e._edges.values();for(;h=m.next(),h.done!==!0;){if(s=h.value,i&&s.undirected!==a)continue;const{key:w,attributes:b,source:I,target:A}=s;if(g=n(w,b,I.key,A.key,I.attributes,A.attributes,s.undirected),t&&g)return w}}function UG(t,e){if(t.size===0)return vl.empty();const r=e!=="mixed"&&e!==t.type,n=e==="undirected",i=t._edges.values();return new vl(function(){let h,s;for(;;){if(h=i.next(),h.done)return h;if(s=h.value,!(r&&s.undirected!==n))break}return{value:{edge:s.key,attributes:s.attributes,source:s.source.key,target:s.target.key,sourceAttributes:s.source.attributes,targetAttributes:s.target.attributes,undirected:s.undirected},done:!1}})}function MT(t,e,r,n,i,a){const h=e?kG:RG;let s;if(r!=="undirected"&&(n!=="out"&&(s=h(t,i.in,a),t&&s)||n!=="in"&&(s=h(t,i.out,a,n?void 0:i.key),t&&s))||r!=="directed"&&(s=h(t,i.undirected,a),t&&s))return s}function GG(t,e,r,n){const i=[];return MT(!1,t,e,r,n,function(a){i.push(a)}),i}function VG(t,e,r){let n=vl.empty();return t!=="undirected"&&(e!=="out"&&typeof r.in<"u"&&(n=wc(n,tE(r.in))),e!=="in"&&typeof r.out<"u"&&(n=wc(n,tE(r.out,e?void 0:r.key)))),t!=="directed"&&typeof r.undirected<"u"&&(n=wc(n,tE(r.undirected))),n}function LT(t,e,r,n,i,a,h){const s=r?zG:FG;let g;if(e!=="undirected"&&(typeof i.in<"u"&&n!=="out"&&(g=s(t,i.in,a,h),t&&g)||typeof i.out<"u"&&n!=="in"&&(n||i.key!==a)&&(g=s(t,i.out,a,h),t&&g))||e!=="directed"&&typeof i.undirected<"u"&&(g=s(t,i.undirected,a,h),t&&g))return g}function jG(t,e,r,n,i){const a=[];return LT(!1,t,e,r,n,i,function(h){a.push(h)}),a}function qG(t,e,r,n){let i=vl.empty();return t!=="undirected"&&(typeof r.in<"u"&&e!=="out"&&n in r.in&&(i=wc(i,rE(r.in,n))),typeof r.out<"u"&&e!=="in"&&n in r.out&&(e||r.key!==n)&&(i=wc(i,rE(r.out,n)))),t!=="directed"&&typeof r.undirected<"u"&&n in r.undirected&&(i=wc(i,rE(r.undirected,n))),i}function $G(t,e){const{name:r,type:n,direction:i}=e;t.prototype[r]=function(a,h){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return[];if(!arguments.length)return BG(this,n);if(arguments.length===1){a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new kt(`Graph.${r}: could not find the "${a}" node in the graph.`);return GG(this.multi,n==="mixed"?this.type:n,i,s)}if(arguments.length===2){a=""+a,h=""+h;const s=this._nodes.get(a);if(!s)throw new kt(`Graph.${r}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(h))throw new kt(`Graph.${r}:  could not find the "${h}" target node in the graph.`);return jG(n,this.multi,i,s,h)}throw new Wt(`Graph.${r}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function ZG(t,e){const{name:r,type:n,direction:i}=e,a="forEach"+r[0].toUpperCase()+r.slice(1,-1);t.prototype[a]=function(m,w,b){if(!(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)){if(arguments.length===1)return b=m,ID(!1,this,n,b);if(arguments.length===2){m=""+m,b=w;const I=this._nodes.get(m);if(typeof I>"u")throw new kt(`Graph.${a}: could not find the "${m}" node in the graph.`);return MT(!1,this.multi,n==="mixed"?this.type:n,i,I,b)}if(arguments.length===3){m=""+m,w=""+w;const I=this._nodes.get(m);if(!I)throw new kt(`Graph.${a}:  could not find the "${m}" source node in the graph.`);if(!this._nodes.has(w))throw new kt(`Graph.${a}:  could not find the "${w}" target node in the graph.`);return LT(!1,n,this.multi,i,I,w,b)}throw new Wt(`Graph.${a}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const h="map"+r[0].toUpperCase()+r.slice(1);t.prototype[h]=function(){const m=Array.prototype.slice.call(arguments),w=m.pop();let b;if(m.length===0){let I=0;n!=="directed"&&(I+=this.undirectedSize),n!=="undirected"&&(I+=this.directedSize),b=new Array(I);let A=0;m.push((z,V,H,Z,D,k,j)=>{b[A++]=w(z,V,H,Z,D,k,j)})}else b=[],m.push((I,A,z,V,H,Z,D)=>{b.push(w(I,A,z,V,H,Z,D))});return this[a].apply(this,m),b};const s="filter"+r[0].toUpperCase()+r.slice(1);t.prototype[s]=function(){const m=Array.prototype.slice.call(arguments),w=m.pop(),b=[];return m.push((I,A,z,V,H,Z,D)=>{w(I,A,z,V,H,Z,D)&&b.push(I)}),this[a].apply(this,m),b};const g="reduce"+r[0].toUpperCase()+r.slice(1);t.prototype[g]=function(){let m=Array.prototype.slice.call(arguments);if(m.length<2||m.length>4)throw new Wt(`Graph.${g}: invalid number of arguments (expecting 2, 3 or 4 and got ${m.length}).`);if(typeof m[m.length-1]=="function"&&typeof m[m.length-2]!="function")throw new Wt(`Graph.${g}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let w,b;m.length===2?(w=m[0],b=m[1],m=[]):m.length===3?(w=m[1],b=m[2],m=[m[0]]):m.length===4&&(w=m[2],b=m[3],m=[m[0],m[1]]);let I=b;return m.push((A,z,V,H,Z,D,k)=>{I=w(I,A,z,V,H,Z,D,k)}),this[a].apply(this,m),I}}function XG(t,e){const{name:r,type:n,direction:i}=e,a="find"+r[0].toUpperCase()+r.slice(1,-1);t.prototype[a]=function(g,m,w){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return!1;if(arguments.length===1)return w=g,ID(!0,this,n,w);if(arguments.length===2){g=""+g,w=m;const b=this._nodes.get(g);if(typeof b>"u")throw new kt(`Graph.${a}: could not find the "${g}" node in the graph.`);return MT(!0,this.multi,n==="mixed"?this.type:n,i,b,w)}if(arguments.length===3){g=""+g,m=""+m;const b=this._nodes.get(g);if(!b)throw new kt(`Graph.${a}:  could not find the "${g}" source node in the graph.`);if(!this._nodes.has(m))throw new kt(`Graph.${a}:  could not find the "${m}" target node in the graph.`);return LT(!0,n,this.multi,i,b,m,w)}throw new Wt(`Graph.${a}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const h="some"+r[0].toUpperCase()+r.slice(1,-1);t.prototype[h]=function(){const g=Array.prototype.slice.call(arguments),m=g.pop();return g.push((b,I,A,z,V,H,Z)=>m(b,I,A,z,V,H,Z)),!!this[a].apply(this,g)};const s="every"+r[0].toUpperCase()+r.slice(1,-1);t.prototype[s]=function(){const g=Array.prototype.slice.call(arguments),m=g.pop();return g.push((b,I,A,z,V,H,Z)=>!m(b,I,A,z,V,H,Z)),!this[a].apply(this,g)}}function WG(t,e){const{name:r,type:n,direction:i}=e,a=r.slice(0,-1)+"Entries";t.prototype[a]=function(h,s){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return vl.empty();if(!arguments.length)return UG(this,n);if(arguments.length===1){h=""+h;const g=this._nodes.get(h);if(!g)throw new kt(`Graph.${a}: could not find the "${h}" node in the graph.`);return VG(n,i,g)}if(arguments.length===2){h=""+h,s=""+s;const g=this._nodes.get(h);if(!g)throw new kt(`Graph.${a}:  could not find the "${h}" source node in the graph.`);if(!this._nodes.has(s))throw new kt(`Graph.${a}:  could not find the "${s}" target node in the graph.`);return qG(n,i,g,s)}throw new Wt(`Graph.${a}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function HG(t){NG.forEach(e=>{$G(t,e),ZG(t,e),XG(t,e),WG(t,e)})}const KG=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function k1(){this.A=null,this.B=null}k1.prototype.wrap=function(t){this.A===null?this.A=t:this.B===null&&(this.B=t)};k1.prototype.has=function(t){return this.A!==null&&t in this.A||this.B!==null&&t in this.B};function sy(t,e,r,n,i){for(const a in n){const h=n[a],s=h.source,g=h.target,m=s===r?g:s;if(e&&e.has(m.key))continue;const w=i(m.key,m.attributes);if(t&&w)return m.key}}function OT(t,e,r,n,i){if(e!=="mixed"){if(e==="undirected")return sy(t,null,n,n.undirected,i);if(typeof r=="string")return sy(t,null,n,n[r],i)}const a=new k1;let h;if(e!=="undirected"){if(r!=="out"){if(h=sy(t,null,n,n.in,i),t&&h)return h;a.wrap(n.in)}if(r!=="in"){if(h=sy(t,a,n,n.out,i),t&&h)return h;a.wrap(n.out)}}if(e!=="directed"&&(h=sy(t,a,n,n.undirected,i),t&&h))return h}function YG(t,e,r){if(t!=="mixed"){if(t==="undirected")return Object.keys(r.undirected);if(typeof e=="string")return Object.keys(r[e])}const n=[];return OT(!1,t,e,r,function(i){n.push(i)}),n}function ay(t,e,r){const n=Object.keys(r),i=n.length;let a=0;return new vl(function(){let s=null;do{if(a>=i)return t&&t.wrap(r),{done:!0};const g=r[n[a++]],m=g.source,w=g.target;if(s=m===e?w:m,t&&t.has(s.key)){s=null;continue}}while(s===null);return{done:!1,value:{neighbor:s.key,attributes:s.attributes}}})}function JG(t,e,r){if(t!=="mixed"){if(t==="undirected")return ay(null,r,r.undirected);if(typeof e=="string")return ay(null,r,r[e])}let n=vl.empty();const i=new k1;return t!=="undirected"&&(e!=="out"&&(n=wc(n,ay(i,r,r.in))),e!=="in"&&(n=wc(n,ay(i,r,r.out)))),t!=="directed"&&(n=wc(n,ay(i,r,r.undirected))),n}function QG(t,e){const{name:r,type:n,direction:i}=e;t.prototype[r]=function(a){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return[];a=""+a;const h=this._nodes.get(a);if(typeof h>"u")throw new kt(`Graph.${r}: could not find the "${a}" node in the graph.`);return YG(n==="mixed"?this.type:n,i,h)}}function eV(t,e){const{name:r,type:n,direction:i}=e,a="forEach"+r[0].toUpperCase()+r.slice(1,-1);t.prototype[a]=function(m,w){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return;m=""+m;const b=this._nodes.get(m);if(typeof b>"u")throw new kt(`Graph.${a}: could not find the "${m}" node in the graph.`);OT(!1,n==="mixed"?this.type:n,i,b,w)};const h="map"+r[0].toUpperCase()+r.slice(1);t.prototype[h]=function(m,w){const b=[];return this[a](m,(I,A)=>{b.push(w(I,A))}),b};const s="filter"+r[0].toUpperCase()+r.slice(1);t.prototype[s]=function(m,w){const b=[];return this[a](m,(I,A)=>{w(I,A)&&b.push(I)}),b};const g="reduce"+r[0].toUpperCase()+r.slice(1);t.prototype[g]=function(m,w,b){if(arguments.length<3)throw new Wt(`Graph.${g}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let I=b;return this[a](m,(A,z)=>{I=w(I,A,z)}),I}}function tV(t,e){const{name:r,type:n,direction:i}=e,a=r[0].toUpperCase()+r.slice(1,-1),h="find"+a;t.prototype[h]=function(m,w){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return;m=""+m;const b=this._nodes.get(m);if(typeof b>"u")throw new kt(`Graph.${h}: could not find the "${m}" node in the graph.`);return OT(!0,n==="mixed"?this.type:n,i,b,w)};const s="some"+a;t.prototype[s]=function(m,w){return!!this[h](m,w)};const g="every"+a;t.prototype[g]=function(m,w){return!this[h](m,(I,A)=>!w(I,A))}}function rV(t,e){const{name:r,type:n,direction:i}=e,a=r.slice(0,-1)+"Entries";t.prototype[a]=function(h){if(n!=="mixed"&&this.type!=="mixed"&&n!==this.type)return vl.empty();h=""+h;const s=this._nodes.get(h);if(typeof s>"u")throw new kt(`Graph.${a}: could not find the "${h}" node in the graph.`);return JG(n==="mixed"?this.type:n,i,s)}}function nV(t){KG.forEach(e=>{QG(t,e),eV(t,e),tV(t,e),rV(t,e)})}function a0(t,e,r,n,i){const a=n._nodes.values(),h=n.type;let s,g,m,w,b,I,A;for(;s=a.next(),s.done!==!0;){let z=!1;if(g=s.value,h!=="undirected"){w=g.out;for(m in w){b=w[m];do{if(I=b.target,z=!0,A=i(g.key,I.key,g.attributes,I.attributes,b.key,b.attributes,b.undirected),t&&A)return b;b=b.next}while(b)}}if(h!=="directed"){w=g.undirected;for(m in w)if(!(e&&g.key>m)){b=w[m];do{if(I=b.target,I.key!==m&&(I=b.source),z=!0,A=i(g.key,I.key,g.attributes,I.attributes,b.key,b.attributes,b.undirected),t&&A)return b;b=b.next}while(b)}}if(r&&!z&&(A=i(g.key,null,g.attributes,null,null,null,null),t&&A))return null}}function iV(t,e){const r={key:t};return vD(e.attributes)||(r.attributes=Uo({},e.attributes)),r}function oV(t,e,r){const n={key:e,source:r.source.key,target:r.target.key};return vD(r.attributes)||(n.attributes=Uo({},r.attributes)),t==="mixed"&&r.undirected&&(n.undirected=!0),n}function sV(t){if(!ms(t))throw new Wt('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in t))throw new Wt("Graph.import: serialized node is missing its key.");if("attributes"in t&&(!ms(t.attributes)||t.attributes===null))throw new Wt("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function aV(t){if(!ms(t))throw new Wt('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in t))throw new Wt("Graph.import: serialized edge is missing its source.");if(!("target"in t))throw new Wt("Graph.import: serialized edge is missing its target.");if("attributes"in t&&(!ms(t.attributes)||t.attributes===null))throw new Wt("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in t&&typeof t.undirected!="boolean")throw new Wt("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const lV=cG(),uV=new Set(["directed","undirected","mixed"]),mA=new Set(["domain","_events","_eventsCount","_maxListeners"]),cV=[{name:t=>`${t}Edge`,generateKey:!0},{name:t=>`${t}DirectedEdge`,generateKey:!0,type:"directed"},{name:t=>`${t}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:t=>`${t}EdgeWithKey`},{name:t=>`${t}DirectedEdgeWithKey`,type:"directed"},{name:t=>`${t}UndirectedEdgeWithKey`,type:"undirected"}],hV={allowSelfLoops:!0,multi:!1,type:"mixed"};function fV(t,e,r){if(r&&!ms(r))throw new Wt(`Graph.addNode: invalid attributes. Expecting an object but got "${r}"`);if(e=""+e,r=r||{},t._nodes.has(e))throw new Er(`Graph.addNode: the "${e}" node already exist in the graph.`);const n=new t.NodeDataClass(e,r);return t._nodes.set(e,n),t.emit("nodeAdded",{key:e,attributes:r}),n}function yA(t,e,r){const n=new t.NodeDataClass(e,r);return t._nodes.set(e,n),t.emit("nodeAdded",{key:e,attributes:r}),n}function PD(t,e,r,n,i,a,h,s){if(!n&&t.type==="undirected")throw new Er(`Graph.${e}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(n&&t.type==="directed")throw new Er(`Graph.${e}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!ms(s))throw new Wt(`Graph.${e}: invalid attributes. Expecting an object but got "${s}"`);if(a=""+a,h=""+h,s=s||{},!t.allowSelfLoops&&a===h)throw new Er(`Graph.${e}: source & target are the same ("${a}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const g=t._nodes.get(a),m=t._nodes.get(h);if(!g)throw new kt(`Graph.${e}: source node "${a}" not found.`);if(!m)throw new kt(`Graph.${e}: target node "${h}" not found.`);const w={key:null,undirected:n,source:a,target:h,attributes:s};if(r)i=t._edgeKeyGenerator();else if(i=""+i,t._edges.has(i))throw new Er(`Graph.${e}: the "${i}" edge already exists in the graph.`);if(!t.multi&&(n?typeof g.undirected[h]<"u":typeof g.out[h]<"u"))throw new Er(`Graph.${e}: an edge linking "${a}" to "${h}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const b=new vg(n,i,g,m,s);t._edges.set(i,b);const I=a===h;return n?(g.undirectedDegree++,m.undirectedDegree++,I&&(g.undirectedLoops++,t._undirectedSelfLoopCount++)):(g.outDegree++,m.inDegree++,I&&(g.directedLoops++,t._directedSelfLoopCount++)),t.multi?b.attachMulti():b.attach(),n?t._undirectedSize++:t._directedSize++,w.key=i,t.emit("edgeAdded",w),i}function pV(t,e,r,n,i,a,h,s,g){if(!n&&t.type==="undirected")throw new Er(`Graph.${e}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(n&&t.type==="directed")throw new Er(`Graph.${e}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(g){if(typeof s!="function")throw new Wt(`Graph.${e}: invalid updater function. Expecting a function but got "${s}"`)}else if(!ms(s))throw new Wt(`Graph.${e}: invalid attributes. Expecting an object but got "${s}"`)}a=""+a,h=""+h;let m;if(g&&(m=s,s=void 0),!t.allowSelfLoops&&a===h)throw new Er(`Graph.${e}: source & target are the same ("${a}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let w=t._nodes.get(a),b=t._nodes.get(h),I,A;if(!r&&(I=t._edges.get(i),I)){if((I.source.key!==a||I.target.key!==h)&&(!n||I.source.key!==h||I.target.key!==a))throw new Er(`Graph.${e}: inconsistency detected when attempting to merge the "${i}" edge with "${a}" source & "${h}" target vs. ("${I.source.key}", "${I.target.key}").`);A=I}if(!A&&!t.multi&&w&&(A=n?w.undirected[h]:w.out[h]),A){const D=[A.key,!1,!1,!1];if(g?!m:!s)return D;if(g){const k=A.attributes;A.attributes=m(k),t.emit("edgeAttributesUpdated",{type:"replace",key:A.key,attributes:A.attributes})}else Uo(A.attributes,s),t.emit("edgeAttributesUpdated",{type:"merge",key:A.key,attributes:A.attributes,data:s});return D}s=s||{},g&&m&&(s=m(s));const z={key:null,undirected:n,source:a,target:h,attributes:s};if(r)i=t._edgeKeyGenerator();else if(i=""+i,t._edges.has(i))throw new Er(`Graph.${e}: the "${i}" edge already exists in the graph.`);let V=!1,H=!1;w||(w=yA(t,a,{}),V=!0,a===h&&(b=w,H=!0)),b||(b=yA(t,h,{}),H=!0),I=new vg(n,i,w,b,s),t._edges.set(i,I);const Z=a===h;return n?(w.undirectedDegree++,b.undirectedDegree++,Z&&(w.undirectedLoops++,t._undirectedSelfLoopCount++)):(w.outDegree++,b.inDegree++,Z&&(w.directedLoops++,t._directedSelfLoopCount++)),t.multi?I.attachMulti():I.attach(),n?t._undirectedSize++:t._directedSize++,z.key=i,t.emit("edgeAdded",z),[i,!0,V,H]}function yd(t,e){t._edges.delete(e.key);const{source:r,target:n,attributes:i}=e,a=e.undirected,h=r===n;a?(r.undirectedDegree--,n.undirectedDegree--,h&&(r.undirectedLoops--,t._undirectedSelfLoopCount--)):(r.outDegree--,n.inDegree--,h&&(r.directedLoops--,t._directedSelfLoopCount--)),t.multi?e.detachMulti():e.detach(),a?t._undirectedSize--:t._directedSize--,t.emit("edgeDropped",{key:e.key,attributes:i,source:r.key,target:n.key,undirected:a})}class wi extends Q7.EventEmitter{constructor(e){if(super(),e=Uo({},hV,e),typeof e.multi!="boolean")throw new Wt(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${e.multi}".`);if(!uV.has(e.type))throw new Wt(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${e.type}".`);if(typeof e.allowSelfLoops!="boolean")throw new Wt(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${e.allowSelfLoops}".`);const r=e.type==="mixed"?xD:e.type==="directed"?wD:ED;el(this,"NodeDataClass",r);const n="geid_"+lV()+"_";let i=0;const a=()=>{let h;do h=n+i++;while(this._edges.has(h));return h};el(this,"_attributes",{}),el(this,"_nodes",new Map),el(this,"_edges",new Map),el(this,"_directedSize",0),el(this,"_undirectedSize",0),el(this,"_directedSelfLoopCount",0),el(this,"_undirectedSelfLoopCount",0),el(this,"_edgeKeyGenerator",a),el(this,"_options",e),mA.forEach(h=>el(this,h,this[h])),$l(this,"order",()=>this._nodes.size),$l(this,"size",()=>this._edges.size),$l(this,"directedSize",()=>this._directedSize),$l(this,"undirectedSize",()=>this._undirectedSize),$l(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),$l(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),$l(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),$l(this,"multi",this._options.multi),$l(this,"type",this._options.type),$l(this,"allowSelfLoops",this._options.allowSelfLoops),$l(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(e){return this._nodes.has(""+e)}hasDirectedEdge(e,r){if(this.type==="undirected")return!1;if(arguments.length===1){const n=""+e,i=this._edges.get(n);return!!i&&!i.undirected}else if(arguments.length===2){e=""+e,r=""+r;const n=this._nodes.get(e);return n?n.out.hasOwnProperty(r):!1}throw new Wt(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(e,r){if(this.type==="directed")return!1;if(arguments.length===1){const n=""+e,i=this._edges.get(n);return!!i&&i.undirected}else if(arguments.length===2){e=""+e,r=""+r;const n=this._nodes.get(e);return n?n.undirected.hasOwnProperty(r):!1}throw new Wt(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(e,r){if(arguments.length===1){const n=""+e;return this._edges.has(n)}else if(arguments.length===2){e=""+e,r=""+r;const n=this._nodes.get(e);return n?typeof n.out<"u"&&n.out.hasOwnProperty(r)||typeof n.undirected<"u"&&n.undirected.hasOwnProperty(r):!1}throw new Wt(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(e,r){if(this.type==="undirected")return;if(e=""+e,r=""+r,this.multi)throw new Er("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const n=this._nodes.get(e);if(!n)throw new kt(`Graph.directedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(r))throw new kt(`Graph.directedEdge: could not find the "${r}" target node in the graph.`);const i=n.out&&n.out[r]||void 0;if(i)return i.key}undirectedEdge(e,r){if(this.type==="directed")return;if(e=""+e,r=""+r,this.multi)throw new Er("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const n=this._nodes.get(e);if(!n)throw new kt(`Graph.undirectedEdge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(r))throw new kt(`Graph.undirectedEdge: could not find the "${r}" target node in the graph.`);const i=n.undirected&&n.undirected[r]||void 0;if(i)return i.key}edge(e,r){if(this.multi)throw new Er("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.edge: could not find the "${e}" source node in the graph.`);if(!this._nodes.has(r))throw new kt(`Graph.edge: could not find the "${r}" target node in the graph.`);const i=n.out&&n.out[r]||n.undirected&&n.undirected[r]||void 0;if(i)return i.key}areDirectedNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areDirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:r in n.in||r in n.out}areOutNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areOutNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:r in n.out}areInNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areInNeighbors: could not find the "${e}" node in the graph.`);return this.type==="undirected"?!1:r in n.in}areUndirectedNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areUndirectedNeighbors: could not find the "${e}" node in the graph.`);return this.type==="directed"?!1:r in n.undirected}areNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&(r in n.in||r in n.out)||this.type!=="directed"&&r in n.undirected}areInboundNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areInboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&r in n.in||this.type!=="directed"&&r in n.undirected}areOutboundNeighbors(e,r){e=""+e,r=""+r;const n=this._nodes.get(e);if(!n)throw new kt(`Graph.areOutboundNeighbors: could not find the "${e}" node in the graph.`);return this.type!=="undirected"&&r in n.out||this.type!=="directed"&&r in n.undirected}inDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.inDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.inDegree}outDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.outDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.outDegree}directedDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.directedDegree: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.inDegree+r.outDegree}undirectedDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.undirectedDegree: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:r.undirectedDegree}inboundDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.inboundDegree: could not find the "${e}" node in the graph.`);let n=0;return this.type!=="directed"&&(n+=r.undirectedDegree),this.type!=="undirected"&&(n+=r.inDegree),n}outboundDegree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.outboundDegree: could not find the "${e}" node in the graph.`);let n=0;return this.type!=="directed"&&(n+=r.undirectedDegree),this.type!=="undirected"&&(n+=r.outDegree),n}degree(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.degree: could not find the "${e}" node in the graph.`);let n=0;return this.type!=="directed"&&(n+=r.undirectedDegree),this.type!=="undirected"&&(n+=r.inDegree+r.outDegree),n}inDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.inDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.inDegree-r.directedLoops}outDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.outDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.outDegree-r.directedLoops}directedDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.directedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="undirected"?0:r.inDegree+r.outDegree-r.directedLoops*2}undirectedDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);return this.type==="directed"?0:r.undirectedDegree-r.undirectedLoops*2}inboundDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let n=0,i=0;return this.type!=="directed"&&(n+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(n+=r.inDegree,i+=r.directedLoops),n-i}outboundDegreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let n=0,i=0;return this.type!=="directed"&&(n+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(n+=r.outDegree,i+=r.directedLoops),n-i}degreeWithoutSelfLoops(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.degreeWithoutSelfLoops: could not find the "${e}" node in the graph.`);let n=0,i=0;return this.type!=="directed"&&(n+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(n+=r.inDegree+r.outDegree,i+=r.directedLoops*2),n-i}source(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.source: could not find the "${e}" edge in the graph.`);return r.source.key}target(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.target: could not find the "${e}" edge in the graph.`);return r.target.key}extremities(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.extremities: could not find the "${e}" edge in the graph.`);return[r.source.key,r.target.key]}opposite(e,r){e=""+e,r=""+r;const n=this._edges.get(r);if(!n)throw new kt(`Graph.opposite: could not find the "${r}" edge in the graph.`);const i=n.source.key,a=n.target.key;if(e===i)return a;if(e===a)return i;throw new kt(`Graph.opposite: the "${e}" node is not attached to the "${r}" edge (${i}, ${a}).`)}hasExtremity(e,r){e=""+e,r=""+r;const n=this._edges.get(e);if(!n)throw new kt(`Graph.hasExtremity: could not find the "${e}" edge in the graph.`);return n.source.key===r||n.target.key===r}isUndirected(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.isUndirected: could not find the "${e}" edge in the graph.`);return r.undirected}isDirected(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.isDirected: could not find the "${e}" edge in the graph.`);return!r.undirected}isSelfLoop(e){e=""+e;const r=this._edges.get(e);if(!r)throw new kt(`Graph.isSelfLoop: could not find the "${e}" edge in the graph.`);return r.source===r.target}addNode(e,r){return fV(this,e,r).key}mergeNode(e,r){if(r&&!ms(r))throw new Wt(`Graph.mergeNode: invalid attributes. Expecting an object but got "${r}"`);e=""+e,r=r||{};let n=this._nodes.get(e);return n?(r&&(Uo(n.attributes,r),this.emit("nodeAttributesUpdated",{type:"merge",key:e,attributes:n.attributes,data:r})),[e,!1]):(n=new this.NodeDataClass(e,r),this._nodes.set(e,n),this.emit("nodeAdded",{key:e,attributes:r}),[e,!0])}updateNode(e,r){if(r&&typeof r!="function")throw new Wt(`Graph.updateNode: invalid updater function. Expecting a function but got "${r}"`);e=""+e;let n=this._nodes.get(e);if(n){if(r){const a=n.attributes;n.attributes=r(a),this.emit("nodeAttributesUpdated",{type:"replace",key:e,attributes:n.attributes})}return[e,!1]}const i=r?r({}):{};return n=new this.NodeDataClass(e,i),this._nodes.set(e,n),this.emit("nodeAdded",{key:e,attributes:i}),[e,!0]}dropNode(e){e=""+e;const r=this._nodes.get(e);if(!r)throw new kt(`Graph.dropNode: could not find the "${e}" node in the graph.`);let n;if(this.type!=="undirected"){for(const i in r.out){n=r.out[i];do yd(this,n),n=n.next;while(n)}for(const i in r.in){n=r.in[i];do yd(this,n),n=n.next;while(n)}}if(this.type!=="directed")for(const i in r.undirected){n=r.undirected[i];do yd(this,n),n=n.next;while(n)}this._nodes.delete(e),this.emit("nodeDropped",{key:e,attributes:r.attributes})}dropEdge(e){let r;if(arguments.length>1){const n=""+arguments[0],i=""+arguments[1];if(r=ll(this,n,i,this.type),!r)throw new kt(`Graph.dropEdge: could not find the "${n}" -> "${i}" edge in the graph.`)}else if(e=""+e,r=this._edges.get(e),!r)throw new kt(`Graph.dropEdge: could not find the "${e}" edge in the graph.`);return yd(this,r),this}dropDirectedEdge(e,r){if(arguments.length<2)throw new Er("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Er("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");e=""+e,r=""+r;const n=ll(this,e,r,"directed");if(!n)throw new kt(`Graph.dropDirectedEdge: could not find a "${e}" -> "${r}" edge in the graph.`);return yd(this,n),this}dropUndirectedEdge(e,r){if(arguments.length<2)throw new Er("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Er("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const n=ll(this,e,r,"undirected");if(!n)throw new kt(`Graph.dropUndirectedEdge: could not find a "${e}" -> "${r}" edge in the graph.`);return yd(this,n),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const e=this._nodes.values();let r;for(;r=e.next(),r.done!==!0;)r.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(e){return this._attributes[e]}getAttributes(){return this._attributes}hasAttribute(e){return this._attributes.hasOwnProperty(e)}setAttribute(e,r){return this._attributes[e]=r,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}updateAttribute(e,r){if(typeof r!="function")throw new Wt("Graph.updateAttribute: updater should be a function.");const n=this._attributes[e];return this._attributes[e]=r(n),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:e}),this}removeAttribute(e){return delete this._attributes[e],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:e}),this}replaceAttributes(e){if(!ms(e))throw new Wt("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=e,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(e){if(!ms(e))throw new Wt("Graph.mergeAttributes: provided attributes are not a plain object.");return Uo(this._attributes,e),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:e}),this}updateAttributes(e){if(typeof e!="function")throw new Wt("Graph.updateAttributes: provided updater is not a function.");return this._attributes=e(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(e,r){if(typeof e!="function")throw new Wt("Graph.updateEachNodeAttributes: expecting an updater function.");if(r&&!gA(r))throw new Wt("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const n=this._nodes.values();let i,a;for(;i=n.next(),i.done!==!0;)a=i.value,a.attributes=e(a.key,a.attributes);this.emit("eachNodeAttributesUpdated",{hints:r||null})}updateEachEdgeAttributes(e,r){if(typeof e!="function")throw new Wt("Graph.updateEachEdgeAttributes: expecting an updater function.");if(r&&!gA(r))throw new Wt("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const n=this._edges.values();let i,a,h,s;for(;i=n.next(),i.done!==!0;)a=i.value,h=a.source,s=a.target,a.attributes=e(a.key,a.attributes,h.key,s.key,h.attributes,s.attributes,a.undirected);this.emit("eachEdgeAttributesUpdated",{hints:r||null})}forEachAdjacencyEntry(e){if(typeof e!="function")throw new Wt("Graph.forEachAdjacencyEntry: expecting a callback.");a0(!1,!1,!1,this,e)}forEachAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new Wt("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");a0(!1,!1,!0,this,e)}forEachAssymetricAdjacencyEntry(e){if(typeof e!="function")throw new Wt("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");a0(!1,!0,!1,this,e)}forEachAssymetricAdjacencyEntryWithOrphans(e){if(typeof e!="function")throw new Wt("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");a0(!1,!0,!0,this,e)}nodes(){return typeof Array.from=="function"?Array.from(this._nodes.keys()):_D(this._nodes.keys(),this._nodes.size)}forEachNode(e){if(typeof e!="function")throw new Wt("Graph.forEachNode: expecting a callback.");const r=this._nodes.values();let n,i;for(;n=r.next(),n.done!==!0;)i=n.value,e(i.key,i.attributes)}findNode(e){if(typeof e!="function")throw new Wt("Graph.findNode: expecting a callback.");const r=this._nodes.values();let n,i;for(;n=r.next(),n.done!==!0;)if(i=n.value,e(i.key,i.attributes))return i.key}mapNodes(e){if(typeof e!="function")throw new Wt("Graph.mapNode: expecting a callback.");const r=this._nodes.values();let n,i;const a=new Array(this.order);let h=0;for(;n=r.next(),n.done!==!0;)i=n.value,a[h++]=e(i.key,i.attributes);return a}someNode(e){if(typeof e!="function")throw new Wt("Graph.someNode: expecting a callback.");const r=this._nodes.values();let n,i;for(;n=r.next(),n.done!==!0;)if(i=n.value,e(i.key,i.attributes))return!0;return!1}everyNode(e){if(typeof e!="function")throw new Wt("Graph.everyNode: expecting a callback.");const r=this._nodes.values();let n,i;for(;n=r.next(),n.done!==!0;)if(i=n.value,!e(i.key,i.attributes))return!1;return!0}filterNodes(e){if(typeof e!="function")throw new Wt("Graph.filterNodes: expecting a callback.");const r=this._nodes.values();let n,i;const a=[];for(;n=r.next(),n.done!==!0;)i=n.value,e(i.key,i.attributes)&&a.push(i.key);return a}reduceNodes(e,r){if(typeof e!="function")throw new Wt("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new Wt("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let n=r;const i=this._nodes.values();let a,h;for(;a=i.next(),a.done!==!0;)h=a.value,n=e(n,h.key,h.attributes);return n}nodeEntries(){const e=this._nodes.values();return new vl(()=>{const r=e.next();if(r.done)return r;const n=r.value;return{value:{node:n.key,attributes:n.attributes},done:!1}})}export(){const e=new Array(this._nodes.size);let r=0;this._nodes.forEach((i,a)=>{e[r++]=iV(a,i)});const n=new Array(this._edges.size);return r=0,this._edges.forEach((i,a)=>{n[r++]=oV(this.type,a,i)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:e,edges:n}}import(e,r=!1){if(e instanceof wi)return e.forEachNode((g,m)=>{r?this.mergeNode(g,m):this.addNode(g,m)}),e.forEachEdge((g,m,w,b,I,A,z)=>{r?z?this.mergeUndirectedEdgeWithKey(g,w,b,m):this.mergeDirectedEdgeWithKey(g,w,b,m):z?this.addUndirectedEdgeWithKey(g,w,b,m):this.addDirectedEdgeWithKey(g,w,b,m)}),this;if(!ms(e))throw new Wt("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(e.attributes){if(!ms(e.attributes))throw new Wt("Graph.import: invalid attributes. Expecting a plain object.");r?this.mergeAttributes(e.attributes):this.replaceAttributes(e.attributes)}let n,i,a,h,s;if(e.nodes){if(a=e.nodes,!Array.isArray(a))throw new Wt("Graph.import: invalid nodes. Expecting an array.");for(n=0,i=a.length;n<i;n++){h=a[n],sV(h);const{key:g,attributes:m}=h;r?this.mergeNode(g,m):this.addNode(g,m)}}if(e.edges){let g=!1;if(this.type==="undirected"&&(g=!0),a=e.edges,!Array.isArray(a))throw new Wt("Graph.import: invalid edges. Expecting an array.");for(n=0,i=a.length;n<i;n++){s=a[n],aV(s);const{source:m,target:w,attributes:b,undirected:I=g}=s;let A;"key"in s?(A=r?I?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:I?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,A.call(this,s.key,m,w,b)):(A=r?I?this.mergeUndirectedEdge:this.mergeDirectedEdge:I?this.addUndirectedEdge:this.addDirectedEdge,A.call(this,m,w,b))}}return this}nullCopy(e){const r=new wi(Uo({},this._options,e));return r.replaceAttributes(Uo({},this.getAttributes())),r}emptyCopy(e){const r=this.nullCopy(e);return this._nodes.forEach((n,i)=>{const a=Uo({},n.attributes);n=new r.NodeDataClass(i,a),r._nodes.set(i,n)}),r}copy(e){if(e=e||{},typeof e.type=="string"&&e.type!==this.type&&e.type!=="mixed")throw new Er(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${e.type}" because this would mean losing information about the current graph.`);if(typeof e.multi=="boolean"&&e.multi!==this.multi&&e.multi!==!0)throw new Er("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof e.allowSelfLoops=="boolean"&&e.allowSelfLoops!==this.allowSelfLoops&&e.allowSelfLoops!==!0)throw new Er("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const r=this.emptyCopy(e),n=this._edges.values();let i,a;for(;i=n.next(),i.done!==!0;)a=i.value,PD(r,"copy",!1,a.undirected,a.key,a.source.key,a.target.key,Uo({},a.attributes));return r}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const e={};this._nodes.forEach((a,h)=>{e[h]=a.attributes});const r={},n={};this._edges.forEach((a,h)=>{const s=a.undirected?"--":"->";let g="",m=a.source.key,w=a.target.key,b;a.undirected&&m>w&&(b=m,m=w,w=b);const I=`(${m})${s}(${w})`;h.startsWith("geid_")?this.multi&&(typeof n[I]>"u"?n[I]=0:n[I]++,g+=`${n[I]}. `):g+=`[${h}]: `,g+=I,r[g]=a.attributes});const i={};for(const a in this)this.hasOwnProperty(a)&&!mA.has(a)&&typeof this[a]!="function"&&typeof a!="symbol"&&(i[a]=this[a]);return i.attributes=this._attributes,i.nodes=e,i.edges=r,el(i,"constructor",this.constructor),i}}typeof Symbol<"u"&&(wi.prototype[Symbol.for("nodejs.util.inspect.custom")]=wi.prototype.inspect);cV.forEach(t=>{["add","merge","update"].forEach(e=>{const r=t.name(e),n=e==="add"?PD:pV;t.generateKey?wi.prototype[r]=function(i,a,h){return n(this,r,!0,(t.type||this.type)==="undirected",null,i,a,h,e==="update")}:wi.prototype[r]=function(i,a,h,s){return n(this,r,!1,(t.type||this.type)==="undirected",i,a,h,s,e==="update")}})});EG(wi);DG(wi);HG(wi);nV(wi);class CD extends wi{constructor(e){const r=Uo({type:"directed"},e);if("multi"in r&&r.multi!==!1)throw new Wt("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(r.type!=="directed")throw new Wt('DirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class AD extends wi{constructor(e){const r=Uo({type:"undirected"},e);if("multi"in r&&r.multi!==!1)throw new Wt("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(r.type!=="undirected")throw new Wt('UndirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class MD extends wi{constructor(e){const r=Uo({multi:!0},e);if("multi"in r&&r.multi!==!0)throw new Wt("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(r)}}class LD extends wi{constructor(e){const r=Uo({type:"directed",multi:!0},e);if("multi"in r&&r.multi!==!0)throw new Wt("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(r.type!=="directed")throw new Wt('MultiDirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class OD extends wi{constructor(e){const r=Uo({type:"undirected",multi:!0},e);if("multi"in r&&r.multi!==!0)throw new Wt("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(r.type!=="undirected")throw new Wt('MultiUndirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}function xg(t){t.from=function(e,r){const n=Uo({},e.options,r),i=new t(n);return i.import(e),i}}xg(wi);xg(CD);xg(AD);xg(MD);xg(LD);xg(OD);wi.Graph=wi;wi.DirectedGraph=CD;wi.UndirectedGraph=AD;wi.MultiGraph=MD;wi.MultiDirectedGraph=LD;wi.MultiUndirectedGraph=OD;wi.InvalidArgumentsGraphError=Wt;wi.NotFoundGraphError=kt;wi.UsageGraphError=Er;var wg={},DD=function(e){return e!==null&&typeof e=="object"&&typeof e.addUndirectedEdgeWithKey=="function"&&typeof e.dropNode=="function"&&typeof e.multi=="boolean"},ND=R1,dV=ND.ARRAY_BUFFER_SUPPORT,gV=ND.SYMBOL_SUPPORT,DT=function(e,r){var n,i,a,h,s;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof r!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||dV&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(a=0,h=e.length;a<h;a++)r(e[a],a);return}if(typeof e.forEach=="function"){e.forEach(r);return}if(gV&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(n=e,a=0;s=n.next(),s.done!==!0;)r(s.value,a),a++;return}for(i in e)e.hasOwnProperty(i)&&r(e[i],i)},RD=N1,mV=DT;function yo(){this.clear()}yo.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};yo.prototype.enqueue=function(t){return this.items.push(t),++this.size};yo.prototype.dequeue=function(){if(this.size){var t=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,t}};yo.prototype.peek=function(){if(this.size)return this.items[this.offset]};yo.prototype.forEach=function(t,e){e=arguments.length>1?e:this;for(var r=this.offset,n=0,i=this.items.length;r<i;r++,n++)t.call(e,this.items[r],n,this)};yo.prototype.toArray=function(){return this.items.slice(this.offset)};yo.prototype.values=function(){var t=this.items,e=this.offset;return new RD(function(){if(e>=t.length)return{done:!0};var r=t[e];return e++,{value:r,done:!1}})};yo.prototype.entries=function(){var t=this.items,e=this.offset,r=0;return new RD(function(){if(e>=t.length)return{done:!0};var n=t[e];return e++,{value:[r++,n],done:!1}})};typeof Symbol<"u"&&(yo.prototype[Symbol.iterator]=yo.prototype.values);yo.prototype.toString=function(){return this.toArray().join(",")};yo.prototype.toJSON=function(){return this.toArray()};yo.prototype.inspect=function(){var t=this.toArray();return Object.defineProperty(t,"constructor",{value:yo,enumerable:!1}),t};typeof Symbol<"u"&&(yo.prototype[Symbol.for("nodejs.util.inspect.custom")]=yo.prototype.inspect);yo.from=function(t){var e=new yo;return mV(t,function(r){e.enqueue(r)}),e};yo.of=function(){return yo.from(arguments)};var yV=yo,_V=function(e,r){var n=r.length;if(n!==0){var i=e.length;e.length+=n;for(var a=0;a<n;a++)e[i+a]=r[a]}},NT=DD,vV=yV,xV=_V;function wV(t,e,r){if(!NT(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');if(!t.hasNode(r))throw new Error('graphology-shortest-path: the "'+r+'" target node does not exist in the given graph.');if(e=""+e,r=""+r,e===r)return[e];var n=t.inboundNeighbors.bind(t),i=t.outboundNeighbors.bind(t),a={},h={};a[e]=null,h[r]=null;var s=[e],g=[r],m,w,b,I,A,z,V,H,Z=!1;e:for(;s.length&&g.length;)if(s.length<=g.length){for(m=s,s=[],A=0,V=m.length;A<V;A++)for(w=m[A],b=i(w),z=0,H=b.length;z<H;z++)if(I=b[z],I in a||(s.push(I),a[I]=w),I in h){Z=!0;break e}}else for(m=g,g=[],A=0,V=m.length;A<V;A++)for(w=m[A],b=n(w),z=0,H=b.length;z<H;z++)if(I=b[z],I in h||(g.push(I),h[I]=w),I in a){Z=!0;break e}if(!Z)return null;for(var D=[];I;)D.unshift(I),I=a[I];for(I=h[D[D.length-1]];I;)D.push(I),I=h[I];return D.length?D:null}function EV(t,e){if(!NT(t))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!t.hasNode(e))throw new Error('graphology-shortest-path: the "'+e+'" source node does not exist in the given graph.');e=""+e;var r={},n={},i,a,h,s,g,m;for(r[e]=!0,n[e]=[e];Object.keys(r).length;){i=r,r={};for(h in i)for(a=t.outboundNeighbors(h),g=0,m=a.length;g<m;g++)s=a[g],n[s]||(n[s]=n[h].concat(s),r[s]=!0)}return n}function kD(t,e,r){if(!NT(e))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!e.hasNode(r))throw new Error('graphology-shortest-path: the "'+r+'" source node does not exist in the given graph.');r=""+r;var n=new Set,i={},a=0;i[r]=0;for(var h=[r],s,g,m;h.length!==0;){var w=[];for(s=0,g=h.length;s<g;s++)m=h[s],!n.has(m)&&(n.add(m),xV(w,e[t](m)),i[m]=a);a++,h=w}return i}var bV=kD.bind(null,"outboundNeighbors"),TV=kD.bind(null,"neighbors");function SV(t,e){e=""+e;var r=[],n={},i={},a=t.nodes(),h,s,g,m,w,b,I,A,z;for(b=0,A=a.length;b<A;b++)m=a[b],n[m]=[],i[m]=0;var V={};i[e]=1,V[e]=0;for(var H=vV.of(e);H.size;)for(m=H.dequeue(),r.push(m),h=V[m],s=i[m],g=t.outboundNeighbors(m),I=0,z=g.length;I<z;I++)w=g[I],w in V||(H.enqueue(w),V[w]=h+1),V[w]===h+1&&(i[w]+=s,n[w].push(m));return[r,n,i]}wg.bidirectional=wV;wg.singleSource=EV;wg.singleSourceLength=bV;wg.undirectedSingleSourceLength=TV;wg.brandes=SV;var RT={},F1={};function IV(t){return typeof t!="number"||isNaN(t)?1:t}function PV(t,e){var r={},n=function(h){return typeof h>"u"?e:h};typeof e=="function"&&(n=e);var i=function(h){return n(h[t])},a=function(){return n(void 0)};return typeof t=="string"?(r.fromAttributes=i,r.fromGraph=function(h,s){return i(h.getNodeAttributes(s))},r.fromEntry=function(h,s){return i(s)}):typeof t=="function"?(r.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},r.fromGraph=function(h,s){return n(t(s,h.getNodeAttributes(s)))},r.fromEntry=function(h,s){return n(t(h,s))}):(r.fromAttributes=a,r.fromGraph=a,r.fromEntry=a),r}function FD(t,e){var r={},n=function(h){return typeof h>"u"?e:h};typeof e=="function"&&(n=e);var i=function(h){return n(h[t])},a=function(){return n(void 0)};return typeof t=="string"?(r.fromAttributes=i,r.fromGraph=function(h,s){return i(h.getEdgeAttributes(s))},r.fromEntry=function(h,s){return i(s)},r.fromPartialEntry=r.fromEntry,r.fromMinimalEntry=r.fromEntry):typeof t=="function"?(r.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},r.fromGraph=function(h,s){var g=h.extremities(s);return n(t(s,h.getEdgeAttributes(s),g[0],g[1],h.getNodeAttributes(g[0]),h.getNodeAttributes(g[1]),h.isUndirected(s)))},r.fromEntry=function(h,s,g,m,w,b,I){return n(t(h,s,g,m,w,b,I))},r.fromPartialEntry=function(h,s,g,m){return n(t(h,s,g,m))},r.fromMinimalEntry=function(h,s){return n(t(h,s))}):(r.fromAttributes=a,r.fromGraph=a,r.fromEntry=a,r.fromMinimalEntry=a),r}F1.createNodeValueGetter=PV;F1.createEdgeValueGetter=FD;F1.createEdgeWeightGetter=function(t){return FD(t,IV)};var p_={},CV=function(t,e){return t<e?-1:t>e?1:0},AV=function(t,e){return t<e?1:t>e?-1:0};function MV(t){return function(e,r){return t(r,e)}}function LV(t){return t===2?function(e,r){return e[0]<r[0]?-1:e[0]>r[0]?1:e[1]<r[1]?-1:e[1]>r[1]?1:0}:function(e,r){for(var n=0;n<t;){if(e[n]<r[n])return-1;if(e[n]>r[n])return 1;n++}return 0}}p_.DEFAULT_COMPARATOR=CV;p_.DEFAULT_REVERSE_COMPARATOR=AV;p_.reverseComparator=MV;p_.createTupleComparator=LV;var d_={},zD={};(function(t){var e=Math.pow(2,8)-1,r=Math.pow(2,16)-1,n=Math.pow(2,32)-1,i=Math.pow(2,7)-1,a=Math.pow(2,15)-1,h=Math.pow(2,31)-1;t.getPointerArray=function(g){var m=g-1;if(m<=e)return Uint8Array;if(m<=r)return Uint16Array;if(m<=n)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},t.getSignedPointerArray=function(g){var m=g-1;return m<=i?Int8Array:m<=a?Int16Array:m<=h?Int32Array:Float64Array},t.getNumberType=function(g){return g===(g|0)?Math.sign(g)===-1?g<=127&&g>=-128?Int8Array:g<=32767&&g>=-32768?Int16Array:Int32Array:g<=255?Uint8Array:g<=65535?Uint16Array:Uint32Array:Float64Array};var s={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};t.getMinimalRepresentation=function(g,m){var w=null,b=0,I,A,z,V,H;for(V=0,H=g.length;V<H;V++)z=m?m(g[V]):g[V],A=t.getNumberType(z),I=s[A.name],I>b&&(b=I,w=A);return w},t.isTypedArray=function(g){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(g)},t.concat=function(){var g=0,m,w,b;for(m=0,b=arguments.length;m<b;m++)g+=arguments[m].length;var I=new arguments[0].constructor(g);for(m=0,w=0;m<b;m++)I.set(arguments[m],w),w+=arguments[m].length;return I},t.indices=function(g){for(var m=t.getPointerArray(g),w=new m(g),b=0;b<g;b++)w[b]=b;return w}})(zD);var BD=DT,UD=zD;function OV(t){return Array.isArray(t)||UD.isTypedArray(t)}function kT(t){if(typeof t.length=="number")return t.length;if(typeof t.size=="number")return t.size}function DV(t){var e=kT(t),r=typeof e=="number"?new Array(e):[],n=0;return BD(t,function(i){r[n++]=i}),r}function NV(t){var e=kT(t),r=typeof e=="number"?UD.getPointerArray(e):Array,n=typeof e=="number"?new Array(e):[],i=typeof e=="number"?new r(e):[],a=0;return BD(t,function(h){n[a]=h,i[a]=a++}),[n,i]}d_.isArrayLike=OV;d_.guessLength=kT;d_.toArray=DV;d_.toArrayWithIndices=NV;var X0=DT,GD=p_,Fu=d_,z1=GD.DEFAULT_COMPARATOR,FT=GD.reverseComparator;function zT(t,e,r,n){for(var i=e[n],a,h;n>r;){if(a=n-1>>1,h=e[a],t(i,h)<0){e[n]=h,n=a;continue}break}e[n]=i}function g_(t,e,r){for(var n=e.length,i=r,a=e[r],h=2*r+1,s;h<n;)s=h+1,s<n&&t(e[h],e[s])>=0&&(h=s),e[r]=e[h],r=h,h=2*r+1;e[r]=a,zT(t,e,i,r)}function VD(t,e,r){e.push(r),zT(t,e,0,e.length-1)}function BT(t,e){var r=e.pop();if(e.length!==0){var n=e[0];return e[0]=r,g_(t,e,0),n}return r}function ug(t,e,r){if(e.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var n=e[0];return e[0]=r,g_(t,e,0),n}function jD(t,e,r){var n;return e.length!==0&&t(e[0],r)<0&&(n=e[0],e[0]=r,r=n,g_(t,e,0)),r}function lp(t,e){for(var r=e.length,n=r>>1,i=n;--i>=0;)g_(t,e,i)}function UT(t,e){for(var r=e.length,n=0,i=new Array(r);n<r;)i[n++]=BT(t,e);return i}function RV(t,e,r){arguments.length===2&&(r=e,e=t,t=z1);var n=FT(t),i,a,h,s=1/0,g;if(e===1){if(Fu.isArrayLike(r)){for(i=0,a=r.length;i<a;i++)h=r[i],(s===1/0||t(h,s)<0)&&(s=h);return g=new r.constructor(1),g[0]=s,g}return X0(r,function(w){(s===1/0||t(w,s)<0)&&(s=w)}),[s]}if(Fu.isArrayLike(r)){if(e>=r.length)return r.slice().sort(t);for(g=r.slice(0,e),lp(n,g),i=e,a=r.length;i<a;i++)n(r[i],g[0])>0&&ug(n,g,r[i]);return g.sort(t)}var m=Fu.guessLength(r);return m!==null&&m<e&&(e=m),g=new Array(e),i=0,X0(r,function(w){i<e?g[i]=w:(i===e&&lp(n,g),n(w,g[0])>0&&ug(n,g,w)),i++}),g.length>i&&(g.length=i),g.sort(t)}function kV(t,e,r){arguments.length===2&&(r=e,e=t,t=z1);var n=FT(t),i,a,h,s=-1/0,g;if(e===1){if(Fu.isArrayLike(r)){for(i=0,a=r.length;i<a;i++)h=r[i],(s===-1/0||t(h,s)>0)&&(s=h);return g=new r.constructor(1),g[0]=s,g}return X0(r,function(w){(s===-1/0||t(w,s)>0)&&(s=w)}),[s]}if(Fu.isArrayLike(r)){if(e>=r.length)return r.slice().sort(n);for(g=r.slice(0,e),lp(t,g),i=e,a=r.length;i<a;i++)t(r[i],g[0])>0&&ug(t,g,r[i]);return g.sort(n)}var m=Fu.guessLength(r);return m!==null&&m<e&&(e=m),g=new Array(e),i=0,X0(r,function(w){i<e?g[i]=w:(i===e&&lp(t,g),t(w,g[0])>0&&ug(t,g,w)),i++}),g.length>i&&(g.length=i),g.sort(n)}function pi(t){if(this.clear(),this.comparator=t||z1,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}pi.prototype.clear=function(){this.items=[],this.size=0};pi.prototype.push=function(t){return VD(this.comparator,this.items,t),++this.size};pi.prototype.peek=function(){return this.items[0]};pi.prototype.pop=function(){return this.size!==0&&this.size--,BT(this.comparator,this.items)};pi.prototype.replace=function(t){return ug(this.comparator,this.items,t)};pi.prototype.pushpop=function(t){return jD(this.comparator,this.items,t)};pi.prototype.consume=function(){return this.size=0,UT(this.comparator,this.items)};pi.prototype.toArray=function(){return UT(this.comparator,this.items.slice())};pi.prototype.inspect=function(){var t=this.toArray();return Object.defineProperty(t,"constructor",{value:pi,enumerable:!1}),t};typeof Symbol<"u"&&(pi.prototype[Symbol.for("nodejs.util.inspect.custom")]=pi.prototype.inspect);function W0(t){if(this.clear(),this.comparator=t||z1,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=FT(this.comparator)}W0.prototype=pi.prototype;pi.from=function(t,e){var r=new pi(e),n;return Fu.isArrayLike(t)?n=t.slice():n=Fu.toArray(t),lp(r.comparator,n),r.items=n,r.size=n.length,r};W0.from=function(t,e){var r=new W0(e),n;return Fu.isArrayLike(t)?n=t.slice():n=Fu.toArray(t),lp(r.comparator,n),r.items=n,r.size=n.length,r};pi.siftUp=g_;pi.siftDown=zT;pi.push=VD;pi.pop=BT;pi.replace=ug;pi.pushpop=jD;pi.heapify=lp;pi.consume=UT;pi.nsmallest=RV;pi.nlargest=kV;pi.MinHeap=pi;pi.MaxHeap=W0;var FV=pi,qD=DD,GT=F1.createEdgeWeightGetter,H0=FV,VT="weight";function JE(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1]>e[1]?1:t[1]<e[1]?-1:t[2]>e[2]?1:t[2]<e[2]?-1:0}function zV(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1]>e[1]?1:t[1]<e[1]?-1:t[2]>e[2]?1:t[2]<e[2]?-1:t[3]>e[3]?1:t[3]<e[3]?-1:0}function BV(t,e,r,n){if(e=""+e,r=""+r,!qD(t))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(e&&!t.hasNode(e))throw new Error('graphology-shortest-path/dijkstra: the "'+e+'" source node does not exist in the given graph.');if(r&&!t.hasNode(r))throw new Error('graphology-shortest-path/dijkstra: the "'+r+'" target node does not exist in the given graph.');if(n=GT(n||VT).fromMinimalEntry,e===r)return[0,[e]];var i=[{},{}],a=[{},{}],h=[new H0(JE),new H0(JE)],s=[{},{}];a[0][e]=[e],a[1][r]=[r],s[0][e]=0,s[1][r]=0;var g=[],m=1/0,w=0,b=1,I,A,z,V,H,Z,D,k,j;for(h[0].push([0,w++,e]),h[1].push([0,w++,r]);h[0].size&&h[1].size;)if(b=1-b,I=h[b].pop(),V=I[0],H=I[2],!(H in i[b])){if(i[b][H]=V,H in i[1-b])return[m,g];for(A=b===1?t.inboundEdges(H):t.outboundEdges(H),k=0,j=A.length;k<j;k++){if(D=A[k],Z=t.opposite(H,D),z=i[b][H]+n(D,t.getEdgeAttributes(D)),Z in i[b]&&z<i[b][Z])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(Z in s[b])||z<s[b][Z])&&(s[b][Z]=z,h[b].push([z,w++,Z]),a[b][Z]=a[b][H].concat(Z),Z in s[0]&&Z in s[1]&&(V=s[0][Z]+s[1][Z],(g.length===0||m>V)&&(m=V,g=a[0][Z].concat(a[1][Z].slice(0,-1).reverse()))))}}return[1/0,null]}function UV(t,e,r,n,i,a){if(!qD(t))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(i&&!t.hasNode(i))throw new Error('graphology-shortest-path/dijkstra: the "'+i+'" target node does not exist in the given graph.');r=GT(r||VT).fromMinimalEntry;var h={},s={},g=new H0(JE),m=0,w,b,I,A,z,V,H,Z,D,k,j;for(Z=0,k=e.length;Z<k;Z++)A=e[Z],s[A]=0,g.push([0,m++,A]),a&&(a[A]=[A]);for(;g.size;)if(b=g.pop(),H=b[0],A=b[2],!(A in h)){if(h[A]=H,A===i)break;for(w=t.outboundEdges(A),D=0,j=w.length;D<j;D++)if(V=w[D],z=t.opposite(A,V),I=r(V,t.getEdgeAttributes(V))+h[A],!(n&&I>n)){if(z in h&&I<h[z])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(z in s)||I<s[z])&&(s[z]=I,g.push([I,m++,z]),a&&(a[z]=a[A].concat(z)))}}return h}function GV(t,e,r){var n={};return UV(t,[e],r,0,null,n),n}function VV(t,e,r,n){return BV(t,e,r,n)[1]}function jV(t,e,r){e=""+e,r=GT(r||VT).fromMinimalEntry;var n=[],i={},a={},h=t.nodes(),s,g,m,w,b,I,A,z,V,H;for(V=0,H=h.length;V<H;V++)I=h[V],i[I]=[],a[I]=0;var Z={};a[e]=1;var D={};D[e]=0;var k=0,j=new H0(zV);for(j.push([0,k++,e,e]);j.size;)if(g=j.pop(),w=g[0],m=g[2],I=g[3],!(I in Z))for(a[I]+=a[m],n.push(I),Z[I]=w,s=t.outboundEdges(I),V=0,H=s.length;V<H;V++)z=s[V],A=t.opposite(I,z),b=w+r(z,t.getEdgeAttributes(z)),!(A in Z)&&(!(A in D)||b<D[A])?(D[A]=b,j.push([b,k++,I,A]),a[A]=0,i[A]=[I]):b===D[A]&&(a[A]+=a[I],i[A].push(I));return[n,i,a]}RT.bidirectional=VV;RT.singleSource=GV;RT.brandes=jV;var m_=wg,qV=m_.bidirectional;m_.singleSource;m_.singleSourceLength;m_.undirectedSingleSourceLength;m_.brandes;const $V="FeatureCollection",ZV="PTV_METRO_TRAIN_STATION",XV={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},WV=[{type:"Feature",properties:{STOP_ID:"19970",LATITUDE:-37.781193,STOP_NAME:"Royal Park Railway Station (Parkville)",LONGITUDE:144.952301,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.95230120580877,-37.7811929725527]}},{type:"Feature",properties:{STOP_ID:"19971",LATITUDE:-37.78814,STOP_NAME:"Flemington Bridge Railway Station (North Melbourne)",LONGITUDE:144.939323,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.93932321237276,-37.788139984393844]}},{type:"Feature",properties:{STOP_ID:"19972",LATITUDE:-37.794267,STOP_NAME:"Macaulay Railway Station (North Melbourne)",LONGITUDE:144.936166,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.93616600406753,-37.79426700459872]}},{type:"Feature",properties:{STOP_ID:"19973",LATITUDE:-37.807419,STOP_NAME:"North Melbourne Railway Station (West Melbourne)",LONGITUDE:144.94257,TICKETZONE:"1",ROUTEUSSP:"Flemington,Sunbury,Upfield,Werribee,Williamstown,Craigieburn"},geometry:{type:"Point",coordinates:[144.94257002890663,-37.80741897361899]}},{type:"Feature",properties:{STOP_ID:"19974",LATITUDE:-37.788657,STOP_NAME:"Clifton Hill Railway Station (Clifton Hill)",LONGITUDE:144.995417,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.9954169601631,-37.78865703363607]}},{type:"Feature",properties:{STOP_ID:"19975",LATITUDE:-37.799158,STOP_NAME:"Victoria Park Railway Station (Abbotsford)",LONGITUDE:144.994451,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.9944510689111,-37.79915796626723]}},{type:"Feature",properties:{STOP_ID:"19976",LATITUDE:-37.804526,STOP_NAME:"Collingwood Railway Station (Abbotsford)",LONGITUDE:144.99375,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.99375014165992,-37.80452601640281]}},{type:"Feature",properties:{STOP_ID:"19977",LATITUDE:-37.810398,STOP_NAME:"North Richmond Railway Station (Richmond)",LONGITUDE:144.9925,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.9924998535909,-37.8103979761548]}},{type:"Feature",properties:{STOP_ID:"19978",LATITUDE:-37.814949,STOP_NAME:"West Richmond Railway Station (Richmond)",LONGITUDE:144.991423,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.991423087592,-37.81494900584843]}},{type:"Feature",properties:{STOP_ID:"19979",LATITUDE:-37.816527,STOP_NAME:"Jolimont-MCG Railway Station (East Melbourne)",LONGITUDE:144.984098,TICKETZONE:"1",ROUTEUSSP:"Mernda,Hurstbridge"},geometry:{type:"Point",coordinates:[144.9840981689869,-37.816526974237526]}},{type:"Feature",properties:{STOP_ID:"19983",LATITUDE:-37.726012,STOP_NAME:"Macleod Railway Station (Macleod)",LONGITUDE:145.069143,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.06914313196347,-37.72601198852847]}},{type:"Feature",properties:{STOP_ID:"19984",LATITUDE:-37.710958,STOP_NAME:"Watsonia Railway Station (Watsonia)",LONGITUDE:145.083793,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.08379299256393,-37.71095796058549]}},{type:"Feature",properties:{STOP_ID:"19985",LATITUDE:-37.703954,STOP_NAME:"Greensborough Railway Station (Greensborough)",LONGITUDE:145.108247,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.10824705206068,-37.703953978517774]}},{type:"Feature",properties:{STOP_ID:"19986",LATITUDE:-37.715296,STOP_NAME:"Montmorency Railway Station (Montmorency)",LONGITUDE:145.121516,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.121515927139,-37.715295960542775]}},{type:"Feature",properties:{STOP_ID:"19987",LATITUDE:-37.71355,STOP_NAME:"Eltham Railway Station (Eltham)",LONGITUDE:145.147822,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.14782184864805,-37.71354996061303]}},{type:"Feature",properties:{STOP_ID:"19988",LATITUDE:-37.673297,STOP_NAME:"Diamond Creek Railway Station (Diamond Creek)",LONGITUDE:145.158506,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.1585059320563,-37.67329701063555]}},{type:"Feature",properties:{STOP_ID:"19989",LATITUDE:-37.663968,STOP_NAME:"Wattle Glen Railway Station (Wattle Glen)",LONGITUDE:145.181615,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.18161506467828,-37.66396797039701]}},{type:"Feature",properties:{STOP_ID:"19990",LATITUDE:-37.639398,STOP_NAME:"Hurstbridge Railway Station (Hurstbridge)",LONGITUDE:145.192017,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.1920168942208,-37.639397969862365]}},{type:"Feature",properties:{STOP_ID:"19991",LATITUDE:-37.867753,STOP_NAME:"Williamstown Railway Station (Williamstown)",LONGITUDE:144.905323,TICKETZONE:"1",ROUTEUSSP:"Williamstown"},geometry:{type:"Point",coordinates:[144.90532295721854,-37.867752990404725]}},{type:"Feature",properties:{STOP_ID:"19992",LATITUDE:-37.863982,STOP_NAME:"Williamstown Beach Railway Station (Williamstown)",LONGITUDE:144.894484,TICKETZONE:"1",ROUTEUSSP:"Williamstown"},geometry:{type:"Point",coordinates:[144.89448409561462,-37.86398198938481]}},{type:"Feature",properties:{STOP_ID:"19993",LATITUDE:-37.857333,STOP_NAME:"North Williamstown Railway Station (Williamstown)",LONGITUDE:144.889069,TICKETZONE:"1",ROUTEUSSP:"Williamstown"},geometry:{type:"Point",coordinates:[144.88906897782545,-37.85733296977821]}},{type:"Feature",properties:{STOP_ID:"19994",LATITUDE:-37.842718,STOP_NAME:"Newport Railway Station (Newport)",LONGITUDE:144.8836,TICKETZONE:"1",ROUTEUSSP:"Williamstown,Werribee"},geometry:{type:"Point",coordinates:[144.88359986187862,-37.84271796018809]}},{type:"Feature",properties:{STOP_ID:"19995",LATITUDE:-37.830639,STOP_NAME:"Spotswood Railway Station (Spotswood)",LONGITUDE:144.885933,TICKETZONE:"1",ROUTEUSSP:"Williamstown,Werribee"},geometry:{type:"Point",coordinates:[144.8859330113764,-37.83063897072853]}},{type:"Feature",properties:{STOP_ID:"19996",LATITUDE:-37.81585,STOP_NAME:"Yarraville Railway Station (Yarraville)",LONGITUDE:144.889934,TICKETZONE:"1",ROUTEUSSP:"Williamstown,Werribee"},geometry:{type:"Point",coordinates:[144.8899340507632,-37.815849989791694]}},{type:"Feature",properties:{STOP_ID:"19997",LATITUDE:-37.809005,STOP_NAME:"Seddon Railway Station (Seddon)",LONGITUDE:144.895672,TICKETZONE:"1",ROUTEUSSP:"Williamstown,Werribee"},geometry:{type:"Point",coordinates:[144.89567208120746,-37.809005040754464]}},{type:"Feature",properties:{STOP_ID:"20000",LATITUDE:-37.701129,STOP_NAME:"Watergardens Railway Station (Sydenham)",LONGITUDE:144.77418,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.77418001840798,-37.70112896819069]}},{type:"Feature",properties:{STOP_ID:"20001",LATITUDE:-37.729279,STOP_NAME:"Keilor Plains Railway Station (St Albans)",LONGITUDE:144.793738,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.79373809136527,-37.72927898714574]}},{type:"Feature",properties:{STOP_ID:"20002",LATITUDE:-37.744861,STOP_NAME:"St Albans Railway Station (St Albans)",LONGITUDE:144.80005,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.8000499727449,-37.74486095681743]}},{type:"Feature",properties:{STOP_ID:"20003",LATITUDE:-37.760067,STOP_NAME:"Ginifer Railway Station (St Albans)",LONGITUDE:144.811348,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.81134785114367,-37.76006699999778]}},{type:"Feature",properties:{STOP_ID:"20004",LATITUDE:-37.777653,STOP_NAME:"Albion Railway Station (Sunshine North)",LONGITUDE:144.824704,TICKETZONE:"1,2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.82470386247024,-37.77765299958764]}},{type:"Feature",properties:{STOP_ID:"20005",LATITUDE:-37.652187,STOP_NAME:"Epping Railway Station (Epping)",LONGITUDE:145.031068,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.03106807483192,-37.65218696812649]}},{type:"Feature",properties:{STOP_ID:"20006",LATITUDE:-37.665851,STOP_NAME:"Lalor Railway Station (Lalor)",LONGITUDE:145.017193,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.01719296110826,-37.665851039818996]}},{type:"Feature",properties:{STOP_ID:"20007",LATITUDE:-37.680338,STOP_NAME:"Thomastown Railway Station (Thomastown)",LONGITUDE:145.014279,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.01427914567134,-37.680337978698795]}},{type:"Feature",properties:{STOP_ID:"20008",LATITUDE:-37.69487,STOP_NAME:"Keon Park Railway Station (Thomastown)",LONGITUDE:145.011884,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.01188405834273,-37.6948700083548]}},{type:"Feature",properties:{STOP_ID:"20009",LATITUDE:-37.707898,STOP_NAME:"Ruthven Railway Station (Reservoir)",LONGITUDE:145.009517,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.00951704207858,-37.707897956372506]}},{type:"Feature",properties:{STOP_ID:"20010",LATITUDE:-37.716885,STOP_NAME:"Reservoir Railway Station (Reservoir)",LONGITUDE:145.006996,TICKETZONE:"1,2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.00699596597707,-37.71688499694048]}},{type:"Feature",properties:{STOP_ID:"20011",LATITUDE:-37.728403,STOP_NAME:"Regent Railway Station (Reservoir)",LONGITUDE:145.002773,TICKETZONE:"1,2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.00277316312736,-37.728403018220824]}},{type:"Feature",properties:{STOP_ID:"20012",LATITUDE:-37.738674,STOP_NAME:"Preston Railway Station (Preston)",LONGITUDE:145.000522,TICKETZONE:"1,2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.00052208049493,-37.738673997291826]}},{type:"Feature",properties:{STOP_ID:"20013",LATITUDE:-37.745562,STOP_NAME:"Bell Railway Station (Preston)",LONGITUDE:145.000155,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.00015487669162,-37.74556196740014]}},{type:"Feature",properties:{STOP_ID:"20014",LATITUDE:-37.755052,STOP_NAME:"Thornbury Railway Station (Thornbury)",LONGITUDE:144.998572,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[144.99857195554867,-37.75505201755157]}},{type:"Feature",properties:{STOP_ID:"20015",LATITUDE:-37.764101,STOP_NAME:"Croxton Railway Station (Northcote)",LONGITUDE:144.997056,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[144.99705601149938,-37.764100977920975]}},{type:"Feature",properties:{STOP_ID:"20016",LATITUDE:-37.769865,STOP_NAME:"Northcote Railway Station (Northcote)",LONGITUDE:144.995277,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[144.99527690393882,-37.7698650286647]}},{type:"Feature",properties:{STOP_ID:"20017",LATITUDE:-37.777847,STOP_NAME:"Merri Railway Station (Northcote)",LONGITUDE:144.992972,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[144.9929721934344,-37.77784704042674]}},{type:"Feature",properties:{STOP_ID:"20019",LATITUDE:-37.783217,STOP_NAME:"Rushall Railway Station (Fitzroy North)",LONGITUDE:144.992407,TICKETZONE:"1",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[144.99240699877623,-37.783216981751494]}},{type:"Feature",properties:{STOP_ID:"20021",LATITUDE:-37.788536,STOP_NAME:"Sunshine Railway Station (Sunshine)",LONGITUDE:144.832878,TICKETZONE:"1,2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.83287803702032,-37.78853598103241]}},{type:"Feature",properties:{STOP_ID:"20022",LATITUDE:-37.799251,STOP_NAME:"Tottenham Railway Station (West Footscray)",LONGITUDE:144.862945,TICKETZONE:"1",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.86294482805647,-37.79925101953307]}},{type:"Feature",properties:{STOP_ID:"20023",LATITUDE:-37.801803,STOP_NAME:"West Footscray Railway Station (West Footscray)",LONGITUDE:144.883985,TICKETZONE:"1",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.88398504854027,-37.80180296938542]}},{type:"Feature",properties:{STOP_ID:"20024",LATITUDE:-37.802505,STOP_NAME:"Middle Footscray Railway Station (Footscray)",LONGITUDE:144.891472,TICKETZONE:"1",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.8914719665355,-37.802504970278676]}},{type:"Feature",properties:{STOP_ID:"20025",LATITUDE:-37.801083,STOP_NAME:"Footscray Railway Station (Footscray)",LONGITUDE:144.903199,TICKETZONE:"1",ROUTEUSSP:"Werribee,Williamstown,Sunbury"},geometry:{type:"Point",coordinates:[144.90319893797937,-37.80108297392747]}},{type:"Feature",properties:{STOP_ID:"20026",LATITUDE:-37.799531,STOP_NAME:"South Kensington Railway Station (Kensington)",LONGITUDE:144.925469,TICKETZONE:"1",ROUTEUSSP:"Williamstown,Werribee"},geometry:{type:"Point",coordinates:[144.92546896739066,-37.799531010135645]}},{type:"Feature",properties:{STOP_ID:"20030",LATITUDE:-37.683049,STOP_NAME:"Broadmeadows Railway Station (Broadmeadows)",LONGITUDE:144.919613,TICKETZONE:"2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.91961320131395,-37.68304895729302]}},{type:"Feature",properties:{STOP_ID:"20031",LATITUDE:-37.695131,STOP_NAME:"Jacana Railway Station (Glenroy)",LONGITUDE:144.915851,TICKETZONE:"2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.9158511944258,-37.695131010164516]}},{type:"Feature",properties:{STOP_ID:"20032",LATITUDE:-37.704536,STOP_NAME:"Glenroy Railway Station (Glenroy)",LONGITUDE:144.91722,TICKETZONE:"1,2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.91721989592028,-37.70453600891375]}},{type:"Feature",properties:{STOP_ID:"20033",LATITUDE:-37.71795,STOP_NAME:"Oak Park Railway Station (Oak Park)",LONGITUDE:144.921519,TICKETZONE:"1,2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.9215190050332,-37.71794996733691]}},{type:"Feature",properties:{STOP_ID:"20034",LATITUDE:-37.730756,STOP_NAME:"Pascoe Vale Railway Station (Pascoe Vale)",LONGITUDE:144.928196,TICKETZONE:"1,2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.92819593517615,-37.73075597710179]}},{type:"Feature",properties:{STOP_ID:"20035",LATITUDE:-37.743591,STOP_NAME:"Strathmore Railway Station (Strathmore)",LONGITUDE:144.927316,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.92731609110757,-37.74359096751782]}},{type:"Feature",properties:{STOP_ID:"20036",LATITUDE:-37.74721,STOP_NAME:"Glenbervie Railway Station (Essendon)",LONGITUDE:144.920939,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.9209390576499,-37.74720995793417]}},{type:"Feature",properties:{STOP_ID:"20037",LATITUDE:-37.756012,STOP_NAME:"Essendon Railway Station (Essendon)",LONGITUDE:144.916198,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.91619785779378,-37.75601195980886]}},{type:"Feature",properties:{STOP_ID:"20038",LATITUDE:-37.765707,STOP_NAME:"Moonee Ponds Railway Station (Moonee Ponds)",LONGITUDE:144.919161,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.91916101804085,-37.765707029872225]}},{type:"Feature",properties:{STOP_ID:"20039",LATITUDE:-37.775306,STOP_NAME:"Ascot Vale Railway Station (Ascot Vale)",LONGITUDE:144.921821,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.92182105511844,-37.775305978752286]}},{type:"Feature",properties:{STOP_ID:"20040",LATITUDE:-37.787328,STOP_NAME:"Newmarket Railway Station (Flemington)",LONGITUDE:144.928978,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.9289778791842,-37.78732800123391]}},{type:"Feature",properties:{STOP_ID:"20041",LATITUDE:-37.79378,STOP_NAME:"Kensington Railway Station (Kensington)",LONGITUDE:144.930524,TICKETZONE:"1",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.93052408229383,-37.79378001234484]}},{type:"Feature",properties:{STOP_ID:"20042",LATITUDE:-37.819222,STOP_NAME:"Box Hill Railway Station (Box Hill)",LONGITUDE:145.121429,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1214291542125,-37.819222033091656]}},{type:"Feature",properties:{STOP_ID:"22180",LATITUDE:-37.817936,STOP_NAME:"Southern Cross Railway Station (Melbourne City)",LONGITUDE:144.951411,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Craigieburn,Cranbourne,Flemington,Frankston,Glen Waverley,Hurstbridge,Lilydale,Mernda,Pakenham,Sandringham,Sunbury,Upfield,Werribee,Williamstown,Alamein"},geometry:{type:"Point",coordinates:[144.9514108850503,-37.81793601351573]}},{type:"Feature",properties:{STOP_ID:"40220",LATITUDE:-37.638231,STOP_NAME:"Roxburgh Park Railway Station (Roxburgh Park)",LONGITUDE:144.935404,TICKETZONE:"2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.9354038580987,-37.63823102879973]}},{type:"Feature",properties:{STOP_ID:"40221",LATITUDE:-37.601817,STOP_NAME:"Craigieburn Railway Station (Craigieburn)",LONGITUDE:144.94332,TICKETZONE:"2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.94331989483877,-37.6018170275946]}},{type:"Feature",properties:{STOP_ID:"44817",LATITUDE:-37.661003,STOP_NAME:"Coolaroo Railway Station (Coolaroo)",LONGITUDE:144.926056,TICKETZONE:"2",ROUTEUSSP:"Craigieburn"},geometry:{type:"Point",coordinates:[144.92605609416944,-37.6610030113571]}},{type:"Feature",properties:{STOP_ID:"45793",LATITUDE:-38.057341,STOP_NAME:"Lynbrook Railway Station (Lynbrook)",LONGITUDE:145.249275,TICKETZONE:"2",ROUTEUSSP:"Cranbourne"},geometry:{type:"Point",coordinates:[145.24927487781102,-38.057340961642154]}},{type:"Feature",properties:{STOP_ID:"45794",LATITUDE:-38.07129,STOP_NAME:"Cardinia Road Railway Station (Pakenham)",LONGITUDE:145.437791,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.43779105694023,-38.071289971320894]}},{type:"Feature",properties:{STOP_ID:"45795",LATITUDE:-37.649159,STOP_NAME:"South Morang Railway Station (South Morang)",LONGITUDE:145.067032,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.0670320966615,-37.64915901306895]}},{type:"Feature",properties:{STOP_ID:"46468",LATITUDE:-37.869865,STOP_NAME:"Williams Landing Railway Station (Williams Landing)",LONGITUDE:144.747445,TICKETZONE:"2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.74744497619167,-37.8698650235294]}},{type:"Feature",properties:{STOP_ID:"52095",LATITUDE:-37.958756,STOP_NAME:"Southland Railway Station (Cheltenham)",LONGITUDE:145.049121,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0491210080803,-37.95875605115335]}},{type:"Feature",properties:{STOP_ID:"52159",LATITUDE:-37.644061,STOP_NAME:"Middle Gorge Railway Station (South Morang)",LONGITUDE:145.092144,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.09214389829435,-37.644060959065094]}},{type:"Feature",properties:{STOP_ID:"52160",LATITUDE:-37.622995,STOP_NAME:"Hawkstowe Railway Station (South Morang)",LONGITUDE:145.097396,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.0973959520007,-37.62299502042986]}},{type:"Feature",properties:{STOP_ID:"52161",LATITUDE:-37.602548,STOP_NAME:"Mernda Railway Station (Mernda)",LONGITUDE:145.100885,TICKETZONE:"2",ROUTEUSSP:"Mernda"},geometry:{type:"Point",coordinates:[145.1008850816138,-37.602548008693105]}},{type:"Feature",properties:{STOP_ID:"15351",LATITUDE:-37.579091,STOP_NAME:"Sunbury Railway Station (Sunbury)",LONGITUDE:144.727319,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.7273191965987,-37.579091041919106]}},{type:"Feature",properties:{STOP_ID:"15353",LATITUDE:-37.627017,STOP_NAME:"Diggers Rest Railway Station (Diggers Rest)",LONGITUDE:144.719922,TICKETZONE:"2",ROUTEUSSP:"Sunbury"},geometry:{type:"Point",coordinates:[144.719921894289,-37.62701703098356]}},{type:"Feature",properties:{STOP_ID:"19827",LATITUDE:-38.374235,STOP_NAME:"Stony Point Railway Station (Crib Point)",LONGITUDE:145.221837,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.2218371303087,-38.37423501463105]}},{type:"Feature",properties:{STOP_ID:"19828",LATITUDE:-38.366123,STOP_NAME:"Crib Point Railway Station (Crib Point)",LONGITUDE:145.204043,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.20404302458843,-38.366123042492156]}},{type:"Feature",properties:{STOP_ID:"19829",LATITUDE:-38.354033,STOP_NAME:"Morradoo Railway Station (Crib Point)",LONGITUDE:145.189602,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.18960200468328,-38.35403298231219]}},{type:"Feature",properties:{STOP_ID:"19830",LATITUDE:-38.33739,STOP_NAME:"Bittern Railway Station (Bittern)",LONGITUDE:145.178027,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.17802694776515,-38.33739000410354]}},{type:"Feature",properties:{STOP_ID:"19831",LATITUDE:-38.305659,STOP_NAME:"Hastings Railway Station (Hastings)",LONGITUDE:145.18598,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.18598004542605,-38.30565897380473]}},{type:"Feature",properties:{STOP_ID:"19832",LATITUDE:-38.259815,STOP_NAME:"Tyabb Railway Station (Tyabb)",LONGITUDE:145.186401,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.18640091121645,-38.25981504276969]}},{type:"Feature",properties:{STOP_ID:"19833",LATITUDE:-38.225342,STOP_NAME:"Somerville Railway Station (Somerville)",LONGITUDE:145.176245,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.17624495783332,-38.22534198465516]}},{type:"Feature",properties:{STOP_ID:"19834",LATITUDE:-38.194043,STOP_NAME:"Baxter Railway Station (Baxter)",LONGITUDE:145.160526,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.1605259068461,-38.194043042101164]}},{type:"Feature",properties:{STOP_ID:"19835",LATITUDE:-37.859308,STOP_NAME:"Glen Iris Railway Station (Glen Iris)",LONGITUDE:145.058225,TICKETZONE:"1",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.0582250497741,-37.85930802724669]}},{type:"Feature",properties:{STOP_ID:"19836",LATITUDE:-38.152034,STOP_NAME:"Leawarra Railway Station (Frankston)",LONGITUDE:145.139534,TICKETZONE:"2",ROUTEUSSP:"Stony Point"},geometry:{type:"Point",coordinates:[145.1395339285365,-38.152034013128976]}},{type:"Feature",properties:{STOP_ID:"19837",LATITUDE:-37.868957,STOP_NAME:"Darling Railway Station (Malvern East)",LONGITUDE:145.062951,TICKETZONE:"1,2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.06295114201313,-37.86895701673703]}},{type:"Feature",properties:{STOP_ID:"19838",LATITUDE:-37.87693,STOP_NAME:"East Malvern Railway Station (Malvern East)",LONGITUDE:145.069393,TICKETZONE:"1,2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.06939298848198,-37.87693002547972]}},{type:"Feature",properties:{STOP_ID:"19839",LATITUDE:-37.874402,STOP_NAME:"Holmesglen Railway Station (Malvern East)",LONGITUDE:145.090662,TICKETZONE:"1,2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.09066211307118,-37.874402019247384]}},{type:"Feature",properties:{STOP_ID:"19840",LATITUDE:-37.873603,STOP_NAME:"Jordanville Railway Station (Mount Waverley)",LONGITUDE:145.11209,TICKETZONE:"2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.11209003619842,-37.87360300336732]}},{type:"Feature",properties:{STOP_ID:"19841",LATITUDE:-37.811981,STOP_NAME:"Flagstaff Railway Station (Melbourne City)",LONGITUDE:144.955654,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Craigieburn,Cranbourne,Flemington,Glen Waverley,Hurstbridge,Lilydale,Mernda,Pakenham,Sunbury,Upfield,Alamein"},geometry:{type:"Point",coordinates:[144.95565385897856,-37.811980983068906]}},{type:"Feature",properties:{STOP_ID:"19842",LATITUDE:-37.809939,STOP_NAME:"Melbourne Central Railway Station (Melbourne City)",LONGITUDE:144.962594,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Craigieburn,Cranbourne,Flemington,Glen Waverley,Hurstbridge,Lilydale,Mernda,Pakenham,Sunbury,Upfield,Alamein"},geometry:{type:"Point",coordinates:[144.9625939477722,-37.80993897219737]}},{type:"Feature",properties:{STOP_ID:"19843",LATITUDE:-37.811054,STOP_NAME:"Parliament Railway Station (Melbourne City)",LONGITUDE:144.972911,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Craigieburn,Cranbourne,Flemington,Glen Waverley,Hurstbridge,Lilydale,Mernda,Pakenham,Sunbury,Upfield,Alamein"},geometry:{type:"Point",coordinates:[144.9729111811868,-37.81105398311787]}},{type:"Feature",properties:{STOP_ID:"19844",LATITUDE:-37.909102,STOP_NAME:"Belgrave Railway Station (Belgrave)",LONGITUDE:145.355291,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.35529094228033,-37.90910196303172]}},{type:"Feature",properties:{STOP_ID:"19845",LATITUDE:-37.908118,STOP_NAME:"Tecoma Railway Station (Tecoma)",LONGITUDE:145.342995,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.3429951499282,-37.90811799418759]}},{type:"Feature",properties:{STOP_ID:"19846",LATITUDE:-37.903691,STOP_NAME:"Upwey Railway Station (Upwey)",LONGITUDE:145.331333,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.33133294736945,-37.903690983475485]}},{type:"Feature",properties:{STOP_ID:"19847",LATITUDE:-37.86832,STOP_NAME:"Alamein Railway Station (Ashburton)",LONGITUDE:145.079656,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.0796558510017,-37.86831999881286]}},{type:"Feature",properties:{STOP_ID:"19848",LATITUDE:-37.861968,STOP_NAME:"Ashburton Railway Station (Ashburton)",LONGITUDE:145.081344,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.08134389547052,-37.86196798070856]}},{type:"Feature",properties:{STOP_ID:"19849",LATITUDE:-37.851563,STOP_NAME:"Burwood Railway Station (Glen Iris)",LONGITUDE:145.080511,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.08051084427572,-37.851562991336685]}},{type:"Feature",properties:{STOP_ID:"19850",LATITUDE:-37.843985,STOP_NAME:"Hartwell Railway Station (Camberwell)",LONGITUDE:145.07556,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.0755601197322,-37.843984988466225]}},{type:"Feature",properties:{STOP_ID:"19851",LATITUDE:-37.835716,STOP_NAME:"Willison Railway Station (Camberwell)",LONGITUDE:145.070298,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.07029800484113,-37.835715965394016]}},{type:"Feature",properties:{STOP_ID:"19852",LATITUDE:-37.831505,STOP_NAME:"Riversdale Railway Station (Camberwell)",LONGITUDE:145.069646,TICKETZONE:"1",ROUTEUSSP:"Alamein"},geometry:{type:"Point",coordinates:[145.0696460448304,-37.831505045420805]}},{type:"Feature",properties:{STOP_ID:"19853",LATITUDE:-37.826567,STOP_NAME:"Camberwell Railway Station (Camberwell)",LONGITUDE:145.058697,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[145.05869701396765,-37.826567020894245]}},{type:"Feature",properties:{STOP_ID:"19854",LATITUDE:-37.818305,STOP_NAME:"Flinders Street Railway Station (Melbourne City)",LONGITUDE:144.966964,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Craigieburn,Cranbourne,Flemington,Frankston,Glen Waverley,Hurstbridge,Lilydale,Mernda,Pakenham,Sandringham,Sunbury,Upfield,Werribee,Williamstown,Alamein"},geometry:{type:"Point",coordinates:[144.96696399665555,-37.81830501305625]}},{type:"Feature",properties:{STOP_ID:"19855",LATITUDE:-38.14299,STOP_NAME:"Frankston Railway Station (Frankston)",LONGITUDE:145.126162,TICKETZONE:"2",ROUTEUSSP:"Stony Point,Frankston"},geometry:{type:"Point",coordinates:[145.12616208447614,-38.14299000537099]}},{type:"Feature",properties:{STOP_ID:"19856",LATITUDE:-38.121742,STOP_NAME:"Kananook Railway Station (Seaford)",LONGITUDE:145.135295,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.13529493934251,-38.12174199466812]}},{type:"Feature",properties:{STOP_ID:"19857",LATITUDE:-38.104021,STOP_NAME:"Seaford Railway Station (Seaford)",LONGITUDE:145.12823,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.12822994038072,-38.10402099378123]}},{type:"Feature",properties:{STOP_ID:"19858",LATITUDE:-38.076504,STOP_NAME:"Carrum Railway Station (Carrum)",LONGITUDE:145.122833,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.1228331806026,-38.076504033265415]}},{type:"Feature",properties:{STOP_ID:"19859",LATITUDE:-38.062945,STOP_NAME:"Bonbeach Railway Station (Bonbeach)",LONGITUDE:145.11968,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.11967993833284,-38.06294499455282]}},{type:"Feature",properties:{STOP_ID:"19860",LATITUDE:-38.051955,STOP_NAME:"Chelsea Railway Station (Chelsea)",LONGITUDE:145.116041,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.1160410561567,-38.05195500582945]}},{type:"Feature",properties:{STOP_ID:"19861",LATITUDE:-38.038056,STOP_NAME:"Edithvale Railway Station (Edithvale)",LONGITUDE:145.108536,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.10853614659555,-38.03805603411457]}},{type:"Feature",properties:{STOP_ID:"19862",LATITUDE:-38.02722,STOP_NAME:"Aspendale Railway Station (Aspendale)",LONGITUDE:145.10215,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.10215009763107,-38.02722003428127]}},{type:"Feature",properties:{STOP_ID:"19863",LATITUDE:-38.006583,STOP_NAME:"Mordialloc Railway Station (Mordialloc)",LONGITUDE:145.087659,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.08765900709295,-38.006583036530465]}},{type:"Feature",properties:{STOP_ID:"19864",LATITUDE:-37.993079,STOP_NAME:"Parkdale Railway Station (Parkdale)",LONGITUDE:145.076327,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0763269243707,-37.993078985669186]}},{type:"Feature",properties:{STOP_ID:"19865",LATITUDE:-37.981865,STOP_NAME:"Mentone Railway Station (Mentone)",LONGITUDE:145.065166,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.06516585321697,-37.98186498543101]}},{type:"Feature",properties:{STOP_ID:"19866",LATITUDE:-37.96665,STOP_NAME:"Cheltenham Railway Station (Cheltenham)",LONGITUDE:145.054558,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.05455809320318,-37.96665004267008]}},{type:"Feature",properties:{STOP_ID:"19867",LATITUDE:-37.892672,STOP_NAME:"Upper Ferntree Gully Railway Station (Upper Ferntree Gully)",LONGITUDE:145.30753,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.30753010573622,-37.89267201519074]}},{type:"Feature",properties:{STOP_ID:"19868",LATITUDE:-37.881698,STOP_NAME:"Ferntree Gully Railway Station (Ferntree Gully)",LONGITUDE:145.295251,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.2952508595173,-37.88169804430563]}},{type:"Feature",properties:{STOP_ID:"19869",LATITUDE:-37.860452,STOP_NAME:"Boronia Railway Station (Boronia)",LONGITUDE:145.284385,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.28438498378276,-37.86045201284621]}},{type:"Feature",properties:{STOP_ID:"19870",LATITUDE:-37.84173,STOP_NAME:"Bayswater Railway Station (Bayswater)",LONGITUDE:145.268136,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.26813602050083,-37.84173003269863]}},{type:"Feature",properties:{STOP_ID:"19871",LATITUDE:-37.828322,STOP_NAME:"Heathmont Railway Station (Heathmont)",LONGITUDE:145.244555,TICKETZONE:"2",ROUTEUSSP:"Belgrave"},geometry:{type:"Point",coordinates:[145.24455493593294,-37.828322013500426]}},{type:"Feature",properties:{STOP_ID:"19872",LATITUDE:-37.948425,STOP_NAME:"Highett Railway Station (Highett)",LONGITUDE:145.041872,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.04187207003986,-37.948425037176236]}},{type:"Feature",properties:{STOP_ID:"19873",LATITUDE:-37.879504,STOP_NAME:"Glen Waverley Railway Station (Glen Waverley)",LONGITUDE:145.162058,TICKETZONE:"2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.16205804677077,-37.87950402884809]}},{type:"Feature",properties:{STOP_ID:"19874",LATITUDE:-37.87623,STOP_NAME:"Syndal Railway Station (Glen Waverley)",LONGITUDE:145.14978,TICKETZONE:"2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.14977988400065,-37.87623001198126]}},{type:"Feature",properties:{STOP_ID:"19875",LATITUDE:-37.875255,STOP_NAME:"Mount Waverley Railway Station (Mount Waverley)",LONGITUDE:145.128056,TICKETZONE:"2",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.1280560390715,-37.87525504140691]}},{type:"Feature",properties:{STOP_ID:"19876",LATITUDE:-37.755518,STOP_NAME:"Lilydale Railway Station (Lilydale)",LONGITUDE:145.34771,TICKETZONE:"2",ROUTEUSSP:"Lilydale"},geometry:{type:"Point",coordinates:[145.34771006372208,-37.75551804148801]}},{type:"Feature",properties:{STOP_ID:"19877",LATITUDE:-37.784749,STOP_NAME:"Mooroolbark Railway Station (Mooroolbark)",LONGITUDE:145.312402,TICKETZONE:"2",ROUTEUSSP:"Lilydale"},geometry:{type:"Point",coordinates:[145.312401980717,-37.78474896242301]}},{type:"Feature",properties:{STOP_ID:"19878",LATITUDE:-37.795437,STOP_NAME:"Croydon Railway Station (Croydon)",LONGITUDE:145.280598,TICKETZONE:"2",ROUTEUSSP:"Lilydale"},geometry:{type:"Point",coordinates:[145.28059813649503,-37.795437003004096]}},{type:"Feature",properties:{STOP_ID:"19879",LATITUDE:-37.811968,STOP_NAME:"Ringwood East Railway Station (Ringwood East)",LONGITUDE:145.250191,TICKETZONE:"2",ROUTEUSSP:"Lilydale"},geometry:{type:"Point",coordinates:[145.25019111735213,-37.811968020901645]}},{type:"Feature",properties:{STOP_ID:"19880",LATITUDE:-38.080614,STOP_NAME:"Pakenham Railway Station (Pakenham)",LONGITUDE:145.486379,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.4863791670269,-38.080613971994666]}},{type:"Feature",properties:{STOP_ID:"19881",LATITUDE:-38.066146,STOP_NAME:"Officer Railway Station (Officer)",LONGITUDE:145.410987,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.41098691161596,-38.06614602358953]}},{type:"Feature",properties:{STOP_ID:"19882",LATITUDE:-38.050831,STOP_NAME:"Beaconsfield Railway Station (Beaconsfield)",LONGITUDE:145.366074,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.36607402041432,-38.05083099268969]}},{type:"Feature",properties:{STOP_ID:"19883",LATITUDE:-38.040408,STOP_NAME:"Berwick Railway Station (Berwick)",LONGITUDE:145.345726,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.345726106732,-38.04040800417337]}},{type:"Feature",properties:{STOP_ID:"19884",LATITUDE:-38.027809,STOP_NAME:"Narre Warren Railway Station (Narre Warren)",LONGITUDE:145.303969,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.30396899348813,-38.02780899067889]}},{type:"Feature",properties:{STOP_ID:"19885",LATITUDE:-38.01774,STOP_NAME:"Hallam Railway Station (Hallam)",LONGITUDE:145.269777,TICKETZONE:"2",ROUTEUSSP:"Pakenham"},geometry:{type:"Point",coordinates:[145.26977691372707,-38.0177399723026]}},{type:"Feature",properties:{STOP_ID:"19886",LATITUDE:-38.099537,STOP_NAME:"Cranbourne Railway Station (Cranbourne)",LONGITUDE:145.280599,TICKETZONE:"2",ROUTEUSSP:"Cranbourne"},geometry:{type:"Point",coordinates:[145.2805988876704,-38.099537015167755]}},{type:"Feature",properties:{STOP_ID:"19887",LATITUDE:-38.079,STOP_NAME:"Merinda Park Railway Station (Cranbourne North)",LONGITUDE:145.263511,TICKETZONE:"2",ROUTEUSSP:"Cranbourne"},geometry:{type:"Point",coordinates:[145.26351110606686,-38.07900000428343]}},{type:"Feature",properties:{STOP_ID:"19888",LATITUDE:-37.989968,STOP_NAME:"Dandenong Railway Station (Dandenong)",LONGITUDE:145.209725,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.20972494168106,-37.98996804320864]}},{type:"Feature",properties:{STOP_ID:"19889",LATITUDE:-37.978255,STOP_NAME:"Yarraman Railway Station (Noble Park)",LONGITUDE:145.1916,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.19160002133484,-37.97825499531765]}},{type:"Feature",properties:{STOP_ID:"19890",LATITUDE:-37.966628,STOP_NAME:"Noble Park Railway Station (Noble Park)",LONGITUDE:145.176325,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.17632485727145,-37.96662798649904]}},{type:"Feature",properties:{STOP_ID:"19891",LATITUDE:-37.956505,STOP_NAME:"Sandown Park Railway Station (Springvale)",LONGITUDE:145.162826,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.16282594045538,-37.9565049634813]}},{type:"Feature",properties:{STOP_ID:"19892",LATITUDE:-37.825894,STOP_NAME:"East Camberwell Railway Station (Camberwell)",LONGITUDE:145.06819,TICKETZONE:"1",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.06818984612514,-37.82589399751228]}},{type:"Feature",properties:{STOP_ID:"19893",LATITUDE:-37.824485,STOP_NAME:"Canterbury Railway Station (Canterbury)",LONGITUDE:145.081224,TICKETZONE:"1,2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.08122400522683,-37.824485052015234]}},{type:"Feature",properties:{STOP_ID:"19894",LATITUDE:-37.8243,STOP_NAME:"Chatham Railway Station (Surrey Hills)",LONGITUDE:145.088648,TICKETZONE:"1,2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.08864792992347,-37.824300013259794]}},{type:"Feature",properties:{STOP_ID:"19895",LATITUDE:-37.824148,STOP_NAME:"Surrey Hills Railway Station (Surrey Hills)",LONGITUDE:145.098775,TICKETZONE:"1,2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.09877510312708,-37.82414800244947]}},{type:"Feature",properties:{STOP_ID:"19896",LATITUDE:-37.819427,STOP_NAME:"Mont Albert Railway Station (Mont Albert)",LONGITUDE:145.10553,TICKETZONE:"1,2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1055301411415,-37.819427052222316]}},{type:"Feature",properties:{STOP_ID:"19897",LATITUDE:-37.82078,STOP_NAME:"Laburnum Railway Station (Blackburn)",LONGITUDE:145.140703,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1407028348687,-37.82078002325073]}},{type:"Feature",properties:{STOP_ID:"19898",LATITUDE:-37.820071,STOP_NAME:"Blackburn Railway Station (Blackburn)",LONGITUDE:145.150014,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1500138764687,-37.820071002378896]}},{type:"Feature",properties:{STOP_ID:"19899",LATITUDE:-37.820428,STOP_NAME:"Nunawading Railway Station (Nunawading)",LONGITUDE:145.175237,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1752369288804,-37.82042802941446]}},{type:"Feature",properties:{STOP_ID:"19900",LATITUDE:-37.818087,STOP_NAME:"Mitcham Railway Station (Mitcham)",LONGITUDE:145.192892,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.1928920581536,-37.818087035153475]}},{type:"Feature",properties:{STOP_ID:"19901",LATITUDE:-37.818835,STOP_NAME:"Heatherdale Railway Station (Ringwood)",LONGITUDE:145.21355,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.21354994696432,-37.81883502338564]}},{type:"Feature",properties:{STOP_ID:"19902",LATITUDE:-37.81566,STOP_NAME:"Ringwood Railway Station (Ringwood)",LONGITUDE:145.229474,TICKETZONE:"2",ROUTEUSSP:"Lilydale,Belgrave"},geometry:{type:"Point",coordinates:[145.2294741698739,-37.81566000007894]}},{type:"Feature",properties:{STOP_ID:"19903",LATITUDE:-37.822398,STOP_NAME:"Auburn Railway Station (Hawthorn East)",LONGITUDE:145.045844,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[145.04584392844583,-37.82239804230204]}},{type:"Feature",properties:{STOP_ID:"19904",LATITUDE:-37.821467,STOP_NAME:"Glenferrie Railway Station (Hawthorn)",LONGITUDE:145.036439,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[145.03643891857303,-37.821466991314885]}},{type:"Feature",properties:{STOP_ID:"19905",LATITUDE:-37.821826,STOP_NAME:"Hawthorn Railway Station (Hawthorn)",LONGITUDE:145.022899,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[145.02289894827368,-37.821825996611395]}},{type:"Feature",properties:{STOP_ID:"19906",LATITUDE:-37.82756,STOP_NAME:"Burnley Railway Station (Burnley)",LONGITUDE:145.007555,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Glen Waverley,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[145.0075550556105,-37.82755998022155]}},{type:"Feature",properties:{STOP_ID:"19907",LATITUDE:-37.8264,STOP_NAME:"East Richmond Railway Station (Richmond)",LONGITUDE:144.997066,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Glen Waverley,Lilydale,Alamein"},geometry:{type:"Point",coordinates:[144.9970661029343,-37.82639997289394]}},{type:"Feature",properties:{STOP_ID:"19908",LATITUDE:-37.824074,STOP_NAME:"Richmond Railway Station (Richmond)",LONGITUDE:144.990164,TICKETZONE:"1",ROUTEUSSP:"Belgrave,Cranbourne,Frankston,Glen Waverley,Lilydale,Pakenham,Sandringham,Alamein"},geometry:{type:"Point",coordinates:[144.9901641806745,-37.82407401385715]}},{type:"Feature",properties:{STOP_ID:"19909",LATITUDE:-37.834672,STOP_NAME:"Heyington Railway Station (Toorak)",LONGITUDE:145.022635,TICKETZONE:"1",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.02263508424622,-37.834671965373985]}},{type:"Feature",properties:{STOP_ID:"19910",LATITUDE:-37.839929,STOP_NAME:"Kooyong Railway Station (Kooyong)",LONGITUDE:145.033552,TICKETZONE:"1",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.03355208421473,-37.839929048366116]}},{type:"Feature",properties:{STOP_ID:"19911",LATITUDE:-37.849366,STOP_NAME:"Tooronga Railway Station (Malvern)",LONGITUDE:145.041734,TICKETZONE:"1",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.04173415478712,-37.84936599739654]}},{type:"Feature",properties:{STOP_ID:"19912",LATITUDE:-37.853279,STOP_NAME:"Gardiner Railway Station (Glen Iris)",LONGITUDE:145.051655,TICKETZONE:"1",ROUTEUSSP:"Glen Waverley"},geometry:{type:"Point",coordinates:[145.05165504987352,-37.85327901773509]}},{type:"Feature",properties:{STOP_ID:"19913",LATITUDE:-37.949509,STOP_NAME:"Springvale Railway Station (Springvale)",LONGITUDE:145.153452,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.1534518921023,-37.94950899259216]}},{type:"Feature",properties:{STOP_ID:"19914",LATITUDE:-37.938491,STOP_NAME:"Westall Railway Station (Clayton South)",LONGITUDE:145.138833,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.13883302874603,-37.938491011333234]}},{type:"Feature",properties:{STOP_ID:"19915",LATITUDE:-37.924683,STOP_NAME:"Clayton Railway Station (Clayton)",LONGITUDE:145.120534,TICKETZONE:"2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.12053387025009,-37.92468303486988]}},{type:"Feature",properties:{STOP_ID:"19916",LATITUDE:-37.911017,STOP_NAME:"Huntingdale Railway Station (Oakleigh)",LONGITUDE:145.102364,TICKETZONE:"1,2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.10236393324308,-37.911016990825836]}},{type:"Feature",properties:{STOP_ID:"19917",LATITUDE:-37.900372,STOP_NAME:"Oakleigh Railway Station (Oakleigh)",LONGITUDE:145.088308,TICKETZONE:"1,2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.0883080921356,-37.90037196749365]}},{type:"Feature",properties:{STOP_ID:"19918",LATITUDE:-37.894881,STOP_NAME:"Hughesdale Railway Station (Hughesdale)",LONGITUDE:145.077635,TICKETZONE:"1,2",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.07763518406495,-37.89488097733909]}},{type:"Feature",properties:{STOP_ID:"19919",LATITUDE:-37.890198,STOP_NAME:"Murrumbeena Railway Station (Murrumbeena)",LONGITUDE:145.067375,TICKETZONE:"1",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.0673751866043,-37.89019800833117]}},{type:"Feature",properties:{STOP_ID:"19920",LATITUDE:-37.886241,STOP_NAME:"Carnegie Railway Station (Carnegie)",LONGITUDE:145.058575,TICKETZONE:"1",ROUTEUSSP:"Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.05857497723898,-37.886240976370786]}},{type:"Feature",properties:{STOP_ID:"19921",LATITUDE:-37.899378,STOP_NAME:"Werribee Railway Station (Werribee)",LONGITUDE:144.661118,TICKETZONE:"2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.66111806209827,-37.89937800378759]}},{type:"Feature",properties:{STOP_ID:"19922",LATITUDE:-37.883276,STOP_NAME:"Hoppers Crossing Railway Station (Hoppers Crossing)",LONGITUDE:144.700955,TICKETZONE:"2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.7009549451706,-37.88327601324334]}},{type:"Feature",properties:{STOP_ID:"19923",LATITUDE:-37.863694,STOP_NAME:"Laverton Railway Station (Laverton)",LONGITUDE:144.772617,TICKETZONE:"1,2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.77261691069953,-37.863693995393945]}},{type:"Feature",properties:{STOP_ID:"19924",LATITUDE:-37.866606,STOP_NAME:"Aircraft Railway Station (Laverton)",LONGITUDE:144.760809,TICKETZONE:"2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.7608088985207,-37.866606032750546]}},{type:"Feature",properties:{STOP_ID:"19925",LATITUDE:-37.865163,STOP_NAME:"Westona Railway Station (Altona)",LONGITUDE:144.813494,TICKETZONE:"1,2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.81349417315855,-37.8651629765648]}},{type:"Feature",properties:{STOP_ID:"19926",LATITUDE:-37.867148,STOP_NAME:"Altona Railway Station (Altona)",LONGITUDE:144.829645,TICKETZONE:"1,2",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.82964484849458,-37.86714801409339]}},{type:"Feature",properties:{STOP_ID:"19927",LATITUDE:-37.867842,STOP_NAME:"Seaholme Railway Station (Seaholme)",LONGITUDE:144.840958,TICKETZONE:"1",ROUTEUSSP:"Werribee"},geometry:{type:"Point",coordinates:[144.84095784803088,-37.86784200270676]}},{type:"Feature",properties:{STOP_ID:"19928",LATITUDE:-37.780621,STOP_NAME:"Westgarth Railway Station (Northcote)",LONGITUDE:144.999233,TICKETZONE:"1",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[144.9992329526931,-37.780621021498604]}},{type:"Feature",properties:{STOP_ID:"19929",LATITUDE:-37.779187,STOP_NAME:"Dennis Railway Station (Northcote)",LONGITUDE:145.008242,TICKETZONE:"1",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.00824193502052,-37.779186960703825]}},{type:"Feature",properties:{STOP_ID:"19930",LATITUDE:-37.779171,STOP_NAME:"Fairfield Railway Station (Fairfield)",LONGITUDE:145.016905,TICKETZONE:"1",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.01690497413267,-37.77917103027729]}},{type:"Feature",properties:{STOP_ID:"19931",LATITUDE:-37.778394,STOP_NAME:"Alphington Railway Station (Alphington)",LONGITUDE:145.031255,TICKETZONE:"1",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.0312549420362,-37.778393970184325]}},{type:"Feature",properties:{STOP_ID:"19932",LATITUDE:-37.774963,STOP_NAME:"Darebin Railway Station (Ivanhoe)",LONGITUDE:145.038476,TICKETZONE:"1",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.0384761897359,-37.774962990239736]}},{type:"Feature",properties:{STOP_ID:"19933",LATITUDE:-37.768897,STOP_NAME:"Ivanhoe Railway Station (Ivanhoe)",LONGITUDE:145.045425,TICKETZONE:"1,2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.0454249007254,-37.76889698950453]}},{type:"Feature",properties:{STOP_ID:"19934",LATITUDE:-37.763586,STOP_NAME:"Eaglemont Railway Station (Eaglemont)",LONGITUDE:145.053943,TICKETZONE:"1,2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.0539428530202,-37.76358600115558]}},{type:"Feature",properties:{STOP_ID:"19935",LATITUDE:-37.757073,STOP_NAME:"Heidelberg Railway Station (Heidelberg)",LONGITUDE:145.060686,TICKETZONE:"1,2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.06068602994233,-37.75707297186314]}},{type:"Feature",properties:{STOP_ID:"19936",LATITUDE:-37.742879,STOP_NAME:"Rosanna Railway Station (Rosanna)",LONGITUDE:145.06614,TICKETZONE:"2",ROUTEUSSP:"Hurstbridge"},geometry:{type:"Point",coordinates:[145.06614004306664,-37.74287898170107]}},{type:"Feature",properties:{STOP_ID:"19937",LATITUDE:-37.934353,STOP_NAME:"Moorabbin Railway Station (Moorabbin)",LONGITUDE:145.036738,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0367381151247,-37.934352997334734]}},{type:"Feature",properties:{STOP_ID:"19938",LATITUDE:-37.925149,STOP_NAME:"Patterson Railway Station (Bentleigh)",LONGITUDE:145.03547,TICKETZONE:"2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.03547018698544,-37.9251489679829]}},{type:"Feature",properties:{STOP_ID:"19939",LATITUDE:-37.917425,STOP_NAME:"Bentleigh Railway Station (Bentleigh)",LONGITUDE:145.036995,TICKETZONE:"1,2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0369951450514,-37.917424987593655]}},{type:"Feature",properties:{STOP_ID:"19940",LATITUDE:-37.910309,STOP_NAME:"McKinnon Railway Station (Mckinnon)",LONGITUDE:145.038299,TICKETZONE:"1,2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.03829905678242,-37.9103090471004]}},{type:"Feature",properties:{STOP_ID:"19941",LATITUDE:-37.903212,STOP_NAME:"Ormond Railway Station (Ormond)",LONGITUDE:145.039613,TICKETZONE:"1,2",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0396130453646,-37.903212006932286]}},{type:"Feature",properties:{STOP_ID:"19942",LATITUDE:-37.889719,STOP_NAME:"Glenhuntly Railway Station (Glen Huntly)",LONGITUDE:145.042223,TICKETZONE:"1",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.04222302981012,-37.889719026839934]}},{type:"Feature",properties:{STOP_ID:"19943",LATITUDE:-37.877459,STOP_NAME:"Caulfield Railway Station (Caulfield East)",LONGITUDE:145.042525,TICKETZONE:"1",ROUTEUSSP:"Frankston,Pakenham,Cranbourne"},geometry:{type:"Point",coordinates:[145.04252511062438,-37.87745904950535]}},{type:"Feature",properties:{STOP_ID:"19944",LATITUDE:-37.866253,STOP_NAME:"Malvern Railway Station (Malvern)",LONGITUDE:145.029294,TICKETZONE:"1",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.02929401539313,-37.86625296743994]}},{type:"Feature",properties:{STOP_ID:"19945",LATITUDE:-37.856452,STOP_NAME:"Armadale Railway Station (Armadale)",LONGITUDE:145.019326,TICKETZONE:"1",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.0193259624038,-37.85645196640077]}},{type:"Feature",properties:{STOP_ID:"19946",LATITUDE:-37.850774,STOP_NAME:"Toorak Railway Station (Armadale)",LONGITUDE:145.013909,TICKETZONE:"1",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.01390904858653,-37.85077404613171]}},{type:"Feature",properties:{STOP_ID:"19947",LATITUDE:-37.844591,STOP_NAME:"Hawksburn Railway Station (South Yarra)",LONGITUDE:145.002142,TICKETZONE:"1",ROUTEUSSP:"Frankston"},geometry:{type:"Point",coordinates:[145.00214211386543,-37.84459104465304]}},{type:"Feature",properties:{STOP_ID:"19948",LATITUDE:-37.95033,STOP_NAME:"Sandringham Railway Station (Sandringham)",LONGITUDE:145.004561,TICKETZONE:"2",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[145.00456092996131,-37.95032997678135]}},{type:"Feature",properties:{STOP_ID:"19949",LATITUDE:-37.937977,STOP_NAME:"Hampton Railway Station (Hampton)",LONGITUDE:145.001471,TICKETZONE:"2",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[145.0014710475163,-37.93797702778554]}},{type:"Feature",properties:{STOP_ID:"19950",LATITUDE:-37.926484,STOP_NAME:"Brighton Beach Railway Station (Brighton)",LONGITUDE:144.989154,TICKETZONE:"1,2",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.98915400748288,-37.92648402636408]}},{type:"Feature",properties:{STOP_ID:"19951",LATITUDE:-37.915134,STOP_NAME:"Middle Brighton Railway Station (Brighton)",LONGITUDE:144.996299,TICKETZONE:"1,2",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.99629892106807,-37.91513403726259]}},{type:"Feature",properties:{STOP_ID:"19952",LATITUDE:-37.904887,STOP_NAME:"North Brighton Railway Station (Brighton)",LONGITUDE:145.002605,TICKETZONE:"1,2",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[145.00260504023572,-37.904886999374064]}},{type:"Feature",properties:{STOP_ID:"19953",LATITUDE:-37.896695,STOP_NAME:"Gardenvale Railway Station (Brighton)",LONGITUDE:145.004168,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[145.0041681594568,-37.89669501891709]}},{type:"Feature",properties:{STOP_ID:"19954",LATITUDE:-37.884753,STOP_NAME:"Elsternwick Railway Station (Elsternwick)",LONGITUDE:145.000898,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[145.00089792626244,-37.88475300849933]}},{type:"Feature",properties:{STOP_ID:"19955",LATITUDE:-37.875906,STOP_NAME:"Ripponlea Railway Station (Ripponlea)",LONGITUDE:144.995237,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.99523695425376,-37.875906008374365]}},{type:"Feature",properties:{STOP_ID:"19956",LATITUDE:-37.869488,STOP_NAME:"Balaclava Railway Station (Balaclava)",LONGITUDE:144.993512,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.99351218235657,-37.869488016261954]}},{type:"Feature",properties:{STOP_ID:"19957",LATITUDE:-37.856053,STOP_NAME:"Windsor Railway Station (Windsor)",LONGITUDE:144.992035,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.99203509329004,-37.85605299340357]}},{type:"Feature",properties:{STOP_ID:"19958",LATITUDE:-37.849518,STOP_NAME:"Prahran Railway Station (Prahran)",LONGITUDE:144.98986,TICKETZONE:"1",ROUTEUSSP:"Sandringham"},geometry:{type:"Point",coordinates:[144.98985999271946,-37.849518003492406]}},{type:"Feature",properties:{STOP_ID:"19959",LATITUDE:-37.838449,STOP_NAME:"South Yarra Railway Station (South Yarra)",LONGITUDE:144.992342,TICKETZONE:"1",ROUTEUSSP:"Frankston,Pakenham,Sandringham,Cranbourne"},geometry:{type:"Point",coordinates:[144.99234219972408,-37.83844899324962]}},{type:"Feature",properties:{STOP_ID:"19960",LATITUDE:-37.666078,STOP_NAME:"Upfield Railway Station (Coolaroo)",LONGITUDE:144.94674,TICKETZONE:"2",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.94673986754253,-37.66607802131612]}},{type:"Feature",properties:{STOP_ID:"19961",LATITUDE:-37.700678,STOP_NAME:"Gowrie Railway Station (Glenroy)",LONGITUDE:144.958874,TICKETZONE:"2",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.95887403782967,-37.700677977421826]}},{type:"Feature",properties:{STOP_ID:"19962",LATITUDE:-37.714621,STOP_NAME:"Fawkner Railway Station (Fawkner)",LONGITUDE:144.960545,TICKETZONE:"1,2",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96054517607726,-37.71462095840933]}},{type:"Feature",properties:{STOP_ID:"19963",LATITUDE:-37.720934,STOP_NAME:"Merlynston Railway Station (Coburg North)",LONGITUDE:144.961314,TICKETZONE:"1,2",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96131413229386,-37.72093400681235]}},{type:"Feature",properties:{STOP_ID:"19964",LATITUDE:-37.733523,STOP_NAME:"Batman Railway Station (Coburg North)",LONGITUDE:144.962841,TICKETZONE:"1,2",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96284088444295,-37.7335230271606]}},{type:"Feature",properties:{STOP_ID:"19965",LATITUDE:-37.742345,STOP_NAME:"Coburg Railway Station (Coburg)",LONGITUDE:144.963336,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96333587826746,-37.74234500853543]}},{type:"Feature",properties:{STOP_ID:"19966",LATITUDE:-37.754485,STOP_NAME:"Moreland Railway Station (Coburg)",LONGITUDE:144.961823,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96182315245065,-37.7544850178849]}},{type:"Feature",properties:{STOP_ID:"19967",LATITUDE:-37.761242,STOP_NAME:"Anstey Railway Station (Brunswick)",LONGITUDE:144.960684,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.96068412503988,-37.761242037577134]}},{type:"Feature",properties:{STOP_ID:"19968",LATITUDE:-37.767721,STOP_NAME:"Brunswick Railway Station (Brunswick)",LONGITUDE:144.959587,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.95958686111737,-37.767720957795504]}},{type:"Feature",properties:{STOP_ID:"19969",LATITUDE:-37.774987,STOP_NAME:"Jewell Railway Station (Brunswick)",LONGITUDE:144.958717,TICKETZONE:"1",ROUTEUSSP:"Upfield"},geometry:{type:"Point",coordinates:[144.95871710696892,-37.7749870197818]}}],HV={type:$V,name:ZV,crs:XV,features:WV};let xa=HV.features;for(const t of xa)t.properties.nameUp=t.properties.STOP_NAME.replace(/ Railway Station.*$/,""),t.properties.nameUp==="Surrey Hills"?t.properties.nameUp="Union":t.properties.nameUp==="Glenhuntly"&&(t.properties.nameUp="Glen Huntly"),t.properties.lines=t.properties.ROUTEUSSP.toLowerCase().split(","),t.properties.name=t.properties.nameUp.toLowerCase();xa=xa.filter(t=>t.properties.name!=="mont albert");const nE=xa.map(t=>t.properties.name);window.s=xa;function KV(){const t=new Set;for(const e of xa)for(const r of e.properties.lines)t.add(r.toLowerCase());return[...t]}function $D(t,e){return Rn(xa.find(r=>r.properties.name===t),xa.find(r=>r.properties.name===e))}window.sd=$D;function ZD(t){const e=xa.filter(a=>a.properties.lines.includes(t));let r=e.find(a=>a.properties.name===t);if(!r)return[];let n=e.filter(a=>a.properties.name!==t);const i=[r];for(;n.length;)n.sort((a,h)=>Rn(a,r)-Rn(h,r)),r=n[0],i.push(r),n=n.filter(a=>a!==r);return i.map(a=>a.properties.name)}let Nf;function YV(){Nf=new wi.Graph;function t(n,i){Nf.addEdge(n,i),Nf.addEdge(i,n)}window.gr=Nf;const e=KV();for(const n of xa)Nf.addNode(n.properties.name);const r=["Flinders Street","Southern Cross","Flagstaff","Melbourne Central","Parliament"].map(n=>n.toLowerCase());r.forEach((n,i)=>t(n,r[(i+1)%r.length])),window.n=xa.map(n=>n.properties.name);for(const n of e){const i=ZD(n);for(let a=0;a<i.length-1;a++)try{if(r.includes(i[a])&&r.includes(i[a+1]))continue;t(i[a],i[a+1])}catch{}}}function XD(t,e){return Nf||YV(),qV(Nf,t,e)}function iE(t){return xa.find(e=>e.properties.name===t)}function JV(t,e,r){const n=iE(t).properties.lines;let i=n.find(m=>iE(e).properties.lines.includes(m));i||(i=n[0]);const a=ZD(i),h=a.indexOf(t);return a.slice(Math.max(h-2,0),h+3).map(m=>{const w=iE(m);if(t===w.properties.name)return w.properties.nameUp;if(r==3)return w.properties.nameUp.replace(/\b(\w)\w+/g,"$1").replace(/ /g,"");if(r===2)return w.properties.nameUp.split(" ").map(b=>b.replace(/\b(\w\w)(\w*)/g,(I,A,z)=>A+"_".repeat(z.length))).join(" ");if(r===1)return w.properties.nameUp.split(" ").map(b=>b.replace(/\b(\w\w)(\w*)(\w)\b/g,(I,A,z,V)=>A+"_".repeat(z.length)+V)).join(" ")}).join(", ")}const QV={class:"info-light3--bg",id:"map",style:{position:"absolute",width:"100%",height:"100%"}};function ej(t,e,r,n,i,a){return ho(),So("div",QV)}const tj=(t,e)=>{const r=t.__vccOpts||t;for(const[n,i]of e)r[n]=i;return r};window.turf=Z7;const rj={props:["guesses","target"],async mounted(){Sw.accessToken="pk.eyJ1Ijoic3RldmFnZSIsImEiOiJjbG1vZGE4cXgwbjY4MmptcHN1d2M4YWYyIn0.AFsAhFFbMnuo9e3NgICpFw";const t=new Sw.Map({container:"map",center:[144.96,-37.81],zoom:12,style:"mapbox://styles/mapbox/light-v9"});kf.init(t,Sw);const e=[...this.guesses,this.target].map(r=>xa.find(n=>n.properties.name===r));t.fitBounds(Fi(hr(e)),{padding:40}),window.map=t,window.mapping=this,t.U.onLoad(()=>{t.U.hide(/place-city/),t.U.addGeoJSON("trains","trainline.geojson"),t.U.addLine("trains-line","trains",{lineColor:"hsl(180,50%,70%)",lineWidth:5}),t.U.addLine("trains-line-inner","trains",{lineColor:"hsl(180,50%,85%)",lineWidth:3}),t.U.addSymbol("trains-label","trains",{symbolPlacement:"line",textField:["get","name"],textColor:"hsla(180,50%,50%, 50%)",textSize:28,textAllowOverlap:!0}),t.U.addGeoJSON("stations",hr(xa)),t.U.addCircle("stations-circle","stations",{circleColor:["case",["==",["get","name"],this.target],"hsl(120,50%,70%)",["case",["in",["get","name"],["literal",this.guesses]],"hsl(0,70%,70%)","hsla(180,50%,80%,0.7)"]],circleRadius:["case",["==",["get","name"],this.target],6,["case",["in",["get","name"],["literal",this.guesses]],6,2]],circleStrokeWidth:2,circleStrokeColor:["case",["==",["get","name"],this.target],"hsl(120,100%,30%)",["case",["in",["get","name"],["literal",this.guesses]],"hsl(0,100%,30%)","hsla(180,50%,60%,0.5)"]]}),t.U.addSymbol("stations-label","stations",{textSize:16,textOffset:[.5,0],textField:["get","nameUp"],textHaloColor:"hsla(0,0%,100%,0.5)",textHaloWidth:1,textAnchor:"left",filter:["in",["get","name"],["literal",[...this.guesses,this.target]]]}),t.U.addSymbol("stations-label-small","stations",{textSize:12,textField:["get","nameUp"],textColor:"hsl(0,0%,50%)",textHaloColor:"hsla(0,0%,100%,0.5)",textHaloWidth:1,textAnchor:"left",textOffset:[.5,0],filter:["!",["in",["get","name"],["literal",[...this.guesses,this.target]]]],minzoom:11})})}},nj=tj(rj,[["render",ej]]);var ij=function(t){var e=t%2147483647;e&&(e+=2147483646);function r(){return e=e*16807%2147483647}function n(){return(r()-1)/2147483646}return{seed:t,random:n,randomInt:r}};const oj=wa(ij),sj={class:"pa3 flex flex-column",style:{"font-family":"sans-serif",height:"100vh"}},aj={style:{"flex-grow":"1"}},lj={class:"tc"},uj={key:0},cj={key:1},hj=yi("p",null,"Guess the station on Melbourne's metro train network.",-1),fj=yi("p",null,"After each guess you will see how many stations away the target station is, and the straight-line distance.",-1),pj={key:0},dj={key:1},gj={class:"mt5"},mj=yi("span",{class:"db w4 gray"},"Station name",-1),yj=["disabled"],_j=["disabled"],vj={key:0,class:"red"},xj={class:"mt3"},wj={class:"pr4 mr1 pa1"},Ej={class:"pr4"},bj={key:2},Tj=yi("h2",null,"Hints",-1),Sj={class:"pa2"},Ij={class:"mr3 dib"},Pj={style:{"font-family":"Lucida Console,courier new,monospace"}},Cj={key:3},Aj={key:4},Mj=yi("span",null,"The station is",-1),Lj={key:5},Oj={key:6,class:"pa3 mv4 shadow-1",style:{border:"1px solid hsl(180,0%,70%)"}},Dj=["innerHTML"],Nj={key:7,class:"map-container",style:{width:"100%",height:"calc(max(50vh, 200px))",position:"relative"}},Rj=yi("footer",{class:"h1",style:{"flex-grow":"0"}},[Iy("Made by"),yi("a",{href:"https://hire.stevebennett.me"},"Steve Bennett"),Iy(".")],-1),kj={data:()=>({target:null,currentGuess:"",guesses:[],hints:[],alert:"",win:!1,fail:!1,gameNumber:0,hintsLeft:void 0,actions:[],hintsAllowed:3}),created(){window.app=this,this.restart()},mounted(){document.querySelector("#guess-input").addEventListener("keyup",t=>{t.key==="Enter"&&(this.guess(),t.preventDefault())}),document.querySelector("#guess-input").focus()},methods:{titleCase(t){return t.split(" ").map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")},guess(){function t(i){return i>20?"":i>5?"":""}const e=this.currentGuess.toLowerCase().trim();if(this.guesses.map(i=>i.station).includes(e)){this.alert="You already guessed that station";return}if(!nE.includes(e)){this.alert="Invalid station name";return}this.alert="";const r=XD(this.target,e),n=Math.round($D(this.target,e));if(this.guesses.push({station:e,result:r.length-1,distance:n}),this.actions.push(t(r.length-1)),e===this.target){this.win=!0,this.actions.push("");return}this.currentGuess="",this.updateCookie()},getGameNumber(){return window.location.search.match(/game=\d\d\d\d/)?window.location.search.match(/game=(\d+)/)[1]:this.isUnlimited()?Math.floor(Math.random()*1e5+1e3):this.daysSinceStart},isUnlimited(){return window.location.search.match(/unlimited/)},restart(){this.win=!1,this.fail=!1,this.hintsLeft=this.hintsAllowed,this.guesses=[],this.hints=[],this.actions=[],this.gameNumber=this.getGameNumber();const t=oj(this.gameNumber*47+9867);this.target=nE[Math.floor(t.random()*nE.length)],this.loadCookie()},giveup(){this.fail=!0,this.actions.push(""),this.updateCookie()},hint(){const t=JV(this.guesses.slice(-1)[0].station,this.target,this.hintsLeft);this.hintsLeft-=1,this.hints.push(t),this.actions.push(""),this.updateCookie()},copyWin(){navigator.clipboard.writeText(this.shareText)},updateCookie(){try{localStorage.setItem(this.gameNumber,JSON.stringify({guesses:this.guesses,hints:this.hints,actions:this.actions,hintsLeft:this.hintsLeft,win:this.win,fail:this.fail,gameNumber:this.gameNumber}))}catch(t){console.log(t)}},loadCookie(){try{const t=localStorage.getItem(this.gameNumber);if(t){const e=JSON.parse(t);this.guesses=e.guesses,this.hints=e.hints,this.actions=e.actions,this.hintsLeft=e.hintsLeft,this.win=e.win,this.fail=e.fail}}catch(t){console.log(t)}}},computed:{daysSinceStart(){const t=new Date;t.setHours(0,0,0,0);const e=new Date("2023-09-19");e.setHours(0,0,0,0);const r=t.getTime()-e.getTime();return Math.floor(r/(1e3*60*60*24))+1},shareText(){return`I ${this.win?"solved":"couldn't solve"} Trainle #${this.gameNumber} in ${this.guesses.length} guesses${this.hintsLeft<this.hintsAllowed?" with "+(this.hintsAllowed-this.hintsLeft)+" hints":""}.
${this.actions.join("")}
 stevage.github.io/trainle${this.gameNumber!==this.daysSinceStart?`?game=${this.gameNumber}`:""}`}},watch:{}},Fj=Object.assign(kj,{__name:"App",setup(t){return window.g=XD,(e,r)=>(ho(),So("div",sj,[yi("div",aj,[yi("h1",lj,[Iy(" Trainle"),e.isUnlimited()?(ho(),So("span",uj,"Unlimited")):(ho(),So("span",cj,"#"+ql(e.gameNumber)+" ",1))]),hj,fj,e.isUnlimited()?(ho(),So("p",pj,"Refresh the page to get a new target station.")):pc("",!0),!e.win&&!e.fail?(ho(),So("div",dj,[yi("label",gj,[mj,L4(yi("input",{class:"h3",id:"guess-input",type:"text","onUpdate:modelValue":r[0]||(r[0]=n=>e.currentGuess=n),placeholder:"Flinders Street",disabled:e.win||e.fail},null,8,yj),[[q5,e.currentGuess]])]),yi("button",{class:"ml1 h3 pa2",id:"guess",type:"submit",onClick:r[1]||(r[1]=(...n)=>e.guess&&e.guess(...n)),disabled:e.win||e.fail},"Guess",8,_j),yi("div",null,[e.alert?(ho(),So("span",vj,ql(e.alert),1)):pc("",!0)])])):pc("",!0),yi("div",xj,[yi("table",null,[(ho(!0),So(Xl,null,A2(e.guesses,n=>(ho(),So("tr",null,[yi("td",wj,ql(e.titleCase(n.station)),1),yi("td",Ej,ql(n.result)+" "+ql(n.result===1?"stop":"stops"),1),yi("td",null,ql(n.distance)+" km",1)]))),256))])]),e.hints.length?(ho(),So("div",bj,[Tj,(ho(!0),So(Xl,null,A2(e.hints,(n,i)=>(ho(),So("div",Sj,[yi("div",Ij,"Hint "+ql(i+1)+":",1),yi("span",Pj,ql(n),1)]))),256))])):pc("",!0),e.win?(ho(),So("div",Cj,[yi("h2",null,[Iy("Yes! The station is"),yi("span",null,ql(e.titleCase(e.target))+".",1)])])):e.fail?(ho(),So("div",Aj,[yi("h2",null,[Mj,yi("span",null,ql(e.titleCase(e.target))+".",1)])])):(ho(),So("div",Lj,[e.hintsLeft>0&&e.guesses.length?(ho(),So("button",{key:0,class:"db mt4 pa2",type:"submit",onClick:r[2]||(r[2]=(...n)=>e.hint&&e.hint(...n))},"Hint ("+ql(e.hintsLeft)+" left)",1)):pc("",!0),e.hintsLeft===0?(ho(),So("button",{key:1,class:"db mt4 pa2",type:"submit",onClick:r[3]||(r[3]=(...n)=>e.giveup&&e.giveup(...n))},"Give up")):pc("",!0)])),e.win||e.fail?(ho(),So("div",Oj,[yi("div",{innerHTML:e.shareText.replace(/\n/g,"<br>")},null,8,Dj),yi("button",{onClick:r[4]||(r[4]=(...n)=>e.copyWin&&e.copyWin(...n))},"Copy")])):pc("",!0),e.fail||e.win?(ho(),So("div",Nj,[Ru(nj,{guesses:e.guesses.map(n=>n.station),target:e.target},null,8,["guesses","target"])])):pc("",!0),e.isUnlimited()&&(e.fail||e.win)?(ho(),So("button",{key:8,id:"restart",type:"submit",onClick:r[5]||(r[5]=(...n)=>e.restart&&e.restart(...n))},"Play again")):pc("",!0)]),Rj]))}});X5(Fj).mount("#app");
